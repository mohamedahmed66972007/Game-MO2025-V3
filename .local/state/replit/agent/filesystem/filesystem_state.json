{"file_contents":{"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n      {children}\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4280,"size_tokens":null},"client/src/components/ui/LoseScreen.tsx":{"content":"import { Button } from \"./button\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { send } from \"@/lib/websocket\";\n\nexport function LoseScreen() {\n  const { mode, singleplayer, multiplayer, restartSingleplayer, setMode, setShowResults, setShowOpponentAttempts, resetMultiplayer, setChallengeStatus, setOpponentId, setOpponentName, setMySecretCode } = useNumberGame();\n  \n  const isSingleplayer = mode === \"singleplayer\";\n  const attempts = isSingleplayer ? singleplayer.attempts.length : multiplayer.attempts.length;\n  const timeElapsed = isSingleplayer\n    ? (singleplayer.endTime ? Math.floor((singleplayer.endTime - singleplayer.startTime) / 1000) : 0)\n    : (multiplayer.endTime ? Math.floor((multiplayer.endTime - multiplayer.startTime) / 1000) : 0);\n  const minutes = Math.floor(timeElapsed / 60);\n  const seconds = timeElapsed % 60;\n  const secretCode = isSingleplayer ? singleplayer.secretCode : multiplayer.opponentSecretCode;\n  const isMultiplayer = mode === \"multiplayer\";\n\n  const handleRematch = () => {\n    send({ type: \"request_rematch\", opponentId: multiplayer.opponentId });\n  };\n\n  const handleBackToLobby = () => {\n    if (isMultiplayer) {\n      // Reset game state but keep multiplayer session\n      setChallengeStatus(\"none\");\n      setOpponentId(null);\n      setOpponentName(\"\");\n      setMySecretCode([]);\n      setShowResults(false);\n      resetMultiplayer();\n    } else {\n      setShowResults(false);\n      setMode(\"menu\");\n      setTimeout(() => {\n        window.location.reload();\n      }, 300);\n    }\n  };\n\n  const handleShowOpponentAttempts = () => {\n    setShowOpponentAttempts(true);\n  };\n\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-red-50 via-white to-orange-50 z-50\">\n      <div className=\"w-full max-w-md mx-4 bg-white rounded-2xl shadow-2xl p-8 text-center space-y-6\">\n        <div className=\"text-6xl\">ğŸ˜¢</div>\n        \n        <div>\n          <h2 className=\"text-4xl font-bold text-gray-800 mb-2\">\n            Ù„Ù‚Ø¯ Ø®Ø³Ø±Øª\n          </h2>\n          {isMultiplayer && (\n            <p className=\"text-gray-600\">Ø§Ù„Ø®ØµÙ… Ø®Ù…Ù† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ÙÙŠ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø£Ù‚Ù„</p>\n          )}\n        </div>\n\n        <div className=\"bg-gradient-to-br from-red-50 to-orange-50 p-6 rounded-xl space-y-3 border border-red-200\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-gray-700 font-semibold\">Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ:</span>\n            <span className=\"text-2xl font-bold text-red-600\">{attempts}</span>\n          </div>\n          \n          {isMultiplayer && multiplayer.opponentAttempts && (\n            <div className=\"flex justify-between items-center border-t border-red-200 pt-3\">\n              <span className=\"text-gray-700 font-semibold\">Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø®ØµÙ…:</span>\n              <span className=\"text-2xl font-bold text-orange-600\">{multiplayer.opponentAttempts.length}</span>\n            </div>\n          )}\n\n          <div className=\"flex justify-between items-center border-t border-red-200 pt-3\">\n            <span className=\"text-gray-700 font-semibold\">Ø§Ù„ÙˆÙ‚Øª:</span>\n            <span className=\"text-2xl font-bold text-pink-600\">\n              {minutes > 0 ? `${minutes}:${seconds.toString().padStart(2, \"0\")}` : `${seconds}Ø«`}\n            </span>\n          </div>\n\n          {secretCode.length > 0 && (\n            <div className=\"flex justify-between items-center border-t border-red-200 pt-3\">\n              <span className=\"text-gray-700 font-semibold\">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ:</span>\n              <span className=\"text-2xl font-mono font-bold text-red-600\">{secretCode.join(\"\")}</span>\n            </div>\n          )}\n        </div>\n\n        <div className=\"space-y-2 pt-4\">\n          {isMultiplayer ? (\n            <>\n              <Button\n                onClick={handleShowOpponentAttempts}\n                className=\"w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 rounded-xl\"\n              >\n                Ø¹Ø±Ø¶ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø®ØµÙ…\n              </Button>\n              <Button\n                onClick={handleRematch}\n                className=\"w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-xl\"\n              >\n                Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©\n              </Button>\n              <Button\n                onClick={handleBackToLobby}\n                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl\"\n              >\n                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØºØ±ÙØ©\n              </Button>\n            </>\n          ) : (\n            <>\n              <Button\n                onClick={restartSingleplayer}\n                className=\"w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-xl\"\n              >\n                Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\n              </Button>\n              <Button\n                onClick={() => {\n                  setMode(\"menu\");\n                  setTimeout(() => {\n                    window.location.reload();\n                  }, 300);\n                }}\n                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl\"\n              >\n                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\n              </Button>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":5391,"size_tokens":null},"client/src/components/mobile/MobileMenu.tsx":{"content":"import { useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { Gamepad2, Users, WifiOff } from \"lucide-react\";\nimport { GameSettings } from \"../ui/GameSettings\";\nimport { useOnlineStatus } from \"@/hooks/use-online-status\";\nimport { OfflineDialog } from \"../ui/OfflineDialog\";\n\nexport function MobileMenu() {\n  const navigate = useNavigate();\n  const { startSingleplayer } = useNumberGame();\n  const [showSettings, setShowSettings] = useState(false);\n  const [showOfflineDialog, setShowOfflineDialog] = useState(false);\n  const isOnline = useOnlineStatus();\n\n  const handleSingleplayer = () => {\n    setShowSettings(true);\n  };\n\n  const handleSettingsConfirm = (settings: { numDigits: number; maxAttempts: number }) => {\n    startSingleplayer(settings);\n    setShowSettings(false);\n    navigate(\"/singleplayer\");\n  };\n\n  if (showSettings) {\n    return <GameSettings onConfirm={handleSettingsConfirm} isMultiplayer={false} />;\n  }\n\n  const handleMultiplayer = () => {\n    if (!isOnline) {\n      setShowOfflineDialog(true);\n      return;\n    }\n    navigate(\"/multiplayer\");\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col items-center justify-center p-6\">\n      <OfflineDialog isOpen={showOfflineDialog} onClose={() => setShowOfflineDialog(false)} />\n      \n      <div className=\"w-full max-w-md space-y-8\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl shadow-lg\">\n            <Gamepad2 className=\"w-10 h-10 text-white\" />\n          </div>\n          \n          <h1 className=\"text-4xl font-bold text-gray-800\">\n            Ù„Ø¹Ø¨Ø© Ø§Ù„ØªØ®Ù…ÙŠÙ†\n          </h1>\n          \n          <div className=\"space-y-2 text-gray-600\">\n            <p className=\"text-lg\">Ø®Ù…Ù† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 4 Ø£Ø±Ù‚Ø§Ù…</p>\n          </div>\n        </div>\n\n        <div className=\"space-y-4\">\n          <button\n            onClick={handleSingleplayer}\n            className=\"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition-all duration-200 hover:shadow-xl hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-3\"\n          >\n            <Gamepad2 className=\"w-6 h-6\" />\n            <span className=\"text-lg\">Ù„Ø¹Ø¨ ÙØ±Ø¯ÙŠ</span>\n          </button>\n\n          <button\n            onClick={handleMultiplayer}\n            className={`w-full ${isOnline \n              ? 'bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700' \n              : 'bg-gradient-to-r from-gray-400 to-gray-500'\n            } text-white font-bold py-4 px-6 rounded-xl shadow-lg transition-all duration-200 hover:shadow-xl hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-3 relative`}\n          >\n            {!isOnline && <WifiOff className=\"w-5 h-5 absolute left-4\" />}\n            <Users className=\"w-6 h-6\" />\n            <span className=\"text-lg\">Ù„Ø¹Ø¨ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</span>\n          </button>\n        </div>\n\n        <div className=\"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-md space-y-3\">\n          <h3 className=\"font-bold text-gray-800 flex items-center gap-2\">\n            <span>ğŸ“–</span>\n            <span>ÙƒÙŠÙ ØªÙ„Ø¹Ø¨:</span>\n          </h3>\n          <ul className=\"space-y-2 text-sm text-gray-700 text-right\">\n            <li>1. <strong>Ø§Ø®ØªØ± Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø³Ø±ÙŠ:</strong> 4 Ø£Ø±Ù‚Ø§Ù… ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„Ø®ØµÙ… ØªØ®Ù…ÙŠÙ†Ù‡Ø§</li>\n            <li>2. <strong>Ø®Ù…Ù† Ø§Ù„Ø±Ù‚Ù…:</strong> Ø£Ø¯Ø®Ù„ 4 Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ø§Ø®ØªÙŠØ§Ø±Ùƒ</li>\n            <li>3. <strong>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> Ø±Ù‚Ù… Ø£Ø²Ø±Ù‚ = ØµØ­ Ø¨Ø£ÙŠ Ù…ÙˆØ¶Ø¹ØŒ Ø±Ù‚Ù… Ø£Ø®Ø¶Ø± = ØµØ­ Ø¨Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„ØµØ­ÙŠØ­</li>\n            <li>4. Ù…Ù† ÙŠØ®Ù…Ù† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø£ÙˆÙ„Ø§Ù‹ ÙŠÙÙˆØ²!</li>\n            <li>5. ÙŠÙ…ÙƒÙ† ØªØ®ØµÙŠØµ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙÙŠ ÙƒÙ„ Ø¬ÙˆÙ„Ø©</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":4173,"size_tokens":null},"client/src/components/ui/WaitingForOpponentScreen.tsx":{"content":"import { useNumberGame } from \"@/lib/stores/useNumberGame\";\n\nexport function WaitingForOpponentScreen() {\n  const { multiplayer } = useNumberGame();\n\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50 z-50\">\n      <div className=\"text-center space-y-8\">\n        <div className=\"flex justify-center\">\n          <div className=\"relative w-24 h-24\">\n            {/* Outer rotating circle */}\n            <div className=\"absolute inset-0 rounded-full border-4 border-transparent border-t-blue-500 border-r-purple-500 animate-spin\"></div>\n            \n            {/* Inner waiting circle */}\n            <div className=\"absolute inset-2 rounded-full border-4 border-blue-200 flex items-center justify-center\">\n              <span className=\"text-5xl animate-pulse\">â³</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"space-y-3\">\n          <h2 className=\"text-4xl font-bold text-gray-800\">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h2>\n          <p className=\"text-xl text-gray-600\">\n            ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± <span className=\"font-bold text-blue-600\">{multiplayer.opponentName}</span>\n          </p>\n          <p className=\"text-gray-500 text-sm\">\n            ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø®ØµÙ… Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù…Ù‡ Ø§Ù„Ø³Ø±ÙŠ...\n          </p>\n        </div>\n\n        <div className=\"flex justify-center gap-2 pt-4\">\n          <div className=\"w-3 h-3 bg-blue-500 rounded-full animate-bounce\" style={{ animationDelay: \"0s\" }}></div>\n          <div className=\"w-3 h-3 bg-purple-500 rounded-full animate-bounce\" style={{ animationDelay: \"0.2s\" }}></div>\n          <div className=\"w-3 h-3 bg-pink-500 rounded-full animate-bounce\" style={{ animationDelay: \"0.4s\" }}></div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":1801,"size_tokens":null},"client/src/components/mobile/MobileSingleplayer.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { useAudio } from \"@/lib/stores/useAudio\";\nimport { Home, Check, X, Maximize2, Minimize2, Lightbulb } from \"lucide-react\";\nimport { useChallenges } from \"@/lib/stores/useChallenges\";\n\nexport function MobileSingleplayer({ onStartChallenge }: { onStartChallenge?: () => void }) {\n  const navigate = useNavigate();\n  const {\n    singleplayer,\n    setMode,\n    restartSingleplayer,\n  } = useNumberGame();\n  const hint = useChallenges((state) => state.hint);\n  const { hasWonAnyChallenge, generateHint } = useChallenges();\n  const hasWonChallenge = hasWonAnyChallenge();\n  \n  const { playDigit, playDelete, playError, successSound } = useAudio();\n  const numDigits = singleplayer.settings.numDigits;\n  const [input, setInput] = useState<string[]>(Array(numDigits).fill(\"\"));\n  const [focusedIndex, setFocusedIndex] = useState(0);\n  const [expandedAttempts, setExpandedAttempts] = useState(false);\n  const [showHint, setShowHint] = useState(false);\n  const [expandedAttemptIndex, setExpandedAttemptIndex] = useState(singleplayer.attempts.length - 1);\n\n  useEffect(() => {\n    if (!singleplayer.secretCode || singleplayer.secretCode.length === 0) {\n      restartSingleplayer();\n    }\n  }, [singleplayer.secretCode, restartSingleplayer]);\n\n  useEffect(() => {\n    setInput(Array(numDigits).fill(\"\"));\n    setFocusedIndex(0);\n  }, [numDigits]);\n\n  useEffect(() => {\n    if (singleplayer.phase === \"won\" && singleplayer.secretCode) {\n      if (!hint) {\n        generateHint(singleplayer.secretCode);\n      }\n    }\n  }, [singleplayer.phase, singleplayer.secretCode, hint, generateHint]);\n\n  const handleNumberInput = (num: string) => {\n    if (focusedIndex >= numDigits) return;\n    \n    playDigit(parseInt(num));\n    const newInput = [...input];\n    newInput[focusedIndex] = num;\n    setInput(newInput);\n    \n    if (focusedIndex < numDigits - 1) {\n      setFocusedIndex(focusedIndex + 1);\n    }\n  };\n\n  const handleBackspace = () => {\n    playDelete();\n    if (focusedIndex > 0) {\n      const newInput = [...input];\n      if (input[focusedIndex] === \"\") {\n        newInput[focusedIndex - 1] = \"\";\n        setFocusedIndex(focusedIndex - 1);\n      } else {\n        newInput[focusedIndex] = \"\";\n      }\n      setInput(newInput);\n    } else if (input[0] !== \"\") {\n      const newInput = [...input];\n      newInput[0] = \"\";\n      setInput(newInput);\n    }\n  };\n\n  const handleSubmit = () => {\n    if (input.some(val => val === \"\")) {\n      return;\n    }\n\n    const guess = input.map(Number);\n    let correctCount = 0;\n    let correctPositionCount = 0;\n\n    const secretCopy = [...singleplayer.secretCode];\n    const guessCopy = [...guess];\n    const numDigits = singleplayer.settings.numDigits;\n\n    for (let i = 0; i < numDigits; i++) {\n      if (guessCopy[i] === secretCopy[i]) {\n        correctPositionCount++;\n        secretCopy[i] = -1;\n        guessCopy[i] = -2;\n      }\n    }\n\n    for (let i = 0; i < numDigits; i++) {\n      if (guessCopy[i] !== -2) {\n        const index = secretCopy.indexOf(guessCopy[i]);\n        if (index !== -1) {\n          correctCount++;\n          secretCopy[index] = -1;\n        }\n      }\n    }\n\n    correctCount += correctPositionCount;\n\n    useNumberGame.setState((state) => ({\n      singleplayer: {\n        ...state.singleplayer,\n        attempts: [...state.singleplayer.attempts, { guess, correctCount, correctPositionCount }],\n      },\n    }));\n\n    if (correctPositionCount === numDigits) {\n      if (successSound) {\n        successSound.currentTime = 0;\n        successSound.play();\n      }\n      useNumberGame.setState((state) => ({\n        singleplayer: {\n          ...state.singleplayer,\n          phase: \"won\",\n        },\n      }));\n    } else if (singleplayer.attempts.length >= singleplayer.settings.maxAttempts - 1) {\n      useNumberGame.setState((state) => ({\n        singleplayer: {\n          ...state.singleplayer,\n          phase: \"lost\",\n        },\n      }));\n    }\n\n    setInput(Array(numDigits).fill(\"\"));\n    setFocusedIndex(0);\n  };\n\n  const handleHome = () => {\n    const { resetToMenu } = useChallenges.getState();\n    resetToMenu();\n    restartSingleplayer();\n    setMode(\"menu\");\n    navigate(\"/\");\n  };\n\n\n  const hintText = hint\n    ? hint.type === \"digit\"\n      ? `Ø§Ù„Ø®Ø§Ù†Ø© ${(hint.position || 0) + 1}: ${hint.value}`\n      : String(hint.value)\n    : \"\";\n\n  if (singleplayer.phase === \"won\") {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-6\">\n        <div className=\"w-full max-w-md bg-white rounded-2xl shadow-2xl p-8 text-center space-y-6\">\n          <div className=\"text-6xl\">ğŸ‰</div>\n          <h2 className=\"text-3xl font-bold text-green-600\">Ù…Ø¨Ø±ÙˆÙƒ! ÙØ²Øª</h2>\n          <p className=\"text-gray-600 text-lg\">\n            Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª: <span className=\"font-bold text-blue-600\">{singleplayer.attempts.length}</span>\n          </p>\n          <p className=\"text-gray-700\">\n            Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ÙƒØ§Ù†: <span className=\"font-mono text-xl font-bold text-purple-600\">{singleplayer.secretCode.join(\"\")}</span>\n          </p>\n          {hint && (\n            <div className=\"bg-gradient-to-r from-yellow-400 to-amber-500 rounded-xl p-4 shadow-lg\">\n              <h3 className=\"text-white font-bold text-lg mb-2 flex items-center gap-2 justify-center\">\n                <Lightbulb className=\"w-5 h-5\" />\n                Ø§Ù„ØªÙ„Ù…ÙŠØ­:\n              </h3>\n              <p className=\"text-white text-base font-bold\">{hintText}</p>\n            </div>\n          )}\n          <div className=\"space-y-3\">\n            {!hint && onStartChallenge ? (\n              <button\n                onClick={onStartChallenge}\n                className=\"w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-xl transition-colors flex items-center gap-2 justify-center\"\n              >\n                <Lightbulb className=\"w-5 h-5\" />\n                Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªÙ„Ù…ÙŠØ­\n              </button>\n            ) : hint ? (\n              <div className=\"w-full bg-green-100 border-2 border-green-500 text-green-800 font-bold py-3 px-6 rounded-xl flex items-center gap-2 justify-center\">\n                <span>âœ“</span>\n                <span>ØªÙ… Ø§ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠ</span>\n              </div>\n            ) : null}\n            <button\n              onClick={handleHome}\n              className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors\"\n            >\n              Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (singleplayer.phase === \"lost\") {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-6\">\n        <div className=\"w-full max-w-md bg-white rounded-2xl shadow-2xl p-8 text-center space-y-6\">\n          <div className=\"text-6xl\">ğŸ˜¢</div>\n          <h2 className=\"text-3xl font-bold text-red-600\">Ø®Ø³Ø±Øª!</h2>\n          <p className=\"text-gray-700\">\n            Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ÙƒØ§Ù†: <span className=\"font-mono text-xl font-bold text-purple-600\">{singleplayer.secretCode.join(\"\")}</span>\n          </p>\n          <div className=\"space-y-3\">\n            <button\n              onClick={restartSingleplayer}\n              className=\"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-xl transition-colors\"\n            >\n              Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\n            </button>\n            <button\n              onClick={handleHome}\n              className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors\"\n            >\n              Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const attemptsLeft = singleplayer.settings.maxAttempts - singleplayer.attempts.length;\n\n  return (\n    <div className=\"min-h-screen p-4 pb-safe flex flex-col overflow-y-auto overflow-x-hidden touch-pan-y\" style={{ WebkitOverflowScrolling: 'touch' }}>\n      <div className=\"max-w-2xl mx-auto w-full space-y-4 flex-1 flex flex-col\">\n        <div className=\"flex flex-row-reverse items-center justify-between bg-white rounded-xl p-4 shadow-md flex-shrink-0\">\n          <button\n            onClick={handleHome}\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n          >\n            <Home className=\"w-6 h-6 text-gray-700\" />\n          </button>\n          <div className=\"text-right\">\n            <p className=\"text-sm text-gray-600\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† {singleplayer.settings.maxAttempts}</p>\n            <p className=\"text-2xl font-bold text-blue-600\">{attemptsLeft}</p>\n          </div>\n        </div>\n\n\n        {/* Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠ Ø£Ùˆ Ù…Ø±Ø¨Ø¹ Ø§Ù„ØªÙ„Ù…ÙŠØ­ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ */}\n        {onStartChallenge && (\n          !hint ? (\n            <button\n              onClick={onStartChallenge}\n              className=\"w-full flex items-center gap-2 justify-center bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-xl transition-colors shadow-md flex-shrink-0\"\n            >\n              <Lightbulb className=\"w-6 h-6\" />\n              <span className=\"text-lg\">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªÙ„Ù…ÙŠØ­</span>\n            </button>\n          ) : (\n            <div className=\"w-full bg-gradient-to-r from-yellow-400 to-amber-500 rounded-xl p-4 shadow-md flex-shrink-0\">\n              <h3 className=\"text-white font-bold text-lg mb-2 flex items-center gap-2\">\n                <Lightbulb className=\"w-5 h-5\" />\n                Ø§Ù„ØªÙ„Ù…ÙŠØ­:\n              </h3>\n              <p className=\"text-white text-base font-bold\">{hint.type === \"digit\" ? `ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø© ${(hint.position || 0) + 1}: Ø±Ù‚Ù… ${hint.value}` : String(hint.value)}</p>\n            </div>\n          )\n        )}\n\n        <div className=\"bg-white rounded-xl p-4 shadow-md flex-shrink-0\">\n          <h3 className=\"text-base font-bold text-gray-800 mb-3 text-center\">Ø£Ø¯Ø®Ù„ {numDigits} Ø£Ø±Ù‚Ø§Ù…</h3>\n          \n          <div className=\"flex gap-2 justify-center mb-4\" dir=\"ltr\">\n            {input.map((digit, idx) => (\n              <div\n                key={idx}\n                className={`w-12 h-14 border-2 rounded-xl flex items-center justify-center text-2xl font-bold transition-all ${\n                  focusedIndex === idx\n                    ? \"border-blue-500 bg-blue-50\"\n                    : \"border-gray-300 bg-white\"\n                }`}\n              >\n                {digit}\n              </div>\n            ))}\n          </div>\n\n          <div className=\"grid grid-cols-3 gap-2 max-w-[280px] mx-auto\" dir=\"ltr\">\n            {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (\n              <button\n                key={num}\n                onClick={() => handleNumberInput(num.toString())}\n                className=\"h-14 bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-xl font-bold rounded-xl shadow-md active:scale-95 transition-all\"\n              >\n                {num}\n              </button>\n            ))}\n            <button\n              onClick={handleBackspace}\n              className=\"h-14 bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold rounded-xl shadow-md active:scale-95 transition-all flex items-center justify-center\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n            <button\n              onClick={() => handleNumberInput(\"0\")}\n              className=\"h-14 bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-xl font-bold rounded-xl shadow-md active:scale-95 transition-all\"\n            >\n              0\n            </button>\n            <button\n              onClick={handleSubmit}\n              disabled={input.some(val => val === \"\")}\n              className=\"h-14 bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white font-bold rounded-xl shadow-md active:scale-95 transition-all flex items-center justify-center\"\n            >\n              <Check className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl p-4 shadow-md flex-shrink-0\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h3 className=\"text-lg font-bold text-gray-800\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ({singleplayer.attempts.length} / {singleplayer.settings.maxAttempts})</h3>\n            {singleplayer.attempts.length > 3 && (\n              <button\n                onClick={() => setExpandedAttempts(true)}\n                className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n              >\n                <Maximize2 className=\"w-5 h-5 text-gray-600\" />\n              </button>\n            )}\n          </div>\n          <div className=\"space-y-2 max-h-[200px] overflow-y-auto\">\n            {singleplayer.attempts.length === 0 ? (\n              <p className=\"text-gray-500 text-center py-4\">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¨Ø¹Ø¯</p>\n            ) : (\n              [...singleplayer.attempts].reverse().map((attempt, idx) => (\n                <div\n                  key={idx}\n                  className=\"flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-green-50 rounded-xl border border-gray-200 flex-row-reverse\"\n                >\n                  <span className=\"font-mono text-lg font-bold text-gray-800\">\n                    {attempt.guess.join(\"\")}\n                  </span>\n                  <div className=\"flex gap-2 text-xs\">\n                    <span className=\"bg-blue-100 text-blue-800 px-2 py-1 rounded-lg font-semibold\">\n                      {attempt.correctCount} ØµØ­\n                    </span>\n                    <span className=\"bg-green-100 text-green-800 px-2 py-1 rounded-lg font-semibold\">\n                      {attempt.correctPositionCount} Ù…ÙƒØ§Ù†\n                    </span>\n                  </div>\n                </div>\n              ))\n            )}\n          </div>\n        </div>\n\n        {expandedAttempts && (\n          <div className=\"fixed inset-0 bg-black/50 flex items-end z-50 p-4\">\n            <div className=\"w-full bg-white rounded-2xl shadow-2xl flex flex-col max-h-[90vh]\">\n              <div className=\"flex items-center justify-between p-4 border-b flex-shrink-0\">\n                <h3 className=\"text-2xl font-bold text-gray-800\">Ù…Ø­Ø§ÙˆÙ„Ø§Øª ({singleplayer.attempts.length} / {singleplayer.settings.maxAttempts})</h3>\n                <button\n                  onClick={() => setExpandedAttempts(false)}\n                  className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                >\n                  <Minimize2 className=\"w-6 h-6 text-gray-600\" />\n                </button>\n              </div>\n              <div className=\"overflow-y-scroll flex-1 p-4\">\n                <div className=\"space-y-3\">\n                  {[...singleplayer.attempts].reverse().map((attempt, idx) => (\n                    <div\n                      key={idx}\n                      className=\"flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-xl border border-gray-200 flex-row-reverse\"\n                    >\n                      <span className=\"font-mono text-2xl font-bold text-gray-800\">\n                        {attempt.guess.join(\"\")}\n                      </span>\n                      <div className=\"flex gap-3\">\n                        <div className=\"flex flex-col items-center\">\n                          <span className=\"text-2xl font-bold text-blue-600\">{attempt.correctCount}</span>\n                          <span className=\"text-xs text-blue-600\">ØµØ­</span>\n                        </div>\n                        <div className=\"flex flex-col items-center\">\n                          <span className=\"text-2xl font-bold text-green-600\">{attempt.correctPositionCount}</span>\n                          <span className=\"text-xs text-green-600\">Ù…ÙƒØ§Ù†Ù‡Ù…</span>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n              <button\n                onClick={() => setExpandedAttempts(false)}\n                className=\"bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 m-4 rounded-xl transition-colors flex-shrink-0\"\n              >\n                Ø¥ØºÙ„Ø§Ù‚\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":16715,"size_tokens":null},"client/src/components/ui/GameHUD.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { useCards } from \"@/lib/stores/useCards\";\n\nexport function GameHUD() {\n  const { mode, singleplayer, multiplayer } = useNumberGame();\n  const { cardSettings } = useCards();\n  const [currentTime, setCurrentTime] = useState(Date.now());\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setCurrentTime(Date.now());\n    }, 100);\n    return () => clearInterval(interval);\n  }, []);\n\n  const getRemainingTime = () => {\n    if (multiplayer.gameStatus === \"playing\" && multiplayer.startTime > 0) {\n      const elapsed = currentTime - multiplayer.startTime;\n      const totalDuration = cardSettings.roundDuration * 60 * 1000;\n      const remaining = totalDuration - elapsed;\n      return Math.max(0, remaining);\n    }\n    return cardSettings.roundDuration * 60 * 1000;\n  };\n\n  const formatTime = (ms: number) => {\n    const totalSeconds = Math.floor(ms / 1000);\n    const minutes = Math.floor(totalSeconds / 60);\n    const seconds = totalSeconds % 60;\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n  };\n\n  const isTimeWarning = () => {\n    const remaining = getRemainingTime();\n    return remaining <= 30000;\n  };\n\n  if (mode === \"singleplayer\") {\n    return (\n      <div className=\"fixed top-4 left-4 bg-black bg-opacity-70 text-white p-4 rounded-lg z-40\">\n        <div className=\"space-y-2\">\n          <p className=\"text-sm text-gray-300\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª: {singleplayer.attempts.length}/{singleplayer.settings.maxAttempts}</p>\n          <p className=\"text-xs text-gray-400\">Ø§Ø¶ØºØ· ESC Ù„Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù‚ÙÙ„</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (mode === \"multiplayer\") {\n    return (\n      <div className=\"fixed top-4 left-4 bg-black bg-opacity-70 text-white p-4 rounded-lg z-40\">\n        <div className=\"space-y-2\">\n          <p className=\"text-sm font-semibold text-blue-300\">\n            Ù„Ø¹Ø¨Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©\n          </p>\n          <p className=\"text-sm text-gray-300\">\n            Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ: {multiplayer.attempts.length}/{multiplayer.settings.maxAttempts}\n          </p>\n          {multiplayer.gameStatus === \"playing\" && multiplayer.startTime > 0 && (\n            <p className={`text-sm ${isTimeWarning() ? 'text-red-400 animate-pulse' : 'text-yellow-400'}`}>\n              Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: {formatTime(getRemainingTime())}\n            </p>\n          )}\n          <p className=\"text-xs text-gray-400\">Ø§Ø¶ØºØ· ESC Ù„Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù‚ÙÙ„</p>\n        </div>\n      </div>\n    );\n  }\n\n  return null;\n}\n","path":null,"size_bytes":2587,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":2001,"size_tokens":null},"client/src/lib/stores/useGame.tsx":{"content":"import { create } from \"zustand\";\nimport { subscribeWithSelector } from \"zustand/middleware\";\n\nexport type GamePhase = \"ready\" | \"playing\" | \"ended\";\n\ninterface GameState {\n  phase: GamePhase;\n  \n  // Actions\n  start: () => void;\n  restart: () => void;\n  end: () => void;\n}\n\nexport const useGame = create<GameState>()(\n  subscribeWithSelector((set) => ({\n    phase: \"ready\",\n    \n    start: () => {\n      set((state) => {\n        // Only transition from ready to playing\n        if (state.phase === \"ready\") {\n          return { phase: \"playing\" };\n        }\n        return {};\n      });\n    },\n    \n    restart: () => {\n      set(() => ({ phase: \"ready\" }));\n    },\n    \n    end: () => {\n      set((state) => {\n        // Only transition from playing to ended\n        if (state.phase === \"playing\") {\n          return { phase: \"ended\" };\n        }\n        return {};\n      });\n    }\n  }))\n);\n","path":null,"size_bytes":893,"size_tokens":null},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\n// Database is optional - game logic uses in-memory storage\nlet pool: Pool | null = null;\nlet db: ReturnType<typeof drizzle> | null = null;\n\nif (process.env.DATABASE_URL) {\n  pool = new Pool({ connectionString: process.env.DATABASE_URL });\n  db = drizzle({ client: pool, schema });\n  console.log(\"Database connected\");\n} else {\n  console.log(\"DATABASE_URL not set - using in-memory storage for game state\");\n}\n\nexport { pool, db };\n","path":null,"size_bytes":651,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute right-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5639,"size_tokens":null},"server/storage.ts":{"content":"import { \n  users, accounts, friendRequests, friendships, notifications,\n  type User, type InsertUser, type Account, type InsertAccount,\n  type FriendRequest, type InsertFriendRequest, type Notification, type InsertNotification\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, or, and, like, desc } from \"drizzle-orm\";\n\nexport interface IStorage {\n  getUser(id: number): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  \n  getAccount(id: number): Promise<Account | undefined>;\n  getAccountByUsername(username: string): Promise<Account | undefined>;\n  createAccount(account: InsertAccount): Promise<Account>;\n  updateAccountOnline(id: number, isOnline: boolean, roomId?: string): Promise<void>;\n  searchAccounts(query: string): Promise<Account[]>;\n  \n  getFriends(userId: number): Promise<Account[]>;\n  areFriends(userId1: number, userId2: number): Promise<boolean>;\n  createFriendship(userId1: number, userId2: number): Promise<void>;\n  removeFriendship(userId1: number, userId2: number): Promise<void>;\n  \n  getPendingFriendRequests(userId: number): Promise<(FriendRequest & { fromUser: Account })[]>;\n  getSentFriendRequests(userId: number): Promise<(FriendRequest & { toUser: Account })[]>;\n  createFriendRequest(request: InsertFriendRequest): Promise<FriendRequest>;\n  updateFriendRequestStatus(requestId: number, status: string): Promise<void>;\n  deleteFriendRequest(requestId: number): Promise<void>;\n  \n  getNotifications(userId: number, limit?: number): Promise<Notification[]>;\n  getUnreadNotificationsCount(userId: number): Promise<number>;\n  createNotification(notification: InsertNotification): Promise<Notification>;\n  markNotificationAsRead(notificationId: number): Promise<void>;\n  markAllNotificationsAsRead(userId: number): Promise<void>;\n  deleteNotification(notificationId: number): Promise<void>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<number, User>;\n  private accountsMap: Map<number, Account>;\n  private friendshipsMap: Map<number, { userId1: number; userId2: number }>;\n  private friendRequestsMap: Map<number, FriendRequest>;\n  private notificationsMap: Map<number, Notification>;\n  currentId: number;\n  accountId: number;\n  friendshipId: number;\n  friendRequestId: number;\n  notificationId: number;\n\n  constructor() {\n    this.users = new Map();\n    this.accountsMap = new Map();\n    this.friendshipsMap = new Map();\n    this.friendRequestsMap = new Map();\n    this.notificationsMap = new Map();\n    this.currentId = 1;\n    this.accountId = 1;\n    this.friendshipId = 1;\n    this.friendRequestId = 1;\n    this.notificationId = 1;\n  }\n\n  async getUser(id: number): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(\n      (user) => user.username === username,\n    );\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = this.currentId++;\n    const user: User = { ...insertUser, id };\n    this.users.set(id, user);\n    return user;\n  }\n\n  async getAccount(id: number): Promise<Account | undefined> {\n    if (db) {\n      const result = await db.select().from(accounts).where(eq(accounts.id, id)).limit(1);\n      return result[0];\n    }\n    return this.accountsMap.get(id);\n  }\n\n  async getAccountByUsername(username: string): Promise<Account | undefined> {\n    if (db) {\n      const result = await db.select().from(accounts).where(eq(accounts.username, username.toLowerCase())).limit(1);\n      return result[0];\n    }\n    return Array.from(this.accountsMap.values()).find(\n      (account) => account.username.toLowerCase() === username.toLowerCase(),\n    );\n  }\n\n  async createAccount(insertAccount: InsertAccount): Promise<Account> {\n    if (db) {\n      const result = await db.insert(accounts).values({\n        displayName: insertAccount.displayName,\n        username: insertAccount.username.toLowerCase(),\n      }).returning();\n      return result[0];\n    }\n    const id = this.accountId++;\n    const account: Account = { \n      ...insertAccount, \n      id, \n      username: insertAccount.username.toLowerCase(),\n      createdAt: new Date(),\n      lastSeen: new Date(),\n      isOnline: false,\n      currentRoomId: null,\n    };\n    this.accountsMap.set(id, account);\n    return account;\n  }\n\n  async updateAccountOnline(id: number, isOnline: boolean, roomId?: string): Promise<void> {\n    if (db) {\n      await db.update(accounts)\n        .set({ \n          isOnline, \n          lastSeen: new Date(),\n          currentRoomId: roomId || null\n        })\n        .where(eq(accounts.id, id));\n      return;\n    }\n    const account = this.accountsMap.get(id);\n    if (account) {\n      account.isOnline = isOnline;\n      account.lastSeen = new Date();\n      account.currentRoomId = roomId || null;\n    }\n  }\n\n  async searchAccounts(query: string): Promise<Account[]> {\n    if (db) {\n      const result = await db.select().from(accounts)\n        .where(or(\n          like(accounts.username, `%${query.toLowerCase()}%`),\n          like(accounts.displayName, `%${query}%`)\n        ))\n        .limit(20);\n      return result;\n    }\n    const lowerQuery = query.toLowerCase();\n    return Array.from(this.accountsMap.values()).filter(\n      (account) => \n        account.username.toLowerCase().includes(lowerQuery) ||\n        account.displayName.toLowerCase().includes(lowerQuery)\n    ).slice(0, 20);\n  }\n\n  async getFriends(userId: number): Promise<Account[]> {\n    if (db) {\n      const result = await db.select().from(friendships)\n        .where(or(\n          eq(friendships.userId1, userId),\n          eq(friendships.userId2, userId)\n        ));\n      \n      const friendIds = result.map(f => f.userId1 === userId ? f.userId2 : f.userId1);\n      if (friendIds.length === 0) return [];\n      \n      const friends = await db.select().from(accounts)\n        .where(or(...friendIds.map(id => eq(accounts.id, id))));\n      return friends;\n    }\n    \n    const friendIds: number[] = [];\n    this.friendshipsMap.forEach((f) => {\n      if (f.userId1 === userId) friendIds.push(f.userId2);\n      else if (f.userId2 === userId) friendIds.push(f.userId1);\n    });\n    \n    return friendIds.map(id => this.accountsMap.get(id)).filter(Boolean) as Account[];\n  }\n\n  async areFriends(userId1: number, userId2: number): Promise<boolean> {\n    if (db) {\n      const result = await db.select().from(friendships)\n        .where(or(\n          and(eq(friendships.userId1, userId1), eq(friendships.userId2, userId2)),\n          and(eq(friendships.userId1, userId2), eq(friendships.userId2, userId1))\n        ))\n        .limit(1);\n      return result.length > 0;\n    }\n    \n    return Array.from(this.friendshipsMap.values()).some(\n      f => (f.userId1 === userId1 && f.userId2 === userId2) ||\n           (f.userId1 === userId2 && f.userId2 === userId1)\n    );\n  }\n\n  async createFriendship(userId1: number, userId2: number): Promise<void> {\n    if (db) {\n      await db.insert(friendships).values({ userId1, userId2 });\n      return;\n    }\n    const id = this.friendshipId++;\n    this.friendshipsMap.set(id, { userId1, userId2 });\n  }\n\n  async removeFriendship(userId1: number, userId2: number): Promise<void> {\n    if (db) {\n      await db.delete(friendships)\n        .where(or(\n          and(eq(friendships.userId1, userId1), eq(friendships.userId2, userId2)),\n          and(eq(friendships.userId1, userId2), eq(friendships.userId2, userId1))\n        ));\n      return;\n    }\n    \n    for (const [id, f] of this.friendshipsMap.entries()) {\n      if ((f.userId1 === userId1 && f.userId2 === userId2) ||\n          (f.userId1 === userId2 && f.userId2 === userId1)) {\n        this.friendshipsMap.delete(id);\n        break;\n      }\n    }\n  }\n\n  async getPendingFriendRequests(userId: number): Promise<(FriendRequest & { fromUser: Account })[]> {\n    if (db) {\n      const result = await db.select({\n        id: friendRequests.id,\n        fromUserId: friendRequests.fromUserId,\n        toUserId: friendRequests.toUserId,\n        status: friendRequests.status,\n        createdAt: friendRequests.createdAt,\n        fromUser: accounts,\n      })\n      .from(friendRequests)\n      .innerJoin(accounts, eq(friendRequests.fromUserId, accounts.id))\n      .where(and(\n        eq(friendRequests.toUserId, userId),\n        eq(friendRequests.status, \"pending\")\n      ))\n      .orderBy(desc(friendRequests.createdAt));\n      \n      return result;\n    }\n    \n    const requests: (FriendRequest & { fromUser: Account })[] = [];\n    this.friendRequestsMap.forEach((req) => {\n      if (req.toUserId === userId && req.status === \"pending\") {\n        const fromUser = this.accountsMap.get(req.fromUserId);\n        if (fromUser) {\n          requests.push({ ...req, fromUser });\n        }\n      }\n    });\n    return requests;\n  }\n\n  async getSentFriendRequests(userId: number): Promise<(FriendRequest & { toUser: Account })[]> {\n    if (db) {\n      const result = await db.select({\n        id: friendRequests.id,\n        fromUserId: friendRequests.fromUserId,\n        toUserId: friendRequests.toUserId,\n        status: friendRequests.status,\n        createdAt: friendRequests.createdAt,\n        toUser: accounts,\n      })\n      .from(friendRequests)\n      .innerJoin(accounts, eq(friendRequests.toUserId, accounts.id))\n      .where(and(\n        eq(friendRequests.fromUserId, userId),\n        eq(friendRequests.status, \"pending\")\n      ))\n      .orderBy(desc(friendRequests.createdAt));\n      \n      return result;\n    }\n    \n    const requests: (FriendRequest & { toUser: Account })[] = [];\n    this.friendRequestsMap.forEach((req) => {\n      if (req.fromUserId === userId && req.status === \"pending\") {\n        const toUser = this.accountsMap.get(req.toUserId);\n        if (toUser) {\n          requests.push({ ...req, toUser });\n        }\n      }\n    });\n    return requests;\n  }\n\n  async createFriendRequest(request: InsertFriendRequest): Promise<FriendRequest> {\n    if (db) {\n      const result = await db.insert(friendRequests).values(request).returning();\n      return result[0];\n    }\n    const id = this.friendRequestId++;\n    const friendRequest: FriendRequest = {\n      ...request,\n      id,\n      status: \"pending\",\n      createdAt: new Date(),\n    };\n    this.friendRequestsMap.set(id, friendRequest);\n    return friendRequest;\n  }\n\n  async updateFriendRequestStatus(requestId: number, status: string): Promise<void> {\n    if (db) {\n      await db.update(friendRequests)\n        .set({ status })\n        .where(eq(friendRequests.id, requestId));\n      return;\n    }\n    const request = this.friendRequestsMap.get(requestId);\n    if (request) {\n      request.status = status;\n    }\n  }\n\n  async deleteFriendRequest(requestId: number): Promise<void> {\n    if (db) {\n      await db.delete(friendRequests).where(eq(friendRequests.id, requestId));\n      return;\n    }\n    this.friendRequestsMap.delete(requestId);\n  }\n\n  async getNotifications(userId: number, limit: number = 50): Promise<Notification[]> {\n    if (db) {\n      const result = await db.select().from(notifications)\n        .where(eq(notifications.userId, userId))\n        .orderBy(desc(notifications.createdAt))\n        .limit(limit);\n      return result;\n    }\n    \n    return Array.from(this.notificationsMap.values())\n      .filter(n => n.userId === userId)\n      .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime())\n      .slice(0, limit);\n  }\n\n  async getUnreadNotificationsCount(userId: number): Promise<number> {\n    if (db) {\n      const result = await db.select().from(notifications)\n        .where(and(\n          eq(notifications.userId, userId),\n          eq(notifications.isRead, false)\n        ));\n      return result.length;\n    }\n    \n    return Array.from(this.notificationsMap.values())\n      .filter(n => n.userId === userId && !n.isRead).length;\n  }\n\n  async createNotification(notification: InsertNotification): Promise<Notification> {\n    if (db) {\n      const result = await db.insert(notifications).values(notification).returning();\n      return result[0];\n    }\n    const id = this.notificationId++;\n    const newNotification: Notification = {\n      ...notification,\n      id,\n      data: notification.data || null,\n      isRead: false,\n      createdAt: new Date(),\n    };\n    this.notificationsMap.set(id, newNotification);\n    return newNotification;\n  }\n\n  async markNotificationAsRead(notificationId: number): Promise<void> {\n    if (db) {\n      await db.update(notifications)\n        .set({ isRead: true })\n        .where(eq(notifications.id, notificationId));\n      return;\n    }\n    const notification = this.notificationsMap.get(notificationId);\n    if (notification) {\n      notification.isRead = true;\n    }\n  }\n\n  async markAllNotificationsAsRead(userId: number): Promise<void> {\n    if (db) {\n      await db.update(notifications)\n        .set({ isRead: true })\n        .where(eq(notifications.userId, userId));\n      return;\n    }\n    this.notificationsMap.forEach((n) => {\n      if (n.userId === userId) {\n        n.isRead = true;\n      }\n    });\n  }\n\n  async deleteNotification(notificationId: number): Promise<void> {\n    if (db) {\n      await db.delete(notifications).where(eq(notifications.id, notificationId));\n      return;\n    }\n    this.notificationsMap.delete(notificationId);\n  }\n}\n\nexport const storage = new MemStorage();\n","path":null,"size_bytes":13423,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Minus } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-1 ring-ring\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Minus />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2143,"size_tokens":null},"client/src/components/ui/Menu.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { Button } from \"./button\";\nimport { Card } from \"./card\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { getLastPlayerName } from \"@/lib/websocket\";\nimport { Gamepad2, Users, BookOpen, WifiOff } from \"lucide-react\";\nimport { GameSettings } from \"./GameSettings\";\nimport { useOnlineStatus } from \"@/hooks/use-online-status\";\nimport { OfflineDialog } from \"./OfflineDialog\";\n\nexport function Menu() {\n  const navigate = useNavigate();\n  const { startSingleplayer } = useNumberGame();\n  const [showSettings, setShowSettings] = useState(false);\n  const [showOfflineDialog, setShowOfflineDialog] = useState(false);\n  const isOnline = useOnlineStatus();\n\n  const handleSingleplayer = () => {\n    setShowSettings(true);\n  };\n\n  const handleMultiplayerMenu = () => {\n    if (!isOnline) {\n      setShowOfflineDialog(true);\n      return;\n    }\n    navigate(\"/multiplayer\");\n  };\n\n  const handleSettingsConfirm = (settings: { numDigits: number; maxAttempts: number }) => {\n    startSingleplayer(settings);\n    setShowSettings(false);\n    navigate(\"/singleplayer\");\n  };\n\n  if (showSettings) {\n    return <GameSettings onConfirm={handleSettingsConfirm} isMultiplayer={false} />;\n  }\n\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50 z-50 p-4\">\n      <OfflineDialog isOpen={showOfflineDialog} onClose={() => setShowOfflineDialog(false)} />\n      <Card className=\"w-full max-w-6xl bg-white shadow-xl border border-gray-200 rounded-2xl relative overflow-hidden\">\n        <div className=\"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500\"></div>\n        \n        <div className=\"grid grid-cols-2 gap-8 p-8\">\n          {/* Right Side - Title and Buttons */}\n          <div className=\"flex flex-col justify-start\">\n            <div className=\"mb-6 flex justify-center\">\n              <div className=\"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg\">\n                <Gamepad2 className=\"w-12 h-12 text-white\" />\n              </div>\n            </div>\n            <h1 className=\"text-center text-gray-800 text-4xl font-bold mb-2\">\n              Ù„Ø¹Ø¨Ø© Ø§Ù„ØªØ®Ù…ÙŠÙ†\n            </h1>\n            <p className=\"text-center text-gray-700 text-base mb-2\">\n              Ø®Ù…Ù† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† <span className=\"text-blue-600 font-bold\">4 Ø£Ø±Ù‚Ø§Ù…</span>\n            </p>\n            <p className=\"text-center text-gray-600 text-sm mb-8\">\n\n            </p>\n\n            <div className=\"space-y-4\">\n              <Button\n                onClick={handleSingleplayer}\n                className=\"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold text-lg py-6 rounded-xl shadow-md hover:shadow-lg transform hover:scale-[1.02] transition-all duration-200 flex items-center justify-center gap-3\"\n                size=\"lg\"\n              >\n                <Gamepad2 className=\"w-6 h-6\" />\n                Ù„Ø¹Ø¨ ÙØ±Ø¯ÙŠ\n              </Button>\n\n              <Button\n                onClick={handleMultiplayerMenu}\n                className={`w-full ${isOnline \n                  ? 'bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700' \n                  : 'bg-gradient-to-r from-gray-400 to-gray-500'\n                } text-white font-semibold text-lg py-6 rounded-xl shadow-md hover:shadow-lg transform hover:scale-[1.02] transition-all duration-200 flex items-center justify-center gap-3 relative`}\n                size=\"lg\"\n              >\n                {!isOnline && <WifiOff className=\"w-5 h-5 absolute left-4\" />}\n                <Users className=\"w-6 h-6\" />\n                Ù„Ø¹Ø¨ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†\n              </Button>\n            </div>\n          </div>\n\n          {/* Left Side - Instructions */}\n          <div className=\"bg-blue-50 p-6 rounded-xl border border-blue-200 h-fit\">\n            <h3 className=\"text-gray-800 font-bold mb-4 text-lg flex items-center\">\n              <BookOpen className=\"w-5 h-5 ml-2\" />\n              ğŸ“– Ø´Ø±Ø­ Ø§Ù„Ù„Ø¹Ø¨Ø©:\n            </h3>\n            <ul className=\"text-gray-800 text-sm space-y-3\">\n              <li className=\"flex items-start\">\n                <span className=\"text-blue-600 font-bold ml-3 mt-0.5\">â‘ </span>\n                <span><strong className=\"text-blue-700\">Ø§Ø®ØªØ± Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø³Ø±ÙŠ:</strong> Ø³ÙŠØ·Ù„Ø¨ Ù…Ù†Ùƒ ÙƒØªØ§Ø¨Ø© 4 Ø£Ø±Ù‚Ø§Ù… Ø³Ø±ÙŠØ© ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„Ø®ØµÙ… ØªØ®Ù…ÙŠÙ†Ù‡Ø§</span>\n              </li>\n              <li className=\"flex items-start\">\n                <span className=\"text-blue-600 font-bold ml-3 mt-0.5\">â‘¡</span>\n                <span><strong className=\"text-blue-700\">Ø§Ø¯Ø®Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø©:</strong> Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù‚ÙÙ„ Ø§Ù„Ù…Ø¤Ø´Ø± ÙˆØ¯Ø®ÙˆÙ„ Ø§Ù„ØºØ±ÙØ© </span>\n              </li>\n              <li className=\"flex items-start\">\n                <span className=\"text-blue-600 font-bold ml-3 mt-0.5\">â‘¢</span>\n                <span><strong className=\"text-blue-700\">Ø§Ù„ØªØ­ÙƒÙ…:</strong> Ø§Ø³ØªØ®Ø¯Ù… <span className=\"text-purple-700 font-mono bg-white px-1 rounded\">W/A/S/D</span> Ù„Ù„ØªØ­Ø±Ùƒ ÙˆØ§Ù„Ù…Ø§ÙˆØ³ Ù„Ù„Ù†Ø¸Ø±</span>\n              </li>\n              <li className=\"flex items-start\">\n                <span className=\"text-blue-600 font-bold ml-3 mt-0.5\">â‘£</span>\n                <span><strong className=\"text-blue-700\">Ø§Ù„ØªØ®Ù…ÙŠÙ†:</strong> Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ù„ØºØ±ÙØ© Ù„Ø¨Ù†Ø§Ø¡ ØªØ®Ù…ÙŠÙ†ÙƒØŒ Ø«Ù… Ø§Ø¶ØºØ· âœ“ Ù„Ù„ØªØ£ÙƒÙŠØ¯</span>\n              </li>\n              <li className=\"flex items-start\">\n                <span className=\"text-blue-600 font-bold ml-3 mt-0.5\">â‘¤</span>\n                <span><strong className=\"text-blue-700\">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ğŸ”µ Ø£Ø²Ø±Ù‚ = Ø±Ù‚Ù… ØµØ­ÙŠØ­ Ø¨Ø£ÙŠ Ù…ÙˆØ¶Ø¹ | ğŸŸ¢ Ø£Ø®Ø¶Ø± = Ø±Ù‚Ù… ØµØ­ÙŠØ­ Ø¨Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„ØµØ­ÙŠØ­</span>\n              </li>\n              <li className=\"flex items-start\">\n                <span className=\"text-blue-600 font-bold ml-3 mt-0.5\">â‘¥</span>\n                <span><strong className=\"text-blue-700\">Ø§Ù„ÙØ§Ø¦Ø²:</strong> Ù…Ù† ÙŠØ®Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø³Ø±ÙŠ Ø£ÙˆÙ„Ø§Ù‹ ÙŠÙÙˆØ² Ø¨Ø§Ù„Ù…Ø¨Ø§Ø±Ø©! ğŸ†</span>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":6493,"size_tokens":null},"client/src/components/mobile/MobileChallenge.tsx":{"content":"import { useEffect, useRef, useState } from \"react\";\nimport { useChallenge } from \"@/lib/stores/useChallenge\";\nimport { Home } from \"lucide-react\";\n\nconst BUTTON_COLORS = [\n  { name: \"Ø£Ø­Ù…Ø±\", color: \"#ef4444\", sound: 261.63 },\n  { name: \"Ø£Ø²Ø±Ù‚\", color: \"#3b82f6\", sound: 293.66 },\n  { name: \"Ø£Ø®Ø¶Ø±\", color: \"#22c55e\", sound: 329.63 },\n  { name: \"Ø£ØµÙØ±\", color: \"#eab308\", sound: 349.23 },\n  { name: \"Ø¨Ù†ÙØ³Ø¬ÙŠ\", color: \"#a855f7\", sound: 392.00 },\n  { name: \"Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ\", color: \"#f97316\", sound: 440.00 },\n  { name: \"ÙˆØ±Ø¯ÙŠ\", color: \"#ec4899\", sound: 493.88 },\n  { name: \"Ø³Ù…Ø§ÙˆÙŠ\", color: \"#06b6d4\", sound: 523.25 },\n];\n\nexport function MobileChallenge({ onExit }: { onExit: () => void }) {\n  const {\n    sequence,\n    playerSequence,\n    currentLevel,\n    phase,\n    isShowingSequence,\n    canInput,\n    addToPlayerSequence,\n    setIsShowingSequence,\n    setCanInput,\n  } = useChallenge();\n\n  const [activeButton, setActiveButton] = useState<number | null>(null);\n  const audioContextRef = useRef<AudioContext | null>(null);\n\n  useEffect(() => {\n    audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)();\n    \n    return () => {\n      if (audioContextRef.current) {\n        audioContextRef.current.close();\n      }\n    };\n  }, []);\n\n  const playSound = (frequency: number, duration: number = 0.3) => {\n    if (!audioContextRef.current) return;\n\n    const oscillator = audioContextRef.current.createOscillator();\n    const gainNode = audioContextRef.current.createGain();\n\n    oscillator.connect(gainNode);\n    gainNode.connect(audioContextRef.current.destination);\n\n    oscillator.frequency.value = frequency;\n    oscillator.type = 'sine';\n\n    gainNode.gain.setValueAtTime(0.3, audioContextRef.current.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(\n      0.01,\n      audioContextRef.current.currentTime + duration\n    );\n\n    oscillator.start(audioContextRef.current.currentTime);\n    oscillator.stop(audioContextRef.current.currentTime + duration);\n  };\n\n  useEffect(() => {\n    if (isShowingSequence && sequence.length > 0) {\n      let index = 0;\n      const delay = Math.max(600 - currentLevel * 50, 300);\n\n      const showNext = () => {\n        if (index < sequence.length) {\n          const buttonIndex = sequence[index];\n          setActiveButton(buttonIndex);\n          playSound(BUTTON_COLORS[buttonIndex].sound);\n\n          setTimeout(() => {\n            setActiveButton(null);\n            index++;\n            setTimeout(showNext, delay);\n          }, 500);\n        } else {\n          setIsShowingSequence(false);\n          setCanInput(true);\n        }\n      };\n\n      setTimeout(showNext, 1000);\n    }\n  }, [isShowingSequence, sequence, currentLevel]);\n\n\n  const handleButtonClick = (index: number) => {\n    if (!canInput || isShowingSequence) return;\n    \n    setActiveButton(index);\n    playSound(BUTTON_COLORS[index].sound);\n    addToPlayerSequence(index);\n\n    setTimeout(() => {\n      setActiveButton(null);\n    }, 300);\n  };\n\n  if (phase === \"won\") {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-6 bg-slate-950\">\n        <div className=\"w-full max-w-md bg-slate-900/90 backdrop-blur-xl rounded-3xl shadow-2xl border border-green-500/30 p-8 text-center space-y-6\">\n          <div className=\"text-8xl animate-bounce\">ğŸ‰</div>\n          <h2 className=\"text-4xl font-bold text-green-400\">Ù…Ø¨Ø±ÙˆÙƒ! ÙØ²Øª</h2>\n          <p className=\"text-gray-300 text-lg\">\n            Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø®Ù…Ø³Ø© Ø¨Ù†Ø¬Ø§Ø­!\n          </p>\n          <p className=\"text-green-300 font-semibold\">\n            Ø³ÙŠØ¸Ù‡Ø± Ù„Ùƒ Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø§Ù„Ø¢Ù†\n          </p>\n          <button\n            onClick={onExit}\n            className=\"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-4 px-6 rounded-xl transition-all shadow-lg shadow-green-500/50\"\n          >\n            Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø¨Ø©\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (phase === \"lost\") {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-6 bg-slate-950\">\n        <div className=\"w-full max-w-md bg-slate-900/90 backdrop-blur-xl rounded-3xl shadow-2xl border border-red-500/30 p-8 text-center space-y-6\">\n          <div className=\"text-8xl\">ğŸ˜”</div>\n          <h2 className=\"text-4xl font-bold text-red-400\">Ø®Ø³Ø±Øª!</h2>\n          <p className=\"text-gray-300 text-lg\">\n            Ù„Ù… ØªØ³ØªØ·Ø¹ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø©\n          </p>\n          <button\n            onClick={onExit}\n            className=\"w-full bg-gradient-to-r from-red-600 to-rose-600 hover:from-red-700 hover:to-rose-700 text-white font-bold py-4 px-6 rounded-xl transition-all shadow-lg shadow-red-500/50\"\n          >\n            Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-950 p-4 overflow-hidden relative\">\n      {/* Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© */}\n      <div className=\"fixed inset-0 bg-gradient-to-br from-purple-950/30 via-slate-950 to-blue-950/30 pointer-events-none\" />\n      <div className=\"fixed inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(139,92,246,0.1),transparent_50%)] pointer-events-none\" />\n      \n      <div className=\"relative z-10\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-6 pt-4\">\n          <button\n            onClick={onExit}\n            className=\"flex items-center gap-2 bg-slate-900/80 backdrop-blur-sm hover:bg-slate-800 border border-red-500/30 text-white font-bold py-3 px-4 rounded-xl transition-all shadow-lg\"\n          >\n            <Home className=\"w-5 h-5\" />\n            <span>Ø®Ø±ÙˆØ¬</span>\n          </button>\n          <div className=\"bg-slate-900/80 backdrop-blur-xl rounded-xl px-6 py-3 border border-purple-500/30 shadow-lg shadow-purple-500/20\">\n            <p className=\"text-white font-bold text-lg\">\n              Ø§Ù„Ù…Ø³ØªÙˆÙ‰: {currentLevel + 1} / 5\n            </p>\n          </div>\n        </div>\n\n        {/* Progress Bar */}\n        <div className=\"mb-6 max-w-lg mx-auto\">\n          <div className=\"flex gap-2 justify-center\">\n            {[...Array(5)].map((_, i) => (\n              <div\n                key={i}\n                className={`h-2 flex-1 rounded-full transition-all duration-500 ${\n                  i < currentLevel + 1\n                    ? 'bg-gradient-to-r from-purple-500 to-pink-500 shadow-lg shadow-purple-500/50'\n                    : 'bg-slate-800/50 border border-slate-700'\n                }`}\n              />\n            ))}\n          </div>\n        </div>\n\n        {/* Status Message */}\n        <div className=\"mb-8 text-center\">\n          {isShowingSequence && (\n            <div className=\"bg-gradient-to-r from-yellow-900/80 to-amber-900/80 backdrop-blur-xl border border-yellow-500/50 rounded-2xl p-5 shadow-2xl shadow-yellow-500/20 max-w-md mx-auto\">\n              <p className=\"text-yellow-200 font-bold text-2xl\">â³ Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªØ³Ù„Ø³Ù„...</p>\n            </div>\n          )}\n          {canInput && (\n            <div className=\"bg-gradient-to-r from-green-900/80 to-emerald-900/80 backdrop-blur-xl border border-green-500/50 rounded-2xl p-5 shadow-2xl shadow-green-500/20 max-w-md mx-auto\">\n              <p className=\"text-green-200 font-bold text-2xl\">\n                âœ¨ Ø¯ÙˆØ±Ùƒ! ({playerSequence.length} / {sequence.length})\n              </p>\n            </div>\n          )}\n          {!isShowingSequence && !canInput && playerSequence.length === 0 && (\n            <div className=\"bg-gradient-to-r from-blue-900/80 to-indigo-900/80 backdrop-blur-xl border border-blue-500/50 rounded-2xl p-5 shadow-2xl shadow-blue-500/20 max-w-md mx-auto\">\n              <p className=\"text-blue-200 font-bold text-2xl\">ğŸ¯ Ø§Ø³ØªØ¹Ø¯...</p>\n            </div>\n          )}\n        </div>\n\n        {/* Color Buttons - Ø´Ø¨ÙƒØ© 4x2 */}\n        <div className=\"grid grid-cols-4 gap-3 max-w-2xl mx-auto mb-6\">\n          {BUTTON_COLORS.map((btn, index) => (\n            <button\n              key={index}\n              onClick={() => handleButtonClick(index)}\n              disabled={!canInput || isShowingSequence}\n              className=\"aspect-square rounded-2xl shadow-2xl transform transition-all duration-200 active:scale-90 disabled:opacity-40 relative overflow-hidden border-2\"\n              style={{\n                backgroundColor: btn.color,\n                borderColor: activeButton === index ? '#ffffff' : `${btn.color}80`,\n                boxShadow: activeButton === index \n                  ? `0 0 40px 15px ${btn.color}, 0 0 80px 20px ${btn.color}80` \n                  : `0 8px 25px ${btn.color}40, inset 0 2px 10px ${btn.color}80`,\n                transform: activeButton === index ? 'scale(1.15)' : 'scale(1)',\n              }}\n            >\n              {/* ØªÙˆÙ‡Ø¬ Ø¯Ø§Ø®Ù„ÙŠ */}\n              <div \n                className=\"absolute inset-0 bg-gradient-to-br from-white/30 to-transparent opacity-50\"\n                style={{\n                  opacity: activeButton === index ? 0.8 : 0.3,\n                }}\n              />\n              \n              {/* Ø­Ù„Ù‚Ø© Ù†ÙŠÙˆÙ† */}\n              {activeButton === index && (\n                <div \n                  className=\"absolute inset-0 rounded-2xl animate-ping\"\n                  style={{\n                    border: `3px solid ${btn.color}`,\n                    boxShadow: `0 0 20px ${btn.color}`,\n                  }}\n                />\n              )}\n            </button>\n          ))}\n        </div>\n\n        {/* Info Panel */}\n        <div className=\"mt-8 max-w-lg mx-auto\">\n          <div className=\"bg-slate-900/60 backdrop-blur-xl border border-slate-700/50 rounded-2xl p-5 shadow-2xl\">\n            <p className=\"text-slate-300 text-sm text-center leading-relaxed\">\n              ğŸ® Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ù†ÙØ³ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø°ÙŠ Ø¸Ù‡Ø±Øª Ø¨Ù‡\n              <br />\n              ğŸ’« ÙƒÙ„ Ù…Ø³ØªÙˆÙ‰ ÙŠØ²ÙŠØ¯ Ø§Ù„Ø³Ø±Ø¹Ø© ÙˆØ§Ù„ØµØ¹ÙˆØ¨Ø©!\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":10192,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path, { dirname } from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\nimport { fileURLToPath } from \"url\";\nimport glsl from \"vite-plugin-glsl\";\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    glsl(), // Add GLSL shader support\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(__dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(__dirname, \"shared\"),\n    },\n  },\n  root: path.resolve(__dirname, \"client\"),\n  build: {\n    outDir: path.resolve(__dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    host: \"0.0.0.0\",\n    port: 5000,\n    strictPort: true,\n    hmr: {\n      clientPort: 443,\n    },\n    allowedHosts: true,\n  },\n  preview: {\n    host: \"0.0.0.0\",\n    port: 5000,\n  },\n  // Add support for large models and audio files\n  assetsInclude: [\"**/*.gltf\", \"**/*.glb\", \"**/*.mp3\", \"**/*.ogg\", \"**/*.wav\"],\n});\n","path":null,"size_bytes":1092,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/WinScreen.tsx":{"content":"import { Button } from \"./button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"./card\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { send } from \"@/lib/websocket\";\n\nexport function WinScreen() {\n  const { mode, singleplayer, multiplayer, restartSingleplayer, setMode, setShowResults, setShowOpponentAttempts, resetMultiplayer, setChallengeStatus, setOpponentId, setOpponentName, setMySecretCode } = useNumberGame();\n  \n  const isSingleplayer = mode === \"singleplayer\";\n  const attempts = isSingleplayer ? singleplayer.attempts.length : multiplayer.attempts.length;\n  const timeElapsed = isSingleplayer\n    ? (singleplayer.endTime ? Math.floor((singleplayer.endTime - singleplayer.startTime) / 1000) : 0)\n    : (multiplayer.endTime ? Math.floor((multiplayer.endTime - multiplayer.startTime) / 1000) : 0);\n  const minutes = Math.floor(timeElapsed / 60);\n  const seconds = timeElapsed % 60;\n  const secretCode = isSingleplayer ? singleplayer.secretCode : multiplayer.opponentSecretCode;\n  const isMultiplayer = mode === \"multiplayer\";\n  const isTie = multiplayer.gameResult === \"tie\";\n\n  const handleRematch = () => {\n    send({ type: \"request_rematch\", opponentId: multiplayer.opponentId });\n  };\n\n  const handleBackToLobby = () => {\n    if (isMultiplayer) {\n      // Reset game state but keep multiplayer session\n      setChallengeStatus(\"none\");\n      setOpponentId(null);\n      setOpponentName(\"\");\n      setMySecretCode([]);\n      setShowResults(false);\n      resetMultiplayer();\n    } else {\n      setShowResults(false);\n      setMode(\"menu\");\n      setTimeout(() => {\n        window.location.reload();\n      }, 300);\n    }\n  };\n\n  const handleShowOpponentAttempts = () => {\n    setShowOpponentAttempts(true);\n  };\n\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50 z-50\">\n      <div className=\"w-full max-w-md mx-4 bg-white rounded-2xl shadow-2xl p-8 text-center space-y-6\">\n        <div className=\"text-6xl\">\n          {isTie ? \"ğŸ¤\" : \"ğŸ‰\"}\n        </div>\n        \n        <div>\n          <h2 className=\"text-4xl font-bold text-gray-800 mb-2\">\n            {isTie ? \"ØªØ¹Ø§Ø¯Ù„!\" : \"Ù„Ù‚Ø¯ ÙØ²Øª!\"}\n          </h2>\n          {isMultiplayer && isTie && (\n            <p className=\"text-gray-600\">ÙƒÙ„Ø§ÙƒÙ…Ø§ Ø®Ù…Ù†ØªÙ… Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ÙÙŠ Ù†ÙØ³ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</p>\n          )}\n        </div>\n\n        <div className=\"bg-gradient-to-br from-blue-50 to-purple-50 p-6 rounded-xl space-y-3 border border-purple-200\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-gray-700 font-semibold\">Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ:</span>\n            <span className=\"text-2xl font-bold text-blue-600\">{attempts}</span>\n          </div>\n          \n          {isMultiplayer && multiplayer.opponentAttempts && (\n            <div className=\"flex justify-between items-center border-t border-purple-200 pt-3\">\n              <span className=\"text-gray-700 font-semibold\">Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø®ØµÙ…:</span>\n              <span className=\"text-2xl font-bold text-purple-600\">{multiplayer.opponentAttempts.length}</span>\n            </div>\n          )}\n\n          <div className=\"flex justify-between items-center border-t border-purple-200 pt-3\">\n            <span className=\"text-gray-700 font-semibold\">Ø§Ù„ÙˆÙ‚Øª:</span>\n            <span className=\"text-2xl font-bold text-pink-600\">\n              {minutes > 0 ? `${minutes}:${seconds.toString().padStart(2, \"0\")}` : `${seconds}Ø«`}\n            </span>\n          </div>\n\n          {secretCode.length > 0 && (\n            <div className=\"flex justify-between items-center border-t border-purple-200 pt-3\">\n              <span className=\"text-gray-700 font-semibold\">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ:</span>\n              <span className=\"text-2xl font-mono font-bold text-green-600\">{secretCode.join(\"\")}</span>\n            </div>\n          )}\n        </div>\n\n        <div className=\"space-y-2 pt-4\">\n          {isMultiplayer ? (\n            <>\n              <Button\n                onClick={handleShowOpponentAttempts}\n                className=\"w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 rounded-xl\"\n              >\n                Ø¹Ø±Ø¶ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø®ØµÙ…\n              </Button>\n              <Button\n                onClick={handleRematch}\n                className=\"w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-xl\"\n              >\n                Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©\n              </Button>\n              <Button\n                onClick={handleBackToLobby}\n                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl\"\n              >\n                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØºØ±ÙØ©\n              </Button>\n            </>\n          ) : (\n            <>\n              <Button\n                onClick={restartSingleplayer}\n                className=\"w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-xl\"\n              >\n                Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\n              </Button>\n              <Button\n                onClick={() => {\n                  setMode(\"menu\");\n                  setTimeout(() => {\n                    window.location.reload();\n                  }, 300);\n                }}\n                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl\"\n              >\n                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\n              </Button>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":5618,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\nconst getLocalStorage = (key: string): any =>\n  JSON.parse(window.localStorage.getItem(key) || \"null\");\nconst setLocalStorage = (key: string, value: any): void =>\n  window.localStorage.setItem(key, JSON.stringify(value));\n\nexport { getLocalStorage, setLocalStorage };\n","path":null,"size_bytes":438,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer base {\n  :root {\n    --background: 210 40% 98%;\n    --foreground: 222 47% 11%;\n    --card: 0 0% 100%;\n    --card-foreground: 222 47% 11%;\n    --popover: 0 0% 100%;\n    --popover-foreground: 222 47% 11%;\n    --primary: 220 90% 56%;\n    --primary-foreground: 0 0% 100%;\n    --secondary: 210 40% 96%;\n    --secondary-foreground: 222 47% 11%;\n    --muted: 210 40% 96%;\n    --muted-foreground: 215 16% 47%;\n    --accent: 210 40% 96%;\n    --accent-foreground: 222 47% 11%;\n    --destructive: 0 84% 60%;\n    --destructive-foreground: 0 0% 100%;\n    --border: 214 32% 91%;\n    --input: 214 32% 91%;\n    --ring: 220 90% 56%;\n    --radius: 0.75rem;\n  }\n\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    margin: 0;\n    padding: 0;\n    overflow: hidden;\n    width: 100vw;\n    height: 100vh;\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;\n  }\n}\n\n#root {\n  width: 100%;\n  height: 100%;\n  position: fixed;\n}\n\ncanvas {\n  width: 100% !important;\n  height: 100% !important;\n  touch-action: none;\n}","path":null,"size_bytes":1159,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1))\",\n          \"2\": \"hsl(var(--chart-2))\",\n          \"3\": \"hsl(var(--chart-3))\",\n          \"4\": \"hsl(var(--chart-4))\",\n          \"5\": \"hsl(var(--chart-5))\",\n        },\n        sidebar: {\n          DEFAULT: \"hsl(var(--sidebar-background))\",\n          foreground: \"hsl(var(--sidebar-foreground))\",\n          primary: \"hsl(var(--sidebar-primary))\",\n          \"primary-foreground\": \"hsl(var(--sidebar-primary-foreground))\",\n          accent: \"hsl(var(--sidebar-accent))\",\n          \"accent-foreground\": \"hsl(var(--sidebar-accent-foreground))\",\n          border: \"hsl(var(--sidebar-border))\",\n          ring: \"hsl(var(--sidebar-ring))\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":2787,"size_tokens":null},"client/src/lib/stores/useChallenge.ts":{"content":"import { create } from \"zustand\";\n\nexport type ChallengePhase = \"menu\" | \"playing\" | \"won\" | \"lost\";\nexport type HintType = \"digit\" | \"description\";\n\nexport interface Hint {\n  type: HintType;\n  value: string | number;\n  position?: number;\n}\n\ninterface ChallengeState {\n  currentLevel: number;\n  sequence: number[];\n  playerSequence: number[];\n  phase: ChallengePhase;\n  challengeCompleted: boolean;\n  hint: Hint | null;\n  isShowingSequence: boolean;\n  canInput: boolean;\n  startTime: number;\n  timeoutHandle: NodeJS.Timeout | null;\n\n  startChallenge: () => void;\n  addToPlayerSequence: (buttonIndex: number) => void;\n  checkSequence: () => void;\n  nextLevel: () => void;\n  failChallenge: () => void;\n  completeChallenge: () => void;\n  resetChallenge: () => void;\n  setIsShowingSequence: (showing: boolean) => void;\n  setCanInput: (canInput: boolean) => void;\n  generateHint: (secretCode: number[]) => void;\n}\n\nconst generateSequence = (level: number): number[] => {\n  const length = 3 + level;\n  return Array.from({ length }, () => Math.floor(Math.random() * 8));\n};\n\nconst generateRandomHint = (secretCode: number[]): Hint => {\n  const numDigits = secretCode.length;\n  const hintChoice = Math.random();\n  \n  if (hintChoice < 0.4) {\n    // Ù†ÙˆØ¹ 1: Ø±Ù‚Ù… Ù…Ø­Ø¯Ø¯ ÙÙŠ Ø®Ø§Ù†Ø© Ù…Ø­Ø¯Ø¯Ø©\n    const position = Math.floor(Math.random() * numDigits);\n    const digit = secretCode[position];\n    return {\n      type: \"digit\",\n      value: digit,\n      position,\n    };\n  } else if (hintChoice < 0.7) {\n    // Ù†ÙˆØ¹ 2: Ø®Ø§Ù†Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ø¹ ÙˆØµÙ even/odd\n    const position = Math.floor(Math.random() * numDigits);\n    const digit = secretCode[position];\n    const isEven = digit % 2 === 0;\n    const parity = isEven ? 'Ø²ÙˆØ¬ÙŠ' : 'ÙØ±Ø¯ÙŠ';\n    \n    return {\n      type: \"description\",\n      value: `Ø§Ù„Ø®Ø§Ù†Ø© ${position + 1} Ø±Ù‚Ù… ${parity}`,\n    };\n  } else {\n    // Ù†ÙˆØ¹ 3: Ø®Ø§Ù†ØªØ§Ù† Ø¹Ø´ÙˆØ§Ø¦ÙŠØªØ§Ù† Ù…Ø¹ ÙˆØµÙ even/odd Ù„ÙƒÙ„ ÙˆØ§Ø­Ø¯Ø©\n    const positions = [];\n    const availablePositions = Array.from({ length: numDigits }, (_, i) => i);\n    \n    // Ø§Ø®ØªÙŠØ§Ø± Ø®Ø§Ù†ØªÙŠÙ† Ø¹Ø´ÙˆØ§Ø¦ÙŠØªÙŠÙ†\n    const pos1Index = Math.floor(Math.random() * availablePositions.length);\n    const pos1 = availablePositions[pos1Index];\n    availablePositions.splice(pos1Index, 1);\n    \n    const pos2Index = Math.floor(Math.random() * availablePositions.length);\n    const pos2 = availablePositions[pos2Index];\n    \n    const digit1 = secretCode[pos1];\n    const digit2 = secretCode[pos2];\n    const parity1 = digit1 % 2 === 0 ? 'Ø²ÙˆØ¬ÙŠ' : 'ÙØ±Ø¯ÙŠ';\n    const parity2 = digit2 % 2 === 0 ? 'Ø²ÙˆØ¬ÙŠ' : 'ÙØ±Ø¯ÙŠ';\n    \n    const hint1 = `Ø§Ù„Ø®Ø§Ù†Ø© ${pos1 + 1} Ø±Ù‚Ù… ${parity1}`;\n    const hint2 = `Ø§Ù„Ø®Ø§Ù†Ø© ${pos2 + 1} Ø±Ù‚Ù… ${parity2}`;\n    \n    return {\n      type: \"description\",\n      value: `${hint1} Ùˆ ${hint2}`,\n    };\n  }\n};\n\nif (typeof window !== 'undefined') {\n  const stored = localStorage.getItem('challenge-storage');\n  if (stored) {\n    try {\n      const data = JSON.parse(stored);\n      if (data.state && data.state.challengeCompleted) {\n        console.log(\"ğŸ’¾ Loaded challengeCompleted from storage:\", data.state.challengeCompleted);\n      }\n    } catch (e) {\n      console.error(\"Error loading challenge storage:\", e);\n    }\n  }\n}\n\nexport const useChallenge = create<ChallengeState>()(\n  (set, get) => ({\n      currentLevel: 0,\n      sequence: [],\n      playerSequence: [],\n      phase: \"menu\",\n      challengeCompleted: false,\n      hint: null,\n      isShowingSequence: false,\n      canInput: false,\n      startTime: 0,\n      timeoutHandle: null,\n\n      startChallenge: () => {\n        console.log(\"ğŸ® Starting challenge - preserving hint and challengeCompleted\");\n        const sequence = generateSequence(0);\n        const { hint, challengeCompleted, timeoutHandle } = get();\n        \n        // Clear previous timeout if exists\n        if (timeoutHandle) clearTimeout(timeoutHandle);\n        \n        // Set 5-minute timeout (300 seconds)\n        const newTimeoutHandle = setTimeout(() => {\n          console.log(\"â° Challenge timeout - 5 minutes elapsed\");\n          set({\n            phase: \"lost\",\n            canInput: false,\n          });\n        }, 5 * 60 * 1000);\n        \n        set({\n          currentLevel: 0,\n          sequence,\n          playerSequence: [],\n          phase: \"playing\",\n          isShowingSequence: true,\n          canInput: false,\n          hint,\n          challengeCompleted,\n          startTime: Date.now(),\n          timeoutHandle: newTimeoutHandle,\n        });\n      },\n\n      addToPlayerSequence: (buttonIndex: number) => {\n        const { playerSequence, canInput, sequence, currentLevel } = get();\n        if (!canInput) return;\n        \n        const newPlayerSequence = [...playerSequence, buttonIndex];\n        const currentIndex = playerSequence.length;\n        \n        if (sequence[currentIndex] !== buttonIndex) {\n          get().failChallenge();\n          return;\n        }\n        \n        set({\n          playerSequence: newPlayerSequence,\n        });\n        \n        if (newPlayerSequence.length === sequence.length) {\n          const nextLevelNum = get().currentLevel + 1;\n          if (nextLevelNum >= 5) {\n            setTimeout(() => {\n              get().completeChallenge();\n            }, 500);\n          } else {\n            setTimeout(() => {\n              get().nextLevel();\n            }, 1000);\n          }\n        }\n      },\n\n      checkSequence: () => {\n      },\n\n      nextLevel: () => {\n        const { currentLevel } = get();\n        const newLevel = currentLevel + 1;\n        const newSequence = generateSequence(newLevel);\n        \n        set({\n          currentLevel: newLevel,\n          sequence: newSequence,\n          playerSequence: [],\n          isShowingSequence: true,\n          canInput: false,\n        });\n      },\n\n\n      completeChallenge: () => {\n        console.log(\"ğŸ¯ Challenge Completed! Setting to true\");\n        const { timeoutHandle } = get();\n        if (timeoutHandle) clearTimeout(timeoutHandle);\n        \n        set({\n          phase: \"won\",\n          challengeCompleted: true,\n          canInput: false,\n          timeoutHandle: null,\n        });\n        setTimeout(() => {\n          const state = get();\n          console.log(\"âœ… Challenge state after set:\", {\n            challengeCompleted: state.challengeCompleted,\n            hint: state.hint,\n            phase: state.phase\n          });\n        }, 100);\n      },\n\n      failChallenge: () => {\n        const { timeoutHandle } = get();\n        if (timeoutHandle) clearTimeout(timeoutHandle);\n        \n        set({\n          phase: \"lost\",\n          playerSequence: [],\n          canInput: false,\n          timeoutHandle: null,\n        });\n      },\n\n      resetChallenge: () => {\n        const { hint, challengeCompleted, timeoutHandle } = get();\n        if (timeoutHandle) clearTimeout(timeoutHandle);\n        \n        console.log(\"ğŸ”„ Resetting challenge - preserving hint and challengeCompleted\");\n        set({\n          currentLevel: 0,\n          sequence: [],\n          playerSequence: [],\n          phase: \"menu\",\n          isShowingSequence: false,\n          canInput: false,\n          hint,\n          challengeCompleted,\n          startTime: 0,\n          timeoutHandle: null,\n        });\n      },\n\n      setIsShowingSequence: (showing: boolean) => {\n        set({ isShowingSequence: showing });\n      },\n\n      setCanInput: (canInput: boolean) => {\n        set({ canInput });\n      },\n\n      generateHint: (secretCode: number[]) => {\n        const hint = generateRandomHint(secretCode);\n        console.log(\"ğŸ’¡ Hint Generated:\", hint);\n        set({ hint });\n        setTimeout(() => {\n          const state = get();\n          console.log(\"âœ… Hint state after set:\", {\n            hint: state.hint,\n            challengeCompleted: state.challengeCompleted\n          });\n        }, 100);\n      },\n    })\n);\n","path":null,"size_bytes":7927,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1376,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/lib/stores/useChallenges.ts":{"content":"import { create } from \"zustand\";\n\nexport type ChallengeType = \"guess\" | \"memory\" | \"direction\" | \"raindrops\";\nexport type ChallengeCategory = \"memory\" | \"reaction\" | \"math\";\nexport type ChallengePhase = \"menu\" | \"playing\" | \"won\" | \"lost\";\nexport type HintType = \"digit\" | \"description\";\n\nexport interface Hint {\n  type: HintType;\n  value: string | number;\n  position?: number;\n}\n\ninterface ChallengeAttempt {\n  challengeId: ChallengeType;\n  success: boolean;\n  timestamp: number;\n}\n\ninterface GuessChallenge {\n  sequence: number[];\n  playerSequence: number[];\n  currentLevel: number;\n  isShowingSequence: boolean;\n}\n\ninterface MemoryChallenge {\n  currentLevel: number;\n  gridSize: number;\n  flashedCells: number[];\n  selectedCells: number[];\n  isShowingCells: boolean;\n  showingScanner: boolean;\n  showingSuccess: boolean;\n}\n\nexport type DirectionType = \"right\" | \"left\" | \"up\" | \"down\" | \"notRight\" | \"notLeft\" | \"notUp\" | \"notDown\" | \"notRed\" | \"notYellow\" | \"notGreen\" | \"notBlue\" | \"nothing\";\nexport type ColorDirection = \"green\" | \"yellow\" | \"blue\" | \"red\";\nexport type ColorPosition = {\n  yellow: 'left' | 'right' | 'top' | 'bottom';\n  green: 'left' | 'right' | 'top' | 'bottom';\n  blue: 'left' | 'right' | 'top' | 'bottom';\n  red: 'left' | 'right' | 'top' | 'bottom';\n};\n\ninterface DirectionChallenge {\n  currentDirection: DirectionType | null;\n  currentColor: ColorDirection | null;\n  useColors: boolean;\n  colorPositions: ColorPosition | null;\n  score: number;\n  errors: number;\n  maxErrors: number;\n  timePerRound: number;\n  roundStartTime: number | null;\n  isWaiting: boolean;\n  gameTime: number;\n  totalRounds: number;\n  currentRound: number;\n}\n\nexport interface RainDrop {\n  id: string;\n  equation: string;\n  answer: number;\n  x: number;\n  y: number;\n  speed: number;\n}\n\ninterface RainDropsChallenge {\n  drops: RainDrop[];\n  score: number;\n  errors: number;\n  maxErrors: number;\n  gameTime: number;\n  timeRemaining: number;\n  currentInput: string;\n  isGameActive: boolean;\n  difficulty: number;\n}\n\ninterface ChallengesState {\n  maxAttempts: number;\n  attempts: ChallengeAttempt[];\n  selectedChallenge: ChallengeType | null;\n  currentPhase: ChallengePhase;\n  hint: Hint | null;\n  \n  guessChallenge: GuessChallenge;\n  memoryChallenge: MemoryChallenge;\n  directionChallenge: DirectionChallenge;\n  raindropsChallenge: RainDropsChallenge;\n\n  selectChallenge: (challengeId: ChallengeType) => void;\n  startChallenge: () => void;\n  completeChallenge: (success: boolean) => void;\n  resetToMenu: () => void;\n  resetChallengesHub: () => void;\n  getRemainingAttempts: () => number;\n  hasWonAnyChallenge: () => boolean;\n  canPlayChallenge: (challengeId: ChallengeType) => boolean;\n  generateHint: (secretCode: number[]) => void;\n\n  guessAddToSequence: (buttonIndex: number) => void;\n  guessNextLevel: () => void;\n  guessSetShowingSequence: (showing: boolean) => void;\n\n  memoryFlashCells: (cells: number[]) => void;\n  memorySelectCell: (cell: number) => void;\n  memoryCheckSelection: () => boolean;\n  memoryNextLevel: () => void;\n  memorySetScanner: (showing: boolean) => void;\n  memorySetSuccess: (showing: boolean) => void;\n\n  directionStartGame: () => void;\n  directionNextRound: () => void;\n  directionHandleInput: (input: \"right\" | \"left\" | \"up\" | \"down\" | \"none\") => boolean;\n  directionTimeOut: () => void;\n\n  raindropsStartGame: () => void;\n  raindropsAddDrop: () => void;\n  raindropsUpdateDrops: (deltaTime: number) => void;\n  raindropsSetInput: (input: string) => void;\n  raindropsSubmitAnswer: () => boolean;\n  raindropsRemoveDrop: (dropId: string) => void;\n  raindropsMissedDrop: () => void;\n  raindropsUpdateTime: (time: number) => void;\n}\n\nconst generateSequence = (level: number): number[] => {\n  const length = 3 + level;\n  return Array.from({ length }, () => Math.floor(Math.random() * 8));\n};\n\nconst generateMathEquation = (difficulty: number): { equation: string; answer: number } => {\n  const operations = ['+', '-', '*', '/'];\n  let num1: number, num2: number, operation: string, answer: number;\n  \n  const maxNum = Math.min(10 + difficulty * 3, 20);\n  \n  do {\n    operation = operations[Math.floor(Math.random() * operations.length)];\n    \n    switch (operation) {\n      case '+':\n        num1 = Math.floor(Math.random() * maxNum) + 1;\n        num2 = Math.floor(Math.random() * maxNum) + 1;\n        answer = num1 + num2;\n        break;\n      case '-':\n        num1 = Math.floor(Math.random() * maxNum) + 2;\n        num2 = Math.floor(Math.random() * (num1 - 1)) + 1;\n        answer = num1 - num2;\n        break;\n      case '*':\n        num1 = Math.floor(Math.random() * Math.min(10, maxNum)) + 1;\n        num2 = Math.floor(Math.random() * Math.min(10, maxNum)) + 1;\n        answer = num1 * num2;\n        break;\n      case '/':\n        num2 = Math.floor(Math.random() * 8) + 2;\n        answer = Math.floor(Math.random() * 10) + 2;\n        num1 = num2 * answer;\n        break;\n      default:\n        num1 = 1;\n        num2 = 1;\n        answer = 2;\n    }\n  } while (answer < 1 || !Number.isInteger(answer));\n  \n  const opSymbol = operation === '*' ? 'Ã—' : operation === '/' ? 'Ã·' : operation;\n  return { equation: `${num1} ${opSymbol} ${num2}`, answer };\n};\n\nconst generateRainDrop = (difficulty: number, timeRemaining: number = 90): RainDrop => {\n  const { equation, answer } = generateMathEquation(difficulty);\n  \n  const baseSpeed = 0.35;\n  const difficultyBonus = difficulty * 0.03;\n  \n  return {\n    id: Math.random().toString(36).substr(2, 9),\n    equation,\n    answer,\n    x: Math.random() * 70 + 15,\n    y: 0,\n    speed: baseSpeed + difficultyBonus,\n  };\n};\n\nconst generateRandomHint = (secretCode: number[]): Hint => {\n  const numDigits = secretCode.length;\n  const hintChoice = Math.random();\n  \n  if (hintChoice < 0.4) {\n    const position = Math.floor(Math.random() * numDigits);\n    const digit = secretCode[position];\n    return {\n      type: \"digit\",\n      value: digit,\n      position,\n    };\n  } else if (hintChoice < 0.7) {\n    const position = Math.floor(Math.random() * numDigits);\n    const digit = secretCode[position];\n    const isEven = digit % 2 === 0;\n    const parity = isEven ? 'Ø²ÙˆØ¬ÙŠ' : 'ÙØ±Ø¯ÙŠ';\n    \n    return {\n      type: \"description\",\n      value: `Ø§Ù„Ø®Ø§Ù†Ø© ${position + 1} Ø±Ù‚Ù… ${parity}`,\n    };\n  } else {\n    const availablePositions = Array.from({ length: numDigits }, (_, i) => i);\n    \n    const pos1Index = Math.floor(Math.random() * availablePositions.length);\n    const pos1 = availablePositions[pos1Index];\n    availablePositions.splice(pos1Index, 1);\n    \n    const pos2Index = Math.floor(Math.random() * availablePositions.length);\n    const pos2 = availablePositions[pos2Index];\n    \n    const digit1 = secretCode[pos1];\n    const digit2 = secretCode[pos2];\n    const parity1 = digit1 % 2 === 0 ? 'Ø²ÙˆØ¬ÙŠ' : 'ÙØ±Ø¯ÙŠ';\n    const parity2 = digit2 % 2 === 0 ? 'Ø²ÙˆØ¬ÙŠ' : 'ÙØ±Ø¯ÙŠ';\n    \n    const hint1 = `Ø§Ù„Ø®Ø§Ù†Ø© ${pos1 + 1} Ø±Ù‚Ù… ${parity1}`;\n    const hint2 = `Ø§Ù„Ø®Ø§Ù†Ø© ${pos2 + 1} Ø±Ù‚Ù… ${parity2}`;\n    \n    return {\n      type: \"description\",\n      value: `${hint1} Ùˆ ${hint2}`,\n    };\n  }\n};\n\nconst generateRandomDirection = (): { direction: DirectionType; color: ColorDirection | null; useColors: boolean } => {\n  const useColors = Math.random() > 0.6;\n  const simpleDirections: DirectionType[] = [\"right\", \"left\", \"up\", \"down\"];\n  const allDirections: DirectionType[] = [\"right\", \"left\", \"up\", \"down\", \"notRight\", \"notLeft\", \"notUp\", \"notDown\", \"notRed\", \"notYellow\", \"notGreen\", \"notBlue\", \"nothing\"];\n  const colors: ColorDirection[] = [\"green\", \"yellow\", \"blue\", \"red\"];\n  \n  if (useColors) {\n    const direction = simpleDirections[Math.floor(Math.random() * simpleDirections.length)];\n    const color = colors[Math.floor(Math.random() * colors.length)];\n    return { direction, color, useColors: true };\n  }\n  \n  const direction = allDirections[Math.floor(Math.random() * allDirections.length)];\n  return { direction, color: null, useColors: false };\n};\n\nconst generateColorPositions = (): ColorPosition => {\n  const positions: ('left' | 'right' | 'top' | 'bottom')[] = ['left', 'right', 'top', 'bottom'];\n  const shuffled = [...positions].sort(() => Math.random() - 0.5);\n  return {\n    yellow: shuffled[0],\n    green: shuffled[1],\n    blue: shuffled[2],\n    red: shuffled[3],\n  };\n};\n\nconst positionToDirection = {\n  'left': 'left' as const,\n  'right': 'right' as const,\n  'top': 'up' as const,\n  'bottom': 'down' as const,\n};\n\nexport const useChallenges = create<ChallengesState>()((set, get) => ({\n  maxAttempts: 3,\n  attempts: [],\n  selectedChallenge: null,\n  currentPhase: \"menu\",\n  hint: null,\n  \n  guessChallenge: {\n    sequence: [],\n    playerSequence: [],\n    currentLevel: 0,\n    isShowingSequence: false,\n  },\n  \n  memoryChallenge: {\n    currentLevel: 1,\n    gridSize: 3,\n    flashedCells: [],\n    selectedCells: [],\n    isShowingCells: false,\n    showingScanner: false,\n    showingSuccess: false,\n  },\n  \n  directionChallenge: {\n    currentDirection: null,\n    currentColor: null,\n    useColors: false,\n    colorPositions: null,\n    score: 0,\n    errors: 0,\n    maxErrors: 3,\n    timePerRound: 2500,\n    roundStartTime: null,\n    isWaiting: false,\n    gameTime: 60,\n    totalRounds: 25,\n    currentRound: 0,\n  },\n\n  raindropsChallenge: {\n    drops: [],\n    score: 0,\n    errors: 0,\n    maxErrors: 5,\n    gameTime: 90,\n    timeRemaining: 90,\n    currentInput: '',\n    isGameActive: false,\n    difficulty: 0,\n  },\n\n  selectChallenge: (challengeId) => {\n    set({ selectedChallenge: challengeId });\n  },\n\n  startChallenge: () => {\n    const { selectedChallenge } = get();\n    if (!selectedChallenge) return;\n\n    set({ currentPhase: \"playing\" });\n\n    if (selectedChallenge === \"guess\") {\n      const sequence = generateSequence(0);\n      set({\n        guessChallenge: {\n          sequence,\n          playerSequence: [],\n          currentLevel: 0,\n          isShowingSequence: true,\n        },\n      });\n    } else if (selectedChallenge === \"memory\") {\n      set({\n        memoryChallenge: {\n          currentLevel: 1,\n          gridSize: 3,\n          flashedCells: [],\n          selectedCells: [],\n          isShowingCells: false,\n          showingScanner: false,\n          showingSuccess: false,\n        },\n      });\n    } else if (selectedChallenge === \"direction\") {\n      get().directionStartGame();\n    } else if (selectedChallenge === \"raindrops\") {\n      get().raindropsStartGame();\n    }\n  },\n\n  completeChallenge: (success) => {\n    const { selectedChallenge, attempts } = get();\n    if (!selectedChallenge) return;\n\n    const newAttempt: ChallengeAttempt = {\n      challengeId: selectedChallenge,\n      success,\n      timestamp: Date.now(),\n    };\n\n    set({\n      attempts: [...attempts, newAttempt],\n      currentPhase: success ? \"won\" : \"lost\",\n    });\n  },\n\n  resetToMenu: () => {\n    set({\n      selectedChallenge: null,\n      currentPhase: \"menu\",\n    });\n  },\n\n  resetChallengesHub: () => {\n    const { hint, attempts } = get();\n    const hasWon = attempts.some(a => a.success);\n    \n    set({\n      maxAttempts: 3,\n      attempts: [],\n      selectedChallenge: null,\n      currentPhase: \"menu\",\n      hint: hasWon ? hint : null,\n      guessChallenge: {\n        sequence: [],\n        playerSequence: [],\n        currentLevel: 0,\n        isShowingSequence: false,\n      },\n      memoryChallenge: {\n        currentLevel: 1,\n        gridSize: 3,\n        flashedCells: [],\n        selectedCells: [],\n        isShowingCells: false,\n        showingScanner: false,\n        showingSuccess: false,\n      },\n      directionChallenge: {\n        currentDirection: null,\n        currentColor: null,\n        useColors: false,\n        colorPositions: null,\n        score: 0,\n        errors: 0,\n        maxErrors: 3,\n        timePerRound: 500,\n        roundStartTime: null,\n        isWaiting: false,\n        gameTime: 60,\n        totalRounds: 30,\n        currentRound: 0,\n      },\n      raindropsChallenge: {\n        drops: [],\n        score: 0,\n        errors: 0,\n        maxErrors: 5,\n        gameTime: 90,\n        timeRemaining: 90,\n        currentInput: '',\n        isGameActive: false,\n        difficulty: 0,\n      },\n    });\n  },\n\n  getRemainingAttempts: () => {\n    const { attempts, maxAttempts } = get();\n    return maxAttempts - attempts.filter(a => !a.success).length;\n  },\n\n  hasWonAnyChallenge: () => {\n    const { attempts } = get();\n    return attempts.some(a => a.success);\n  },\n\n  canPlayChallenge: (challengeId) => {\n    const { attempts, hasWonAnyChallenge, getRemainingAttempts } = get();\n    \n    if (hasWonAnyChallenge()) return false;\n    \n    if (getRemainingAttempts() <= 0) return false;\n    \n    const hasWon = attempts.some(a => a.challengeId === challengeId && a.success);\n    if (hasWon) return false;\n    \n    return true;\n  },\n\n  generateHint: (secretCode) => {\n    const hint = generateRandomHint(secretCode);\n    set({ hint });\n  },\n\n  guessAddToSequence: (buttonIndex) => {\n    const { guessChallenge } = get();\n    const { playerSequence, sequence, currentLevel } = guessChallenge;\n\n    const newPlayerSequence = [...playerSequence, buttonIndex];\n    const currentIndex = playerSequence.length;\n\n    if (sequence[currentIndex] !== buttonIndex) {\n      get().completeChallenge(false);\n      return;\n    }\n\n    set({\n      guessChallenge: {\n        ...guessChallenge,\n        playerSequence: newPlayerSequence,\n      },\n    });\n\n    if (newPlayerSequence.length === sequence.length) {\n      const nextLevelNum = currentLevel + 1;\n      if (nextLevelNum >= 5) {\n        setTimeout(() => {\n          get().completeChallenge(true);\n        }, 500);\n      } else {\n        setTimeout(() => {\n          get().guessNextLevel();\n        }, 1000);\n      }\n    }\n  },\n\n  guessNextLevel: () => {\n    const { guessChallenge } = get();\n    const newLevel = guessChallenge.currentLevel + 1;\n    const newSequence = generateSequence(newLevel);\n\n    set({\n      guessChallenge: {\n        ...guessChallenge,\n        currentLevel: newLevel,\n        sequence: newSequence,\n        playerSequence: [],\n        isShowingSequence: true,\n      },\n    });\n  },\n\n  guessSetShowingSequence: (showing) => {\n    const { guessChallenge } = get();\n    set({\n      guessChallenge: {\n        ...guessChallenge,\n        isShowingSequence: showing,\n      },\n    });\n  },\n\n  memoryFlashCells: (cells) => {\n    const { memoryChallenge } = get();\n    set({\n      memoryChallenge: {\n        ...memoryChallenge,\n        flashedCells: cells,\n        selectedCells: [],\n        isShowingCells: true,\n        showingScanner: false,\n        showingSuccess: false,\n      },\n    });\n  },\n\n  memorySelectCell: (cell) => {\n    const { memoryChallenge } = get();\n    if (memoryChallenge.selectedCells.includes(cell)) return;\n\n    set({\n      memoryChallenge: {\n        ...memoryChallenge,\n        selectedCells: [...memoryChallenge.selectedCells, cell],\n      },\n    });\n  },\n\n  memoryCheckSelection: () => {\n    const { memoryChallenge } = get();\n    const { flashedCells, selectedCells } = memoryChallenge;\n\n    if (selectedCells.length !== flashedCells.length) return false;\n\n    for (const cell of selectedCells) {\n      if (!flashedCells.includes(cell)) {\n        get().completeChallenge(false);\n        return false;\n      }\n    }\n\n    return true;\n  },\n\n  memoryNextLevel: () => {\n    const { memoryChallenge } = get();\n    const newLevel = memoryChallenge.currentLevel + 1;\n\n    if (newLevel > 5) {\n      get().completeChallenge(true);\n      return;\n    }\n\n    set({\n      memoryChallenge: {\n        ...memoryChallenge,\n        currentLevel: newLevel,\n        gridSize: 5,\n        flashedCells: [],\n        selectedCells: [],\n        isShowingCells: false,\n        showingScanner: false,\n        showingSuccess: false,\n      },\n    });\n  },\n\n  memorySetScanner: (showing) => {\n    const { memoryChallenge } = get();\n    set({\n      memoryChallenge: {\n        ...memoryChallenge,\n        showingScanner: showing,\n      },\n    });\n  },\n\n  memorySetSuccess: (showing) => {\n    const { memoryChallenge } = get();\n    set({\n      memoryChallenge: {\n        ...memoryChallenge,\n        showingSuccess: showing,\n      },\n    });\n  },\n\n  directionStartGame: () => {\n    const { direction, color, useColors } = generateRandomDirection();\n    const colorPositions = useColors ? generateColorPositions() : null;\n    set({\n      directionChallenge: {\n        currentDirection: direction,\n        currentColor: color,\n        useColors,\n        colorPositions,\n        score: 0,\n        errors: 0,\n        maxErrors: 3,\n        timePerRound: 1700,\n        roundStartTime: Date.now(),\n        isWaiting: false,\n        gameTime: 60,\n        totalRounds: 25,\n        currentRound: 1,\n      },\n    });\n  },\n\n  directionNextRound: () => {\n    const { directionChallenge } = get();\n    const newRound = directionChallenge.currentRound + 1;\n    \n    if (newRound > directionChallenge.totalRounds) {\n      get().completeChallenge(true);\n      return;\n    }\n\n    const { direction, color, useColors } = generateRandomDirection();\n    const colorPositions = useColors ? generateColorPositions() : null;\n    set({\n      directionChallenge: {\n        ...directionChallenge,\n        currentDirection: direction,\n        currentColor: color,\n        useColors,\n        colorPositions,\n        roundStartTime: Date.now(),\n        isWaiting: false,\n        currentRound: newRound,\n      },\n    });\n  },\n\n  directionHandleInput: (input) => {\n    const state = get();\n    const { directionChallenge } = state;\n    const { currentDirection, currentColor, useColors, colorPositions, errors, maxErrors, score } = directionChallenge;\n    \n    if (!currentDirection) {\n      console.log(\"[Direction] No current direction, returning false\");\n      return false;\n    }\n\n    // Helper function to convert direction to color\n    const directionToColor = (dir: string): ColorDirection | null => {\n      switch(dir) {\n        case \"up\": return \"red\";\n        case \"left\": return \"yellow\";\n        case \"right\": return \"green\";\n        case \"down\": return \"blue\";\n        default: return null;\n      }\n    };\n\n    let isCorrect = false;\n    let expectedInput: string = \"\";\n    \n    if (currentDirection === \"nothing\") {\n      expectedInput = \"none (timeout)\";\n      isCorrect = input === \"none\";\n    } else if (useColors && currentColor && colorPositions) {\n      const position = colorPositions[currentColor];\n      expectedInput = positionToDirection[position];\n      isCorrect = input === expectedInput;\n      console.log(`[Direction Color Mode] Color: ${currentColor}, Position: ${position}, Expected: ${expectedInput}, Got: ${input}, Correct: ${isCorrect}`);\n    } else {\n      switch (currentDirection) {\n        case \"right\":\n          expectedInput = \"right\";\n          isCorrect = input === \"right\";\n          break;\n        case \"left\":\n          expectedInput = \"left\";\n          isCorrect = input === \"left\";\n          break;\n        case \"up\":\n          expectedInput = \"up\";\n          isCorrect = input === \"up\";\n          break;\n        case \"down\":\n          expectedInput = \"down\";\n          isCorrect = input === \"down\";\n          break;\n        case \"notRight\":\n          expectedInput = \"left, up, or down\";\n          isCorrect = input === \"left\" || input === \"up\" || input === \"down\";\n          break;\n        case \"notLeft\":\n          expectedInput = \"right, up, or down\";\n          isCorrect = input === \"right\" || input === \"up\" || input === \"down\";\n          break;\n        case \"notUp\":\n          expectedInput = \"left, right, or down\";\n          isCorrect = input === \"left\" || input === \"right\" || input === \"down\";\n          break;\n        case \"notDown\":\n          expectedInput = \"left, right, or up\";\n          isCorrect = input === \"left\" || input === \"right\" || input === \"up\";\n          break;\n        case \"notRed\": {\n          const selectedColor = directionToColor(input);\n          expectedInput = \"green, yellow, or blue\";\n          isCorrect = selectedColor !== \"red\";\n          console.log(`[Direction Not Color Mode] Input: ${input}, Selected Color: ${selectedColor}, Expected: not red, Correct: ${isCorrect}`);\n          break;\n        }\n        case \"notYellow\": {\n          const selectedColor = directionToColor(input);\n          expectedInput = \"red, green, or blue\";\n          isCorrect = selectedColor !== \"yellow\";\n          console.log(`[Direction Not Color Mode] Input: ${input}, Selected Color: ${selectedColor}, Expected: not yellow, Correct: ${isCorrect}`);\n          break;\n        }\n        case \"notGreen\": {\n          const selectedColor = directionToColor(input);\n          expectedInput = \"red, yellow, or blue\";\n          isCorrect = selectedColor !== \"green\";\n          console.log(`[Direction Not Color Mode] Input: ${input}, Selected Color: ${selectedColor}, Expected: not green, Correct: ${isCorrect}`);\n          break;\n        }\n        case \"notBlue\": {\n          const selectedColor = directionToColor(input);\n          expectedInput = \"red, yellow, or green\";\n          isCorrect = selectedColor !== \"blue\";\n          console.log(`[Direction Not Color Mode] Input: ${input}, Selected Color: ${selectedColor}, Expected: not blue, Correct: ${isCorrect}`);\n          break;\n        }\n      }\n      console.log(`[Direction] Direction: ${currentDirection}, Expected: ${expectedInput}, Got: ${input}, Correct: ${isCorrect}`);\n    }\n\n    if (isCorrect) {\n      const newScore = score + 1;\n      set({\n        directionChallenge: {\n          ...directionChallenge,\n          score: newScore,\n        },\n      });\n      console.log(`[Direction] Correct! Score: ${score} -> ${newScore}`);\n      return true;\n    } else {\n      const newErrors = errors + 1;\n      console.log(`[Direction] Wrong! Errors: ${errors} -> ${newErrors}`);\n      if (newErrors >= maxErrors) {\n        get().completeChallenge(false);\n      } else {\n        set({\n          directionChallenge: {\n            ...directionChallenge,\n            errors: newErrors,\n          },\n        });\n      }\n      return false;\n    }\n  },\n\n  directionTimeOut: () => {\n    const { directionChallenge } = get();\n    const { currentDirection, errors, maxErrors } = directionChallenge;\n    \n    if (currentDirection === \"nothing\") {\n      set({\n        directionChallenge: {\n          ...directionChallenge,\n          score: directionChallenge.score + 1,\n        },\n      });\n      return;\n    }\n    \n    const newErrors = errors + 1;\n    if (newErrors >= maxErrors) {\n      get().completeChallenge(false);\n    } else {\n      set({\n        directionChallenge: {\n          ...directionChallenge,\n          errors: newErrors,\n        },\n      });\n    }\n  },\n\n  raindropsStartGame: () => {\n    const initialDrop = generateRainDrop(0);\n    set({\n      raindropsChallenge: {\n        drops: [initialDrop],\n        score: 0,\n        errors: 0,\n        maxErrors: 5,\n        gameTime: 90,\n        timeRemaining: 90,\n        currentInput: '',\n        isGameActive: true,\n        difficulty: 0,\n      },\n    });\n  },\n\n  raindropsAddDrop: () => {\n    const { raindropsChallenge } = get();\n    if (!raindropsChallenge.isGameActive) return;\n    \n    const newDrop = generateRainDrop(raindropsChallenge.difficulty, raindropsChallenge.timeRemaining);\n    set({\n      raindropsChallenge: {\n        ...raindropsChallenge,\n        drops: [...raindropsChallenge.drops, newDrop],\n      },\n    });\n  },\n\n  raindropsUpdateDrops: (deltaTime: number) => {\n    const { raindropsChallenge } = get();\n    if (!raindropsChallenge.isGameActive) return;\n    \n    const { timeRemaining } = raindropsChallenge;\n    let speedMultiplier = 0.025;\n    \n    if (timeRemaining <= 15) {\n      const urgencyFactor = (15 - timeRemaining) / 15;\n      speedMultiplier = 0.025 + urgencyFactor * 0.02;\n    }\n    \n    const updatedDrops = raindropsChallenge.drops.map(drop => ({\n      ...drop,\n      y: drop.y + drop.speed * deltaTime * speedMultiplier,\n    }));\n    \n    set({\n      raindropsChallenge: {\n        ...raindropsChallenge,\n        drops: updatedDrops,\n      },\n    });\n  },\n\n  raindropsSetInput: (input: string) => {\n    const { raindropsChallenge } = get();\n    set({\n      raindropsChallenge: {\n        ...raindropsChallenge,\n        currentInput: input,\n      },\n    });\n  },\n\n  raindropsSubmitAnswer: () => {\n    const { raindropsChallenge } = get();\n    const answer = parseInt(raindropsChallenge.currentInput);\n    \n    if (isNaN(answer)) return false;\n    \n    const matchingDrop = raindropsChallenge.drops.find(drop => drop.answer === answer);\n    \n    if (matchingDrop) {\n      const newScore = raindropsChallenge.score + 1;\n      const newDifficulty = Math.floor(newScore / 5);\n      \n      set({\n        raindropsChallenge: {\n          ...raindropsChallenge,\n          drops: raindropsChallenge.drops.filter(d => d.id !== matchingDrop.id),\n          score: newScore,\n          currentInput: '',\n          difficulty: newDifficulty,\n        },\n      });\n      return true;\n    } else {\n      const newErrors = raindropsChallenge.errors + 1;\n      if (newErrors >= raindropsChallenge.maxErrors) {\n        set({\n          raindropsChallenge: {\n            ...raindropsChallenge,\n            errors: newErrors,\n            isGameActive: false,\n            currentInput: '',\n          },\n        });\n        get().completeChallenge(false);\n      } else {\n        set({\n          raindropsChallenge: {\n            ...raindropsChallenge,\n            errors: newErrors,\n            currentInput: '',\n          },\n        });\n      }\n      return false;\n    }\n  },\n\n  raindropsRemoveDrop: (dropId: string) => {\n    const { raindropsChallenge } = get();\n    set({\n      raindropsChallenge: {\n        ...raindropsChallenge,\n        drops: raindropsChallenge.drops.filter(d => d.id !== dropId),\n      },\n    });\n  },\n\n  raindropsMissedDrop: () => {\n    const { raindropsChallenge } = get();\n    const newErrors = raindropsChallenge.errors + 1;\n    \n    if (newErrors >= raindropsChallenge.maxErrors) {\n      set({\n        raindropsChallenge: {\n          ...raindropsChallenge,\n          errors: newErrors,\n          isGameActive: false,\n        },\n      });\n      get().completeChallenge(false);\n    } else {\n      set({\n        raindropsChallenge: {\n          ...raindropsChallenge,\n          errors: newErrors,\n        },\n      });\n    }\n  },\n\n  raindropsUpdateTime: (time: number) => {\n    const { raindropsChallenge } = get();\n    \n    if (time <= 0) {\n      set({\n        raindropsChallenge: {\n          ...raindropsChallenge,\n          timeRemaining: 0,\n          isGameActive: false,\n        },\n      });\n      get().completeChallenge(true);\n      return;\n    }\n    \n    const newDifficulty = Math.floor((90 - time) / 15);\n    \n    set({\n      raindropsChallenge: {\n        ...raindropsChallenge,\n        timeRemaining: time,\n        difficulty: newDifficulty,\n      },\n    });\n  },\n}));\n","path":null,"size_bytes":26856,"size_tokens":null},"client/src/components/game/DisplayPanel.tsx":{"content":"import { Text, RoundedBox } from \"@react-three/drei\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\n\nexport function DisplayPanel() {\n  const { mode, singleplayer, multiplayer } = useNumberGame();\n  const currentGuess = mode === \"singleplayer\" ? singleplayer.currentGuess : multiplayer.currentGuess;\n  const numDigits = mode === \"singleplayer\" ? singleplayer.settings.numDigits : multiplayer.settings.numDigits;\n\n  const displayText = currentGuess.map((d) => d.toString()).join(\"  \");\n  const emptySlots = numDigits - currentGuess.length;\n  const emptyText = \"_  \".repeat(emptySlots);\n  \n  // Calculate panel width based on number of digits\n  const panelWidth = numDigits * 0.8;\n\n  return (\n    <group position={[0, 2.2, 0]}>\n      <RoundedBox\n        args={[panelWidth, 0.65, 0.2]}\n        radius={0.12}\n        smoothness={6}\n        castShadow\n      >\n        <meshStandardMaterial \n          color=\"#1e293b\"\n          metalness={0.3}\n          roughness={0.5}\n          emissive=\"#334155\"\n          emissiveIntensity={0.3}\n        />\n      </RoundedBox>\n      \n      <Text\n        position={[0, 0, 0.15]}\n        fontSize={0.42}\n        color=\"#f1f5f9\"\n        anchorX=\"center\"\n        anchorY=\"middle\"\n        fontWeight=\"bold\"\n        letterSpacing={0.12}\n      >\n        {displayText}{emptyText}\n      </Text>\n    </group>\n  );\n}\n","path":null,"size_bytes":1351,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-9 px-2 min-w-9\",\n        sm: \"h-8 px-1.5 min-w-8\",\n        lg: \"h-10 px-2.5 min-w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1486,"size_tokens":null},"client/src/components/game/challenges/ReactionChallenge.tsx":{"content":"import { useEffect, useState, useRef } from \"react\";\nimport { useChallenges } from \"@/lib/stores/useChallenges\";\nimport { useAudio } from \"@/lib/stores/useAudio\";\nimport { ArrowLeft, Clock, Zap } from \"lucide-react\";\n\nexport function ReactionChallenge() {\n  const {\n    reactionChallenge,\n    reactionStartGame,\n    reactionClickCell,\n    reactionUpdateTimer,\n    reactionSpawnTarget,\n    resetToMenu,\n  } = useChallenges();\n\n  const { playConfirm, playError } = useAudio();\n  const [currentSpeed, setCurrentSpeed] = useState(1500);\n  const timerRef = useRef<NodeJS.Timeout | null>(null);\n  const spawnRef = useRef<NodeJS.Timeout | null>(null);\n  const fakeOutRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    reactionStartGame();\n\n    timerRef.current = setInterval(() => {\n      reactionUpdateTimer();\n    }, 1000);\n\n    spawnTarget();\n\n    return () => {\n      if (timerRef.current) clearInterval(timerRef.current);\n      if (spawnRef.current) clearTimeout(spawnRef.current);\n      if (fakeOutRef.current) clearTimeout(fakeOutRef.current);\n    };\n  }, []);\n\n  useEffect(() => {\n    const elapsedTime = 45 - reactionChallenge.timeRemaining;\n    \n    // Last 10 seconds: decelerate from 1500ms to 700ms\n    if (reactionChallenge.timeRemaining <= 10) {\n      const progressInLast10 = (10 - reactionChallenge.timeRemaining) / 10;\n      const newSpeed = 1500 - (progressInLast10 * 800);\n      setCurrentSpeed(Math.max(newSpeed, 700));\n    } else {\n      // Initial speed: 1500ms\n      setCurrentSpeed(1500);\n    }\n  }, [reactionChallenge.timeRemaining]);\n\n  const spawnTarget = () => {\n    const timeRemainingWhenSpawned = reactionChallenge.timeRemaining;\n    \n    // Calculate speed based on current time remaining\n    let speed = 1500;\n    if (timeRemainingWhenSpawned <= 10) {\n      const progressInLast10 = (10 - timeRemainingWhenSpawned) / 10;\n      speed = Math.max(1500 - (progressInLast10 * 800), 700);\n    }\n    \n    reactionSpawnTarget();\n\n    // Fake-out behavior in last 20 seconds\n    if (timeRemainingWhenSpawned <= 20 && Math.random() > 0.5) {\n      // Create a fake-out: show target briefly then hide it\n      fakeOutRef.current = setTimeout(() => {\n        if (reactionChallenge.currentTarget !== null) {\n          // Hide the target (spawn null or new location)\n          const totalCells = reactionChallenge.gridSize * reactionChallenge.gridSize;\n          const newCell = Math.floor(Math.random() * totalCells);\n          reactionSpawnTarget();\n        }\n      }, 300); // Show fake target for 300ms then switch\n    }\n\n    spawnRef.current = setTimeout(() => {\n      if (reactionChallenge.currentTarget !== null) {\n        const newErrors = reactionChallenge.errors + 1;\n        if (newErrors < 5) {\n          spawnTarget();\n        }\n      }\n    }, speed);\n  };\n\n  const handleCellClick = (cell: number, e?: React.MouseEvent) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    const isCorrect = reactionChallenge.currentTarget === cell;\n    \n    if (isCorrect) {\n      playConfirm();\n    } else {\n      playError();\n    }\n    \n    reactionClickCell(cell);\n    \n    if (spawnRef.current) {\n      clearTimeout(spawnRef.current);\n    }\n    if (fakeOutRef.current) {\n      clearTimeout(fakeOutRef.current);\n    }\n\n    if (reactionChallenge.errors < 5) {\n      setTimeout(() => {\n        spawnTarget();\n      }, 300);\n    }\n  };\n\n  return (\n    <div className=\"w-full h-full flex flex-col items-center justify-center p-8 bg-slate-950\">\n      <div className=\"w-full max-w-3xl\">\n        <div className=\"flex items-center justify-between mb-8\">\n          <button\n            onClick={resetToMenu}\n            className=\"flex items-center gap-2 bg-slate-800/80 hover:bg-slate-700/80 text-white px-6 py-3 rounded-xl transition-all shadow-lg\"\n          >\n            <ArrowLeft className=\"w-5 h-5\" />\n            <span className=\"font-bold\">Ø±Ø¬ÙˆØ¹</span>\n          </button>\n\n          <div className=\"text-center\">\n            <h2 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-white mb-1\">\n              Ù„Ø¹Ø¨Ø© Ø±Ø¯ Ø§Ù„ÙØ¹Ù„\n            </h2>\n            <p className=\"text-sm sm:text-base lg:text-lg text-gray-400\">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù…Ø¶ÙŠØ¡ Ø¨Ø³Ø±Ø¹Ø©!</p>\n          </div>\n\n          <div className=\"w-24\"></div>\n        </div>\n\n        <div className=\"flex flex-col sm:flex-row items-center justify-around gap-4 sm:gap-3 lg:gap-4 mb-8 w-full\">\n          <div className=\"bg-slate-800/80 backdrop-blur-xl px-4 sm:px-6 py-3 sm:py-4 rounded-2xl shadow-lg flex-1 sm:flex-none\">\n            <div className=\"flex items-center gap-2 sm:gap-3\">\n              <Clock className=\"w-5 sm:w-6 h-5 sm:h-6 text-blue-400\" />\n              <div>\n                <p className=\"text-gray-400 text-xs sm:text-sm\">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</p>\n                <p className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-white\">\n                  {reactionChallenge.timeRemaining}s\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-slate-800/80 backdrop-blur-xl px-4 sm:px-6 py-3 sm:py-4 rounded-2xl shadow-lg flex-1 sm:flex-none\">\n            <div className=\"flex items-center gap-2 sm:gap-3\">\n              <Zap className=\"w-5 sm:w-6 h-5 sm:h-6 text-green-400\" />\n              <div>\n                <p className=\"text-gray-400 text-xs sm:text-sm\">Ø§Ù„Ù†Ù‚Ø§Ø·</p>\n                <p className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-white\">\n                  {reactionChallenge.score}\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-slate-800/80 backdrop-blur-xl px-4 sm:px-6 py-3 sm:py-4 rounded-2xl shadow-lg flex-1 sm:flex-none\">\n            <div className=\"flex items-center gap-2 sm:gap-3\">\n              <svg\n                className=\"w-5 sm:w-6 h-5 sm:h-6 text-red-400\"\n                fill=\"currentColor\"\n                viewBox=\"0 0 20 20\"\n              >\n                <path\n                  fillRule=\"evenodd\"\n                  d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\"\n                  clipRule=\"evenodd\"\n                />\n              </svg>\n              <div>\n                <p className=\"text-gray-400 text-xs sm:text-sm\">Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</p>\n                <p className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-white\">\n                  {reactionChallenge.errors} / 5\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div\n          className=\"grid grid-cols-5 gap-1 sm:gap-2 md:gap-3 lg:gap-4 w-full max-w-xs sm:max-w-sm md:max-w-xl lg:max-w-3xl mx-auto px-2 sm:px-4\"\n        >\n          {Array.from({ length: 25 }).map((_, i) => {\n            const isTarget = reactionChallenge.currentTarget === i;\n\n            return (\n              <button\n                key={i}\n                onClick={(e) => handleCellClick(i, e)}\n                className={`aspect-square rounded-xl transition-all transform shadow-lg ${\n                  isTarget\n                    ? \"bg-yellow-500 scale-110 shadow-2xl shadow-yellow-500/50 animate-pulse\"\n                    : \"bg-slate-700 hover:bg-slate-600 hover:scale-105\"\n                }`}\n              />\n            );\n          })}\n        </div>\n\n        <div className=\"mt-8 text-center\">\n          <p className=\"text-sm sm:text-base lg:text-lg text-gray-400\">\n            Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: {(currentSpeed / 1000).toFixed(1)}s\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7709,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/game/AttemptsHistory.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { Text, RoundedBox } from \"@react-three/drei\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\n\nexport function AttemptsHistory() {\n  const { mode, singleplayer, multiplayer } = useNumberGame();\n  const [scrollOffset, setScrollOffset] = useState(0);\n  const scrollRef = useRef(0);\n\n  if (mode !== \"singleplayer\" && mode !== \"multiplayer\") {\n    return null;\n  }\n\n  const attempts = mode === \"singleplayer\" ? singleplayer.attempts : multiplayer.attempts;\n  const numDigits = mode === \"singleplayer\" ? singleplayer.settings.numDigits : multiplayer.settings.numDigits;\n  const maxAttempts = mode === \"singleplayer\" ? singleplayer.settings.maxAttempts : multiplayer.settings.maxAttempts;\n  const attemptCount = attempts.length;\n  const itemHeight = 0.65;\n  const panelWidth = 5.5;\n  const panelHeight = 4.5;\n  const maxVisibleItems = 5;\n  \n  const dragStartY = useRef(0);\n  const isDragging = useRef(false);\n\n  useEffect(() => {\n    const handleWheel = (e: WheelEvent) => {\n      // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¨Ø³Ø±Ø¹Ø© Ø£ÙƒØ¨Ø± Ø¹Ø´Ø§Ù† ÙŠÙƒÙˆÙ† Ø³Ù„Ø³ Ø²ÙŠ Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†\n      const maxScroll = Math.max(0, attemptCount - maxVisibleItems) * itemHeight;\n      scrollRef.current = Math.max(0, Math.min(maxScroll, scrollRef.current + e.deltaY * 0.008));\n      setScrollOffset(scrollRef.current);\n    };\n\n    const handleKeyboard = (e: KeyboardEvent) => {\n      if (e.key === 'PageDown' || (e.key === 'ArrowDown' && e.shiftKey)) {\n        e.preventDefault();\n        const maxScroll = Math.max(0, attemptCount - maxVisibleItems) * itemHeight;\n        scrollRef.current = Math.max(0, Math.min(maxScroll, scrollRef.current + itemHeight * 2));\n        setScrollOffset(scrollRef.current);\n      } else if (e.key === 'PageUp' || (e.key === 'ArrowUp' && e.shiftKey)) {\n        e.preventDefault();\n        const maxScroll = Math.max(0, attemptCount - maxVisibleItems) * itemHeight;\n        scrollRef.current = Math.max(0, Math.min(maxScroll, scrollRef.current - itemHeight * 2));\n        setScrollOffset(scrollRef.current);\n      }\n    };\n\n    const handleMouseDown = (e: MouseEvent) => {\n      // ÙƒÙ„ÙŠÙƒ ÙŠÙ…ÙŠÙ† Ù…Ø·ÙˆÙ„ Ù„Ù„Ø³Ø­Ø¨\n      if (e.button === 2) { // 2 = right mouse button\n        isDragging.current = true;\n        dragStartY.current = e.clientY;\n      }\n    };\n\n    const handleMouseMove = (e: MouseEvent) => {\n      if (!isDragging.current) return;\n      \n      const deltaY = e.clientY - dragStartY.current;\n      const maxScroll = Math.max(0, attemptCount - maxVisibleItems) * itemHeight;\n      // Ø¹ÙƒØ³ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ - Ù„Ù…Ø§ ØªØ³Ø­Ø¨ Ù„Ø£Ø³ÙÙ„ ÙŠØ±ÙØ¹ Ù„Ù„Ø£Ø¹Ù„Ù‰\n      scrollRef.current = Math.max(0, Math.min(maxScroll, scrollRef.current - deltaY * 0.008));\n      setScrollOffset(scrollRef.current);\n      dragStartY.current = e.clientY;\n    };\n\n    const handleMouseUp = () => {\n      isDragging.current = false;\n    };\n\n    const handleContextMenu = (e: MouseEvent) => {\n      // Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„ÙƒÙ„ÙŠÙƒ Ø§Ù„ÙŠÙ…ÙŠÙ†\n      e.preventDefault();\n    };\n\n    window.addEventListener('wheel', handleWheel, { passive: true });\n    window.addEventListener('keydown', handleKeyboard);\n    window.addEventListener('mousedown', handleMouseDown);\n    window.addEventListener('mousemove', handleMouseMove);\n    window.addEventListener('mouseup', handleMouseUp);\n    window.addEventListener('contextmenu', handleContextMenu);\n    \n    return () => {\n      window.removeEventListener('wheel', handleWheel);\n      window.removeEventListener('keydown', handleKeyboard);\n      window.removeEventListener('mousedown', handleMouseDown);\n      window.removeEventListener('mousemove', handleMouseMove);\n      window.removeEventListener('mouseup', handleMouseUp);\n      window.removeEventListener('contextmenu', handleContextMenu);\n    };\n  }, [attemptCount, maxVisibleItems, itemHeight]);\n\n  const startIndex = Math.floor(scrollOffset / itemHeight);\n  const visibleAttempts = attempts.slice(startIndex, startIndex + maxVisibleItems);\n\n  const maxScroll = Math.max(0, (attemptCount - maxVisibleItems) * itemHeight);\n  const scrollProgress = maxScroll > 0 ? scrollOffset / maxScroll : 0;\n\n  return (\n    <group position={[5, 2.5, -12.8]}>\n      {/* Ø®Ù„ÙÙŠØ© Ø§Ù„Ù„ÙˆØ­Ø© */}\n      <RoundedBox\n        args={[3.3, panelHeight, 0.25]}\n        radius={0.18}\n        smoothness={6}\n        castShadow\n      >\n        <meshStandardMaterial \n          color=\"#f8fafc\"\n          metalness={0.15}\n          roughness={0.6}\n          emissive=\"#cbd5e1\"\n          emissiveIntensity={0.1}\n        />\n      </RoundedBox>\n\n      {/* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */}\n      {attemptCount > maxVisibleItems && (\n        <>\n          {/* Ø®Ù„ÙÙŠØ© Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */}\n          <RoundedBox\n            args={[0.18, panelHeight - 0.8, 0.08]}\n            radius={0.09}\n            smoothness={6}\n            position={[1.45, -0.15, 0.08]}\n          >\n            <meshStandardMaterial \n              color=\"#e2e8f0\"\n              metalness={0.1}\n              roughness={0.7}\n            />\n          </RoundedBox>\n\n          {/* Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ± */}\n          <RoundedBox\n            args={[0.16, Math.max(0.3, (panelHeight - 0.8) * (maxVisibleItems / attemptCount)), 0.09]}\n            radius={0.08}\n            smoothness={6}\n            position={[1.45, (panelHeight / 2 - 1) - scrollProgress * (Math.max(0, panelHeight - 0.8 - ((panelHeight - 0.8) * (maxVisibleItems / attemptCount)))), 0.09]}\n          >\n            <meshStandardMaterial \n              color=\"#6366f1\"\n              metalness={0.2}\n              roughness={0.3}\n              emissive=\"#6366f1\"\n              emissiveIntensity={0.2}\n            />\n          </RoundedBox>\n        </>\n      )}\n\n      {/* Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù„ÙˆØ­Ø© */}\n      <Text\n        position={[0, panelHeight / 2 - 0.5, 0.15]}\n        fontSize={0.32}\n        color=\"#4338ca\"\n        anchorX=\"center\"\n        anchorY=\"middle\"\n        fontWeight=\"bold\"\n      >\n        Ù…Ø­Ø§ÙˆÙ„Ø§Øª ({attemptCount}/{maxAttempts})\n      </Text>\n\n      {/* Ø®Ø· ÙØ§ØµÙ„ */}\n      <RoundedBox\n        args={[3.2, 0.02, 0.02]}\n        radius={0.01}\n        smoothness={4}\n        position={[0, panelHeight / 2 - 0.85, 0.12]}\n      >\n        <meshStandardMaterial \n          color=\"#818cf8\"\n          emissive=\"#818cf8\"\n          emissiveIntensity={0.5}\n        />\n      </RoundedBox>\n\n      {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª - Ù…Ø¹ clipping */}\n      <group position={[0, 0, 0]}>\n        {/* Ù‚Ù†Ø§Ø¹ clipping Ù„Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª */}\n        {visibleAttempts.map((attempt, visibleIndex) => {\n          const globalIndex = startIndex + visibleIndex;\n          const guessText = attempt.guess.join(\" \");\n          const yPosition = panelHeight / 2 - 1.5 - visibleIndex * itemHeight;\n          \n          const positionText = \n            attempt.correctPositionCount === 0 ? '0 Ù…ÙƒØ§Ù†Ùˆ ØµØ­' :\n            attempt.correctPositionCount === 1 ? '1 Ù…ÙƒØ§Ù†Ùˆ ØµØ­' :\n            `${attempt.correctPositionCount} Ù…ÙƒØ§Ù†Ù‡Ù… ØµØ­`;\n\n          return (\n            <group key={globalIndex} position={[0, yPosition, 0]}>\n              {/* Ø®Ù„ÙÙŠØ© ØµÙ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© */}\n              <RoundedBox\n                args={[3.05, itemHeight - 0.08, 0.08]}\n                radius={0.1}\n                smoothness={6}\n                position={[0, 0, 0.08]}\n              >\n                <meshStandardMaterial \n                  color={globalIndex % 2 === 0 ? \"#f0f4ff\" : \"#ffffff\"}\n                  transparent\n                  opacity={0.7}\n                  metalness={0.3}\n                  roughness={0.2}\n                />\n              </RoundedBox>\n\n              {/* Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­Ø§ÙˆÙ„ - Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */}\n              <Text\n                position={[1.35, 0, 0.15]}\n                fontSize={0.24}\n                color=\"#1e293b\"\n                anchorX=\"right\"\n                anchorY=\"middle\"\n                fontWeight=\"bold\"\n              >\n                {guessText}\n              </Text>\n\n              {/* Badge: Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµØ­ÙŠØ­Ø© */}\n              <RoundedBox\n                args={[0.55, 0.28, 0.06]}\n                radius={0.08}\n                smoothness={6}\n                position={[-0.25, 0.08, 0.12]}\n              >\n                <meshStandardMaterial \n                  color=\"#dbeafe\"\n                  metalness={0.2}\n                  roughness={0.4}\n                />\n              </RoundedBox>\n              <Text\n                position={[-0.25, 0.08, 0.16]}\n                fontSize={0.14}\n                color=\"#1e40af\"\n                anchorX=\"center\"\n                anchorY=\"middle\"\n                fontWeight=\"bold\"\n              >\n                {attempt.correctCount} ØµØ­\n              </Text>\n\n              {/* Badge: Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ù…ÙƒØ§Ù†Ù‡Ø§ Ø§Ù„ØµØ­ÙŠØ­ */}\n              <RoundedBox\n                args={[0.85, 0.28, 0.06]}\n                radius={0.08}\n                smoothness={6}\n                position={[-0.95, 0.08, 0.12]}\n              >\n                <meshStandardMaterial \n                  color=\"#dcfce7\"\n                  metalness={0.2}\n                  roughness={0.4}\n                />\n              </RoundedBox>\n              <Text\n                position={[-0.95, 0.08, 0.16]}\n                fontSize={0.12}\n                color=\"#166534\"\n                anchorX=\"center\"\n                anchorY=\"middle\"\n                fontWeight=\"bold\"\n              >\n                {positionText}\n              </Text>\n            </group>\n          );\n        })}\n      </group>\n\n\n      {attemptCount === 0 && (\n        <Text\n          position={[0, 0, 0.15]}\n          fontSize={0.24}\n          color=\"#94a3b8\"\n          anchorX=\"center\"\n          anchorY=\"middle\"\n        >\n          Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¨Ø¹Ø¯\n        </Text>\n      )}\n    </group>\n  );\n}\n","path":null,"size_bytes":9919,"size_tokens":null},"client/src/components/ui/sonner.tsx":{"content":"\"use client\"\n\nimport { useTheme } from \"next-themes\"\nimport { Toaster as Sonner } from \"sonner\"\nimport { useIsMobile } from \"@/hooks/use-is-mobile\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n  const isMobile = useIsMobile()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      position={isMobile ? \"bottom-center\" : \"bottom-right\"}\n      style={{ zIndex: 9999 }}\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster }\n","path":null,"size_bytes":1071,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4419,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1148,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7480,"size_tokens":null},"client/src/components/ui/Crosshair.tsx":{"content":"export function Crosshair({ isHoveringButton = false }: { isHoveringButton?: boolean }) {\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center pointer-events-none z-50\">\n      <div className=\"relative\">\n        {/* Ù†Ù‚Ø·Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© */}\n        <div \n          className=\"w-2 h-2 rounded-full transition-all duration-200 shadow-lg\"\n          style={{\n            backgroundColor: isHoveringButton ? '#22c55e' : '#ffffff',\n            boxShadow: isHoveringButton \n              ? '0 0 8px 2px rgba(34, 197, 94, 0.8)' \n              : '0 0 4px 1px rgba(255, 255, 255, 0.5)',\n          }}\n        />\n        \n        {/* Ø­Ù„Ù‚Ø© Ø®Ø§Ø±Ø¬ÙŠØ© Ø±ÙÙŠØ¹Ø© Ø¹Ù†Ø¯ hover */}\n        {isHoveringButton && (\n          <div \n            className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 rounded-full border border-green-400 opacity-60\"\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":943,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-3.5 w-3.5 fill-primary\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1410,"size_tokens":null},"client/src/App.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { Routes, Route, useNavigate, useParams, useLocation } from \"react-router-dom\";\nimport { useNumberGame } from \"./lib/stores/useNumberGame\";\nimport { useAudio } from \"./lib/stores/useAudio\";\nimport { send, reconnectToSession, connectWebSocket, reconnectWithRetry, getLastRoomSession, clearSession, clearPersistentRoom, disconnect } from \"./lib/websocket\";\nimport { useIsMobile } from \"./hooks/use-is-mobile\";\nimport { MobileApp } from \"./components/mobile/MobileApp\";\nimport { Menu } from \"./components/ui/Menu\";\nimport { MultiplayerLobby } from \"./components/ui/MultiplayerLobby\";\nimport { MultiplayerResults } from \"./components/ui/MultiplayerResults\";\nimport { ChallengesHub } from \"./components/game/ChallengesHub\";\nimport { useChallenges } from \"./lib/stores/useChallenges\";\nimport { DesktopSingleplayer } from \"./components/desktop/DesktopSingleplayer\";\nimport { MultiplayerGame2D } from \"./components/desktop/MultiplayerGame2D\";\nimport \"@fontsource/inter\";\n\nfunction MenuPage() {\n  const navigate = useNavigate();\n  const isMobile = useIsMobile();\n  const { setMode, resetMultiplayer } = useNumberGame();\n  const { setSuccessSound } = useAudio();\n  const [checkedLastRoom, setCheckedLastRoom] = useState(false);\n\n  useEffect(() => {\n    const successAudio = new Audio(\"/sounds/success.mp3\");\n    successAudio.load();\n    setSuccessSound(successAudio);\n  }, [setSuccessSound]);\n\n  useEffect(() => {\n    if (checkedLastRoom) return;\n    \n    const lastRoom = getLastRoomSession();\n    if (lastRoom && lastRoom.roomId) {\n      console.log(\"Found last room session:\", lastRoom.roomId);\n      setCheckedLastRoom(true);\n      navigate(`/room/${lastRoom.roomId}`, { replace: true });\n      return;\n    }\n    \n    setCheckedLastRoom(true);\n    resetMultiplayer();\n    setMode(\"menu\");\n    clearSession();\n  }, [checkedLastRoom]);\n\n  if (isMobile) {\n    return <MobileApp />;\n  }\n\n  return (\n    <div dir=\"rtl\" style={{ width: '100vw', height: '100vh', position: 'relative', overflow: 'hidden' }}>\n      <Menu />\n    </div>\n  );\n}\n\nfunction SingleplayerPage() {\n  const navigate = useNavigate();\n  const isMobile = useIsMobile();\n  const { singleplayer, setMode, restartSingleplayer } = useNumberGame();\n  const { setSuccessSound } = useAudio();\n  const [showChallengesHub, setShowChallengesHub] = useState(false);\n  const { hasWonAnyChallenge, resetToMenu: resetChallengesHub, generateHint: generateChallengeHint } = useChallenges();\n\n  useEffect(() => {\n    const successAudio = new Audio(\"/sounds/success.mp3\");\n    successAudio.load();\n    setSuccessSound(successAudio);\n  }, [setSuccessSound]);\n\n  useEffect(() => {\n    setMode(\"singleplayer\");\n    if (!singleplayer.secretCode || singleplayer.secretCode.length === 0) {\n      restartSingleplayer();\n    }\n  }, []);\n\n  if (isMobile) {\n    return <MobileApp />;\n  }\n\n  return (\n    <div dir=\"rtl\" style={{ width: '100vw', height: '100vh', position: 'relative', overflow: 'hidden' }}>\n      {!showChallengesHub && singleplayer.secretCode.length > 0 && (\n        <DesktopSingleplayer onStartChallenge={() => setShowChallengesHub(true)} />\n      )}\n      {showChallengesHub && (\n        <ChallengesHub onExit={() => {\n          if (hasWonAnyChallenge()) {\n            generateChallengeHint(singleplayer.secretCode);\n          }\n          setShowChallengesHub(false);\n          resetChallengesHub();\n        }} />\n      )}\n    </div>\n  );\n}\n\nfunction MultiplayerPage() {\n  const navigate = useNavigate();\n  const isMobile = useIsMobile();\n  const { multiplayer, setMode, resetMultiplayer, isConnecting, setIsConnecting, connectionError, setConnectionError, setPlayerName } = useNumberGame();\n  const { setSuccessSound } = useAudio();\n  const [playerNameInput, setPlayerNameInputState] = useState(() => localStorage.getItem(\"lastPlayerName\") || \"\");\n  const [joinRoomId, setJoinRoomId] = useState(\"\");\n  const [showJoinForm, setShowJoinForm] = useState(false);\n\n  useEffect(() => {\n    const successAudio = new Audio(\"/sounds/success.mp3\");\n    successAudio.load();\n    setSuccessSound(successAudio);\n  }, [setSuccessSound]);\n\n  useEffect(() => {\n    setMode(\"multiplayer\");\n  }, []);\n\n  useEffect(() => {\n    if (multiplayer.roomId) {\n      navigate(`/room/${multiplayer.roomId}`, { replace: true });\n    }\n  }, [multiplayer.roomId, navigate]);\n\n  const handleCreateRoom = () => {\n    if (!playerNameInput.trim()) return;\n    localStorage.setItem(\"lastPlayerName\", playerNameInput.trim());\n    setPlayerName(playerNameInput.trim());\n    setIsConnecting(true);\n    connectWebSocket(playerNameInput.trim());\n  };\n\n  const handleJoinRoom = () => {\n    if (!playerNameInput.trim() || !joinRoomId.trim()) return;\n    localStorage.setItem(\"lastPlayerName\", playerNameInput.trim());\n    setPlayerName(playerNameInput.trim());\n    setIsConnecting(true);\n    connectWebSocket(playerNameInput.trim(), joinRoomId.trim().toUpperCase());\n  };\n\n  if (isMobile) {\n    return <MobileApp />;\n  }\n\n  return (\n    <div dir=\"rtl\" style={{ width: '100vw', height: '100vh', position: 'relative', overflow: 'hidden' }}>\n      {connectionError && (\n        <div className=\"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-red-50 via-white to-red-50 z-50\">\n          <div className=\"text-center relative max-w-md mx-4\">\n            <div className=\"inline-flex items-center justify-center mb-4\">\n              <div className=\"text-6xl\">âŒ</div>\n            </div>\n            <p className=\"text-gray-800 text-xl font-semibold mb-4\">{connectionError}</p>\n            <button\n              onClick={() => {\n                setConnectionError(null);\n                resetMultiplayer();\n                navigate(\"/\");\n              }}\n              className=\"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg font-semibold transition-colors\"\n            >\n              Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\n            </button>\n          </div>\n        </div>\n      )}\n\n      {isConnecting && !connectionError && (\n        <div className=\"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50 z-50\">\n          <div className=\"text-center relative\">\n            <div className=\"inline-flex items-center justify-center mb-4\">\n              <div className=\"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-500\"></div>\n            </div>\n            <p className=\"text-gray-800 text-xl font-semibold\">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</p>\n            <p className=\"text-gray-600 text-sm mt-2\">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p>\n          </div>\n        </div>\n      )}\n\n      {!isConnecting && !connectionError && (\n        <div className=\"min-h-screen p-6 flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50\">\n          <div className=\"w-full max-w-md space-y-4\">\n            <div className=\"bg-white rounded-2xl shadow-xl p-6 space-y-4\">\n              <button\n                onClick={() => navigate(\"/\")}\n                className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n              >\n                <svg className=\"w-6 h-6 text-gray-700\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\" />\n                </svg>\n              </button>\n\n              <div className=\"text-center mb-6\">\n                <div className=\"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg\">\n                  <span className=\"text-3xl\">ğŸ‘¥</span>\n                </div>\n                <h2 className=\"text-2xl font-bold text-gray-800\">Ù„Ø¹Ø¨ Ø¬Ù…Ø§Ø¹ÙŠ</h2>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-bold text-gray-700 mb-2 text-right\">\n                  Ø§Ø³Ù…Ùƒ\n                </label>\n                <input\n                  type=\"text\"\n                  value={playerNameInput}\n                  onChange={(e) => setPlayerNameInputState(e.target.value)}\n                  placeholder=\"Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ\"\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 rounded-xl text-right focus:outline-none focus:border-blue-500\"\n                  dir=\"rtl\"\n                />\n              </div>\n\n              <button\n                onClick={handleCreateRoom}\n                disabled={!playerNameInput.trim()}\n                className=\"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-xl transition-all flex items-center justify-center gap-2\"\n              >\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\" />\n                </svg>\n                Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©\n              </button>\n\n              <div className=\"relative\">\n                <div className=\"absolute inset-0 flex items-center\">\n                  <div className=\"w-full border-t border-gray-300\"></div>\n                </div>\n                <div className=\"relative flex justify-center text-sm\">\n                  <span className=\"px-4 bg-white text-gray-500\">Ø£Ùˆ</span>\n                </div>\n              </div>\n\n              {!showJoinForm ? (\n                <button\n                  onClick={() => setShowJoinForm(true)}\n                  className=\"w-full bg-white border-2 border-gray-300 hover:border-blue-500 text-gray-700 font-bold py-3 px-6 rounded-xl transition-all flex items-center justify-center gap-2\"\n                >\n                  Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ© Ù…ÙˆØ¬ÙˆØ¯Ø©\n                </button>\n              ) : (\n                <div className=\"space-y-3\">\n                  <div>\n                    <label className=\"block text-sm font-bold text-gray-700 mb-2 text-right\">\n                      Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={joinRoomId}\n                      onChange={(e) => setJoinRoomId(e.target.value.toUpperCase())}\n                      placeholder=\"Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©\"\n                      className=\"w-full px-4 py-3 border-2 border-gray-300 rounded-xl text-center font-mono uppercase focus:outline-none focus:border-blue-500\"\n                      maxLength={6}\n                    />\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={handleJoinRoom}\n                      disabled={!playerNameInput.trim() || !joinRoomId.trim()}\n                      className=\"flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 disabled:from-gray-400 disabled:to-gray-500 text-white font-bold py-3 rounded-xl transition-all\"\n                    >\n                      Ø§Ù†Ø¶Ù…\n                    </button>\n                    <button\n                      onClick={() => setShowJoinForm(false)}\n                      className=\"px-4 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 rounded-xl transition-all\"\n                    >\n                      Ø¥Ù„ØºØ§Ø¡\n                    </button>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction RoomPage() {\n  const { roomId } = useParams<{ roomId: string }>();\n  const navigate = useNavigate();\n  const isMobile = useIsMobile();\n  const { multiplayer, setMode, setIsConnecting, setPlayerName, resetMultiplayer, connectionError, setConnectionError, isConnecting } = useNumberGame();\n  const { setSuccessSound } = useAudio();\n  const [playerNameInput, setPlayerNameInputState] = useState(() => localStorage.getItem(\"lastPlayerName\") || \"\");\n  const [isJoining, setIsJoining] = useState(false);\n  const [hasAttemptedReconnect, setHasAttemptedReconnect] = useState(false);\n\n  useEffect(() => {\n    const successAudio = new Audio(\"/sounds/success.mp3\");\n    successAudio.load();\n    setSuccessSound(successAudio);\n  }, [setSuccessSound]);\n\n  useEffect(() => {\n    setMode(\"multiplayer\");\n  }, []);\n\n  useEffect(() => {\n    if (hasAttemptedReconnect) return;\n    if (!roomId) return;\n    if (multiplayer.roomId === roomId && multiplayer.playerId) return;\n\n    const session = reconnectToSession();\n    if (session && session.roomId === roomId && session.playerId) {\n      console.log(\"Reconnecting to room from session:\", roomId);\n      setHasAttemptedReconnect(true);\n      setPlayerName(session.playerName);\n      setIsConnecting(true);\n      reconnectWithRetry(session.playerName, session.playerId, session.roomId);\n      \n      setTimeout(() => {\n        if (useNumberGame.getState().isConnecting) {\n          console.error(\"Connection timeout\");\n          setIsConnecting(false);\n        }\n      }, 5000);\n      return;\n    }\n\n    const lastRoom = getLastRoomSession();\n    if (lastRoom && lastRoom.roomId === roomId && lastRoom.playerId) {\n      console.log(\"Reconnecting to last room:\", roomId);\n      setHasAttemptedReconnect(true);\n      setPlayerName(lastRoom.playerName);\n      setIsConnecting(true);\n      reconnectWithRetry(lastRoom.playerName, lastRoom.playerId, lastRoom.roomId);\n      \n      setTimeout(() => {\n        if (useNumberGame.getState().isConnecting) {\n          console.error(\"Connection timeout\");\n          setIsConnecting(false);\n        }\n      }, 5000);\n      return;\n    }\n\n    setHasAttemptedReconnect(true);\n  }, [roomId, hasAttemptedReconnect]);\n\n  const handleJoinRoom = () => {\n    if (!playerNameInput.trim() || !roomId) return;\n    setIsJoining(true);\n    localStorage.setItem(\"lastPlayerName\", playerNameInput.trim());\n    setPlayerName(playerNameInput.trim());\n    setIsConnecting(true);\n    connectWebSocket(playerNameInput.trim(), roomId);\n  };\n\n  if (isMobile) {\n    return <MobileApp />;\n  }\n\n  const isInRoom = multiplayer.roomId === roomId && multiplayer.playerId;\n  const isGameActive = multiplayer.gameStatus === \"playing\" && multiplayer.sharedSecret.length > 0;\n\n  return (\n    <div dir=\"rtl\" style={{ width: '100vw', height: '100vh', position: 'relative', overflow: 'hidden' }}>\n      {connectionError && (\n        <div className=\"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-red-50 via-white to-red-50 z-50\">\n          <div className=\"text-center relative max-w-md mx-4\">\n            <div className=\"inline-flex items-center justify-center mb-4\">\n              <div className=\"text-6xl\">âŒ</div>\n            </div>\n            <p className=\"text-gray-800 text-xl font-semibold mb-4\">{connectionError}</p>\n            <button\n              onClick={() => {\n                setConnectionError(null);\n                resetMultiplayer();\n                navigate(\"/\");\n              }}\n              className=\"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg font-semibold transition-colors\"\n            >\n              Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\n            </button>\n          </div>\n        </div>\n      )}\n\n      {isConnecting && !connectionError && (\n        <div className=\"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50 z-50\">\n          <div className=\"text-center relative\">\n            <div className=\"inline-flex items-center justify-center mb-4\">\n              <div className=\"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-500\"></div>\n            </div>\n            <p className=\"text-gray-800 text-xl font-semibold\">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</p>\n            <p className=\"text-gray-600 text-sm mt-2\">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p>\n          </div>\n        </div>\n      )}\n\n      {!isConnecting && !connectionError && !isInRoom && (\n        <div className=\"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50 z-50 p-4\">\n          <div className=\"w-full max-w-md bg-white rounded-2xl shadow-2xl p-6 text-center space-y-6\">\n            <div className=\"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-2xl flex items-center justify-center mx-auto shadow-lg\">\n              <span className=\"text-3xl\">ğŸ®</span>\n            </div>\n            <h2 className=\"text-2xl font-bold text-gray-800\">Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ©</h2>\n            <p className=\"text-gray-600\">Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©: <span className=\"font-mono font-bold text-blue-600\">{roomId}</span></p>\n            \n            <div className=\"space-y-4\">\n              <input\n                type=\"text\"\n                placeholder=\"Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ\"\n                value={playerNameInput}\n                onChange={(e) => setPlayerNameInputState(e.target.value)}\n                className=\"w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-center font-semibold focus:border-blue-500 focus:outline-none transition-colors\"\n                maxLength={20}\n              />\n              <button\n                onClick={handleJoinRoom}\n                disabled={!playerNameInput.trim() || isJoining}\n                className=\"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 disabled:from-gray-400 disabled:to-gray-500 text-white font-bold py-3 rounded-xl transition-all\"\n              >\n                {isJoining ? \"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…...\" : \"Ø§Ù†Ø¶Ù… Ù„Ù„ØºØ±ÙØ©\"}\n              </button>\n              <button\n                onClick={() => navigate(\"/\")}\n                className=\"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-3 rounded-xl transition-colors\"\n              >\n                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {isInRoom && !isGameActive && !multiplayer.showResults && (\n        <MultiplayerLobby />\n      )}\n      \n      {isInRoom && isGameActive && !multiplayer.showResults && (\n        <MultiplayerGame2D />\n      )}\n      \n      {isInRoom && multiplayer.showResults && (\n        <MultiplayerResults />\n      )}\n\n      {multiplayer.rematchState.requested && multiplayer.rematchState.countdown !== null && (\n        <RematchDialog />\n      )}\n    </div>\n  );\n}\n\nfunction RematchDialog() {\n  const { multiplayer } = useNumberGame();\n  const myVote = multiplayer.rematchState.votes.find(v => v.playerId === multiplayer.playerId);\n\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 p-4\">\n      <div className=\"w-full max-w-2xl bg-gradient-to-br from-blue-50 to-white rounded-3xl shadow-2xl border-2 border-blue-300 p-6 md:p-8 text-center space-y-6\">\n        <div>\n          <div className=\"flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full mx-auto mb-4 shadow-lg\">\n            <svg className=\"w-8 h-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n            </svg>\n          </div>\n          <h2 className=\"text-2xl md:text-3xl font-bold text-gray-800 mb-2\">Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©ØŸ</h2>\n          <p className=\"text-sm md:text-base text-gray-600\">Ù„Ø¯ÙŠÙƒ <span className=\"font-bold text-blue-600\">{multiplayer.rematchState.countdown}s</span> Ù„Ù„ØªØµÙˆÙŠØª</p>\n        </div>\n\n        {!myVote && (\n          <div className=\"grid grid-cols-2 gap-3 md:gap-4\">\n            <button\n              onClick={() => send({ type: \"rematch_vote\", accepted: true })}\n              className=\"bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 md:py-4 px-4 md:px-6 rounded-xl transition-all transform hover:scale-105 shadow-lg flex flex-col items-center gap-2\"\n            >\n              <span className=\"text-xl md:text-2xl\">âœ“</span>\n              <span className=\"text-xs md:text-sm\">Ù…ÙˆØ§ÙÙ‚</span>\n            </button>\n            <button\n              onClick={() => send({ type: \"rematch_vote\", accepted: false })}\n              className=\"bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-3 md:py-4 px-4 md:px-6 rounded-xl transition-all transform hover:scale-105 shadow-lg flex flex-col items-center gap-2\"\n            >\n              <span className=\"text-xl md:text-2xl\">âœ—</span>\n              <span className=\"text-xs md:text-sm\">Ø±Ø§ÙØ¶</span>\n            </button>\n          </div>\n        )}\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4\">\n          {multiplayer.players.map(player => {\n            const vote = multiplayer.rematchState.votes.find(v => v.playerId === player.id);\n            const isCurrentPlayer = player.id === multiplayer.playerId;\n            \n            return (\n              <div\n                key={player.id}\n                className={`relative rounded-2xl p-4 md:p-5 border-2 transition-all transform ${\n                  vote?.accepted\n                    ? 'bg-gradient-to-br from-green-50 to-green-100 border-green-400 scale-100'\n                    : vote?.accepted === false\n                    ? 'bg-gradient-to-br from-red-50 to-red-100 border-red-400 scale-100'\n                    : 'bg-gradient-to-br from-gray-50 to-gray-100 border-gray-300 animate-pulse'\n                }`}\n              >\n                <div className=\"absolute top-2 right-2 md:top-3 md:right-3\">\n                  {vote?.accepted ? (\n                    <div className=\"w-8 h-8 md:w-10 md:h-10 bg-green-500 rounded-full flex items-center justify-center shadow-lg\">\n                      <span className=\"text-white font-bold text-lg md:text-xl\">âœ“</span>\n                    </div>\n                  ) : vote?.accepted === false ? (\n                    <div className=\"w-8 h-8 md:w-10 md:h-10 bg-red-500 rounded-full flex items-center justify-center shadow-lg\">\n                      <span className=\"text-white font-bold text-lg md:text-xl\">âœ—</span>\n                    </div>\n                  ) : (\n                    <div className=\"w-8 h-8 md:w-10 md:h-10 bg-gray-400 rounded-full flex items-center justify-center shadow-lg\">\n                      <span className=\"text-white font-bold text-lg md:text-xl\">â³</span>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"pr-10 md:pr-12\">\n                  <p className=\"font-bold text-gray-800 text-sm md:text-base flex items-center gap-2\">\n                    {player.name}\n                    {isCurrentPlayer && <span className=\"text-xs bg-blue-200 text-blue-700 px-2 py-0.5 rounded-lg\">(Ø£Ù†Øª)</span>}\n                  </p>\n                  <p className={`text-xs md:text-sm font-semibold mt-1 ${\n                    vote?.accepted ? 'text-green-700' : vote?.accepted === false ? 'text-red-700' : 'text-gray-500'\n                  }`}>\n                    {vote?.accepted ? 'Ù…ÙˆØ§ÙÙ‚ âœ“' : vote?.accepted === false ? 'Ø±Ø§ÙØ¶ âœ—' : 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...'}\n                  </p>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <Routes>\n      <Route path=\"/\" element={<MenuPage />} />\n      <Route path=\"/singleplayer\" element={<SingleplayerPage />} />\n      <Route path=\"/multiplayer\" element={<MultiplayerPage />} />\n      <Route path=\"/room/:roomId\" element={<RoomPage />} />\n    </Routes>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":24299,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5124,"size_tokens":null},"README.md":{"content":"# Ù„Ø¹Ø¨Ø© ØªØ®Ù…ÙŠÙ† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© - Ø§Ù„Ø¥ØµØ¯Ø§Ø± 2D\n\nÙ„Ø¹Ø¨Ø© ØªØ®Ù…ÙŠÙ† Ø£Ø±Ù‚Ø§Ù… ØªÙØ§Ø¹Ù„ÙŠØ© Ù…Ø¹ ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©. Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† ÙŠØ­Ø§ÙˆÙ„ÙˆÙ† ØªØ®Ù…ÙŠÙ† Ø±Ù‚Ù… Ø³Ø±ÙŠ ÙŠØªÙ„Ù‚ÙˆÙ† ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø­ÙˆÙ„ Ø¯Ù‚Ø© Ø§Ù„ØªØ®Ù…ÙŠÙ†. Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ¯Ø¹Ù… Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ±Ø¯ÙŠ ÙˆØ§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ù…Ø¹ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„ÙÙˆØ±ÙŠ Ø¹Ø¨Ø± WebSocket.\n\n## Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\n\n- **ÙˆØ¶Ø¹ ÙØ±Ø¯ÙŠ**: Ø§Ù„Ø¹Ø¨ Ø¶Ø¯ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨ Ù…Ø¹ Ù…Ø³ØªÙˆÙŠØ§Øª ØµØ¹ÙˆØ¨Ø© Ù…Ø®ØªÙ„ÙØ©\n- **ÙˆØ¶Ø¹ Ø¬Ù…Ø§Ø¹ÙŠ**: Ù„Ø¹Ø¨ ØªÙ†Ø§ÙØ³ÙŠ ÙÙˆØ±ÙŠ Ù…Ø¹ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¢Ø®Ø±ÙŠÙ† Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª\n- **ØªØ­Ø¯ÙŠØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø©**: 4 ØªØ­Ø¯ÙŠØ§Øª ØµØºÙŠØ±Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙ„Ù…ÙŠØ­Ø§Øª:\n  - ØªØ­Ø¯ÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©: ØªØ°ÙƒØ± ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ù„ÙˆØ§Ù†\n  - ØªØ­Ø¯ÙŠ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª: ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø³Ù‡Ù… ÙÙŠ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©\n  - ØªØ­Ø¯ÙŠ Ø­Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ø±: Ø­Ù„ Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø±ÙŠØ§Ø¶ÙŠØ© Ø³Ø±ÙŠØ¹Ø©\n  - ØªØ­Ø¯ÙŠ Ø§Ù„ØªØ®Ù…ÙŠÙ†: ØªÙˆÙ‚Ø¹ Ø§Ù„Ù†Ù…Ø· Ø§Ù„ØµØ­ÙŠØ­\n- **Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª**: Ø¨Ø·Ø§Ù‚Ø§Øª ÙØ±ÙŠØ¯Ø© Ø­ØµØ±ÙŠØ© Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ù…Ø¹ ØªØ£Ø«ÙŠØ±Ø§Øª Ø®Ø§ØµØ©\n- **ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ© ÙƒØ§Ù…Ù„Ø©**: ØªØµÙ…ÙŠÙ… ÙŠØ¯Ø¹Ù… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø±)\n- **ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨**: ÙˆØ§Ø¬Ù‡Ø§Øª Ù…Ù†ÙØµÙ„Ø© Ù„Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„Ø­Ø§Ø³ÙˆØ¨ Ù…Ø¹ ØªØ­Ø³ÙŠÙ† Ù„ÙƒÙ„ Ø¬Ù‡Ø§Ø²\n- **Ù†Ø¸Ø§Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„**: Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ù„Ù…Ø¯Ø© 5 Ø¯Ù‚Ø§Ø¦Ù‚\n\n## Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©\n\n### Frontend (Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©)\n\n**Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:**\n- React 18 Ù…Ø¹ TypeScript Ù„Ù„Ù…ÙƒÙˆÙ†Ø§Øª\n- Vite ÙƒØ£Ø¯Ø§Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±\n- TailwindCSS Ù„Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…\n- Radix UI Ù„Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§\n- Zustand Ù„Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚\n\n**Ø§Ù„ØªØ®Ø·ÙŠØ·:**\n- **Ø¯ÙŠØ³ÙƒØªÙˆØ¨**: ÙˆØ§Ø¬Ù‡Ø© ÙƒØ§Ù…Ù„Ø© Ù…Ø¹ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø§Ù†Ø¨\n- **Ù…ÙˆØ¨Ø§ÙŠÙ„**: ÙˆØ§Ø¬Ù‡Ø© Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ù…Ø¹ Ù„ÙˆØ­Ø© Ø£Ø±Ù‚Ø§Ù… Ù…Ø®ØµØµØ©\n- **ÙƒØ´Ù Ø§Ù„Ø¬Ù‡Ø§Ø²**: Ø§ÙƒØªØ´Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ 768px\n\n**Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø©:**\n- `useNumberGame`: Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\n- `useChallenges`: Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„ØµØºÙŠØ±Ø©\n- `useCards`: Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ\n- `useAudio`: ØªØ£Ø«ÙŠØ±Ø§Øª ØµÙˆØªÙŠØ© ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§Øª Ø³Ù…Ø¹ÙŠØ©\n\n### Backend (Ø§Ù„Ø®Ø§Ø¯Ù…)\n\n**Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:**\n- Express.js Ù…Ø¹ TypeScript\n- WebSocket (ws) Ù„Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„ÙÙˆØ±ÙŠ\n- Neon PostgreSQL Ù…Ø¹ Drizzle ORM\n- Ø¬Ù„Ø³Ø§Øª Ù…Ø­Ù„ÙŠØ© Ø§Ù„Ø°Ø§ÙƒØ±Ø©\n\n**Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨Ø©:**\n- Ù†Ø¸Ø§Ù… Ø§Ù„ØºØ±Ù Ù…Ø¹ Ù…Ø¹Ø±ÙØ§Øª ÙØ±ÙŠØ¯Ø©\n- ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø£ÙƒÙˆØ§Ø² Ø§Ù„Ø³Ø±ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†\n- Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØª (60 Ø«Ø§Ù†ÙŠØ© Ù„ÙƒÙ„ Ø¯ÙˆØ±)\n- Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª\n- Ø¥Ø¯Ø§Ø±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„\n\n## Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\n\n- **Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†**: Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ (authentication Ø¬Ø§Ù‡Ø² Ù„ÙƒÙ† ØºÙŠØ± Ù…ÙØ¹Ù„)\n- **Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª**: ØªØªØ¨Ø¹ WebSocket ÙˆØ­Ø§Ù„Ø© Ø§Ù„ØºØ±Ù\n- **Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø©**: Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ ÙÙŠ sessionStorage Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«\n\n## Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\n\n**ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:**\n- `@radix-ui/*`: Ù…ÙƒÙˆÙ†Ø§Øª UI Ø¢Ù…Ù†Ø© ÙˆØ³Ù‡Ù„Ø© Ø§Ù„ÙˆØµÙˆÙ„\n- `react-icons`: Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©\n- `framer-motion`: Ø­Ø±ÙƒØ§Øª Ø³Ù„Ø³Ø©\n\n**Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø©:**\n- `zustand`: Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ø®ÙÙŠÙØ© Ø§Ù„ÙˆØ²Ù†\n- `@tanstack/react-query`: Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…\n\n**Ø§Ù„ØªØµÙ…ÙŠÙ…:**\n- `tailwindcss`: Ù†Ø¸Ø§Ù… ØªØµÙ…ÙŠÙ… Ø­Ø¯ÙŠØ«\n- `tailwind-merge` Ùˆ `clsx`: Ø£Ø¯ÙˆØ§Øª ÙØ¦Ø§Øª Ø´Ø±Ø·ÙŠØ©\n\n**Ø§Ù„Ø£ØµÙˆØ§Øª:**\n- `howler`: Ù…Ø´ØºÙ„ ØµÙˆØªÙŠ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¯Ø§Ø¡\n\n**Ø§Ù„ØªØ·ÙˆÙŠØ±:**\n- `tsx`: ØªÙ†ÙÙŠØ° TypeScript Ù…Ø¨Ø§Ø´Ø±\n- `vite`: Ø¨Ù†Ø§Ø¡ Ø³Ø±ÙŠØ¹ Ù…Ø¹ HMR\n","path":null,"size_bytes":4028,"size_tokens":null},"client/src/components/desktop/MultiplayerGame2D.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { MultiplayerResults } from \"../ui/MultiplayerResults\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { useAudio } from \"@/lib/stores/useAudio\";\nimport { useCards } from \"@/lib/stores/useCards\";\nimport { send, connectWebSocket, disconnect } from \"@/lib/websocket\";\nimport { Home, Check, X, Users, Copy, Crown, Play, Settings, RefreshCw, Eye, Trophy, Maximize2, Minimize2, LogOut } from \"lucide-react\";\nimport { GameSettings } from \"../ui/GameSettings\";\nimport { clearSession, clearPersistentRoom } from \"@/lib/websocket\";\nimport { CardHand, CardEffectDisplay } from \"../game/cards/CardSystem\";\nimport { MultiplayerChallenge } from \"../game/MultiplayerChallenge\";\n\nexport function MultiplayerGame2D() {\n  const {\n    multiplayer,\n    setMode,\n    resetMultiplayer,\n    addMultiplayerDigit,\n    deleteMultiplayerDigit,\n    submitMultiplayerGuess,\n    setShowPreGameChallenge,\n  } = useNumberGame();\n\n  const { playDigit, playDelete, playConfirm, playError, successSound } = useAudio();\n  const { cardSettings } = useCards();\n  const [playerName, setPlayerName] = useState(\"\");\n  const [joinRoomId, setJoinRoomId] = useState(\"\");\n  const [showJoinForm, setShowJoinForm] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [selectedPlayer, setSelectedPlayer] = useState<string | null>(null);\n  const [copied, setCopied] = useState(false);\n  const [expandedAttempts, setExpandedAttempts] = useState(false);\n  const [currentTime, setCurrentTime] = useState(Date.now());\n\n  const [input, setInput] = useState<string[]>([]);\n  const [focusedIndex, setFocusedIndex] = useState(0);\n\n  const numDigits = multiplayer.settings.numDigits;\n\n  useEffect(() => {\n    const savedName = localStorage.getItem(\"lastPlayerName\");\n    if (savedName) {\n      setPlayerName(savedName);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (playerName.trim()) {\n      localStorage.setItem(\"lastPlayerName\", playerName);\n    }\n  }, [playerName]);\n\n  useEffect(() => {\n    setInput(new Array(numDigits).fill(\"\"));\n    setFocusedIndex(0);\n  }, [numDigits]);\n\n  useEffect(() => {\n    if (multiplayer.currentGuess.length < numDigits) {\n      const newInput = [...multiplayer.currentGuess.map(String), ...new Array(numDigits - multiplayer.currentGuess.length).fill(\"\")];\n      setInput(newInput);\n      setFocusedIndex(multiplayer.currentGuess.length);\n    } else if (multiplayer.currentGuess.length === numDigits) {\n      setInput(multiplayer.currentGuess.map(String));\n      setFocusedIndex(numDigits);\n    }\n  }, [multiplayer.currentGuess, numDigits]);\n\n  // Live timer update\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setCurrentTime(Date.now());\n    }, 100);\n    return () => clearInterval(interval);\n  }, []);\n\n  // Keyboard controls for game input\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (multiplayer.gameStatus !== \"playing\" || multiplayer.phase !== \"playing\") return;\n      if (expandedAttempts) return;\n      if (multiplayer.showPreGameChallenge) return;\n      \n      if (e.key >= '0' && e.key <= '9') {\n        e.preventDefault();\n        handleNumberInput(e.key);\n      } else if (e.key === 'Backspace') {\n        e.preventDefault();\n        handleBackspace();\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n        if (!input.some(val => val === \"\")) {\n          handleSubmit();\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [multiplayer.gameStatus, multiplayer.phase, focusedIndex, input, numDigits, expandedAttempts, multiplayer.showPreGameChallenge]);\n\n  const handleCreateRoom = () => {\n    if (!playerName.trim()) return;\n    connectWebSocket(playerName.trim());\n  };\n\n  const handleJoinRoom = () => {\n    if (!playerName.trim() || !joinRoomId.trim()) return;\n    connectWebSocket(playerName.trim(), joinRoomId.trim().toUpperCase());\n  };\n\n  const handleStartGame = () => {\n    if (multiplayer.isHost && multiplayer.players.length >= 2) {\n      send({ type: \"start_game\" });\n    }\n  };\n\n  const { hasActiveEffect, removeExpiredEffects, revealedDigits, burnedNumbers, getActiveEffect, playerCards } = useCards();\n  \n  const isPlayerFrozen = () => {\n    removeExpiredEffects();\n    return hasActiveEffect(multiplayer.playerId, \"freeze\");\n  };\n\n  const getRevealedDigitAtPosition = (position: number): number | null => {\n    const revealed = revealedDigits.find(r => r.position === position);\n    return revealed ? revealed.digit : null;\n  };\n\n  const isBurnedNumber = (num: number): boolean => {\n    return burnedNumbers.includes(num);\n  };\n  \n  const getParityAtPosition = (position: number): { isEven: boolean } | null => {\n    const player = playerCards.find(p => p.playerId === multiplayer.playerId);\n    if (!player) return null;\n    \n    const parityEffect = player.activeEffects.find(e => e.cardType === \"revealParity\" && e.expiresAt > Date.now());\n    if (!parityEffect || !parityEffect.value) return null;\n    \n    const parityInfos = parityEffect.value as { position: number; isEven: boolean }[];\n    const parityInfo = parityInfos.find(p => p.position === position);\n    return parityInfo ? { isEven: parityInfo.isEven } : null;\n  };\n\n  const handleNumberInput = (num: string) => {\n    if (multiplayer.gameStatus !== \"playing\" || multiplayer.phase !== \"playing\") return;\n    if (focusedIndex >= numDigits) return;\n    \n    if (isPlayerFrozen()) {\n      playError();\n      return;\n    }\n\n    // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù…Ø­Ø±ÙˆÙ‚\n    if (isBurnedNumber(parseInt(num))) {\n      playError();\n      return;\n    }\n\n    // ØªØ®Ø·ÙŠ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØ´ÙˆÙØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹\n    let targetIndex = focusedIndex;\n    while (targetIndex < numDigits && getRevealedDigitAtPosition(targetIndex) !== null) {\n      targetIndex++;\n    }\n    \n    if (targetIndex >= numDigits) {\n      playError();\n      return;\n    }\n\n    playDigit(parseInt(num));\n    addMultiplayerDigit(parseInt(num));\n    \n    // ØªØ­Ø¯ÙŠØ« focusedIndex Ù„Ù„Ø®Ø§Ù†Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©\n    let nextIndex = targetIndex + 1;\n    while (nextIndex < numDigits && getRevealedDigitAtPosition(nextIndex) !== null) {\n      nextIndex++;\n    }\n    setFocusedIndex(nextIndex);\n  };\n\n  const handleBackspace = () => {\n    if (multiplayer.gameStatus !== \"playing\" || multiplayer.phase !== \"playing\") return;\n    if (focusedIndex === 0) return;\n\n    playDelete();\n    deleteMultiplayerDigit();\n    \n    // Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØºÙŠØ± Ø§Ù„Ù…ÙƒØ´ÙˆÙØ©\n    let prevIndex = focusedIndex - 1;\n    while (prevIndex >= 0 && getRevealedDigitAtPosition(prevIndex) !== null) {\n      prevIndex--;\n    }\n    setFocusedIndex(Math.max(0, prevIndex));\n  };\n\n  const handleSubmit = () => {\n    if (multiplayer.gameStatus !== \"playing\" || multiplayer.phase !== \"playing\") return;\n    if (input.some(val => val === \"\")) {\n      playError();\n      return;\n    }\n    \n    if (isPlayerFrozen()) {\n      playError();\n      return;\n    }\n\n    playConfirm();\n    send({\n      type: \"submit_guess\",\n      guess: multiplayer.currentGuess,\n    });\n    submitMultiplayerGuess();\n  };\n\n  const handleLeaveRoom = () => {\n    send({ type: \"leave_room\" });\n    clearSession();\n    clearPersistentRoom();\n    disconnect();\n    resetMultiplayer();\n  };\n\n  const handleHome = () => {\n    if (multiplayer.roomId) {\n      handleLeaveRoom();\n    }\n    setMode(\"menu\");\n  };\n\n  const handleCopyRoomId = () => {\n    navigator.clipboard.writeText(multiplayer.roomId);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  const handleRematchVote = (accepted: boolean) => {\n    send({ type: \"rematch_vote\", accepted });\n  };\n\n  const formatDuration = (ms: number) => {\n    const seconds = Math.floor(ms / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const remainingSeconds = seconds % 60;\n    if (minutes > 0) {\n      return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;\n    }\n    return `${seconds}s`;\n  };\n\n  const getElapsedTime = () => {\n    if (multiplayer.gameStatus === \"playing\" && multiplayer.startTime > 0) {\n      const elapsed = currentTime - multiplayer.startTime;\n      return Math.max(0, elapsed);\n    }\n    return 0;\n  };\n  \n  const getRemainingTime = () => {\n    if (multiplayer.gameStatus === \"playing\") {\n      // Get round duration from multiplayer settings (from server) or cardSettings (from store)\n      const roundDuration = multiplayer.settings?.cardSettings?.roundDuration ?? cardSettings.roundDuration ?? 5;\n      if (multiplayer.startTime > 0) {\n        // Game has started - calculate remaining time\n        const elapsed = currentTime - multiplayer.startTime;\n        const totalDuration = roundDuration * 60 * 1000;\n        const remaining = totalDuration - elapsed;\n        return Math.max(0, remaining);\n      } else {\n        // Waiting for challenges to complete (startTime is 0)\n        return roundDuration * 60 * 1000;\n      }\n    }\n    const roundDuration = multiplayer.settings?.cardSettings?.roundDuration ?? cardSettings.roundDuration ?? 5;\n    return roundDuration * 60 * 1000;\n  };\n\n  const isTimeWarning = () => {\n    const remaining = getRemainingTime();\n    return remaining <= 30000; // Last 30 seconds\n  };\n\n  // Check if current player has finished\n  const playerFinished = multiplayer.phase === \"won\" || multiplayer.phase === \"lost\";\n  \n  // Show results screen only if explicitly requested via showResults flag\n  const shouldShowResults = multiplayer.showResults;\n\n  // Check if there are still players playing\n  const hasPlayersStillPlaying = multiplayer.stillPlaying && multiplayer.stillPlaying.length > 0;\n\n  // Get player details from winners, losers, or stillPlaying\n  const playerDetails = selectedPlayer \n    ? [...multiplayer.winners, ...multiplayer.losers, ...(multiplayer.stillPlaying || [])].find(p => p.playerId === selectedPlayer)\n    : null;\n\n  // Get available players to watch (stillPlaying + winners if not yet finished)\n  const availableToWatch = playerFinished && !shouldShowResults\n    ? multiplayer.stillPlaying || []\n    : [];\n\n  // Initialize spectator mode when player finishes\n  useEffect(() => {\n    if (playerFinished && !multiplayer.showResults) {\n      // If there are still players playing, auto-select the first one for spectating\n      if (hasPlayersStillPlaying && !selectedPlayer) {\n        setSelectedPlayer(multiplayer.stillPlaying[0]?.playerId || null);\n      }\n      console.log(\"Player finished, watching mode enabled. Still playing:\", availableToWatch.length);\n    }\n  }, [playerFinished, multiplayer.showResults, hasPlayersStillPlaying]);\n\n  // Note: GameSettings handles sending update_settings with full cardSettings\n  if (showSettings && multiplayer.isHost && multiplayer.gameStatus === \"waiting\") {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4\">\n        <GameSettings\n          onConfirm={() => {\n            setShowSettings(false);\n          }}\n          isMultiplayer={true}\n        />\n      </div>\n    );\n  }\n\n  if (shouldShowResults) {\n    return <MultiplayerResults />;\n  }\n\n  if (multiplayer.gameStatus === \"playing\" && multiplayer.showPreGameChallenge) {\n    return (\n      <MultiplayerChallenge \n        onComplete={(won) => {\n          console.log(\"Challenge completed, won:\", won);\n          setShowPreGameChallenge(false);\n          send({ type: \"challenge_completed\" });\n        }}\n      />\n    );\n  }\n\n  // Waiting for other players to finish challenges\n  if (multiplayer.gameStatus === \"playing\" && multiplayer.sharedSecret.length > 0 && multiplayer.startTime === 0) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4\">\n        <div className=\"text-center space-y-6\">\n          <div className=\"flex justify-center\">\n            <div className=\"relative w-32 h-32\">\n              <div className=\"absolute inset-0 bg-blue-500 rounded-full animate-pulse\"></div>\n              <div className=\"absolute inset-2 bg-white rounded-full flex items-center justify-center\">\n                <span className=\"text-6xl\">â³</span>\n              </div>\n            </div>\n          </div>\n          <h2 className=\"text-4xl font-bold text-gray-800\">Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹</h2>\n          <p className=\"text-xl text-gray-600\">\n            Ø§Ù†ØªÙ‡ÙŠØª Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠ! Ø§Ù„Ù„Ø¹Ø¨Ø© Ø³ØªØ¨Ø¯Ø£ Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ†ØªÙ‡ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ§ØªÙ‡Ù….\n          </p>\n          <div className=\"space-y-4 mt-8\">\n            <p className=\"text-lg text-gray-500\">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†: {multiplayer.players.length}</p>\n            <div className=\"flex flex-wrap gap-3 justify-center\">\n              {multiplayer.players.map((player) => (\n                <div\n                  key={player.id}\n                  className=\"px-4 py-2 bg-blue-100 text-blue-800 rounded-lg font-semibold text-lg\"\n                >\n                  {player.name === multiplayer.playerName ? `${player.name} âœ“` : player.name}\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Spectator mode: show list of players still playing when current player finished\n  if (playerFinished && !shouldShowResults && hasPlayersStillPlaying && !selectedPlayer) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4\">\n        <div className=\"max-w-2xl mx-auto space-y-4\">\n          <div className=\"bg-white rounded-xl p-6 shadow-md text-center\">\n            <div className=\"text-5xl mb-4\">ğŸ‘€</div>\n            <h2 className=\"text-3xl font-bold text-blue-600 mb-2\">Ø§Ù†ØªÙ‡ÙŠØª Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©! ğŸ‰</h2>\n            <p className=\"text-gray-600 mb-6\">Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙ‡</p>\n            \n            <div className=\"space-y-3\">\n              {multiplayer.stillPlaying.map((player) => (\n                <button\n                  key={player.playerId}\n                  onClick={() => setSelectedPlayer(player.playerId)}\n                  className=\"w-full flex items-center justify-between bg-gradient-to-r from-blue-100 to-purple-100 p-4 rounded-xl border-2 border-blue-300 hover:border-blue-600 hover:shadow-lg transition-all\"\n                >\n                  <div className=\"flex items-center gap-3 flex-1\">\n                    <Eye className=\"w-6 h-6 text-blue-600\" />\n                    <div className=\"text-right flex-1\">\n                      <p className=\"font-bold text-gray-800\">{player.playerName}</p>\n                      <p className=\"text-sm text-gray-600\">\n                        {player.attempts} Ù…Ø­Ø§ÙˆÙ„Ø§Øª Â· {formatDuration(player.duration)}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"text-2xl font-bold text-purple-600 ml-4\">\n                    {player.attempts}/{multiplayer.settings.maxAttempts}\n                  </div>\n                </button>\n              ))}\n            </div>\n\n            <button\n              onClick={() => handleLeaveRoom()}\n              className=\"w-full mt-6 flex items-center justify-center gap-2 bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl font-bold transition-colors\"\n            >\n              <LogOut className=\"w-5 h-5\" />\n              Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ØºØ±ÙØ©\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (selectedPlayer && playerDetails) {\n    // Get navigation for watching mode\n    const watchingPlayers = playerFinished && availableToWatch.length > 0 ? availableToWatch : null;\n    const currentPlayerIndex = watchingPlayers ? watchingPlayers.findIndex(p => p.playerId === selectedPlayer) : -1;\n    const canGoPrevious = watchingPlayers && currentPlayerIndex > 0;\n    const canGoNext = watchingPlayers && currentPlayerIndex < watchingPlayers.length - 1;\n\n    const goToPreviousPlayer = () => {\n      if (canGoPrevious && watchingPlayers) {\n        setSelectedPlayer(watchingPlayers[currentPlayerIndex - 1].playerId);\n      }\n    };\n\n    const goToNextPlayer = () => {\n      if (canGoNext && watchingPlayers) {\n        setSelectedPlayer(watchingPlayers[currentPlayerIndex + 1].playerId);\n      }\n    };\n\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4\">\n        <div className=\"max-w-2xl mx-auto space-y-4\">\n          <div className=\"flex items-center justify-between bg-white rounded-xl p-4 shadow-md\">\n            <div className=\"flex items-center gap-2\">\n              {watchingPlayers && (\n                <>\n                  <button\n                    onClick={goToPreviousPlayer}\n                    disabled={!canGoPrevious}\n                    className={`p-2 rounded-lg transition-colors ${\n                      canGoPrevious\n                        ? \"hover:bg-gray-100 text-gray-700\"\n                        : \"text-gray-300 cursor-not-allowed\"\n                    }`}\n                  >\n                    â†\n                  </button>\n                  <span className=\"text-sm text-gray-600 min-w-[60px] text-center\">\n                    {currentPlayerIndex + 1} / {watchingPlayers.length}\n                  </span>\n                  <button\n                    onClick={goToNextPlayer}\n                    disabled={!canGoNext}\n                    className={`p-2 rounded-lg transition-colors ${\n                      canGoNext\n                        ? \"hover:bg-gray-100 text-gray-700\"\n                        : \"text-gray-300 cursor-not-allowed\"\n                    }`}\n                  >\n                    â†’\n                  </button>\n                </>\n              )}\n            </div>\n            <h2 className=\"text-xl font-bold text-gray-800\">{playerDetails.playerName}</h2>\n            <button\n              onClick={() => watchingPlayers ? setSelectedPlayer(null) : handleLeaveRoom()}\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n              title={watchingPlayers ? \"Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©\" : \"Ø®Ø±ÙˆØ¬\"}\n            >\n              <X className=\"w-6 h-6 text-gray-700\" />\n            </button>\n          </div>\n\n          <div className=\"bg-white rounded-xl p-6 shadow-md\">\n            <div className=\"space-y-4\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-gray-600\">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª:</span>\n                <span className=\"text-2xl font-bold text-blue-600\">{playerDetails.attempts}</span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-gray-600\">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚:</span>\n                <span className=\"text-xl font-bold text-green-600\">{formatDuration(playerDetails.duration)}</span>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-xl p-4 shadow-md\">\n            <h3 className=\"text-lg font-bold text-gray-800 mb-4\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</h3>\n            <div className=\"space-y-3\">\n              {playerDetails.attemptsDetails.map((attempt, idx) => (\n                <div\n                  key={idx}\n                  className=\"flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-xl border border-gray-200 flex-row-reverse\"\n                >\n                  <span className=\"font-mono text-2xl font-bold text-gray-800\">\n                    {attempt.guess.join(\"\")}\n                  </span>\n                  <div className=\"flex gap-3\">\n                    <div className=\"flex flex-col items-center\">\n                      <span className=\"text-2xl font-bold text-blue-600\">{attempt.correctCount}</span>\n                      <span className=\"text-xs text-blue-600\">ØµØ­</span>\n                    </div>\n                    <div className=\"flex flex-col items-center\">\n                      <span className=\"text-2xl font-bold text-green-600\">{attempt.correctPositionCount}</span>\n                      <span className=\"text-xs text-green-600\">Ù…ÙƒØ§Ù†Ù‡Ù…</span>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (false) { // Removed old finished game screen - use results component instead\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4\">\n        <div className=\"max-w-2xl mx-auto space-y-4\">\n          <div className=\"bg-white rounded-xl p-6 shadow-md text-center\">\n            <div className=\"text-6xl mb-4\">ğŸ†</div>\n            <h2 className=\"text-3xl font-bold text-purple-600 mb-6\">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>\n            \n            {multiplayer.winners.length > 0 && (\n              <div className=\"mb-6\">\n                <h3 className=\"text-xl font-bold text-green-600 mb-3 flex items-center justify-center gap-2\">\n                  <Trophy className=\"w-6 h-6\" />\n                  Ø§Ù„ÙØ§Ø¦Ø²ÙˆÙ†\n                </h3>\n                <div className=\"space-y-2\">\n                  {multiplayer.winners.map((winner, idx) => (\n                    <button\n                      key={winner.playerId}\n                      onClick={() => setSelectedPlayer(winner.playerId)}\n                      className=\"w-full flex items-center justify-between bg-gradient-to-r from-yellow-100 to-green-100 p-4 rounded-xl border-2 border-green-400 hover:border-green-600 transition-colors\"\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <span className=\"text-2xl font-bold text-purple-600\">#{idx + 1}</span>\n                        <Crown className=\"w-6 h-6 text-yellow-500\" />\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"font-bold text-gray-800\">{winner.playerName}</p>\n                        <p className=\"text-sm text-gray-600\">\n                          {winner.attempts} Ù…Ø­Ø§ÙˆÙ„Ø§Øª Â· {formatDuration(winner.duration)}\n                        </p>\n                      </div>\n                      <Eye className=\"w-5 h-5 text-gray-500\" />\n                    </button>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {multiplayer.losers.length > 0 && (\n              <div className=\"mb-6\">\n                <h3 className=\"text-xl font-bold text-red-600 mb-3\">Ù„Ù… ÙŠÙƒÙ…Ù„ÙˆØ§</h3>\n                <div className=\"space-y-2\">\n                  {multiplayer.losers.map((loser) => (\n                    <button\n                      key={loser.playerId}\n                      onClick={() => setSelectedPlayer(loser.playerId)}\n                      className=\"w-full flex items-center justify-between bg-gray-100 p-4 rounded-xl border-2 border-gray-300 hover:border-gray-400 transition-colors\"\n                    >\n                      <span className=\"font-bold text-gray-700\">{loser.playerName}</span>\n                      <Eye className=\"w-5 h-5 text-gray-500\" />\n                    </button>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {multiplayer.rematchState.requested && (\n              <div className=\"bg-blue-50 border-2 border-blue-300 rounded-xl p-4 mb-4\">\n                <p className=\"text-lg font-bold text-blue-800 mb-3\">Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©ØŸ</p>\n                <div className=\"flex gap-3\">\n                  <button\n                    onClick={() => handleRematchVote(true)}\n                    className=\"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl transition-colors\"\n                  >\n                    Ù†Ø¹Ù…\n                  </button>\n                  <button\n                    onClick={() => handleRematchVote(false)}\n                    className=\"flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl transition-colors\"\n                  >\n                    Ù„Ø§\n                  </button>\n                </div>\n              </div>\n            )}\n\n            <button\n              onClick={handleHome}\n              className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors\"\n            >\n              Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Show game while playing\n  if (multiplayer.gameStatus === \"playing\" && multiplayer.sharedSecret.length > 0) {\n    return (\n      <div className=\"min-h-screen h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 overflow-y-auto\">\n        <div className=\"w-full h-full flex flex-col p-4\">\n          {/* Header - Same for all devices */}\n          <div className=\"flex flex-row-reverse items-center justify-between bg-white rounded-xl p-4 shadow-md gap-4 mb-4 max-w-6xl mx-auto w-full\">\n            <div className=\"flex gap-2\">\n              <button\n                onClick={() => {\n                  handleLeaveRoom();\n                  setMode(\"menu\");\n                }}\n                className=\"p-2 hover:bg-red-50 rounded-lg transition-colors flex-shrink-0 text-red-600\"\n                title=\"Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ØºØ±ÙØ©\"\n              >\n                <LogOut className=\"w-6 h-6\" />\n              </button>\n              <button\n                onClick={() => {\n                  handleLeaveRoom();\n                  setMode(\"menu\");\n                }}\n                className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors flex-shrink-0\"\n                title=\"Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\"\n              >\n                <Home className=\"w-6 h-6 text-gray-700\" />\n              </button>\n            </div>\n            <div className=\"text-right flex-1\">\n              <p className=\"text-sm text-gray-600\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† {multiplayer.settings.maxAttempts}</p>\n              <p className=\"text-2xl font-bold text-blue-600\">{multiplayer.settings.maxAttempts - multiplayer.attempts.length}</p>\n            </div>\n            <div className=\"text-right flex-1 border-l-2 border-gray-300 pl-4\">\n              <p className=\"text-sm text-gray-600\">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</p>\n              <p className={`text-2xl font-bold ${isTimeWarning() ? 'text-red-600 animate-pulse' : 'text-green-600'}`}>{formatDuration(getRemainingTime())}</p>\n            </div>\n          </div>\n\n          {/* Main Game Area - Different layouts for desktop vs mobile/tablet */}\n          <div className=\"flex-1 flex flex-col xl:flex-row gap-4 max-w-6xl mx-auto w-full\">\n            {/* Desktop: Attempts on RIGHT (order-2), Number pad on LEFT (order-1) */}\n            {/* Mobile/Tablet: Number pad first, then attempts below */}\n            \n            {/* Number Input Section - LEFT on desktop, TOP on mobile/tablet */}\n            <div className=\"bg-white rounded-xl p-4 shadow-md xl:flex-1 xl:order-1\">\n              <h3 className=\"text-lg font-bold text-gray-800 mb-3 text-center\">Ø£Ø¯Ø®Ù„ {numDigits} Ø£Ø±Ù‚Ø§Ù…</h3>\n              \n              <div className=\"flex gap-3 justify-center mb-4\" dir=\"ltr\">\n                {input.map((digit, idx) => {\n                  const revealedDigit = getRevealedDigitAtPosition(idx);\n                  const isRevealed = revealedDigit !== null;\n                  const parityInfo = getParityAtPosition(idx);\n                  \n                  return (\n                    <div\n                      key={idx}\n                      className={`relative w-14 h-16 md:w-16 md:h-18 xl:w-14 xl:h-16 border-2 rounded-xl flex items-center justify-center text-2xl md:text-3xl xl:text-2xl font-bold transition-all ${\n                        isRevealed\n                          ? \"border-purple-500 bg-purple-50\"\n                          : focusedIndex === idx\n                          ? \"border-blue-500 bg-blue-50\"\n                          : \"border-gray-300 bg-white\"\n                      }`}\n                      title={isRevealed ? \"Ø±Ù‚Ù… Ù…ÙƒØ´ÙˆÙ\" : parityInfo ? (parityInfo.isEven ? \"Ø±Ù‚Ù… Ø²ÙˆØ¬ÙŠ\" : \"Ø±Ù‚Ù… ÙØ±Ø¯ÙŠ\") : undefined}\n                    >\n                      {isRevealed && !digit && (\n                        <span className=\"absolute inset-0 flex items-center justify-center text-2xl md:text-3xl xl:text-2xl font-bold opacity-40 text-purple-600\">\n                          {revealedDigit}\n                        </span>\n                      )}\n                      {parityInfo && !isRevealed && !digit && (\n                        <span className={`absolute inset-0 flex items-center justify-center text-lg font-medium opacity-40 ${\n                          parityInfo.isEven ? \"text-green-600\" : \"text-orange-600\"\n                        }`}>\n                          {parityInfo.isEven ? \"Ø²ÙˆØ¬ÙŠ\" : \"ÙØ±Ø¯ÙŠ\"}\n                        </span>\n                      )}\n                      <span className=\"relative z-10\">{digit}</span>\n                      {isRevealed && (\n                        <span className=\"absolute -top-1 -right-1 w-4 h-4 bg-purple-500 rounded-full flex items-center justify-center\">\n                          <Eye className=\"w-2.5 h-2.5 text-white\" />\n                        </span>\n                      )}\n                      {parityInfo && !isRevealed && (\n                        <span className={`absolute -bottom-1 -right-1 w-4 h-4 rounded-full flex items-center justify-center text-[8px] text-white ${\n                          parityInfo.isEven ? \"bg-green-500\" : \"bg-orange-500\"\n                        }`}>\n                          {parityInfo.isEven ? \"Ø²\" : \"Ù\"}\n                        </span>\n                      )}\n                    </div>\n                  );\n                })}\n              </div>\n\n              {/* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…Ø­Ø±ÙˆÙ‚Ø© */}\n              {burnedNumbers.length > 0 && (\n                <div className=\"flex items-center justify-center gap-1 mb-3 text-sm text-red-600\">\n                  <X className=\"w-4 h-4\" />\n                  <span>Ø£Ø±Ù‚Ø§Ù… Ù…Ø­Ø±ÙˆÙ‚Ø©: {burnedNumbers.join(\"ØŒ \")}</span>\n                </div>\n              )}\n\n              <div className=\"grid grid-cols-3 gap-3 max-w-xs mx-auto\" dir=\"ltr\">\n                {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => {\n                  const isBurned = isBurnedNumber(num);\n                  return (\n                    <button\n                      key={num}\n                      onClick={() => handleNumberInput(num.toString())}\n                      disabled={isBurned}\n                      className={`h-14 md:h-16 xl:h-14 text-xl font-bold rounded-xl shadow-md active:scale-95 transition-all ${\n                        isBurned\n                          ? \"bg-gradient-to-br from-red-300 to-red-400 text-red-100 cursor-not-allowed line-through\"\n                          : \"bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white\"\n                      }`}\n                    >\n                      {num}\n                    </button>\n                  );\n                })}\n                <button\n                  onClick={handleBackspace}\n                  className=\"h-14 md:h-16 xl:h-14 bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold rounded-xl shadow-md active:scale-95 transition-all flex items-center justify-center\"\n                >\n                  <X className=\"w-6 h-6\" />\n                </button>\n                <button\n                  onClick={() => handleNumberInput(\"0\")}\n                  disabled={isBurnedNumber(0)}\n                  className={`h-14 md:h-16 xl:h-14 text-xl font-bold rounded-xl shadow-md active:scale-95 transition-all ${\n                    isBurnedNumber(0)\n                      ? \"bg-gradient-to-br from-red-300 to-red-400 text-red-100 cursor-not-allowed line-through\"\n                      : \"bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white\"\n                  }`}\n                >\n                  0\n                </button>\n                <button\n                  onClick={handleSubmit}\n                  disabled={input.some((val, idx) => val === \"\" && getRevealedDigitAtPosition(idx) === null)}\n                  className=\"h-14 md:h-16 xl:h-14 bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white font-bold rounded-xl shadow-md active:scale-95 transition-all flex items-center justify-center\"\n                >\n                  <Check className=\"w-6 h-6\" />\n                </button>\n              </div>\n            </div>\n\n            {/* Attempts Section - RIGHT on desktop (order-2), BOTTOM on mobile/tablet */}\n            <div className=\"bg-white rounded-xl p-4 shadow-md flex-1 overflow-hidden flex flex-col min-h-[200px] xl:order-2 xl:min-w-[350px] xl:max-w-[400px]\">\n              <div className=\"flex items-center justify-between mb-3 flex-shrink-0\">\n                <h3 className=\"text-lg font-bold text-gray-800\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ({multiplayer.attempts.length} / {multiplayer.settings.maxAttempts})</h3>\n                {multiplayer.attempts.length > 3 && (\n                  <button\n                    onClick={() => setExpandedAttempts(true)}\n                    className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                  >\n                    <Maximize2 className=\"w-5 h-5 text-gray-600\" />\n                  </button>\n                )}\n              </div>\n              <div className=\"overflow-y-auto flex-1 space-y-2\">\n                {multiplayer.attempts.length === 0 ? (\n                  <p className=\"text-gray-500 text-center py-4\">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¨Ø¹Ø¯</p>\n                ) : (\n                  [...multiplayer.attempts].reverse().map((attempt, idx) => (\n                    <div\n                      key={idx}\n                      className=\"flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-green-50 rounded-xl border border-gray-200 flex-row-reverse\"\n                    >\n                      <span className=\"font-mono text-xl font-bold text-gray-800\">\n                        {attempt.guess.join(\"\")}\n                      </span>\n                      <div className=\"flex gap-2 text-sm\">\n                        <span className=\"bg-blue-100 text-blue-800 px-3 py-1 rounded-lg font-semibold\">\n                          {attempt.correctCount} ØµØ­\n                        </span>\n                        <span className=\"bg-green-100 text-green-800 px-3 py-1 rounded-lg font-semibold\">\n                          {attempt.correctPositionCount} Ù…ÙƒØ§Ù†\n                        </span>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Expanded Attempts Modal */}\n          {expandedAttempts && (\n            <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n              <div className=\"w-full max-w-lg bg-white rounded-2xl shadow-2xl flex flex-col max-h-[90vh]\">\n                <div className=\"flex items-center justify-between p-4 border-b flex-shrink-0\">\n                  <h3 className=\"text-xl font-bold text-gray-800\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ({multiplayer.attempts.length} / {multiplayer.settings.maxAttempts})</h3>\n                  <button\n                    onClick={() => setExpandedAttempts(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                  >\n                    <Minimize2 className=\"w-6 h-6 text-gray-600\" />\n                  </button>\n                </div>\n                <div className=\"overflow-y-auto flex-1 p-4\">\n                  <div className=\"space-y-3\">\n                    {[...multiplayer.attempts].reverse().map((attempt, idx) => (\n                      <div\n                        key={idx}\n                        className=\"flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-xl border border-gray-200 flex-row-reverse\"\n                      >\n                        <span className=\"font-mono text-2xl font-bold text-gray-800\">\n                          {attempt.guess.join(\"\")}\n                        </span>\n                        <div className=\"flex gap-3\">\n                          <div className=\"flex flex-col items-center\">\n                            <span className=\"text-2xl font-bold text-blue-600\">{attempt.correctCount}</span>\n                            <span className=\"text-xs text-blue-600\">ØµØ­</span>\n                          </div>\n                          <div className=\"flex flex-col items-center\">\n                            <span className=\"text-2xl font-bold text-green-600\">{attempt.correctPositionCount}</span>\n                            <span className=\"text-xs text-green-600\">Ù…ÙƒØ§Ù†</span>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n                <button\n                  onClick={() => setExpandedAttempts(false)}\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 m-4 rounded-xl transition-colors flex-shrink-0\"\n                >\n                  Ø¥ØºÙ„Ø§Ù‚\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Cards System UI */}\n        {multiplayer.settings.cardsEnabled && (\n          <>\n            <CardEffectDisplay playerId={multiplayer.playerId} revealNumberShowPosition={cardSettings.revealNumberShowPosition} currentPlayerName={multiplayer.playerName} />\n            <CardHand\n              playerId={multiplayer.playerId}\n              onUseCard={(cardId, targetPlayerId) => {\n                const cardsState = useCards.getState();\n                const playerCardsData = cardsState.playerCards.find(p => p.playerId === multiplayer.playerId);\n                const card = playerCardsData?.cards.find(c => c.id === cardId);\n                \n                if (!card) return;\n                \n                // Ø­ÙØ¸ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ÙƒØ´ÙˆÙØ© Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…\n                const prevRevealedCount = cardsState.revealedDigits.length;\n                \n                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¹Ø¨Ø± Ø§Ù„Ù…ØªØ¬Ø± - ÙŠØªÙ… Ø­Ø³Ø§Ø¨ ÙƒÙ„ Ø´ÙŠØ¡ Ù‡Ù†Ø§Ùƒ\n                const success = cardsState.useCard(\n                  multiplayer.playerId, \n                  cardId, \n                  targetPlayerId, \n                  multiplayer.sharedSecret,\n                  multiplayer.settings.numDigits\n                );\n                \n                if (success) {\n                  // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ£Ø«ÙŠØ± Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±\n                  const updatedCardsState = useCards.getState();\n                  const updatedPlayerCards = updatedCardsState.playerCards.find(p => p.playerId === multiplayer.playerId);\n                  const latestEffect = updatedPlayerCards?.activeEffects[updatedPlayerCards.activeEffects.length - 1];\n                  \n                  // Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© revealNumber Ù…Ø¹ Ø¥Ø¸Ù‡Ø§Ø± ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø©ØŒ Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ù† revealedDigits\n                  let effectValue = latestEffect?.value;\n                  if (card.type === \"revealNumber\" && updatedCardsState.cardSettings.revealNumberShowPosition) {\n                    const newRevealed = updatedCardsState.revealedDigits[updatedCardsState.revealedDigits.length - 1];\n                    if (newRevealed && updatedCardsState.revealedDigits.length > prevRevealedCount) {\n                      effectValue = { position: newRevealed.position, digit: newRevealed.digit };\n                    }\n                  }\n                  \n                  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¹Ø¨Ø± WebSocket\n                  send({\n                    type: \"use_card\",\n                    cardId,\n                    cardType: card.type,\n                    targetPlayerId,\n                    effectDuration: latestEffect ? latestEffect.expiresAt - Date.now() : 30000,\n                    effectValue,\n                  });\n                  console.log(\"Card used successfully:\", card.type, effectValue);\n                }\n              }}\n              otherPlayers={multiplayer.players\n                .filter(p => p.id !== multiplayer.playerId)\n                .map(p => ({ id: p.id, name: p.name }))}\n            />\n          </>\n        )}\n      </div>\n    );\n  }\n\n  if (!multiplayer.roomId) {\n    return (\n      <div className=\"min-h-screen p-6 flex items-center justify-center\">\n        <div className=\"w-full max-w-md space-y-4\">\n          <div className=\"bg-white rounded-2xl shadow-xl p-6 space-y-4\">\n            <button\n              onClick={handleHome}\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n            >\n              <Home className=\"w-6 h-6 text-gray-700\" />\n            </button>\n\n            <div className=\"text-center mb-6\">\n              <h2 className=\"text-2xl font-bold text-gray-800\">Ù„Ø¹Ø¨ Ø¬Ù…Ø§Ø¹ÙŠ</h2>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-bold text-gray-700 mb-2 text-right\">\n                Ø§Ø³Ù…Ùƒ\n              </label>\n              <input\n                type=\"text\"\n                value={playerName}\n                onChange={(e) => setPlayerName(e.target.value)}\n                placeholder=\"Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ\"\n                className=\"w-full px-4 py-3 border-2 border-gray-300 rounded-xl text-right focus:outline-none focus:border-blue-500\"\n                dir=\"rtl\"\n              />\n            </div>\n\n            <button\n              onClick={handleCreateRoom}\n              disabled={!playerName.trim()}\n              className=\"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-xl transition-all flex items-center justify-center gap-2\"\n            >\n              <Users className=\"w-5 h-5\" />\n              Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©\n            </button>\n\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <div className=\"w-full border-t border-gray-300\"></div>\n              </div>\n              <div className=\"relative flex justify-center text-sm\">\n                <span className=\"px-4 bg-white text-gray-500\">Ø£Ùˆ</span>\n              </div>\n            </div>\n\n            {!showJoinForm ? (\n              <button\n                onClick={() => setShowJoinForm(true)}\n                disabled={!playerName.trim()}\n                className=\"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-xl transition-colors\"\n              >\n                Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©\n              </button>\n            ) : (\n              <div className=\"space-y-3\">\n                <input\n                  type=\"text\"\n                  value={joinRoomId}\n                  onChange={(e) => setJoinRoomId(e.target.value.toUpperCase())}\n                  placeholder=\"Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©\"\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 rounded-xl text-center focus:outline-none focus:border-blue-500 font-mono text-xl uppercase\"\n                  maxLength={6}\n                />\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={() => setShowJoinForm(false)}\n                    className=\"flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 rounded-xl transition-colors\"\n                  >\n                    Ø¥Ù„ØºØ§Ø¡\n                  </button>\n                  <button\n                    onClick={handleJoinRoom}\n                    disabled={!playerName.trim() || !joinRoomId.trim() || joinRoomId.length !== 6}\n                    className=\"flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold py-3 rounded-xl transition-colors\"\n                  >\n                    Ø§Ù†Ø¶Ù…Ø§Ù…\n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Mobile lobby screen (waiting for game to start)\n  if (multiplayer.gameStatus === \"waiting\") {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4\">\n        <div className=\"max-w-2xl mx-auto space-y-4\">\n          {/* Header */}\n          <div className=\"bg-white rounded-xl p-4 shadow-md\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <button\n                onClick={handleHome}\n                className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n              >\n                <Home className=\"w-6 h-6 text-gray-700\" />\n              </button>\n              <div className=\"text-center flex-1\">\n                <h3 className=\"text-sm text-gray-600\">Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©</h3>\n                <div className=\"flex items-center justify-center gap-2\">\n                  <button\n                    onClick={handleCopyRoomId}\n                    className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                  >\n                    {copied ? (\n                      <Check className=\"w-5 h-5 text-green-600\" />\n                    ) : (\n                      <Copy className=\"w-5 h-5 text-gray-600\" />\n                    )}\n                  </button>\n                  <p className=\"text-3xl font-mono font-bold text-blue-600\">{multiplayer.roomId}</p>\n                </div>\n              </div>\n              {multiplayer.isHost && (\n                <button\n                  onClick={() => setShowSettings(true)}\n                  className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                >\n                  <Settings className=\"w-6 h-6 text-gray-700\" />\n                </button>\n              )}\n            </div>\n\n            {/* Settings Display */}\n            <div className=\"bg-gray-100 rounded-lg p-3 text-center text-sm text-gray-600\">\n              Ø£Ø±Ù‚Ø§Ù…: <span className=\"font-bold text-gray-800\">{multiplayer.settings.numDigits}</span> Â· Ù…Ø­Ø§ÙˆÙ„Ø§Øª: <span className=\"font-bold text-gray-800\">{multiplayer.settings.maxAttempts}</span>\n            </div>\n          </div>\n\n          {/* Players List */}\n          <div className=\"bg-white rounded-xl p-4 shadow-md\">\n            <h3 className=\"text-lg font-bold text-gray-800 mb-4 flex items-center\">\n              <Users className=\"w-5 h-5 ml-2\" />\n              Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† ({multiplayer.players.length})\n            </h3>\n            <div className=\"space-y-2\">\n              {multiplayer.players.map((player) => {\n                const isHost = player.id === multiplayer.hostId;\n                const isYou = player.id === multiplayer.playerId;\n                \n                return (\n                  <div\n                    key={player.id}\n                    className={`p-3 rounded-xl flex items-center gap-3 ${\n                      isYou\n                        ? \"bg-gradient-to-r from-blue-100 to-purple-100 border-2 border-blue-300\"\n                        : \"bg-gray-50 border border-gray-200\"\n                    }`}\n                  >\n                    {isHost && (\n                      <Crown className=\"w-5 h-5 text-yellow-500 fill-yellow-500\" />\n                    )}\n                    {!isHost && (\n                      <span className=\"w-5 h-5 bg-purple-600 text-white rounded-full flex items-center justify-center text-xs\">\n                        ğŸ‘¤\n                      </span>\n                    )}\n                    <span className=\"font-bold text-gray-800\">{player.name}</span>\n                    {isYou && (\n                      <span className=\"text-xs bg-blue-200 text-blue-700 px-2 py-0.5 rounded-lg ml-auto\">\n                        (Ø£Ù†Øª)\n                      </span>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n            {multiplayer.players.length < 2 && (\n              <div className=\"bg-blue-50 p-3 rounded-xl border-2 border-blue-300 mt-3\">\n                <p className=\"text-blue-800 text-center font-medium text-sm\">\n                  ğŸ•’ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¢Ø®Ø±ÙŠÙ†...\n                </p>\n              </div>\n            )}\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"space-y-2\">\n            {multiplayer.isHost && multiplayer.players.length >= 2 && (\n              <button\n                onClick={handleStartGame}\n                className=\"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-3 rounded-xl shadow-lg flex items-center justify-center gap-2\"\n              >\n                <Play className=\"w-5 h-5\" />\n                Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©\n              </button>\n            )}\n\n            {!multiplayer.isHost && (\n              <div className=\"bg-purple-50 border-2 border-purple-300 rounded-xl p-3\">\n                <p className=\"text-purple-800 text-center font-semibold text-sm\">\n                  â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¶ÙŠÙ Ù„Ù„Ø¹Ø¨Ø©...\n                </p>\n              </div>\n            )}\n\n            <button\n              onClick={handleLeaveRoom}\n              className=\"w-full bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-3 rounded-xl shadow-lg flex items-center justify-center gap-2\"\n            >\n              <LogOut className=\"w-5 h-5\" />\n              Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØºØ±ÙØ©\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // If we reach here, something is wrong - return empty or fallback\n  return null;\n}\n","path":null,"size_bytes":50328,"size_tokens":null},"client/src/components/desktop/DesktopSingleplayer.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { useAudio } from \"@/lib/stores/useAudio\";\nimport { Home, Check, X, Maximize2, Minimize2, Lightbulb } from \"lucide-react\";\nimport { useChallenges } from \"@/lib/stores/useChallenges\";\n\nfunction useResponsiveSizes() {\n  const [screenWidth, setScreenWidth] = useState(typeof window !== 'undefined' ? window.innerWidth : 0);\n\n  useEffect(() => {\n    const handleResize = () => setScreenWidth(window.innerWidth);\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø­Ø¬Ø§Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„ÙØ¹Ù„ÙŠ\n  const getButtonHeight = () => {\n    if (screenWidth < 480) return 'h-9';\n    if (screenWidth < 640) return 'h-10';\n    if (screenWidth < 768) return 'h-11';\n    if (screenWidth < 1024) return 'h-12';\n    return 'h-12';\n  };\n\n  const getInputSize = () => {\n    if (screenWidth < 480) return { width: 'w-9', height: 'h-11' };\n    if (screenWidth < 640) return { width: 'w-10', height: 'h-12' };\n    if (screenWidth < 768) return { width: 'w-11', height: 'h-14' };\n    if (screenWidth < 1024) return { width: 'w-12', height: 'h-16' };\n    return { width: 'w-12', height: 'h-16' };\n  };\n\n  const getTextSize = () => {\n    if (screenWidth < 480) return 'text-xs';\n    if (screenWidth < 640) return 'text-sm';\n    if (screenWidth < 768) return 'text-base';\n    return 'text-lg';\n  };\n\n  const getIconSize = () => {\n    if (screenWidth < 480) return 'w-3 h-3';\n    if (screenWidth < 640) return 'w-4 h-4';\n    if (screenWidth < 768) return 'w-5 h-5';\n    return 'w-6 h-6';\n  };\n\n  return { getButtonHeight, getInputSize, getTextSize, getIconSize, screenWidth };\n}\n\nexport function DesktopSingleplayer({ onStartChallenge }: { onStartChallenge?: () => void }) {\n  const navigate = useNavigate();\n  const {\n    singleplayer,\n    setMode,\n    restartSingleplayer,\n  } = useNumberGame();\n  const hint = useChallenges((state) => state.hint);\n  const { hasWonAnyChallenge, generateHint } = useChallenges();\n  const hasWonChallenge = hasWonAnyChallenge();\n  \n  const { playDigit, playDelete, playError, successSound } = useAudio();\n  const numDigits = singleplayer.settings.numDigits;\n  const [input, setInput] = useState<string[]>(Array(numDigits).fill(\"\"));\n  const [focusedIndex, setFocusedIndex] = useState(0);\n  const [expandedAttempts, setExpandedAttempts] = useState(false);\n  const [showHint, setShowHint] = useState(false);\n  const [expandedAttemptIndex, setExpandedAttemptIndex] = useState(singleplayer.attempts.length - 1);\n  const { getButtonHeight, getInputSize, getTextSize, getIconSize } = useResponsiveSizes();\n\n  useEffect(() => {\n    if (!singleplayer.secretCode || singleplayer.secretCode.length === 0) {\n      restartSingleplayer();\n    }\n  }, [singleplayer.secretCode, restartSingleplayer]);\n\n  useEffect(() => {\n    setInput(Array(numDigits).fill(\"\"));\n    setFocusedIndex(0);\n  }, [numDigits]);\n\n  useEffect(() => {\n    if (singleplayer.phase === \"won\" && !hint && singleplayer.secretCode) {\n      console.log(\"âœ¨ Singleplayer won - generating hint\");\n      generateHint(singleplayer.secretCode);\n    }\n  }, [singleplayer.phase, hint, singleplayer.secretCode, generateHint]);\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (singleplayer.phase !== \"playing\") return;\n      if (expandedAttempts) return;\n      \n      if (e.key >= '0' && e.key <= '9') {\n        e.preventDefault();\n        handleNumberInput(e.key);\n      } else if (e.key === 'Backspace') {\n        e.preventDefault();\n        handleBackspace();\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n        if (!input.some(val => val === \"\")) {\n          handleSubmit();\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [singleplayer.phase, focusedIndex, input, numDigits, expandedAttempts]);\n\n  const handleNumberInput = (num: string) => {\n    if (focusedIndex >= numDigits) return;\n    \n    playDigit(parseInt(num));\n    const newInput = [...input];\n    newInput[focusedIndex] = num;\n    setInput(newInput);\n    \n    if (focusedIndex < numDigits - 1) {\n      setFocusedIndex(focusedIndex + 1);\n    }\n  };\n\n  const handleBackspace = () => {\n    playDelete();\n    if (focusedIndex > 0) {\n      const newInput = [...input];\n      if (input[focusedIndex] === \"\") {\n        newInput[focusedIndex - 1] = \"\";\n        setFocusedIndex(focusedIndex - 1);\n      } else {\n        newInput[focusedIndex] = \"\";\n      }\n      setInput(newInput);\n    } else if (input[0] !== \"\") {\n      const newInput = [...input];\n      newInput[0] = \"\";\n      setInput(newInput);\n    }\n  };\n\n  const handleSubmit = () => {\n    if (input.some(val => val === \"\")) {\n      return;\n    }\n\n    const guess = input.map(Number);\n    let correctCount = 0;\n    let correctPositionCount = 0;\n\n    const secretCopy = [...singleplayer.secretCode];\n    const guessCopy = [...guess];\n    const numDigits = singleplayer.settings.numDigits;\n\n    for (let i = 0; i < numDigits; i++) {\n      if (guessCopy[i] === secretCopy[i]) {\n        correctPositionCount++;\n        secretCopy[i] = -1;\n        guessCopy[i] = -2;\n      }\n    }\n\n    for (let i = 0; i < numDigits; i++) {\n      if (guessCopy[i] !== -2) {\n        const index = secretCopy.indexOf(guessCopy[i]);\n        if (index !== -1) {\n          correctCount++;\n          secretCopy[index] = -1;\n        }\n      }\n    }\n\n    correctCount += correctPositionCount;\n\n    useNumberGame.setState((state) => ({\n      singleplayer: {\n        ...state.singleplayer,\n        attempts: [...state.singleplayer.attempts, { guess, correctCount, correctPositionCount }],\n      },\n    }));\n\n    if (correctPositionCount === numDigits) {\n      if (successSound) {\n        successSound.currentTime = 0;\n        successSound.play();\n      }\n      useNumberGame.setState((state) => ({\n        singleplayer: {\n          ...state.singleplayer,\n          phase: \"won\",\n        },\n      }));\n    } else if (singleplayer.attempts.length >= singleplayer.settings.maxAttempts - 1) {\n      useNumberGame.setState((state) => ({\n        singleplayer: {\n          ...state.singleplayer,\n          phase: \"lost\",\n        },\n      }));\n    }\n\n    setInput(Array(numDigits).fill(\"\"));\n    setFocusedIndex(0);\n  };\n\n  const handleHome = () => {\n    const { resetToMenu } = useChallenges.getState();\n    resetToMenu();\n    restartSingleplayer();\n    setMode(\"menu\");\n    navigate(\"/\");\n  };\n\n  useEffect(() => {\n    if (singleplayer.phase === \"won\") {\n      console.log(\"ğŸ† Player won - generating hint if needed\");\n      if (!hint && singleplayer.secretCode) {\n        console.log(\"ğŸ“ Generating hint on win...\");\n        generateHint(singleplayer.secretCode);\n      }\n    }\n  }, [singleplayer.phase, hint, singleplayer.secretCode, generateHint]);\n\n  const hintText = hint\n    ? hint.type === \"digit\"\n      ? `Ø§Ù„Ø®Ø§Ù†Ø© ${(hint.position || 0) + 1}: ${hint.value}`\n      : String(hint.value)\n    : \"\";\n\n  if (singleplayer.phase === \"won\") {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-4 sm:p-6\">\n        <div className=\"w-full max-w-md sm:max-w-lg bg-white rounded-2xl shadow-2xl p-6 sm:p-8 text-center space-y-6\">\n          <div className=\"text-5xl sm:text-6xl\">ğŸ‰</div>\n          <h2 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-green-600\">Ù…Ø¨Ø±ÙˆÙƒ! ÙØ²Øª</h2>\n          <p className=\"text-sm sm:text-base lg:text-lg text-gray-600\">\n            Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª: <span className=\"font-bold text-blue-600\">{singleplayer.attempts.length}</span>\n          </p>\n          <p className=\"text-sm sm:text-base text-gray-700\">\n            Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ÙƒØ§Ù†: <span className=\"font-mono text-lg sm:text-xl lg:text-2xl font-bold text-purple-600\">{singleplayer.secretCode.join(\"\")}</span>\n          </p>\n          <div className=\"space-y-3\">\n            <button\n              onClick={handleHome}\n              className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors\"\n            >\n              Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (singleplayer.phase === \"lost\") {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-4 sm:p-6\">\n        <div className=\"w-full max-w-md sm:max-w-lg bg-white rounded-2xl shadow-2xl p-6 sm:p-8 text-center space-y-6\">\n          <div className=\"text-5xl sm:text-6xl\">ğŸ˜¢</div>\n          <h2 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-red-600\">Ø®Ø³Ø±Øª!</h2>\n          <p className=\"text-sm sm:text-base text-gray-700\">\n            Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ÙƒØ§Ù†: <span className=\"font-mono text-lg sm:text-xl lg:text-2xl font-bold text-purple-600\">{singleplayer.secretCode.join(\"\")}</span>\n          </p>\n          <div className=\"space-y-3\">\n            <button\n              onClick={restartSingleplayer}\n              className=\"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-xl transition-colors\"\n            >\n              Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\n            </button>\n            <button\n              onClick={handleHome}\n              className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors\"\n            >\n              Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const attemptsLeft = singleplayer.settings.maxAttempts - singleplayer.attempts.length;\n\n  return (\n    <div className=\"min-h-screen p-6 pb-safe overflow-y-auto\">\n      <div className=\"max-w-7xl mx-auto w-full min-h-[calc(100vh-3rem)]\">\n        <div className=\"grid lg:grid-cols-2 gap-6\">\n          {/* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª - Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± */}\n          <div className=\"bg-white rounded-xl p-6 shadow-md overflow-hidden flex flex-col\">\n            <div className=\"flex items-center justify-between mb-4 flex-shrink-0\">\n              <h3 className=\"text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-gray-800\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ({singleplayer.attempts.length} / {singleplayer.settings.maxAttempts})</h3>\n              {singleplayer.attempts.length > 5 && !expandedAttempts && (\n                <button\n                  onClick={() => setExpandedAttempts(true)}\n                  className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                >\n                  <Maximize2 className=\"w-5 sm:w-6 h-5 sm:h-6 text-gray-600\" />\n                </button>\n              )}\n            </div>\n            <div className=\"flex-1 overflow-y-auto space-y-3\">\n              {singleplayer.attempts.length === 0 ? (\n                <p className=\"text-gray-400 text-center py-8\">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¨Ø¹Ø¯</p>\n              ) : (\n                [...singleplayer.attempts].reverse().slice(0, 5).map((attempt, idx) => (\n                  <div\n                    key={idx}\n                    className=\"flex items-center justify-between p-4 sm:p-5 md:p-6 bg-gradient-to-r from-blue-50 to-green-50 rounded-xl border border-gray-200 flex-row-reverse\"\n                  >\n                    <span className=\"font-mono text-xl sm:text-2xl md:text-3xl font-bold text-gray-800\">\n                      {attempt.guess.join(\"\")}\n                    </span>\n                    <div className=\"flex gap-2 sm:gap-3 md:gap-4\">\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-lg sm:text-2xl md:text-3xl font-bold text-blue-600\">{attempt.correctCount}</span>\n                        <span className=\"text-xs sm:text-sm text-blue-600\">ØµØ­</span>\n                      </div>\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-lg sm:text-2xl md:text-3xl font-bold text-green-600\">{attempt.correctPositionCount}</span>\n                        <span className=\"text-xs sm:text-sm text-green-600\">Ù…ÙƒØ§Ù†Ù‡Ù…</span>\n                      </div>\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n          </div>\n\n          {/* Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø¥Ø¯Ø®Ø§Ù„ - Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */}\n          <div className=\"flex flex-col gap-4\">\n            <div className=\"flex items-center justify-between bg-white rounded-xl p-2 md:p-3 shadow-md\">\n              <button\n                onClick={handleHome}\n                className=\"p-1 hover:bg-gray-100 rounded-lg transition-colors\"\n              >\n                <Home className={`${getIconSize()} text-gray-700`} />\n              </button>\n              <div className=\"text-right\">\n                <p className={`${getTextSize()} text-gray-600`}>Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† {singleplayer.settings.maxAttempts}</p>\n                <p className={`${getTextSize()} font-bold text-blue-600`}>{attemptsLeft}</p>\n              </div>\n            </div>\n\n            {onStartChallenge && (\n              !hasWonChallenge ? (\n                <button\n                  onClick={onStartChallenge}\n                  className=\"w-full flex items-center gap-2 justify-center bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-3 rounded-lg transition-colors shadow-md\"\n                >\n                  <Lightbulb className={getIconSize()} />\n                  <span className={getTextSize()}>Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªÙ„Ù…ÙŠØ­</span>\n                </button>\n              ) : hint ? (\n                <div className=\"w-full bg-gradient-to-r from-yellow-400 to-amber-500 rounded-lg p-2 md:p-3 shadow-md\">\n                  <h3 className={`text-white font-bold ${getTextSize()} mb-1 flex items-center gap-2`}>\n                    <Lightbulb className={getIconSize()} />\n                    Ø§Ù„ØªÙ„Ù…ÙŠØ­:\n                  </h3>\n                  <p className={`text-white ${getTextSize()} font-bold`}>{hint.type === \"digit\" ? `ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø© ${(hint.position || 0) + 1}: Ø±Ù‚Ù… ${hint.value}` : String(hint.value)}</p>\n                </div>\n              ) : null\n            )}\n\n            <div className=\"bg-white rounded-xl p-6 shadow-md flex-1 flex flex-col justify-center\">\n          <h3 className={`${getTextSize()} font-bold text-gray-800 mb-3 text-center`}>Ø£Ø¯Ø®Ù„ {numDigits} Ø£Ø±Ù‚Ø§Ù…</h3>\n          \n          <div className=\"flex gap-1 sm:gap-2 md:gap-2 justify-center mb-4\" dir=\"ltr\">\n            {input.map((digit, idx) => {\n              const inputSize = getInputSize();\n              return (\n                <div\n                  key={idx}\n                  className={`${inputSize.width} ${inputSize.height} border-2 rounded-lg flex items-center justify-center ${getTextSize()} font-bold transition-all ${\n                    focusedIndex === idx\n                      ? \"border-blue-500 bg-blue-50\"\n                      : \"border-gray-300 bg-white\"\n                  }`}\n                >\n                  {digit}\n                </div>\n              );\n            })}\n          </div>\n\n          <div className=\"grid grid-cols-3 gap-1 mb-1\" dir=\"ltr\">\n            {[1, 2, 3].map((num) => (\n              <button\n                key={num}\n                onClick={() => handleNumberInput(num.toString())}\n                className={`${getButtonHeight()} bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white ${getTextSize()} font-bold rounded-lg shadow-md active:scale-95 transition-all`}\n              >\n                {num}\n              </button>\n            ))}\n          </div>\n\n          <div className=\"grid grid-cols-3 gap-1 mb-1\" dir=\"ltr\">\n            {[4, 5, 6].map((num) => (\n              <button\n                key={num}\n                onClick={() => handleNumberInput(num.toString())}\n                className={`${getButtonHeight()} bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white ${getTextSize()} font-bold rounded-lg shadow-md active:scale-95 transition-all`}\n              >\n                {num}\n              </button>\n            ))}\n          </div>\n\n          <div className=\"grid grid-cols-3 gap-1 mb-1\" dir=\"ltr\">\n            {[7, 8, 9].map((num) => (\n              <button\n                key={num}\n                onClick={() => handleNumberInput(num.toString())}\n                className={`${getButtonHeight()} bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white ${getTextSize()} font-bold rounded-lg shadow-md active:scale-95 transition-all`}\n              >\n                {num}\n              </button>\n            ))}\n          </div>\n\n          <div className=\"grid grid-cols-3 gap-1\" dir=\"ltr\">\n            <button\n              onClick={handleBackspace}\n              className={`${getButtonHeight()} bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold rounded-lg shadow-md active:scale-95 transition-all flex items-center justify-center col-span-1`}\n            >\n              <X className={getIconSize()} />\n            </button>\n            <button\n              onClick={() => handleNumberInput(\"0\")}\n              className={`${getButtonHeight()} bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white ${getTextSize()} font-bold rounded-lg shadow-md active:scale-95 transition-all col-span-1`}\n            >\n              0\n            </button>\n            <button\n              onClick={handleSubmit}\n              disabled={input.some(val => val === \"\")}\n              className={`${getButtonHeight()} bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white font-bold rounded-lg shadow-md active:scale-95 transition-all flex items-center justify-center col-span-1`}\n            >\n              <Check className={getIconSize()} />\n            </button>\n          </div>\n            </div>\n          </div>\n        </div>\n\n        {expandedAttempts && (\n          <div className=\"fixed inset-0 bg-black/50 flex items-end z-50 p-4\">\n            <div className=\"w-full bg-white rounded-2xl shadow-2xl flex flex-col max-h-[90vh]\">\n              <div className=\"flex items-center justify-between p-4 border-b flex-shrink-0\">\n                <h3 className=\"text-2xl font-bold text-gray-800\">Ù…Ø­Ø§ÙˆÙ„Ø§Øª ({singleplayer.attempts.length} / {singleplayer.settings.maxAttempts})</h3>\n                <button\n                  onClick={() => setExpandedAttempts(false)}\n                  className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                >\n                  <Minimize2 className=\"w-6 h-6 text-gray-600\" />\n                </button>\n              </div>\n              <div className=\"overflow-y-scroll flex-1 p-4\">\n                <div className=\"space-y-3\">\n                  {[...singleplayer.attempts].reverse().map((attempt, idx) => (\n                    <div\n                      key={idx}\n                      className=\"flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-xl border border-gray-200 flex-row-reverse\"\n                    >\n                      <span className=\"font-mono text-2xl font-bold text-gray-800\">\n                        {attempt.guess.join(\"\")}\n                      </span>\n                      <div className=\"flex gap-3\">\n                        <div className=\"flex flex-col items-center\">\n                          <span className=\"text-2xl font-bold text-blue-600\">{attempt.correctCount}</span>\n                          <span className=\"text-xs text-blue-600\">ØµØ­</span>\n                        </div>\n                        <div className=\"flex flex-col items-center\">\n                          <span className=\"text-2xl font-bold text-green-600\">{attempt.correctPositionCount}</span>\n                          <span className=\"text-xs text-green-600\">Ù…ÙƒØ§Ù†Ù‡Ù…</span>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n              <button\n                onClick={() => setExpandedAttempts(false)}\n                className=\"bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 m-4 rounded-xl transition-colors flex-shrink-0\"\n              >\n                Ø¥ØºÙ„Ø§Ù‚\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":20731,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1012,"size_tokens":null},"client/src/components/ui/GameSettings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"./button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"./card\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { useCards, DEFAULT_CARD_SETTINGS, CardSettings } from \"@/lib/stores/useCards\";\nimport { send } from \"@/lib/websocket\";\nimport { Sliders, Sparkles, Eye, XCircle, Hash, Snowflake, Shield, Gamepad2, Shuffle, Brain, Zap, CloudRain, Lightbulb, Check, Clock, Settings2 } from \"lucide-react\";\n\ntype ChallengeType = \"guess\" | \"memory\" | \"direction\" | \"raindrops\" | \"random\";\ntype CardTypeId = \"revealNumber\" | \"burnNumber\" | \"revealParity\" | \"freeze\" | \"shield\";\n\ninterface GameSettingsProps {\n  onConfirm: (settings: { numDigits: number; maxAttempts: number; cardsEnabled?: boolean; selectedChallenge?: ChallengeType; allowedCards?: CardTypeId[] }) => void;\n  isMultiplayer?: boolean;\n}\n\nconst SETTINGS_STORAGE_KEY = \"multiplayer_room_settings\";\n\nconst challenges: { id: ChallengeType; name: string; description: string; icon: React.ReactNode; color: string }[] = [\n  { id: \"guess\", name: \"ØªØ­Ø¯ÙŠ ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ø¶ÙˆØ§Ø¡\", description: \"ØªØ°ÙƒØ± ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ£Ø¹Ø¯Ù‡ Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨\", icon: <Lightbulb className=\"w-5 h-5\" />, color: \"blue\" },\n  { id: \"memory\", name: \"Ù„ÙˆØ­Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©\", description: \"ØªØ°ÙƒØ± Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù…Ø¶ÙŠØ¦Ø© ÙˆØ§Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡Ø§\", icon: <Brain className=\"w-5 h-5\" />, color: \"purple\" },\n  { id: \"direction\", name: \"ØªØ±ØªÙŠØ¨ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª\", description: \"Ø§Ø¶ØºØ· Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ø³Ø±Ø¹Ø©\", icon: <Zap className=\"w-5 h-5\" />, color: \"orange\" },\n  { id: \"raindrops\", name: \"Ø­Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ø±\", description: \"Ø­Ù„ Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ Ù‚Ø¨Ù„ ÙˆØµÙˆÙ„ Ø§Ù„Ù‚Ø·Ø±Ø§Øª\", icon: <CloudRain className=\"w-5 h-5\" />, color: \"cyan\" },\n  { id: \"random\", name: \"Ø¹Ø´ÙˆØ§Ø¦ÙŠ\", description: \"ÙŠØ®ØªØ§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… ØªØ­Ø¯ÙŠ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹\", icon: <Shuffle className=\"w-5 h-5\" />, color: \"pink\" },\n];\n\nconst cardTypes: { id: CardTypeId; name: string; icon: React.ReactNode; color: string }[] = [\n  { id: \"revealNumber\", name: \"Ø¥Ø¸Ù‡Ø§Ø± Ø±Ù‚Ù…\", icon: <Eye className=\"w-3 h-3\" />, color: \"purple\" },\n  { id: \"burnNumber\", name: \"Ø­Ø±Ù‚ Ø±Ù‚Ù…\", icon: <XCircle className=\"w-3 h-3\" />, color: \"red\" },\n  { id: \"revealParity\", name: \"Ø²ÙˆØ¬ÙŠ/ÙØ±Ø¯ÙŠ\", icon: <Hash className=\"w-3 h-3\" />, color: \"green\" },\n  { id: \"freeze\", name: \"ØªØ¬Ù…ÙŠØ¯\", icon: <Snowflake className=\"w-3 h-3\" />, color: \"cyan\" },\n  { id: \"shield\", name: \"Ø¯Ø±Ø¹\", icon: <Shield className=\"w-3 h-3\" />, color: \"blue\" },\n];\n\nconst allCardIds: CardTypeId[] = [\"revealNumber\", \"burnNumber\", \"revealParity\", \"freeze\", \"shield\"];\n\nconst loadSavedSettings = () => {\n  try {\n    const saved = localStorage.getItem(SETTINGS_STORAGE_KEY);\n    if (saved) {\n      return JSON.parse(saved);\n    }\n  } catch (e) {\n    console.log(\"Failed to load saved settings\");\n  }\n  return null;\n};\n\nconst saveSettings = (settings: any) => {\n  try {\n    localStorage.setItem(SETTINGS_STORAGE_KEY, JSON.stringify(settings));\n  } catch (e) {\n    console.log(\"Failed to save settings\");\n  }\n};\n\nexport function GameSettings({ onConfirm, isMultiplayer = false }: GameSettingsProps) {\n  const { singleplayer, multiplayer, setSingleplayerSettings, setMultiplayerSettings } = useNumberGame();\n  const { cardSettings, setCardSettings } = useCards();\n  const currentSettings = isMultiplayer ? multiplayer.settings : singleplayer.settings;\n  \n  const savedSettings = isMultiplayer ? loadSavedSettings() : null;\n  \n  const [numDigits, setNumDigits] = useState(savedSettings?.numDigits ?? currentSettings.numDigits);\n  const [maxAttempts, setMaxAttempts] = useState(savedSettings?.maxAttempts ?? currentSettings.maxAttempts);\n  const [cardsEnabled, setCardsEnabled] = useState(savedSettings?.cardsEnabled ?? currentSettings.cardsEnabled ?? false);\n  const [selectedChallenge, setSelectedChallenge] = useState<ChallengeType>(\n    savedSettings?.selectedChallenge ?? (currentSettings.selectedChallenge as ChallengeType) ?? \"random\"\n  );\n  const [allowedCards, setAllowedCards] = useState<CardTypeId[]>(\n    savedSettings?.allowedCards ?? (currentSettings.allowedCards as CardTypeId[]) ?? allCardIds\n  );\n  \n  const [showCardSettings, setShowCardSettings] = useState(false);\n  const [roundDuration, setRoundDuration] = useState(savedSettings?.cardSettings?.roundDuration ?? cardSettings.roundDuration);\n  const [revealNumberShowPosition, setRevealNumberShowPosition] = useState(savedSettings?.cardSettings?.revealNumberShowPosition ?? cardSettings.revealNumberShowPosition);\n  const [burnNumberCount, setBurnNumberCount] = useState(savedSettings?.cardSettings?.burnNumberCount ?? cardSettings.burnNumberCount);\n  const [revealParitySlots, setRevealParitySlots] = useState(Math.min(savedSettings?.cardSettings?.revealParitySlots ?? cardSettings.revealParitySlots, numDigits));\n  const [freezeDuration, setFreezeDuration] = useState(savedSettings?.cardSettings?.freezeDuration ?? cardSettings.freezeDuration);\n  const [shieldDuration, setShieldDuration] = useState(savedSettings?.cardSettings?.shieldDuration ?? cardSettings.shieldDuration);\n\n  const toggleCard = (cardId: CardTypeId) => {\n    if (allowedCards.includes(cardId)) {\n      if (allowedCards.length > 1) {\n        setAllowedCards(allowedCards.filter(id => id !== cardId));\n      }\n    } else {\n      setAllowedCards([...allowedCards, cardId]);\n    }\n  };\n\n  const handleConfirm = () => {\n    const settings = { \n      numDigits, \n      maxAttempts, \n      cardsEnabled: isMultiplayer ? cardsEnabled : undefined,\n      selectedChallenge: isMultiplayer && cardsEnabled ? selectedChallenge : undefined,\n      allowedCards: isMultiplayer && cardsEnabled ? allowedCards : undefined\n    };\n    \n    if (isMultiplayer) {\n      const cardSettingsToSave = {\n        roundDuration,\n        revealNumberShowPosition,\n        burnNumberCount,\n        revealParitySlots: Math.min(revealParitySlots, numDigits),\n        freezeDuration,\n        shieldDuration,\n      };\n      \n      setCardSettings(cardSettingsToSave);\n      \n      setMultiplayerSettings({ \n        numDigits, \n        maxAttempts, \n        cardsEnabled, \n        selectedChallenge: selectedChallenge as any, \n        allowedCards \n      });\n      \n      saveSettings({\n        numDigits,\n        maxAttempts,\n        cardsEnabled,\n        selectedChallenge,\n        allowedCards,\n        cardSettings: cardSettingsToSave,\n      });\n      \n      send({\n        type: \"update_settings\",\n        settings: { \n          numDigits, \n          maxAttempts, \n          cardsEnabled, \n          selectedChallenge, \n          allowedCards,\n          cardSettings: cardSettingsToSave,\n        },\n      });\n    } else {\n      setSingleplayerSettings({ numDigits, maxAttempts });\n    }\n    onConfirm(settings);\n  };\n\n  const canSave = numDigits >= 3 && numDigits <= 10 && maxAttempts >= 5 && maxAttempts <= 50;\n\n  const getChallengeColors = (color: string, isSelected: boolean) => {\n    const colors: Record<string, { bg: string; selectedBg: string; border: string; text: string; iconBg: string }> = {\n      blue: { bg: \"#eff6ff\", selectedBg: \"#dbeafe\", border: \"#60a5fa\", text: \"#1e40af\", iconBg: \"#3b82f6\" },\n      purple: { bg: \"#faf5ff\", selectedBg: \"#f3e8ff\", border: \"#c084fc\", text: \"#6b21a8\", iconBg: \"#a855f7\" },\n      orange: { bg: \"#fff7ed\", selectedBg: \"#ffedd5\", border: \"#fb923c\", text: \"#9a3412\", iconBg: \"#f97316\" },\n      cyan: { bg: \"#ecfeff\", selectedBg: \"#cffafe\", border: \"#22d3ee\", text: \"#155e75\", iconBg: \"#06b6d4\" },\n      pink: { bg: \"#fdf2f8\", selectedBg: \"#fce7f3\", border: \"#f472b6\", text: \"#9d174d\", iconBg: \"#ec4899\" },\n    };\n    return colors[color] || colors.blue;\n  };\n\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50 z-50 p-4 overflow-y-auto\">\n      <Card className=\"w-full max-w-md bg-white shadow-xl border border-gray-200 rounded-2xl relative overflow-hidden my-auto\">\n        <div className=\"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500\"></div>\n        \n        <CardHeader className=\"text-center pb-2 pt-6\">\n          <div className=\"mb-4 flex justify-center\">\n            <div className=\"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg\">\n              <Sliders className=\"w-8 h-8 text-white\" />\n            </div>\n          </div>\n          <CardTitle className=\"text-center text-gray-800 text-3xl font-bold mb-2\">\n            {isMultiplayer ? \"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø©\" : \"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©\"}\n          </CardTitle>\n          <p className=\"text-center text-gray-600 text-base\">\n            Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø© ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª\n          </p>\n        </CardHeader>\n        \n        <CardContent className=\"space-y-6 p-6 max-h-[70vh] overflow-y-auto\">\n          <div>\n            <label className=\"block text-gray-700 font-semibold mb-3 text-sm\">\n              Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ®Ù…ÙŠÙ†Ù‡Ø§: <span className=\"text-blue-600 text-lg\">{numDigits}</span>\n            </label>\n            <input\n              type=\"range\"\n              min=\"3\"\n              max=\"10\"\n              value={numDigits}\n              onChange={(e) => setNumDigits(Number(e.target.value))}\n              className=\"w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer accent-blue-600\"\n            />\n            <div className=\"flex justify-between text-xs text-gray-500 mt-2\">\n              <span>3</span>\n              <span>10</span>\n            </div>\n            <div className=\"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200\">\n              <p className=\"text-sm text-gray-700\">\n                ØµØ¹ÙˆØ¨Ø©: <span className=\"font-semibold\">\n                  {numDigits <= 4 ? \"Ø³Ù‡Ù„Ø©\" : numDigits <= 6 ? \"Ù…ØªÙˆØ³Ø·Ø©\" : \"ØµØ¹Ø¨Ø©\"}\n                </span>\n              </p>\n            </div>\n          </div>\n\n          <div>\n            <label className=\"block text-gray-700 font-semibold mb-3 text-sm\">\n              Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§: <span className=\"text-purple-600 text-lg\">{maxAttempts}</span>\n            </label>\n            <input\n              type=\"range\"\n              min=\"5\"\n              max=\"50\"\n              step=\"5\"\n              value={maxAttempts}\n              onChange={(e) => setMaxAttempts(Number(e.target.value))}\n              className=\"w-full h-2 bg-purple-200 rounded-lg appearance-none cursor-pointer accent-purple-600\"\n            />\n            <div className=\"flex justify-between text-xs text-gray-500 mt-2\">\n              <span>5</span>\n              <span>50</span>\n            </div>\n            <div className=\"mt-3 p-3 bg-purple-50 rounded-lg border border-purple-200\">\n              <p className=\"text-sm text-gray-700\">\n                Ø§Ù„ÙØ±Øµ: <span className=\"font-semibold\">\n                  {maxAttempts <= 15 ? \"Ù‚Ù„ÙŠÙ„Ø©\" : maxAttempts <= 25 ? \"Ù…ØªÙˆØ³Ø·Ø©\" : \"Ø§Ù„ÙƒØ«ÙŠØ±\"}\n                </span>\n              </p>\n            </div>\n          </div>\n\n          {isMultiplayer && (\n            <div className=\"space-y-3\">\n              {/* Ù…Ø¯Ø© Ø§Ù„Ø¬ÙˆÙ„Ø© - ØªØ¸Ù‡Ø± Ø¯Ø§Ø¦Ù…Ø§Ù‹ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ */}\n              <div className=\"p-4 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl border border-blue-200\">\n                <label className=\"block text-gray-700 font-semibold mb-3 text-sm flex items-center gap-2\">\n                  <Clock className=\"w-4 h-4 text-blue-600\" />\n                  Ù…Ø¯Ø© Ø§Ù„Ø¬ÙˆÙ„Ø©: <span className=\"text-blue-600 text-lg\">{roundDuration} Ø¯Ù‚Ø§Ø¦Ù‚</span>\n                </label>\n                <input\n                  type=\"range\"\n                  min=\"1\"\n                  max=\"15\"\n                  value={roundDuration}\n                  onChange={(e) => setRoundDuration(Number(e.target.value))}\n                  className=\"w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer accent-blue-600\"\n                />\n                <div className=\"flex justify-between text-xs text-gray-500 mt-2\">\n                  <span>1 Ø¯Ù‚ÙŠÙ‚Ø©</span>\n                  <span>15 Ø¯Ù‚ÙŠÙ‚Ø©</span>\n                </div>\n                <div className=\"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200\">\n                  <p className=\"text-sm text-gray-700\">\n                    Ø§Ù„ÙˆÙ‚Øª: <span className=\"font-semibold\">\n                      {roundDuration <= 3 ? \"Ù‚ØµÙŠØ±\" : roundDuration <= 7 ? \"Ù…ØªÙˆØ³Ø·\" : \"Ø·ÙˆÙŠÙ„\"}\n                    </span>\n                  </p>\n                </div>\n              </div>\n              \n              <div className=\"flex items-center justify-between p-4 bg-gradient-to-br from-yellow-50 to-orange-50 rounded-xl border border-yellow-200\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-10 h-10 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-xl flex items-center justify-center shadow-md\">\n                    <Sparkles className=\"w-5 h-5 text-white\" />\n                  </div>\n                  <div>\n                    <p className=\"font-semibold text-gray-800 text-sm\">ÙˆØ¶Ø¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</p>\n                    <p className=\"text-xs text-gray-600\">Ø§Ù„Ø¹Ø¨ ØªØ­Ø¯ÙŠ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø©</p>\n                  </div>\n                </div>\n                <button\n                  onClick={() => setCardsEnabled(!cardsEnabled)}\n                  className={`relative w-14 h-7 rounded-full transition-all duration-300 ${\n                    cardsEnabled \n                      ? \"bg-gradient-to-r from-green-400 to-green-500\" \n                      : \"bg-gray-300\"\n                  }`}\n                >\n                  <span className={`absolute top-0.5 w-6 h-6 bg-white rounded-full shadow-md transition-all duration-300 ${\n                    cardsEnabled ? \"right-0.5\" : \"left-0.5\"\n                  }`} />\n                </button>\n              </div>\n              \n              {cardsEnabled && (\n                <div className=\"space-y-4\">\n                  <div className=\"p-4 bg-gradient-to-br from-indigo-50 to-blue-50 rounded-xl border border-indigo-200\">\n                    <p className=\"text-sm text-gray-800 font-semibold mb-3 flex items-center gap-2\">\n                      <Gamepad2 className=\"w-4 h-4\" />\n                      Ø§Ø®ØªØ± Ø§Ù„ØªØ­Ø¯ÙŠ:\n                    </p>\n                    <p className=\"text-xs text-gray-600 mb-3\">\n                      Ø§Ù„ÙØ§Ø¦Ø² Ø¨Ø§Ù„ØªØ­Ø¯ÙŠ ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø© ÙˆØ§Ø­Ø¯Ø© ÙŠØ³ØªØ®Ø¯Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©\n                    </p>\n                    \n                    <div className=\"space-y-2\">\n                      {challenges.map((challenge) => {\n                        const colors = getChallengeColors(challenge.color, selectedChallenge === challenge.id);\n                        return (\n                          <button\n                            key={challenge.id}\n                            onClick={() => setSelectedChallenge(challenge.id)}\n                            className=\"w-full p-3 rounded-lg border-2 transition-all duration-200 flex items-center gap-3\"\n                            style={{\n                              backgroundColor: selectedChallenge === challenge.id ? colors.selectedBg : colors.bg,\n                              borderColor: selectedChallenge === challenge.id ? colors.border : `${colors.border}50`,\n                            }}\n                          >\n                            <div \n                              className=\"w-10 h-10 rounded-lg flex items-center justify-center text-white\"\n                              style={{ backgroundColor: colors.iconBg }}\n                            >\n                              {challenge.icon}\n                            </div>\n                            <div className=\"flex-1 text-right\">\n                              <p className=\"font-semibold text-sm\" style={{ color: colors.text }}>\n                                {challenge.name}\n                              </p>\n                              <p className=\"text-xs text-gray-600\">{challenge.description}</p>\n                            </div>\n                            {selectedChallenge === challenge.id && (\n                              <div \n                                className=\"w-6 h-6 rounded-full flex items-center justify-center text-white\"\n                                style={{ backgroundColor: colors.iconBg }}\n                              >\n                                <Check className=\"w-4 h-4\" />\n                              </div>\n                            )}\n                          </button>\n                        );\n                      })}\n                    </div>\n                  </div>\n\n                  <div className=\"p-3 bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg border border-purple-200\">\n                    <p className=\"text-xs text-gray-700 font-medium mb-2 flex items-center gap-1\">\n                      <Sparkles className=\"w-3 h-3\" />\n                      Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø© ({allowedCards.length} Ù…Ù† {cardTypes.length}):\n                    </p>\n                    <p className=\"text-xs text-gray-500 mb-2\">\n                      Ø§Ù„ÙØ§Ø¦Ø² ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©\n                    </p>\n                    <div className=\"grid grid-cols-2 gap-1.5 text-xs\">\n                      {cardTypes.map((card) => {\n                        const isSelected = allowedCards.includes(card.id);\n                        return (\n                          <button\n                            key={card.id}\n                            onClick={() => toggleCard(card.id)}\n                            className={`px-2 py-1.5 rounded flex items-center gap-1 transition-all duration-200 border-2 ${\n                              isSelected \n                                ? card.color === 'purple' ? 'bg-purple-100 text-purple-700 border-purple-400' :\n                                  card.color === 'red' ? 'bg-red-100 text-red-700 border-red-400' :\n                                  card.color === 'green' ? 'bg-green-100 text-green-700 border-green-400' :\n                                  card.color === 'cyan' ? 'bg-cyan-100 text-cyan-700 border-cyan-400' :\n                                  card.color === 'blue' ? 'bg-blue-100 text-blue-700 border-blue-400' :\n                                  'bg-orange-100 text-orange-700 border-orange-400'\n                                : 'bg-gray-100 text-gray-400 border-gray-200 opacity-60'\n                            }`}\n                          >\n                            {card.icon} {card.name}\n                            {isSelected && <Check className=\"w-3 h-3 mr-auto\" />}\n                          </button>\n                        );\n                      })}\n                    </div>\n                  </div>\n\n                  {/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© */}\n                  <div className=\"p-3 bg-gradient-to-br from-gray-50 to-slate-50 rounded-lg border border-gray-200\">\n                    <button\n                      onClick={() => setShowCardSettings(!showCardSettings)}\n                      className=\"w-full flex items-center justify-between text-sm text-gray-700 font-medium\"\n                    >\n                      <span className=\"flex items-center gap-2\">\n                        <Settings2 className=\"w-4 h-4\" />\n                        Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©\n                      </span>\n                      <span className={`transform transition-transform ${showCardSettings ? 'rotate-180' : ''}`}>â–¼</span>\n                    </button>\n                    \n                    {showCardSettings && (\n                      <div className=\"mt-4 space-y-4\">\n                        {/* Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø±Ù‚Ù… */}\n                        {allowedCards.includes(\"revealNumber\") && (\n                          <div className=\"p-2 bg-purple-50 rounded-lg border border-purple-200\">\n                            <p className=\"text-xs font-medium text-purple-700 mb-2 flex items-center gap-1\">\n                              <Eye className=\"w-3 h-3\" />\n                              Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø±Ù‚Ù…\n                            </p>\n                            <div className=\"flex items-center gap-2\">\n                              <button\n                                onClick={() => setRevealNumberShowPosition(true)}\n                                className={`flex-1 px-2 py-1.5 text-xs rounded border-2 transition-all ${\n                                  revealNumberShowPosition \n                                    ? 'bg-purple-100 border-purple-400 text-purple-700' \n                                    : 'bg-white border-gray-200 text-gray-500'\n                                }`}\n                              >\n                                Ø¥Ø¸Ù‡Ø§Ø± ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø©\n                              </button>\n                              <button\n                                onClick={() => setRevealNumberShowPosition(false)}\n                                className={`flex-1 px-2 py-1.5 text-xs rounded border-2 transition-all ${\n                                  !revealNumberShowPosition \n                                    ? 'bg-purple-100 border-purple-400 text-purple-700' \n                                    : 'bg-white border-gray-200 text-gray-500'\n                                }`}\n                              >\n                                Ø¥Ø´Ø¹Ø§Ø± ÙÙ‚Ø·\n                              </button>\n                            </div>\n                          </div>\n                        )}\n\n                        {/* Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨Ø·Ø§Ù‚Ø© Ø­Ø±Ù‚ Ø±Ù‚Ù… */}\n                        {allowedCards.includes(\"burnNumber\") && (\n                          <div className=\"p-2 bg-red-50 rounded-lg border border-red-200\">\n                            <p className=\"text-xs font-medium text-red-700 mb-2 flex items-center gap-1\">\n                              <XCircle className=\"w-3 h-3\" />\n                              Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…Ø­Ø±ÙˆÙ‚Ø©: <span className=\"text-red-600 font-bold\">{burnNumberCount}</span>\n                            </p>\n                            <input\n                              type=\"range\"\n                              min=\"1\"\n                              max=\"3\"\n                              value={burnNumberCount}\n                              onChange={(e) => setBurnNumberCount(Number(e.target.value))}\n                              className=\"w-full h-1.5 bg-red-200 rounded-lg appearance-none cursor-pointer accent-red-600\"\n                            />\n                          </div>\n                        )}\n\n                        {/* Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨Ø·Ø§Ù‚Ø© ÙƒØ´Ù Ø§Ù„Ø²ÙˆØ¬ÙŠ/Ø§Ù„ÙØ±Ø¯ÙŠ */}\n                        {allowedCards.includes(\"revealParity\") && (\n                          <div className=\"p-2 bg-green-50 rounded-lg border border-green-200\">\n                            <p className=\"text-xs font-medium text-green-700 mb-2 flex items-center gap-1\">\n                              <Hash className=\"w-3 h-3\" />\n                              Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØ´ÙˆÙØ©: <span className=\"text-green-600 font-bold\">{Math.min(revealParitySlots, numDigits)}</span>\n                            </p>\n                            <input\n                              type=\"range\"\n                              min=\"1\"\n                              max={numDigits}\n                              value={Math.min(revealParitySlots, numDigits)}\n                              onChange={(e) => setRevealParitySlots(Number(e.target.value))}\n                              className=\"w-full h-1.5 bg-green-200 rounded-lg appearance-none cursor-pointer accent-green-600\"\n                            />\n                          </div>\n                        )}\n\n                        {/* Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ¬Ù…ÙŠØ¯ */}\n                        {allowedCards.includes(\"freeze\") && (\n                          <div className=\"p-2 bg-cyan-50 rounded-lg border border-cyan-200\">\n                            <p className=\"text-xs font-medium text-cyan-700 mb-2 flex items-center gap-1\">\n                              <Snowflake className=\"w-3 h-3\" />\n                              Ù…Ø¯Ø© Ø§Ù„ØªØ¬Ù…ÙŠØ¯: <span className=\"text-cyan-600 font-bold\">{freezeDuration} Ø«Ø§Ù†ÙŠØ©</span>\n                            </p>\n                            <input\n                              type=\"range\"\n                              min=\"10\"\n                              max=\"120\"\n                              step=\"10\"\n                              value={freezeDuration}\n                              onChange={(e) => setFreezeDuration(Number(e.target.value))}\n                              className=\"w-full h-1.5 bg-cyan-200 rounded-lg appearance-none cursor-pointer accent-cyan-600\"\n                            />\n                          </div>\n                        )}\n\n                        {/* Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¹ */}\n                        {allowedCards.includes(\"shield\") && (\n                          <div className=\"p-2 bg-blue-50 rounded-lg border border-blue-200\">\n                            <p className=\"text-xs font-medium text-blue-700 mb-2 flex items-center gap-1\">\n                              <Shield className=\"w-3 h-3\" />\n                              Ù…Ø¯Ø© Ø§Ù„Ø¯Ø±Ø¹: <span className=\"text-blue-600 font-bold\">{shieldDuration} Ø«Ø§Ù†ÙŠØ©</span>\n                            </p>\n                            <input\n                              type=\"range\"\n                              min=\"30\"\n                              max=\"300\"\n                              step=\"30\"\n                              value={shieldDuration}\n                              onChange={(e) => setShieldDuration(Number(e.target.value))}\n                              className=\"w-full h-1.5 bg-blue-200 rounded-lg appearance-none cursor-pointer accent-blue-600\"\n                            />\n                            <p className=\"text-xs text-gray-500 mt-1\">\n                              Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø¯Ø±Ø¹ Ù„Ø§ ÙŠÙ„ØºÙŠ Ø§Ù„ØªØ¬Ù…ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØ¹Ù‘Ù„Ø§Ù‹ Ù‚Ø¨Ù„Ù‡\n                            </p>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n\n          <div className=\"bg-gradient-to-br from-blue-50 to-purple-50 p-4 rounded-xl border border-blue-200\">\n            <p className=\"text-sm text-gray-700 font-semibold mb-2\">Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:</p>\n            <ul className=\"text-sm text-gray-600 space-y-1\">\n              <li>Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ø³Ø±ÙŠ Ù…Ù† <span className=\"font-bold\">{numDigits} Ø£Ø±Ù‚Ø§Ù…</span></li>\n              <li>Ù„Ø¯ÙŠÙƒ <span className=\"font-bold\">{maxAttempts} Ù…Ø­Ø§ÙˆÙ„Ø§Øª</span> Ù„Ù„ØªØ®Ù…ÙŠÙ†</li>\n              <li>ÙŠØ¬Ø¨ ØªØ®Ù…ÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø£Ù…Ø§ÙƒÙ†Ù‡Ø§ Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ù„ÙÙˆØ²</li>\n              {isMultiplayer && cardsEnabled && (\n                <>\n                  <li>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª: <span className=\"font-bold text-yellow-600\">Ù…ÙØ¹Ù‘Ù„Ø©</span></li>\n                  <li>Ø§Ù„ØªØ­Ø¯ÙŠ: <span className=\"font-bold text-indigo-600\">\n                    {challenges.find(c => c.id === selectedChallenge)?.name}\n                  </span></li>\n                  <li>Ù…Ø¯Ø© Ø§Ù„Ø¬ÙˆÙ„Ø©: <span className=\"font-bold text-blue-600\">{roundDuration} Ø¯Ù‚Ø§Ø¦Ù‚</span></li>\n                </>\n              )}\n            </ul>\n          </div>\n\n          <Button\n            onClick={handleConfirm}\n            disabled={!canSave}\n            className=\"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 disabled:from-gray-300 disabled:to-gray-400 disabled:opacity-50 text-white font-semibold text-base py-6 rounded-xl shadow-md hover:shadow-lg transform hover:scale-[1.02] transition-all duration-200 flex items-center justify-center gap-2\"\n          >\n            ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":28480,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/game/ChallengeRoom.tsx":{"content":"import { useEffect, useRef, useState } from \"react\";\nimport { Canvas, useFrame } from \"@react-three/fiber\";\nimport { Text, RoundedBox, KeyboardControls } from \"@react-three/drei\";\nimport { FirstPersonControls, Controls } from \"./FirstPersonControls\";\nimport { useChallenge } from \"@/lib/stores/useChallenge\";\nimport * as THREE from \"three\";\nimport { useThree } from \"@react-three/fiber\";\nimport { Crosshair } from \"../ui/Crosshair\";\n\nconst BUTTON_COLORS = [\n  { name: \"Ø£Ø­Ù…Ø±\", color: \"#ef4444\", sound: 261.63 },\n  { name: \"Ø£Ø²Ø±Ù‚\", color: \"#3b82f6\", sound: 293.66 },\n  { name: \"Ø£Ø®Ø¶Ø±\", color: \"#22c55e\", sound: 329.63 },\n  { name: \"Ø£ØµÙØ±\", color: \"#eab308\", sound: 349.23 },\n  { name: \"Ø¨Ù†ÙØ³Ø¬ÙŠ\", color: \"#a855f7\", sound: 392.00 },\n  { name: \"Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ\", color: \"#f97316\", sound: 440.00 },\n  { name: \"ÙˆØ±Ø¯ÙŠ\", color: \"#ec4899\", sound: 493.88 },\n  { name: \"Ø³Ù…Ø§ÙˆÙŠ\", color: \"#06b6d4\", sound: 523.25 },\n];\n\nfunction ColorButton({\n  index,\n  color,\n  position,\n  isActive,\n  isHovered,\n}: {\n  index: number;\n  color: string;\n  position: [number, number, number];\n  isActive: boolean;\n  isHovered: boolean;\n}) {\n  const meshRef = useRef<THREE.Mesh>(null);\n  const lightRef = useRef<THREE.PointLight>(null);\n\n  useFrame((state) => {\n    if (meshRef.current && !isActive) {\n      const time = state.clock.getElapsedTime();\n      meshRef.current.position.y = Math.sin(time * 2 + index) * 0.1;\n    }\n    \n    if (lightRef.current) {\n      lightRef.current.intensity = isActive ? 12 : isHovered ? 0.2 : 0.05;\n    }\n  });\n\n  useEffect(() => {\n    if (isActive && meshRef.current) {\n      const material = meshRef.current.material as THREE.MeshStandardMaterial;\n      material.emissiveIntensity = 8;\n      \n      const timeout = setTimeout(() => {\n        material.emissiveIntensity = isHovered ? 0.1 : 0;\n      }, 500);\n      \n      return () => clearTimeout(timeout);\n    }\n  }, [isActive, isHovered]);\n\n  return (\n    <group position={position}>\n      {/* Ø¥Ø¶Ø§Ø¡Ø© Ù†Ù‚Ø·ÙŠØ© Ù…Ù† Ø§Ù„ÙƒØ±Ø© */}\n      <pointLight\n        ref={lightRef}\n        position={[0, 0, 0]}\n        color={color}\n        intensity={isActive ? 12 : isHovered ? 0.2 : 0.05}\n        distance={8}\n        decay={2}\n      />\n      \n      <mesh\n        ref={meshRef}\n        userData={{ buttonIndex: index, isButton: true }}\n      >\n        <sphereGeometry args={[0.6, 32, 32]} />\n        <meshStandardMaterial\n          color={color}\n          emissive={color}\n          emissiveIntensity={isActive ? 8 : isHovered ? 0.1 : 0}\n          metalness={0.5}\n          roughness={0.3}\n        />\n      </mesh>\n    </group>\n  );\n}\n\nfunction RaycastInteraction({ onButtonClick, onHoverButton, onExitClick }: { \n  onButtonClick: (index: number) => void;\n  onHoverButton: (index: number | null) => void;\n  onExitClick: () => void;\n}) {\n  const { camera, scene } = useThree();\n  const raycaster = useRef(new THREE.Raycaster());\n  const lastClickTimeRef = useRef(0);\n\n  useFrame(() => {\n    raycaster.current.setFromCamera(new THREE.Vector2(0, 0), camera);\n    const intersects = raycaster.current.intersectObjects(scene.children, true);\n    \n    let foundButton = false;\n    for (const intersect of intersects) {\n      if (intersect.object.userData.isButton) {\n        onHoverButton(intersect.object.userData.buttonIndex);\n        foundButton = true;\n        break;\n      }\n      if (intersect.object.userData.isExitButton) {\n        onHoverButton(-1);\n        foundButton = true;\n        break;\n      }\n    }\n    \n    if (!foundButton) {\n      onHoverButton(null);\n    }\n  });\n\n  useEffect(() => {\n    const handlePointerDown = () => {\n      const now = Date.now();\n      if (now - lastClickTimeRef.current < 300) return;\n      lastClickTimeRef.current = now;\n      \n      raycaster.current.setFromCamera(new THREE.Vector2(0, 0), camera);\n      const intersects = raycaster.current.intersectObjects(scene.children, true);\n      \n      for (const intersect of intersects) {\n        if (intersect.object.userData.isExitButton) {\n          onExitClick();\n          break;\n        }\n        if (intersect.object.userData.isButton) {\n          const buttonIndex = intersect.object.userData.buttonIndex;\n          onButtonClick(buttonIndex);\n          break;\n        }\n      }\n    };\n\n    window.addEventListener('pointerdown', handlePointerDown);\n    return () => window.removeEventListener('pointerdown', handlePointerDown);\n  }, [camera, scene, onButtonClick, onExitClick]);\n\n  return null;\n}\n\nfunction ChallengeRoomScene({ onExit, onHoverButton }: { \n  onExit: () => void;\n  onHoverButton: (index: number | null) => void;\n}) {\n  const {\n    sequence,\n    playerSequence,\n    currentLevel,\n    phase,\n    isShowingSequence,\n    canInput,\n    startTime,\n    addToPlayerSequence,\n    checkSequence,\n    setIsShowingSequence,\n    setCanInput,\n    startChallenge,\n    resetChallenge,\n  } = useChallenge();\n\n  const [activeButton, setActiveButton] = useState<number | null>(null);\n  const [hoveredButton, setHoveredButton] = useState<number | null>(null);\n  const [isExitButtonHovered, setIsExitButtonHovered] = useState(false);\n  const [currentTime, setCurrentTime] = useState(Date.now());\n  const [showResultDialog, setShowResultDialog] = useState(false);\n  const audioContextRef = useRef<AudioContext | null>(null);\n\n  const handleHoverButton = (index: number | null) => {\n    setHoveredButton(index);\n    onHoverButton(index);\n  };\n\n  useEffect(() => {\n    audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)();\n    \n    return () => {\n      if (audioContextRef.current) {\n        audioContextRef.current.close();\n      }\n    };\n  }, []);\n\n  // Update time display\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setCurrentTime(Date.now());\n    }, 100);\n    \n    return () => clearInterval(interval);\n  }, []);\n\n  // Show result dialog when game ends\n  useEffect(() => {\n    if (phase === \"won\" || phase === \"lost\") {\n      setShowResultDialog(true);\n    }\n  }, [phase]);\n\n  const playSound = (frequency: number, duration: number = 0.3) => {\n    if (!audioContextRef.current) return;\n\n    const oscillator = audioContextRef.current.createOscillator();\n    const gainNode = audioContextRef.current.createGain();\n\n    oscillator.connect(gainNode);\n    gainNode.connect(audioContextRef.current.destination);\n\n    oscillator.frequency.value = frequency;\n    oscillator.type = 'sine';\n\n    gainNode.gain.setValueAtTime(0.3, audioContextRef.current.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(\n      0.01,\n      audioContextRef.current.currentTime + duration\n    );\n\n    oscillator.start(audioContextRef.current.currentTime);\n    oscillator.stop(audioContextRef.current.currentTime + duration);\n  };\n\n  useEffect(() => {\n    if (isShowingSequence && sequence.length > 0) {\n      let index = 0;\n      const delay = Math.max(600 - currentLevel * 50, 300);\n\n      const showNext = () => {\n        if (index < sequence.length) {\n          const buttonIndex = sequence[index];\n          if (buttonIndex !== undefined && BUTTON_COLORS[buttonIndex]) {\n            setActiveButton(buttonIndex);\n            playSound(BUTTON_COLORS[buttonIndex].sound);\n\n            setTimeout(() => {\n              setActiveButton(null);\n              index++;\n              setTimeout(showNext, delay);\n            }, 500);\n          }\n        } else {\n          setIsShowingSequence(false);\n          setCanInput(true);\n        }\n      };\n\n      setTimeout(showNext, 1000);\n    }\n  }, [isShowingSequence, sequence, currentLevel]);\n\n\n  const lastClickRef = useRef<number>(-Infinity);\n\n  const handleButtonClick = (index: number) => {\n    if (!canInput || isShowingSequence) return;\n    \n    const now = Date.now();\n    if (now - lastClickRef.current < 350) return;\n    lastClickRef.current = now;\n    \n    setActiveButton(index);\n    playSound(BUTTON_COLORS[index].sound);\n    addToPlayerSequence(index);\n\n    setTimeout(() => {\n      setActiveButton(null);\n    }, 300);\n  };\n\n  const buttonPositions: [number, number, number][] = [\n    [-4.5, 4.5, -10],\n    [-1.5, 4.5, -10],\n    [1.5, 4.5, -10],\n    [4.5, 4.5, -10],\n    [-4.5, 2, -10],\n    [-1.5, 2, -10],\n    [1.5, 2, -10],\n    [4.5, 2, -10],\n  ];\n\n  return (\n    <>\n      <color attach=\"background\" args={[\"#000000\"]} />\n      <fog attach=\"fog\" args={[\"#000000\", 15, 40]} />\n      \n      <ambientLight intensity={0.15} />\n      <hemisphereLight intensity={0.2} groundColor=\"#000000\" />\n      <pointLight position={[0, 6, 0]} intensity={0.8} color=\"#ffffff\" />\n      <pointLight position={[0, 3, -10]} intensity={0.5} color=\"#ffffff\" />\n\n      {/* Ø£Ø±Ø¶ÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ Ø¹Ø§ÙƒØ³Ø© */}\n      <mesh position={[0, 0, 0]} rotation={[-Math.PI / 2, 0, 0]} receiveShadow>\n        <planeGeometry args={[30, 30]} />\n        <meshStandardMaterial \n          color=\"#000000\" \n          metalness={1} \n          roughness={0.1}\n          envMapIntensity={0.5}\n        />\n      </mesh>\n\n      {/* Ø§Ù„Ø­Ø§Ø¦Ø· Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ */}\n      <mesh position={[0, 4, -13]} receiveShadow>\n        <boxGeometry args={[27, 8, 0.5]} />\n        <meshStandardMaterial \n          color=\"#000000\" \n          metalness={0.9} \n          roughness={0.1}\n        />\n      </mesh>\n\n      {/* Ø§Ù„Ø­Ø§Ø¦Ø· Ø§Ù„Ø®Ù„ÙÙŠ */}\n      <mesh position={[0, 4, 13]} receiveShadow>\n        <boxGeometry args={[27, 8, 0.5]} />\n        <meshStandardMaterial \n          color=\"#000000\" \n          metalness={0.9} \n          roughness={0.1}\n        />\n      </mesh>\n\n      {/* Ø§Ù„Ø­Ø§Ø¦Ø· Ø§Ù„Ø£ÙŠÙ…Ù† */}\n      <mesh position={[13, 4, 0]} rotation={[0, Math.PI / 2, 0]} receiveShadow>\n        <boxGeometry args={[27, 8, 0.5]} />\n        <meshStandardMaterial \n          color=\"#000000\" \n          metalness={0.9} \n          roughness={0.1}\n        />\n      </mesh>\n\n      {/* Ø§Ù„Ø­Ø§Ø¦Ø· Ø§Ù„Ø£ÙŠØ³Ø± */}\n      <mesh position={[-13, 4, 0]} rotation={[0, Math.PI / 2, 0]} receiveShadow>\n        <boxGeometry args={[27, 8, 0.5]} />\n        <meshStandardMaterial \n          color=\"#000000\" \n          metalness={0.9} \n          roughness={0.1}\n        />\n      </mesh>\n\n      {/* Ø§Ù„Ø³Ù‚Ù */}\n      <mesh position={[0, 8, 0]} rotation={[Math.PI / 2, 0, 0]} receiveShadow>\n        <planeGeometry args={[27, 27]} />\n        <meshStandardMaterial \n          color=\"#000000\" \n          metalness={0.9} \n          roughness={0.1}\n        />\n      </mesh>\n\n      {/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ù„ÙˆÙ†Ø© - ÙƒØ±Ø§Øª Ø·Ø§ÙÙŠØ© */}\n      {BUTTON_COLORS.map((btn, index) => (\n        <ColorButton\n          key={index}\n          index={index}\n          color={btn.color}\n          position={buttonPositions[index]}\n          isActive={activeButton === index}\n          isHovered={hoveredButton === index}\n        />\n      ))}\n\n      {/* Ù„ÙˆØ­Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ø¦Ù…Ø© */}\n      <group position={[0, 6.5, -9]}>\n        <mesh>\n          <planeGeometry args={[8, 1.5]} />\n          <meshStandardMaterial \n            color=\"#000000\" \n            transparent \n            opacity={0.7}\n            metalness={0.5}\n            roughness={0.2}\n          />\n        </mesh>\n        <Text\n          position={[0, 0.3, 0.1]}\n          fontSize={0.5}\n          color=\"#ffffff\"\n          anchorX=\"center\"\n          anchorY=\"middle\"\n          fontWeight=\"bold\"\n        >\n          Ø§Ù„Ù…Ø³ØªÙˆÙ‰: {currentLevel + 1} / 5\n        </Text>\n        \n        {startTime > 0 && (\n          <Text\n            position={[-3, -0.3, 0.1]}\n            fontSize={0.3}\n            color=\"#fbbf24\"\n            anchorX=\"center\"\n            anchorY=\"middle\"\n          >\n            â±ï¸ {Math.floor((currentTime - startTime) / 1000)}s\n          </Text>\n        )}\n\n        {isShowingSequence && (\n          <Text\n            position={[0, -0.3, 0.1]}\n            fontSize={0.35}\n            color=\"#fbbf24\"\n            anchorX=\"center\"\n            anchorY=\"middle\"\n          >\n            Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªØ³Ù„Ø³Ù„...\n          </Text>\n        )}\n\n        {canInput && (\n          <Text\n            position={[0, -0.3, 0.1]}\n            fontSize={0.35}\n            color=\"#22c55e\"\n            anchorX=\"center\"\n            anchorY=\"middle\"\n          >\n            Ø¯ÙˆØ±Ùƒ! ({playerSequence.length} / {sequence.length})\n          </Text>\n        )}\n      </group>\n\n      {/* Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ */}\n      <group position={[-11, 2, 0]} rotation={[0, Math.PI / 2, 0]}>\n        <mesh userData={{ isExitButton: true }}>\n          <boxGeometry args={[2, 3.5, 0.3]} />\n          <meshStandardMaterial\n            color={isExitButtonHovered ? \"#dc2626\" : \"#ef4444\"}\n            emissive=\"#ef4444\"\n            emissiveIntensity={isExitButtonHovered ? 1 : 0.8}\n            metalness={0.5}\n            roughness={0.3}\n          />\n        </mesh>\n        <Text\n          position={[0, 0, 0.2]}\n          fontSize={0.4}\n          color=\"#ffffff\"\n          anchorX=\"center\"\n          anchorY=\"middle\"\n        >\n          Ø®Ø±ÙˆØ¬\n        </Text>\n      </group>\n\n      <RaycastInteraction onButtonClick={handleButtonClick} onHoverButton={(index) => {\n        setIsExitButtonHovered(index === -1);\n        if (index !== -1) handleHoverButton(index);\n      }} onExitClick={onExit} />\n      \n      <FirstPersonControls />\n    </>\n  );\n}\n\nconst keyMap = [\n  { name: Controls.forward, keys: [\"ArrowUp\", \"KeyW\"] },\n  { name: Controls.back, keys: [\"ArrowDown\", \"KeyS\"] },\n  { name: Controls.left, keys: [\"ArrowLeft\", \"KeyA\"] },\n  { name: Controls.right, keys: [\"ArrowRight\", \"KeyD\"] },\n];\n\nexport function ChallengeRoom({ onExit }: { onExit: () => void }) {\n  const [hoveredButton, setHoveredButton] = useState<number | null>(null);\n  const { phase, resetChallenge, startChallenge } = useChallenge();\n  const [showDialog, setShowDialog] = useState(false);\n\n  useEffect(() => {\n    if (phase === \"won\" || phase === \"lost\") {\n      setShowDialog(true);\n    }\n  }, [phase]);\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        document.exitPointerLock?.();\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, []);\n\n  const handlePlayAgain = () => {\n    setShowDialog(false);\n    resetChallenge();\n    startChallenge();\n  };\n\n  const handleBackToMenu = () => {\n    setShowDialog(false);\n    resetChallenge();\n    onExit();\n  };\n\n  return (\n    <div style={{ width: '100vw', height: '100vh', position: 'fixed', top: 0, left: 0, zIndex: 100 }}>\n      <KeyboardControls map={keyMap}>\n        <Canvas\n          camera={{\n            position: [0, 3.5, 2],\n            fov: 60,\n            near: 0.1,\n            far: 1000,\n          }}\n          onCreated={({ gl }) => {\n            requestAnimationFrame(() => {\n              gl.domElement.requestPointerLock();\n            });\n          }}\n        >\n          <ChallengeRoomScene onExit={onExit} onHoverButton={setHoveredButton} />\n        </Canvas>\n      </KeyboardControls>\n      \n      <Crosshair isHoveringButton={hoveredButton !== null} />\n\n      {/* Result Dialog */}\n      {showDialog && (phase === \"won\" || phase === \"lost\") && (\n        <div className=\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-50\">\n          <div className=\"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4\">\n            <div className=\"text-center mb-6\">\n              {phase === \"won\" ? (\n                <>\n                  <h2 className=\"text-4xl font-bold text-green-600 mb-2\">ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ!</h2>\n                  <p className=\"text-lg text-gray-700\">Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø§Ù„ØªØ­Ø¯ÙŠ Ø¨Ù†Ø¬Ø§Ø­!</p>\n                </>\n              ) : (\n                <>\n                  <h2 className=\"text-4xl font-bold text-red-600 mb-2\">âŒ Ù„Ù„Ø£Ø³Ù</h2>\n                  <p className=\"text-lg text-gray-700\">Ù„Ù… ØªØªÙ…ÙƒÙ† Ù…Ù† Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠ</p>\n                </>\n              )}\n            </div>\n\n            <div className=\"space-y-3\">\n              <button\n                onClick={handlePlayAgain}\n                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors\"\n              >\n                ğŸ® Ù„Ø¹Ø¨ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©\n              </button>\n              <button\n                onClick={handleBackToMenu}\n                className=\"w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-lg transition-colors\"\n              >\n                ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":16569,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { WebSocketServer, WebSocket } from \"ws\";\nimport { storage } from \"./storage\";\n\ninterface Player {\n  id: string;\n  name: string;\n  ws: WebSocket;\n  roomId: string;\n  disconnectTime?: number;\n  timeoutHandle?: NodeJS.Timeout;\n}\n\ninterface PlayerAttempt {\n  guess: number[];\n  correctCount: number;\n  correctPositionCount: number;\n  timestamp: number;\n}\n\ninterface PlayerGameData {\n  playerId: string;\n  playerName: string;\n  attempts: PlayerAttempt[];\n  startTime: number;\n  endTime: number | null;\n  won: boolean;\n  finished: boolean;\n}\n\ninterface RematchVote {\n  playerId: string;\n  accepted: boolean;\n}\n\ninterface GameSession {\n  sharedSecret: number[];\n  status: \"waiting\" | \"pre_game_challenge\" | \"playing\" | \"finished\";\n  players: Map<string, PlayerGameData>;\n  startTime: number;\n  endTime: number | null;\n  gameTimerHandle?: NodeJS.Timeout; // 5-minute game timer\n  challengesCompleted: Set<string>; // Track which players completed challenges\n  lastResults?: {\n    winners: any[];\n    losers: any[];\n    stillPlaying: any[];\n    reason: string;\n  }; // Store latest results for reconnecting players\n  rematchState: {\n    requested: boolean;\n    votes: Map<string, boolean>; // playerId -> accepted\n    countdown: number | null;\n    countdownHandle?: NodeJS.Timeout;\n  };\n}\n\ninterface CardSettings {\n  roundDuration: number;\n  revealNumberShowPosition?: boolean;\n  burnNumberCount?: number;\n  revealParitySlots?: number;\n  freezeDuration?: number;\n  shieldDuration?: number;\n}\n\ninterface Room {\n  id: string;\n  hostId: string;\n  players: Player[];\n  disconnectedPlayers: Map<string, { player: Player; disconnectTime: number; timeoutHandle: NodeJS.Timeout }>;\n  game: GameSession | null;\n  settings: { numDigits: number; maxAttempts: number; cardsEnabled?: boolean; cardSettings?: CardSettings };\n  roomTimeoutHandle?: NodeJS.Timeout;\n}\n\nconst rooms = new Map<string, Room>();\nconst players = new Map<WebSocket, Player>();\n\nfunction generateRoomId(): string {\n  return Math.random().toString(36).substring(2, 8).toUpperCase();\n}\n\nfunction generatePlayerId(): string {\n  return Math.random().toString(36).substring(2, 15);\n}\n\nfunction generateSecretCode(numDigits: number): number[] {\n  return Array.from({ length: numDigits }, () => Math.floor(Math.random() * 10));\n}\n\nfunction checkGuess(secret: number[], guess: number[]): { correctCount: number; correctPositionCount: number } {\n  let correctCount = 0;\n  let correctPositionCount = 0;\n\n  const secretCopy = [...secret];\n  const guessCopy = [...guess];\n  const length = Math.min(secret.length, guess.length);\n\n  for (let i = 0; i < length; i++) {\n    if (guessCopy[i] === secretCopy[i]) {\n      correctPositionCount++;\n      secretCopy[i] = -1;\n      guessCopy[i] = -2;\n    }\n  }\n\n  for (let i = 0; i < length; i++) {\n    if (guessCopy[i] !== -2) {\n      const index = secretCopy.indexOf(guessCopy[i]);\n      if (index !== -1) {\n        correctCount++;\n        secretCopy[index] = -1;\n      }\n    }\n  }\n\n  correctCount += correctPositionCount;\n\n  return { correctCount, correctPositionCount };\n}\n\nconst onlineUsers = new Map<number, WebSocket>();\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  const httpServer = createServer(app);\n  const wss = new WebSocketServer({ noServer: true });\n\n  app.post(\"/api/accounts/create\", async (req, res) => {\n    try {\n      const { displayName, username } = req.body;\n      \n      if (!displayName || !username) {\n        return res.status(400).json({ error: \"Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø·Ù„ÙˆØ¨Ø§Ù†\" });\n      }\n      \n      if (username.length < 3 || username.length > 30) {\n        return res.status(400).json({ error: \"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 3 Ùˆ 30 Ø­Ø±Ù\" });\n      }\n      \n      if (!/^[a-zA-Z0-9_]+$/.test(username)) {\n        return res.status(400).json({ error: \"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·\" });\n      }\n      \n      const existing = await storage.getAccountByUsername(username);\n      if (existing) {\n        return res.status(409).json({ error: \"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„\" });\n      }\n      \n      const account = await storage.createAccount({ displayName, username });\n      res.json(account);\n    } catch (error) {\n      console.error(\"Error creating account:\", error);\n      res.status(500).json({ error: \"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨\" });\n    }\n  });\n\n  app.get(\"/api/accounts/check/:username\", async (req, res) => {\n    try {\n      const account = await storage.getAccountByUsername(req.params.username);\n      if (account) {\n        res.json({ exists: true, account: { id: account.id, displayName: account.displayName, username: account.username } });\n      } else {\n        res.json({ exists: false });\n      }\n    } catch (error) {\n      console.error(\"Error checking account:\", error);\n      res.status(500).json({ error: \"Ø­Ø¯Ø« Ø®Ø·Ø£\" });\n    }\n  });\n\n  app.get(\"/api/accounts/search\", async (req, res) => {\n    try {\n      const query = req.query.q as string;\n      if (!query || query.length < 2) {\n        return res.json([]);\n      }\n      const accounts = await storage.searchAccounts(query);\n      res.json(accounts.map(a => ({ id: a.id, displayName: a.displayName, username: a.username, isOnline: a.isOnline })));\n    } catch (error) {\n      console.error(\"Error searching accounts:\", error);\n      res.status(500).json({ error: \"Ø­Ø¯Ø« Ø®Ø·Ø£\" });\n    }\n  });\n\n  app.get(\"/api/friends/:userId\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const friends = await storage.getFriends(userId);\n      res.json(friends.map(f => ({ id: f.id, displayName: f.displayName, username: f.username, isOnline: f.isOnline, currentRoomId: f.currentRoomId })));\n    } catch (error) {\n      console.error(\"Error getting friends:\", error);\n      res.status(500).json({ error: \"Ø­Ø¯Ø« Ø®Ø·Ø£\" });\n    }\n  });\n\n  app.post(\"/api/friends/request\", async (req, res) => {\n    try {\n      const { fromUserId, toUserId } = req.body;\n      \n      if (fromUserId === toUserId) {\n        return res.status(400).json({ error: \"Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù†ÙØ³Ùƒ\" });\n      }\n      \n      const areFriends = await storage.areFriends(fromUserId, toUserId);\n      if (areFriends) {\n        return res.status(400).json({ error: \"Ø£Ù†ØªÙ…Ø§ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¨Ø§Ù„ÙØ¹Ù„\" });\n      }\n      \n      const pendingRequests = await storage.getSentFriendRequests(fromUserId);\n      const alreadySent = pendingRequests.some(r => r.toUserId === toUserId);\n      if (alreadySent) {\n        return res.status(400).json({ error: \"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØµØ¯Ø§Ù‚Ø© Ø¨Ø§Ù„ÙØ¹Ù„\" });\n      }\n      \n      const request = await storage.createFriendRequest({ fromUserId, toUserId });\n      \n      const fromUser = await storage.getAccount(fromUserId);\n      await storage.createNotification({\n        userId: toUserId,\n        type: \"friend_request\",\n        title: \"Ø·Ù„Ø¨ ØµØ¯Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯\",\n        message: `${fromUser?.displayName || \"Ø´Ø®Øµ Ù…Ø§\"} ÙŠØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØªÙƒ ÙƒØµØ¯ÙŠÙ‚`,\n        data: JSON.stringify({ requestId: request.id, fromUserId }),\n      });\n      \n      const targetWs = onlineUsers.get(toUserId);\n      if (targetWs && targetWs.readyState === WebSocket.OPEN) {\n        targetWs.send(JSON.stringify({\n          type: \"friend_request_received\",\n          request: { id: request.id, fromUserId, fromUser: { id: fromUser?.id, displayName: fromUser?.displayName, username: fromUser?.username } },\n        }));\n      }\n      \n      res.json(request);\n    } catch (error) {\n      console.error(\"Error creating friend request:\", error);\n      res.status(500).json({ error: \"Ø­Ø¯Ø« Ø®Ø·Ø£\" });\n    }\n  });\n\n  app.get(\"/api/friends/requests/:userId\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const requests = await storage.getPendingFriendRequests(userId);\n      res.json(requests);\n    } catch (error) {\n      console.error(\"Error getting friend requests:\", error);\n      res.status(500).json({ error: \"Ø­Ø¯Ø« Ø®Ø·Ø£\" });\n    }\n  });\n\n  app.post(\"/api/friends/accept\", async (req, res) => {\n    try {\n      const { requestId, userId } = req.body;\n      \n      const requests = await storage.getPendingFriendRequests(userId);\n      const request = requests.find(r => r.id === requestId);\n      \n      if (!request) {\n        return res.status(404).json({ error: \"Ø·Ù„Ø¨ Ø§Ù„ØµØ¯Ø§Ù‚Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯\" });\n      }\n      \n      await storage.createFriendship(request.fromUserId, request.toUserId);\n      await storage.deleteFriendRequest(requestId);\n      \n      const toUser = await storage.getAccount(userId);\n      await storage.createNotification({\n        userId: request.fromUserId,\n        type: \"friend_accepted\",\n        title: \"ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ Ø§Ù„ØµØ¯Ø§Ù‚Ø©\",\n        message: `${toUser?.displayName || \"Ø´Ø®Øµ Ù…Ø§\"} Ù‚Ø¨Ù„ Ø·Ù„Ø¨ ØµØ¯Ø§Ù‚ØªÙƒ`,\n        data: JSON.stringify({ userId }),\n      });\n      \n      const fromWs = onlineUsers.get(request.fromUserId);\n      if (fromWs && fromWs.readyState === WebSocket.OPEN) {\n        fromWs.send(JSON.stringify({\n          type: \"friend_request_accepted\",\n          friend: { id: toUser?.id, displayName: toUser?.displayName, username: toUser?.username, isOnline: toUser?.isOnline },\n        }));\n      }\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error accepting friend request:\", error);\n      res.status(500).json({ error: \"Ø­Ø¯Ø« Ø®Ø·Ø£\" });\n    }\n  });\n\n  app.post(\"/api/friends/reject\", async (req, res) => {\n    try {\n      const { requestId } = req.body;\n      await storage.deleteFriendRequest(requestId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error rejecting friend request:\", error);\n      res.status(500).json({ error: \"Ø­Ø¯Ø« Ø®Ø·Ø£\" });\n    }\n  });\n\n  app.post(\"/api/friends/remove\", async (req, res) => {\n    try {\n      const { userId1, userId2 } = req.body;\n      await storage.removeFriendship(userId1, userId2);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error removing friend:\", error);\n      res.status(500).json({ error: \"Ø­Ø¯Ø« Ø®Ø·Ø£\" });\n    }\n  });\n\n  app.get(\"/api/notifications/:userId\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const notifications = await storage.getNotifications(userId);\n      res.json(notifications);\n    } catch (error) {\n      console.error(\"Error getting notifications:\", error);\n      res.status(500).json({ error: \"Ø­Ø¯Ø« Ø®Ø·Ø£\" });\n    }\n  });\n\n  app.get(\"/api/notifications/unread/:userId\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const count = await storage.getUnreadNotificationsCount(userId);\n      res.json({ count });\n    } catch (error) {\n      console.error(\"Error getting unread count:\", error);\n      res.status(500).json({ error: \"Ø­Ø¯Ø« Ø®Ø·Ø£\" });\n    }\n  });\n\n  app.post(\"/api/notifications/markRead\", async (req, res) => {\n    try {\n      const { notificationId } = req.body;\n      await storage.markNotificationAsRead(notificationId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error marking notification as read:\", error);\n      res.status(500).json({ error: \"Ø­Ø¯Ø« Ø®Ø·Ø£\" });\n    }\n  });\n\n  app.post(\"/api/notifications/markAllRead\", async (req, res) => {\n    try {\n      const { userId } = req.body;\n      await storage.markAllNotificationsAsRead(userId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error marking all notifications as read:\", error);\n      res.status(500).json({ error: \"Ø­Ø¯Ø« Ø®Ø·Ø£\" });\n    }\n  });\n\n  app.post(\"/api/invite/send\", async (req, res) => {\n    try {\n      const { fromUserId, toUserId, roomId } = req.body;\n      \n      const fromUser = await storage.getAccount(fromUserId);\n      const toUser = await storage.getAccount(toUserId);\n      \n      if (!toUser) {\n        return res.status(404).json({ error: \"Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯\" });\n      }\n      \n      await storage.createNotification({\n        userId: toUserId,\n        type: \"room_invite\",\n        title: \"Ø¯Ø¹ÙˆØ© Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©\",\n        message: `${fromUser?.displayName || \"ØµØ¯ÙŠÙ‚Ùƒ\"} ÙŠØ¯Ø¹ÙˆÙƒ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ ØºØ±ÙØªÙ‡`,\n        data: JSON.stringify({ roomId, fromUserId, fromUserName: fromUser?.displayName }),\n      });\n      \n      const targetWs = onlineUsers.get(toUserId);\n      if (targetWs && targetWs.readyState === WebSocket.OPEN) {\n        targetWs.send(JSON.stringify({\n          type: \"room_invite\",\n          roomId,\n          fromUser: { id: fromUser?.id, displayName: fromUser?.displayName, username: fromUser?.username },\n        }));\n      }\n      \n      res.json({ success: true, isOnline: !!targetWs });\n    } catch (error) {\n      console.error(\"Error sending invite:\", error);\n      res.status(500).json({ error: \"Ø­Ø¯Ø« Ø®Ø·Ø£\" });\n    }\n  });\n\n  httpServer.on(\"upgrade\", (request, socket, head) => {\n    const pathname = new URL(request.url!, `http://${request.headers.host}`).pathname;\n    \n    if (pathname === \"/game\") {\n      wss.handleUpgrade(request, socket, head, (ws) => {\n        wss.emit(\"connection\", ws, request);\n      });\n    }\n  });\n\n  wss.on(\"connection\", (ws: WebSocket) => {\n    console.log(\"New game WebSocket connection\");\n\n    ws.on(\"message\", (data: Buffer) => {\n      try {\n        const message = JSON.parse(data.toString());\n        handleMessage(ws, message);\n      } catch (error) {\n        console.error(\"Error parsing message:\", error);\n      }\n    });\n\n    ws.on(\"close\", () => {\n      const player = players.get(ws);\n      if (player) {\n        const room = rooms.get(player.roomId);\n        if (room) {\n          // Remove from active players\n          room.players = room.players.filter((p) => p.id !== player.id);\n          \n          // Keep player in disconnectedPlayers for reconnection (both during game AND on results page)\n          const disconnectTime = Date.now();\n          player.disconnectTime = disconnectTime;\n          \n          // Timeout duration: 2 minutes for finished games, 5 minutes for active games\n          const timeoutDuration = (room.game && room.game.status === \"finished\") ? 2 * 60 * 1000 : 5 * 60 * 1000;\n          \n          const timeoutHandle = setTimeout(() => {\n            const disconnected = room.disconnectedPlayers.get(player.id);\n            if (disconnected) {\n              room.disconnectedPlayers.delete(player.id);\n              \n              // If player is in active game, mark them as quit\n              if (room.game && room.game.status === \"playing\") {\n                const playerData = room.game.players.get(player.id);\n                if (playerData && !playerData.finished) {\n                  playerData.finished = true;\n                  playerData.endTime = Date.now();\n                  \n                  // Notify others player timed out\n                  broadcastToRoom(room, {\n                    type: \"player_timeout\",\n                    playerId: player.id,\n                    playerName: player.name,\n                  });\n                  \n                  checkGameEnd(room);\n                }\n              }\n            }\n            \n            // Check if room should be deleted after timeout\n            checkAndDeleteRoomIfNeeded(room);\n          }, timeoutDuration);\n          \n          room.disconnectedPlayers.set(player.id, { player, disconnectTime, timeoutHandle });\n          console.log(`Player ${player.name} disconnected from ${room.game?.status === \"finished\" ? \"finished\" : \"active\"} game - allowing reconnection for ${timeoutDuration / 1000}s`);\n          \n          // Notify others that player disconnected (but only if game is active)\n          if (!room.game || room.game.status !== \"finished\") {\n            broadcastToRoom(room, {\n              type: \"player_disconnected\",\n              playerId: player.id,\n              playerName: player.name,\n            });\n          }\n          \n          // Check if room should be deleted (1 player left or empty)\n          if (!checkAndDeleteRoomIfNeeded(room)) {\n            // Room still has enough players\n            // If host left, assign new host\n            if (room.hostId === player.id && room.players.length > 0) {\n              room.hostId = room.players[0].id;\n              broadcastToRoom(room, {\n                type: \"host_changed\",\n                newHostId: room.hostId,\n              });\n            }\n            \n            broadcastToRoom(room, {\n              type: \"players_updated\",\n              players: room.players.map((p) => ({ id: p.id, name: p.name })),\n              hostId: room.hostId,\n            });\n          }\n        }\n        players.delete(ws);\n      }\n    });\n  });\n\n  // Check if room should be deleted (only 1 player or empty)\n  function checkAndDeleteRoomIfNeeded(room: Room): boolean {\n    const totalPlayers = room.players.length + room.disconnectedPlayers.size;\n    \n    // Delete room if only 1 player left (can't play multiplayer alone)\n    // OR if room is completely empty\n    if (totalPlayers <= 1) {\n      // Kick the last remaining player if any\n      if (room.players.length === 1) {\n        const lastPlayer = room.players[0];\n        send(lastPlayer.ws, {\n          type: \"room_deleted\",\n          message: \"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ØºØ§Ø¯Ø±ÙˆØ§ Ø§Ù„ØºØ±ÙØ©\",\n        });\n        console.log(`Kicking last player ${lastPlayer.name} from room ${room.id}`);\n      }\n      \n      // Clean up all timers\n      if (room.game?.rematchState.countdownHandle) {\n        clearInterval(room.game.rematchState.countdownHandle);\n      }\n      if (room.game?.gameTimerHandle) {\n        clearTimeout(room.game.gameTimerHandle);\n      }\n      \n      // Clear all disconnected player timeouts\n      room.disconnectedPlayers.forEach((disconnected) => {\n        clearTimeout(disconnected.timeoutHandle);\n      });\n      \n      rooms.delete(room.id);\n      console.log(`Room ${room.id} deleted (insufficient players: ${totalPlayers})`);\n      return true;\n    }\n    \n    return false;\n  }\n\n  // Send current game results to ALL finished players\n  function sendResultsToAllFinishedPlayers(room: Room, reason: string = \"player_finished\") {\n    if (!room.game) return;\n    \n    const results = calculateGameResults(room);\n    \n    // Store results for reconnecting players\n    room.game.lastResults = {\n      winners: results.winners,\n      losers: results.losers,\n      stillPlaying: results.stillPlaying,\n      reason: reason,\n    };\n    \n    // Send updated results to ALL connected players who have finished\n    room.players.forEach((player) => {\n      const playerData = room.game!.players.get(player.id);\n      if (playerData && playerData.finished) {\n        send(player.ws, {\n          type: \"game_results\",\n          winners: results.winners,\n          losers: results.losers,\n          stillPlaying: results.stillPlaying,\n          sharedSecret: room.game!.sharedSecret,\n          reason: reason,\n        });\n      }\n    });\n  }\n\n  function checkGameEnd(room: Room) {\n    if (!room.game || room.game.status !== \"playing\") return;\n    \n    const allGamePlayers = Array.from(room.game.players.values());\n    const allPlayersFinished = allGamePlayers.every(p => p.finished);\n    \n    // Only end game when ALL players have finished (won, lost, or timed out)\n    // Do NOT auto-win the last remaining player - they must play until they finish naturally\n    if (allPlayersFinished && room.game) {\n      room.game.status = \"finished\";\n      room.game.endTime = Date.now();\n      \n      // Clear the game timer since game is ending\n      if (room.game.gameTimerHandle) {\n        clearTimeout(room.game.gameTimerHandle);\n        room.game.gameTimerHandle = undefined;\n      }\n      \n      // Send final results to ALL finished players (everyone at this point)\n      sendResultsToAllFinishedPlayers(room, \"all_finished\");\n    }\n  }\n\n  function calculateGameResults(room: Room) {\n    if (!room.game) return { winners: [], losers: [], stillPlaying: [] };\n    \n    const winners: any[] = [];\n    const losers: any[] = [];\n    const stillPlaying: any[] = [];\n    \n    room.game.players.forEach((playerData) => {\n      const endTime = playerData.endTime || Date.now();\n      const playerInfo = {\n        playerId: playerData.playerId,\n        playerName: playerData.playerName,\n        attempts: playerData.attempts.length,\n        duration: endTime - playerData.startTime,\n        attemptsDetails: playerData.attempts,\n      };\n      \n      if (playerData.won) {\n        winners.push(playerInfo);\n      } else if (playerData.finished) {\n        losers.push(playerInfo);\n      } else {\n        stillPlaying.push(playerInfo);\n      }\n    });\n    \n    // Sort winners: first by attempts (ascending), then by duration (ascending)\n    winners.sort((a, b) => {\n      if (a.attempts !== b.attempts) {\n        return a.attempts - b.attempts;\n      }\n      return a.duration - b.duration;\n    });\n    \n    // Sort losers by duration (ascending) - those who lasted longer are ranked better among losers\n    losers.sort((a, b) => b.duration - a.duration);\n    \n    // Assign ranks to winners\n    winners.forEach((winner, index) => {\n      winner.rank = index + 1;\n    });\n    \n    return { winners, losers, stillPlaying };\n  }\n\n  function handleMessage(ws: WebSocket, message: any) {\n    switch (message.type) {\n      case \"create_room\": {\n        const roomId = generateRoomId();\n        const playerId = generatePlayerId();\n        const player: Player = {\n          id: playerId,\n          name: message.playerName,\n          ws,\n          roomId,\n        };\n\n        const room: Room = {\n          id: roomId,\n          hostId: playerId,\n          players: [player],\n          disconnectedPlayers: new Map(),\n          game: null,\n          settings: { \n            numDigits: 4, \n            maxAttempts: 20,\n            cardsEnabled: false,\n            selectedChallenge: \"random\",\n            allowedCards: [\"revealNumber\", \"burnNumber\", \"revealParity\", \"freeze\", \"shield\"],\n            cardSettings: {\n              roundDuration: 5,\n              maxCards: 3,\n              revealNumberShowPosition: true,\n              burnNumberCount: 1,\n              revealParitySlots: 2,\n              freezeDuration: 5000,\n              shieldDuration: 5000\n            }\n          },\n        };\n\n        rooms.set(roomId, room);\n        players.set(ws, player);\n\n        send(ws, {\n          type: \"room_created\",\n          roomId,\n          playerId,\n          hostId: playerId,\n        });\n        break;\n      }\n\n      case \"join_room\": {\n        const room = rooms.get(message.roomId);\n        \n        // Room doesn't exist\n        if (!room) {\n          send(ws, { type: \"error\", message: \"Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© - Ù„Ø±Ø¨Ù…Ø§ ØªÙ… Ø­Ø°ÙÙ‡Ø§\" });\n          return;\n        }\n        \n        // Check if room is full\n        if (room.players.length >= 10) {\n          send(ws, { type: \"error\", message: \"Ø§Ù„ØºØ±ÙØ© Ù…Ù…ØªÙ„Ø¦Ø©\" });\n          return;\n        }\n        \n        // Don't allow joining if game is in progress\n        if (room.game && room.game.status === \"playing\") {\n          send(ws, { type: \"error\", message: \"Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¢Ù† - Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…\" });\n          return;\n        }\n        \n        // Don't allow joining if game is finished (results screen)\n        if (room.game && room.game.status === \"finished\") {\n          send(ws, { type: \"error\", message: \"Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø© - ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©\" });\n          return;\n        }\n        \n        // Proceed with join only if conditions are met\n        if (room && room.players.length < 10) {\n          \n          const playerId = generatePlayerId();\n          const player: Player = {\n            id: playerId,\n            name: message.playerName,\n            ws,\n            roomId: room.id,\n          };\n\n          if (!room.disconnectedPlayers) {\n            room.disconnectedPlayers = new Map();\n          }\n\n          room.players.push(player);\n          players.set(ws, player);\n\n          send(ws, {\n            type: \"room_joined\",\n            roomId: room.id,\n            playerId,\n            hostId: room.hostId,\n            players: room.players.map((p) => ({ id: p.id, name: p.name })),\n          });\n\n          send(ws, {\n            type: \"settings_updated\",\n            settings: room.settings,\n          });\n\n          broadcastToRoom(room, {\n            type: \"players_updated\",\n            players: room.players.map((p) => ({ id: p.id, name: p.name })),\n            hostId: room.hostId,\n          });\n        } else {\n          send(ws, { type: \"error\", message: \"Room not found or full\" });\n        }\n        break;\n      }\n\n      case \"update_settings\": {\n        const player = players.get(ws);\n        if (!player) return;\n\n        const room = rooms.get(player.roomId);\n        if (!room) return;\n\n        // Only host can update settings\n        if (room.hostId !== player.id) {\n          send(ws, { type: \"error\", message: \"Only host can update settings\" });\n          return;\n        }\n\n        // Can't update during active game\n        if (room.game && room.game.status === \"playing\") {\n          send(ws, { type: \"error\", message: \"Cannot update settings during game\" });\n          return;\n        }\n\n        // Deep merge settings to properly update cardSettings and other nested properties\n        room.settings = {\n          ...room.settings,\n          ...message.settings,\n          cardSettings: message.settings.cardSettings \n            ? { ...room.settings.cardSettings, ...message.settings.cardSettings }\n            : room.settings.cardSettings,\n        };\n        \n        console.log(`[update_settings] Room ${room.id} - roundDuration: ${room.settings.cardSettings?.roundDuration}, cardsEnabled: ${room.settings.cardsEnabled}`);\n\n        broadcastToRoom(room, {\n          type: \"settings_updated\",\n          settings: room.settings,\n        });\n        break;\n      }\n\n      case \"start_game\": {\n        const player = players.get(ws);\n        if (!player) return;\n\n        const room = rooms.get(player.roomId);\n        if (!room) return;\n\n        // Only host can start game\n        if (room.hostId !== player.id) {\n          send(ws, { type: \"error\", message: \"Only host can start game\" });\n          return;\n        }\n\n        // Need at least 2 players\n        if (room.players.length < 2) {\n          send(ws, { type: \"error\", message: \"Need at least 2 players to start\" });\n          return;\n        }\n\n        // Generate shared secret\n        const sharedSecret = generateSecretCode(room.settings.numDigits);\n        \n        // Initialize game session - start in pre-game challenge mode\n        const game: GameSession = {\n          sharedSecret,\n          status: \"pre_game_challenge\",\n          players: new Map(),\n          startTime: Date.now(),\n          endTime: null,\n          challengesCompleted: new Set(),\n          rematchState: {\n            requested: false,\n            votes: new Map(),\n            countdown: null,\n          },\n        };\n\n        // Initialize player data\n        room.players.forEach((p) => {\n          game.players.set(p.id, {\n            playerId: p.id,\n            playerName: p.name,\n            attempts: [],\n            startTime: Date.now(),\n            endTime: null,\n            won: false,\n            finished: false,\n          });\n        });\n\n        room.game = game;\n\n        // Only start game timer immediately if cards are NOT enabled\n        // If cards are enabled, timer starts after all players complete challenges\n        const cardsEnabled = room.settings.cardsEnabled ?? false;\n        console.log(`[start_game] Room ${room.id} - cardsEnabled: ${cardsEnabled}, cardSettings: ${JSON.stringify(room.settings.cardSettings)}`);\n        if (!cardsEnabled) {\n          // No challenges - start playing immediately\n          const gameStartTime = Date.now();\n          game.status = \"playing\";\n          game.startTime = gameStartTime;\n          \n          // Update all player startTimes\n          game.players.forEach((playerData) => {\n            playerData.startTime = gameStartTime;\n          });\n          \n          const roundDurationMinutes = room.settings.cardSettings?.roundDuration ?? 5;\n          const timerDuration = roundDurationMinutes * 60 * 1000;\n          console.log(`Cards disabled - Starting game timer immediately: ${roundDurationMinutes} minutes (${timerDuration}ms) for room ${room.id}`);\n          const gameTimerHandle = setTimeout(() => {\n            console.log(`${roundDurationMinutes}-minute timer expired for room ${room.id}`);\n            if (room.game && room.game.status === \"playing\") {\n              room.game.players.forEach((playerData) => {\n                if (!playerData.finished) {\n                  playerData.finished = true;\n                  playerData.endTime = Date.now();\n                  playerData.won = false;\n                }\n              });\n              room.game.status = \"finished\";\n              room.game.endTime = Date.now();\n              room.game.gameTimerHandle = undefined;\n              sendResultsToAllFinishedPlayers(room, \"time_expired\");\n            }\n          }, timerDuration);\n          game.gameTimerHandle = gameTimerHandle;\n        }\n\n        // Broadcast game start to all players with server start time for sync\n        // Ensure cardSettings is always included\n        const settingsToSend = {\n          ...room.settings,\n          cardSettings: room.settings.cardSettings || {\n            roundDuration: 5,\n            maxCards: 3,\n            revealNumberShowPosition: true,\n            burnNumberCount: 1,\n            revealParitySlots: 4,\n            freezeDuration: 5000,\n            shieldDuration: 5000\n          }\n        };\n        \n        broadcastToRoom(room, {\n          type: \"game_started\",\n          sharedSecret, // All players get the same secret\n          settings: settingsToSend,\n          serverStartTime: cardsEnabled ? 0 : game.startTime, // 0 means wait for challenges to complete\n        });\n        break;\n      }\n\n      case \"challenges_completed\": {\n        const player = players.get(ws);\n        if (!player) return;\n\n        const room = rooms.get(player.roomId);\n        if (!room || !room.game) return;\n\n        // Mark this player as completed challenges\n        room.game.challengesCompleted.add(player.id);\n\n        // Check if all players completed challenges\n        if (room.game.challengesCompleted.size === room.players.length) {\n          // All players completed challenges - start the actual game\n          room.game.status = \"playing\";\n          const gameStartTime = Date.now();\n          room.game.startTime = gameStartTime;\n\n          // Update all player startTimes to match the actual game start time\n          room.game.players.forEach((playerData) => {\n            playerData.startTime = gameStartTime;\n          });\n\n          // Clear any existing timer and restart the game timer based on roundDuration\n          if (room.game.gameTimerHandle) {\n            clearTimeout(room.game.gameTimerHandle);\n          }\n\n          const roundDurationMinutes = room.settings.cardSettings?.roundDuration ?? 5;\n          const timerDuration = roundDurationMinutes * 60 * 1000;\n          console.log(`Starting game timer: ${roundDurationMinutes} minutes (${timerDuration}ms) for room ${room.id}`);\n          const gameTimerHandle = setTimeout(() => {\n            console.log(`${roundDurationMinutes}-minute timer expired for room ${room.id}`);\n            if (room.game && room.game.status === \"playing\") {\n              room.game.players.forEach((playerData) => {\n                if (!playerData.finished) {\n                  playerData.finished = true;\n                  playerData.endTime = Date.now();\n                  playerData.won = false;\n                }\n              });\n              room.game.status = \"finished\";\n              room.game.endTime = Date.now();\n              room.game.gameTimerHandle = undefined;\n              sendResultsToAllFinishedPlayers(room, \"time_expired\");\n            }\n          }, timerDuration);\n\n          room.game.gameTimerHandle = gameTimerHandle;\n\n          // Notify all players game is starting with server timestamp for sync\n          broadcastToRoom(room, {\n            type: \"game_starting\",\n            message: \"Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù†ØªÙ‡ÙˆØ§ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª - Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©!\",\n            serverStartTime: room.game.startTime,\n          });\n        }\n        break;\n      }\n\n      case \"submit_guess\": {\n        const player = players.get(ws);\n        if (!player) return;\n\n        const room = rooms.get(player.roomId);\n        if (!room || !room.game) return;\n\n        const playerData = room.game.players.get(player.id);\n        if (!playerData) return;\n\n        // Check if player already finished\n        if (playerData.finished) {\n          send(ws, { type: \"error\", message: \"You have already finished\" });\n          return;\n        }\n\n        // Check if max attempts already reached (shouldn't happen but safety check)\n        if (playerData.attempts.length >= room.settings.maxAttempts) {\n          send(ws, { type: \"error\", message: \"Ù„Ù‚Ø¯ Ø§Ø³ØªÙ†ÙØ°Øª Ø¬Ù…ÙŠØ¹ Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ Ø¨Ø§Ù„ÙØ¹Ù„\" });\n          return;\n        }\n\n        const { correctCount, correctPositionCount } = checkGuess(room.game.sharedSecret, message.guess);\n        \n        const attempt: PlayerAttempt = {\n          guess: message.guess,\n          correctCount,\n          correctPositionCount,\n          timestamp: Date.now(),\n        };\n\n        playerData.attempts.push(attempt);\n\n        const won = correctPositionCount === room.settings.numDigits;\n        const isLastAttempt = playerData.attempts.length >= room.settings.maxAttempts;\n        \n        // Mark as finished if won OR if this was the last attempt and didn't win\n        if (won) {\n          playerData.won = true;\n          playerData.finished = true;\n          playerData.endTime = Date.now();\n        } else if (isLastAttempt) {\n          // Out of attempts and didn't win - mark as loser\n          playerData.won = false;\n          playerData.finished = true;\n          playerData.endTime = Date.now();\n        }\n\n        // Send result to the player\n        send(ws, {\n          type: \"guess_result\",\n          guess: message.guess,\n          correctCount,\n          correctPositionCount,\n          won,\n          attemptNumber: playerData.attempts.length,\n          isLastAttempt,\n        });\n\n        // Broadcast to others that this player made an attempt\n        broadcastToRoom(room, {\n          type: \"player_attempt\",\n          playerId: player.id,\n          playerName: player.name,\n          attemptNumber: playerData.attempts.length,\n          guess: message.guess,\n          correctCount,\n          correctPositionCount,\n          won,\n        }, ws);\n\n        // If player just finished (won or ran out of attempts), send updated results\n        if (playerData.finished) {\n          if (isLastAttempt && !won) {\n            // Notify player they're out of attempts\n            send(ws, {\n              type: \"max_attempts_reached\",\n              message: \"Ù„Ù‚Ø¯ Ø§Ø³ØªÙ†ÙØ°Øª Ø¬Ù…ÙŠØ¹ Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ\",\n            });\n          }\n          \n          sendResultsToAllFinishedPlayers(room, \"player_finished\");\n          // Check if all players finished for final cleanup\n          checkGameEnd(room);\n        }\n        break;\n      }\n\n      case \"request_attempt_details\": {\n        const player = players.get(ws);\n        if (!player) return;\n\n        const room = rooms.get(player.roomId);\n        if (!room || !room.game) return;\n\n        const targetPlayerData = room.game.players.get(message.targetPlayerId);\n        if (!targetPlayerData) return;\n\n        send(ws, {\n          type: \"player_details\",\n          playerId: targetPlayerData.playerId,\n          playerName: targetPlayerData.playerName,\n          attempts: targetPlayerData.attempts,\n          duration: targetPlayerData.endTime ? targetPlayerData.endTime - targetPlayerData.startTime : 0,\n        });\n        break;\n      }\n\n      case \"request_rematch\": {\n        const player = players.get(ws);\n        if (!player) return;\n\n        const room = rooms.get(player.roomId);\n        if (!room || !room.game) return;\n\n        // Game must be finished\n        if (room.game.status !== \"finished\") {\n          send(ws, { type: \"error\", message: \"Game is not finished yet\" });\n          return;\n        }\n\n        // Check if rematch already requested\n        if (room.game.rematchState.requested) {\n          send(ws, { type: \"error\", message: \"Rematch already requested\" });\n          return;\n        }\n\n        // Initialize rematch state\n        room.game.rematchState.requested = true;\n        room.game.rematchState.votes.clear();\n        room.game.rematchState.countdown = 10;\n        \n        // Player who requested automatically votes yes\n        room.game.rematchState.votes.set(player.id, true);\n\n        // Broadcast rematch request with current votes\n        broadcastToRoom(room, {\n          type: \"rematch_requested\",\n          countdown: 10,\n          requestedBy: player.name,\n          votes: Array.from(room.game.rematchState.votes.entries()).map(([playerId, accepted]) => ({\n            playerId,\n            accepted,\n          })),\n        });\n\n        // Start countdown\n        const countdownHandle = setInterval(() => {\n          if (!room.game || !room.game.rematchState.countdown) {\n            clearInterval(countdownHandle);\n            return;\n          }\n\n          room.game.rematchState.countdown--;\n\n          if (room.game.rematchState.countdown <= 0) {\n            clearInterval(countdownHandle);\n            \n            // Process rematch\n            const acceptedPlayers = Array.from(room.game.rematchState.votes.entries())\n              .filter(([_, accepted]) => accepted)\n              .map(([playerId, _]) => playerId);\n            \n            // Need at least 2 players who accepted\n            if (acceptedPlayers.length >= 2) {\n              // Remove players who didn't accept\n              const rejectedPlayers = room.players.filter(\n                p => !acceptedPlayers.includes(p.id) && p.id !== room.hostId\n              );\n              \n              rejectedPlayers.forEach(p => {\n                send(p.ws, {\n                  type: \"kicked_from_room\",\n                  message: \"Ù„Ù… ØªÙ‚Ø¨Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©\",\n                });\n              });\n              \n              room.players = room.players.filter(p => \n                acceptedPlayers.includes(p.id) || p.id === room.hostId\n              );\n              \n              // Reset game\n              room.game = null;\n              \n              broadcastToRoom(room, {\n                type: \"rematch_starting\",\n                players: room.players.map((p) => ({ id: p.id, name: p.name })),\n              });\n            } else {\n              broadcastToRoom(room, {\n                type: \"rematch_cancelled\",\n                message: \"Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙƒØ§ÙÙŠÙŠÙ†\",\n              });\n              room.game.rematchState.requested = false;\n            }\n          } else {\n            broadcastToRoom(room, {\n              type: \"rematch_countdown\",\n              countdown: room.game.rematchState.countdown,\n              votes: Array.from(room.game.rematchState.votes.entries()).map(([playerId, accepted]) => ({\n                playerId,\n                accepted,\n              })),\n            });\n          }\n        }, 1000);\n\n        room.game.rematchState.countdownHandle = countdownHandle;\n        break;\n      }\n\n      case \"request_rematch_state\": {\n        const player = players.get(ws);\n        if (!player) return;\n\n        const room = rooms.get(player.roomId);\n        if (!room || !room.game) return;\n\n        // If there's an active rematch request, send it to the player\n        if (room.game.rematchState && room.game.rematchState.requested && room.game.rematchState.countdown !== null) {\n          send(ws, {\n            type: \"rematch_requested\",\n            countdown: room.game.rematchState.countdown,\n            votes: Array.from(room.game.rematchState.votes.entries()).map(([playerId, accepted]) => ({\n              playerId,\n              accepted,\n            })),\n          });\n        }\n        break;\n      }\n\n      case \"rematch_vote\": {\n        const player = players.get(ws);\n        if (!player) return;\n\n        const room = rooms.get(player.roomId);\n        if (!room || !room.game) return;\n\n        if (!room.game.rematchState.requested) {\n          send(ws, { type: \"error\", message: \"No rematch requested\" });\n          return;\n        }\n\n        room.game.rematchState.votes.set(player.id, message.accepted);\n\n        // Broadcast updated votes\n        broadcastToRoom(room, {\n          type: \"rematch_vote_update\",\n          playerId: player.id,\n          accepted: message.accepted,\n          votes: Array.from(room.game.rematchState.votes.entries()).map(([playerId, accepted]) => ({\n            playerId,\n            accepted,\n          })),\n        });\n\n        // Check if we have at least 2 acceptances - if so, start immediately\n        const acceptedPlayers = Array.from(room.game.rematchState.votes.entries())\n          .filter(([_, accepted]) => accepted)\n          .map(([playerId, _]) => playerId);\n\n        if (acceptedPlayers.length >= 2) {\n          // Clear the countdown timer\n          if (room.game.rematchState.countdownHandle) {\n            clearInterval(room.game.rematchState.countdownHandle);\n          }\n\n          // Remove players who didn't accept\n          const rejectedPlayers = room.players.filter(\n            p => !acceptedPlayers.includes(p.id) && p.id !== room.hostId\n          );\n          \n          rejectedPlayers.forEach(p => {\n            send(p.ws, {\n              type: \"kicked_from_room\",\n              message: \"Ù„Ù… ØªÙ‚Ø¨Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©\",\n            });\n          });\n          \n          room.players = room.players.filter(p => \n            acceptedPlayers.includes(p.id) || p.id === room.hostId\n          );\n          \n          // Remove players from disconnected as well\n          rejectedPlayers.forEach(p => {\n            room.disconnectedPlayers?.delete(p.id);\n          });\n          \n          // Reset game\n          room.game = null;\n          \n          // Notify accepted players that rematch is starting\n          broadcastToRoom(room, {\n            type: \"rematch_starting\",\n            players: room.players.map((p) => ({ id: p.id, name: p.name })),\n          });\n          \n          // Start new game automatically\n          const sharedSecret = generateSecretCode(room.settings.numDigits);\n          const game: GameSession = {\n            sharedSecret,\n            status: \"pre_game_challenge\",\n            startTime: Date.now(),\n            endTime: null,\n            players: new Map(),\n            lastResults: undefined,\n            gameTimerHandle: undefined,\n            challengesCompleted: new Set(),\n            rematchState: {\n              requested: false,\n              votes: new Map(),\n              countdown: null,\n            },\n          };\n\n          // Initialize player data\n          room.players.forEach((p) => {\n            game.players.set(p.id, {\n              playerId: p.id,\n              playerName: p.name,\n              attempts: [],\n              startTime: Date.now(),\n              endTime: null,\n              won: false,\n              finished: false,\n            });\n          });\n\n          // Start 5-minute game timer\n          const gameTimerHandle = setTimeout(() => {\n            console.log(`5-minute timer expired for room ${room.id}`);\n            if (room.game && room.game.status === \"playing\") {\n              room.game.players.forEach((playerData) => {\n                if (!playerData.finished) {\n                  playerData.finished = true;\n                  playerData.endTime = Date.now();\n                  playerData.won = false;\n                }\n              });\n              \n              room.game.status = \"finished\";\n              room.game.endTime = Date.now();\n              room.game.gameTimerHandle = undefined;\n              \n              sendResultsToAllFinishedPlayers(room, \"time_expired\");\n            }\n          }, 5 * 60 * 1000);\n\n          game.gameTimerHandle = gameTimerHandle;\n          room.game = game;\n\n          // Broadcast game start\n          broadcastToRoom(room, {\n            type: \"game_started\",\n            sharedSecret,\n            settings: room.settings,\n          });\n        }\n        break;\n      }\n\n      case \"reconnect\": {\n        const room = rooms.get(message.roomId);\n        if (!room) {\n          send(ws, { type: \"error\", message: \"Room not found\" });\n          return;\n        }\n        \n        const disconnected = room.disconnectedPlayers?.get(message.playerId);\n        if (!disconnected) {\n          send(ws, { type: \"error\", message: \"Player session not found or expired\" });\n          return;\n        }\n        \n        // Clear the timeout since player reconnected\n        clearTimeout(disconnected.timeoutHandle);\n        room.disconnectedPlayers.delete(message.playerId);\n        \n        // Restore player to active\n        const reconnectedPlayer: Player = {\n          id: message.playerId,\n          name: message.playerName,\n          ws,\n          roomId: room.id,\n        };\n        \n        room.players.push(reconnectedPlayer);\n        players.set(ws, reconnectedPlayer);\n        \n        console.log(`Player ${message.playerName} reconnected to room ${room.id}`);\n        \n        send(ws, {\n          type: \"room_rejoined\",\n          roomId: room.id,\n          playerId: message.playerId,\n          hostId: room.hostId,\n          players: room.players.map((p) => ({ id: p.id, name: p.name })),\n        });\n        \n        if (room.game) {\n          send(ws, {\n            type: \"game_state\",\n            sharedSecret: room.game.sharedSecret,\n            status: room.game.status,\n            settings: room.settings,\n            gameStartTime: room.game.startTime,\n          });\n          \n          // Send current game data for this player\n          const playerData = room.game.players.get(message.playerId);\n          if (playerData) {\n            send(ws, {\n              type: \"player_game_state\",\n              attempts: playerData.attempts,\n              finished: playerData.finished,\n              won: playerData.won,\n            });\n            \n            // If player has finished, send them latest results with fresh stillPlaying data\n            if (playerData.finished) {\n              const freshResults = calculateGameResults(room);\n              const reason = room.game.lastResults?.reason || \"player_finished\";\n              send(ws, {\n                type: \"game_results\",\n                winners: freshResults.winners,\n                losers: freshResults.losers,\n                stillPlaying: freshResults.stillPlaying,\n                sharedSecret: room.game.sharedSecret,\n                reason: reason,\n              });\n            }\n          }\n        }\n        \n        // Notify others of reconnection\n        broadcastToRoom(room, {\n          type: \"player_reconnected\",\n          playerId: message.playerId,\n          playerName: message.playerName,\n        }, ws);\n        \n        broadcastToRoom(room, {\n          type: \"players_updated\",\n          players: room.players.map((p) => ({ id: p.id, name: p.name })),\n          hostId: room.hostId,\n        });\n        break;\n      }\n\n      case \"leave_room\": {\n        const player = players.get(ws);\n        if (!player) return;\n\n        const room = rooms.get(player.roomId);\n        if (!room) return;\n\n        // Handle cleanup (same as disconnect)\n        if (room.game && room.game.status === \"playing\") {\n          const playerData = room.game.players.get(player.id);\n          if (playerData && !playerData.finished) {\n            playerData.finished = true;\n            playerData.endTime = Date.now();\n            \n            broadcastToRoom(room, {\n              type: \"player_quit\",\n              playerId: player.id,\n              playerName: player.name,\n            }, ws);\n            \n            checkGameEnd(room);\n          }\n        }\n        \n        room.players = room.players.filter((p) => p.id !== player.id);\n        \n        // Check if room should be deleted\n        if (!checkAndDeleteRoomIfNeeded(room)) {\n          // Room still has enough players\n          if (room.hostId === player.id && room.players.length > 0) {\n            room.hostId = room.players[0].id;\n            broadcastToRoom(room, {\n              type: \"host_changed\",\n              newHostId: room.hostId,\n            });\n          }\n          \n          broadcastToRoom(room, {\n            type: \"players_updated\",\n            players: room.players.map((p) => ({ id: p.id, name: p.name })),\n            hostId: room.hostId,\n          });\n        }\n        \n        players.delete(ws);\n        break;\n      }\n\n      case \"use_card\": {\n        const player = players.get(ws);\n        if (!player) return;\n\n        const room = rooms.get(player.roomId);\n        if (!room || !room.game || room.game.status !== \"playing\") return;\n\n        // Get target player info\n        const targetPlayer = message.targetPlayerId \n          ? room.players.find(p => p.id === message.targetPlayerId)\n          : null;\n\n        // Broadcast card usage to ALL players in the room (including the user)\n        broadcastToRoom(room, {\n          type: \"card_used\",\n          fromPlayerId: player.id,\n          fromPlayerName: player.name,\n          targetPlayerId: message.targetPlayerId,\n          targetPlayerName: targetPlayer?.name,\n          cardType: message.cardType,\n          cardId: message.cardId,\n          effectDuration: message.effectDuration,\n          effectValue: message.effectValue,\n        });\n\n        console.log(`[Cards] ${player.name} used ${message.cardType} on ${targetPlayer?.name || \"self\"}`);\n        break;\n      }\n    }\n  }\n\n  function send(ws: WebSocket, message: any) {\n    if (ws.readyState === WebSocket.OPEN) {\n      ws.send(JSON.stringify(message));\n    }\n  }\n\n  function broadcastToRoom(room: Room, message: any, exclude?: WebSocket) {\n    room.players.forEach((player) => {\n      if (player.ws !== exclude) {\n        send(player.ws, message);\n      }\n    });\n  }\n\n  return httpServer;\n}\n","path":null,"size_bytes":50764,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverAnchor = PopoverPrimitive.Anchor\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }\n","path":null,"size_bytes":1292,"size_tokens":null},"client/src/components/ui/SecretCodeSetup.tsx":{"content":"import { useState } from \"react\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { send } from \"@/lib/websocket\";\nimport { Check, X } from \"lucide-react\";\n\nexport function SecretCodeSetup() {\n  const { multiplayer, setMySecretCode } = useNumberGame();\n  const [code, setCode] = useState<string[]>(Array(multiplayer.settings.numDigits).fill(\"\"));\n  const [focusedIndex, setFocusedIndex] = useState(0);\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const numDigits = multiplayer.settings.numDigits;\n\n  const handleSecretNumberInput = (num: string) => {\n    if (focusedIndex >= numDigits) return;\n    const newInput = [...code];\n    newInput[focusedIndex] = num;\n    setCode(newInput);\n    if (focusedIndex < numDigits - 1) {\n      setFocusedIndex(focusedIndex + 1);\n    }\n  };\n\n  const handleSecretBackspace = () => {\n    if (focusedIndex > 0) {\n      const newInput = [...code];\n      if (code[focusedIndex] === \"\") {\n        newInput[focusedIndex - 1] = \"\";\n        setFocusedIndex(focusedIndex - 1);\n      } else {\n        newInput[focusedIndex] = \"\";\n      }\n      setCode(newInput);\n    } else if (code[0] !== \"\") {\n      const newInput = [...code];\n      newInput[0] = \"\";\n      setCode(newInput);\n    }\n  };\n\n  const handleSubmitSecretCode = () => {\n    if (code.length !== numDigits || code.some(val => val === \"\")) return;\n    const numCode = code.map(Number);\n    setMySecretCode(numCode);\n    setIsSubmitted(true);\n    send({\n      type: \"set_secret_code\",\n      code: numCode,\n      opponentId: multiplayer.opponentId,\n    });\n  };\n\n  const isCodeComplete = code.length === numDigits && code.every(val => val !== \"\");\n\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50 z-50 p-4\">\n      <div className=\"w-full max-w-md bg-white rounded-2xl shadow-2xl p-8 space-y-6 border border-gray-200\">\n        <div className=\"flex justify-center mb-4\">\n          <div className=\"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-3xl flex items-center justify-center shadow-lg\">\n            <div className=\"w-12 h-12 bg-white rounded-2xl flex items-center justify-center\">\n              <span className=\"text-2xl\">ğŸ”’</span>\n            </div>\n          </div>\n        </div>\n        <div className=\"text-center\">\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Ø§Ø®ØªØ± Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø³Ø±ÙŠ</h2>\n          <p className=\"text-sm text-gray-600\">Ø§Ø®ØªØ± {numDigits} Ø£Ø±Ù‚Ø§Ù… Ù„ØªØ®Ù…ÙŠÙ†Ù‡Ø§ Ø®ØµÙ…Ùƒ</p>\n        </div>\n        \n        <div className=\"flex gap-3 justify-center mb-6\" dir=\"ltr\">\n          {Array.from({ length: numDigits }, (_, idx) => (\n            <div\n              key={idx}\n              className={`w-16 h-20 border-2 rounded-xl flex items-center justify-center text-3xl font-bold transition-all ${\n                focusedIndex === idx\n                  ? \"border-blue-500 bg-blue-50\"\n                  : \"border-gray-300 bg-white\"\n              }`}\n            >\n              {code[idx] || \"\"}\n            </div>\n          ))}\n        </div>\n\n        <div className=\"grid grid-cols-3 gap-3 mb-4\" dir=\"ltr\">\n          {[1, 2, 3].map((num) => (\n            <button\n              key={num}\n              onClick={() => handleSecretNumberInput(num.toString())}\n              className=\"h-16 bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-2xl font-bold rounded-xl shadow-md active:scale-95 transition-all\"\n            >\n              {num}\n            </button>\n          ))}\n        </div>\n\n        <div className=\"grid grid-cols-3 gap-3 mb-4\" dir=\"ltr\">\n          {[4, 5, 6].map((num) => (\n            <button\n              key={num}\n              onClick={() => handleSecretNumberInput(num.toString())}\n              className=\"h-16 bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-2xl font-bold rounded-xl shadow-md active:scale-95 transition-all\"\n            >\n              {num}\n            </button>\n          ))}\n        </div>\n\n        <div className=\"grid grid-cols-3 gap-3 mb-4\" dir=\"ltr\">\n          {[7, 8, 9].map((num) => (\n            <button\n              key={num}\n              onClick={() => handleSecretNumberInput(num.toString())}\n              className=\"h-16 bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-2xl font-bold rounded-xl shadow-md active:scale-95 transition-all\"\n            >\n              {num}\n            </button>\n          ))}\n        </div>\n\n        <div className=\"grid grid-cols-3 gap-3\" dir=\"ltr\">\n          <button\n            onClick={handleSecretBackspace}\n            className=\"h-16 bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold rounded-xl shadow-md active:scale-95 transition-all flex items-center justify-center col-span-1\"\n          >\n            <X className=\"w-6 h-6\" />\n          </button>\n          <button\n            onClick={() => handleSecretNumberInput(\"0\")}\n            className=\"h-16 bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-2xl font-bold rounded-xl shadow-md active:scale-95 transition-all col-span-1\"\n          >\n            0\n          </button>\n          <button\n            onClick={handleSubmitSecretCode}\n            disabled={!isCodeComplete}\n            className=\"h-16 bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white font-bold rounded-xl shadow-md active:scale-95 transition-all flex items-center justify-center col-span-1\"\n          >\n            <Check className=\"w-6 h-6\" />\n          </button>\n        </div>\n\n        {isSubmitted && (\n          <div className=\"bg-gradient-to-br from-blue-50 to-cyan-50 p-5 rounded-xl border-2 border-blue-200 shadow-md animate-pulse\">\n            <div className=\"flex items-center justify-center mb-2\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"></div>\n            </div>\n            <p className=\"text-blue-700 text-center font-semibold text-lg\">\n              ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø®ØµÙ…...\n            </p>\n            <p className=\"text-blue-600 text-center text-sm mt-2\">\n              ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠØ¯Ø®Ù„ Ø®ØµÙ…Ùƒ Ø±Ù‚Ù…Ù‡ Ø§Ù„Ø³Ø±ÙŠ\n            </p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6544,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1877,"size_tokens":null},"client/src/components/ui/MultiplayerLobby.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"./button\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { send, clearSession, clearPersistentRoom, disconnect } from \"@/lib/websocket\";\nimport { Users, Copy, LogOut, Settings, Crown, Play, Link, Check, UserPlus } from \"lucide-react\";\nimport { GameSettings } from \"./GameSettings\";\nimport { toast } from \"sonner\";\nimport { FriendsDialog } from \"./FriendsDialog\";\nimport { useAccount } from \"@/lib/stores/useAccount\";\n\nexport function MultiplayerLobby() {\n  const { multiplayer, setMode, resetMultiplayer } = useNumberGame();\n  const { account } = useAccount();\n  const [showSettings, setShowSettings] = useState(false);\n  const [showFriends, setShowFriends] = useState(false);\n  const [copied, setCopied] = useState(false);\n  const [linkCopied, setLinkCopied] = useState(false);\n\n  const roomLink = `${window.location.origin}/room/${multiplayer.roomId}`;\n\n  const handleLeaveRoom = () => {\n    send({ type: \"leave_room\" });\n    clearSession();\n    clearPersistentRoom();\n    disconnect();\n    resetMultiplayer();\n    setMode(\"menu\");\n    setTimeout(() => {\n      window.location.reload();\n    }, 300);\n  };\n\n  const handleStartGame = () => {\n    if (multiplayer.isHost && multiplayer.players.length >= 2) {\n      send({ type: \"start_game\" });\n    }\n  };\n\n  const handleCopyRoomId = () => {\n    navigator.clipboard.writeText(multiplayer.roomId);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  const handleCopyLink = () => {\n    navigator.clipboard.writeText(roomLink);\n    setLinkCopied(true);\n    toast.success(\"ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·! Ø´Ø§Ø±ÙƒÙ‡ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ ğŸ®\");\n    setTimeout(() => setLinkCopied(false), 2000);\n  };\n\n  // Render GameSettings if showSettings is true\n  // Note: GameSettings handles sending update_settings with full cardSettings\n  if (showSettings && multiplayer.isHost) {\n    return (\n      <GameSettings\n        onConfirm={() => {\n          setShowSettings(false);\n        }}\n        isMultiplayer={true}\n      />\n    );\n  }\n\n  // Main lobby view\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50 z-50 p-4\">\n      <div className=\"w-full max-w-4xl bg-white border-2 border-gray-200 shadow-2xl rounded-3xl max-h-[90vh] flex flex-col\">\n        {/* Compact Header */}\n        <div className=\"p-4 border-b border-gray-200 flex items-center justify-between flex-shrink-0\">\n          {/* Right side - Logo and Title */}\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-xl flex items-center justify-center shadow-md\">\n              <Users className=\"w-6 h-6 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-xl font-bold text-gray-800\">ØºØ±ÙØ© Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ</h1>\n              <p className=\"text-xs text-gray-600\">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†: {multiplayer.players.length}/10</p>\n            </div>\n          </div>\n\n          {/* Left side - Room ID and Settings */}\n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex items-center gap-2 bg-gradient-to-br from-blue-50 to-purple-50 px-3 py-2 rounded-lg border border-blue-200\">\n              <input\n                type=\"text\"\n                readOnly\n                value={multiplayer.roomId}\n                className=\"w-24 bg-transparent text-gray-800 font-mono font-bold text-sm text-center focus:outline-none\"\n              />\n              <Button\n                onClick={handleCopyRoomId}\n                size=\"sm\"\n                className=\"bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded-md flex items-center gap-1 h-7\"\n              >\n                <Copy className=\"w-3 h-3\" />\n                {copied ? 'âœ“' : 'Ù†Ø³Ø®'}\n              </Button>\n            </div>\n            {multiplayer.isHost && (\n              <button\n                onClick={() => setShowSettings(true)}\n                className=\"p-2 hover:bg-blue-100 rounded-lg transition-colors\"\n                title=\"Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª\"\n              >\n                <Settings className=\"w-5 h-5 text-blue-600\" />\n              </button>\n            )}\n          </div>\n        </div>\n\n        {/* Room Link */}\n        <div className=\"px-4 py-3 bg-gradient-to-r from-green-50 to-emerald-50 border-b border-green-200 flex-shrink-0\">\n          <div className=\"flex items-center justify-center gap-2\">\n            <Link className=\"w-4 h-4 text-green-600\" />\n            <span className=\"text-green-700 font-medium text-sm\">Ø±Ø§Ø¨Ø· Ø§Ù„ØºØ±ÙØ©:</span>\n          </div>\n          <div className=\"flex items-center justify-center gap-2 mt-2\">\n            <div className=\"flex-1 max-w-md bg-white border border-green-300 rounded-lg px-3 py-2 text-sm text-gray-600 font-mono truncate\" dir=\"ltr\">\n              {roomLink}\n            </div>\n            <Button\n              onClick={handleCopyLink}\n              size=\"sm\"\n              className={`${\n                linkCopied \n                  ? \"bg-green-600 hover:bg-green-700\" \n                  : \"bg-emerald-600 hover:bg-emerald-700\"\n              } text-white px-3 py-2 rounded-lg flex items-center gap-2 transition-all`}\n            >\n              {linkCopied ? <Check className=\"w-4 h-4\" /> : <Copy className=\"w-4 h-4\" />}\n              {linkCopied ? 'ØªÙ… Ø§Ù„Ù†Ø³Ø®!' : 'Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·'}\n            </Button>\n            {account && (\n              <Button\n                onClick={() => setShowFriends(true)}\n                size=\"sm\"\n                className=\"bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg flex items-center gap-2 transition-all\"\n              >\n                <UserPlus className=\"w-4 h-4\" />\n                Ø¯Ø¹ÙˆØ© ØµØ¯ÙŠÙ‚\n              </Button>\n            )}\n          </div>\n        </div>\n\n        {/* Settings Info */}\n        <div className=\"px-4 py-2 bg-gradient-to-r from-amber-50 to-yellow-50 border-b border-amber-200 flex items-center justify-center gap-4 flex-wrap flex-shrink-0\">\n          <div className=\"flex items-center gap-2 text-sm\">\n            <span className=\"text-gray-600\">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…:</span>\n            <span className=\"bg-white px-2 py-0.5 rounded font-bold text-blue-600 border border-blue-300\">\n              {multiplayer.settings.numDigits}\n            </span>\n          </div>\n          <div className=\"flex items-center gap-2 text-sm\">\n            <span className=\"text-gray-600\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª:</span>\n            <span className=\"bg-white px-2 py-0.5 rounded font-bold text-blue-600 border border-blue-300\">\n              {multiplayer.settings.maxAttempts}\n            </span>\n          </div>\n          <div className=\"flex items-center gap-2 text-sm\">\n            <span className=\"text-gray-600\">Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª:</span>\n            <span className={`px-2 py-0.5 rounded font-bold border ${\n              multiplayer.settings.cardsEnabled \n                ? \"bg-green-100 text-green-700 border-green-300\" \n                : \"bg-gray-100 text-gray-600 border-gray-300\"\n            }`}>\n              {multiplayer.settings.cardsEnabled ? \"Ù…ÙØ¹Ù‘Ù„Ø© âœ¨\" : \"Ù…Ø¹Ø·Ù‘Ù„Ø©\"}\n            </span>\n          </div>\n        </div>\n        \n        {/* Players List - Main content area */}\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          <div className=\"bg-gradient-to-br from-blue-50 to-purple-50 p-4 rounded-2xl border-2 border-gray-200 h-full\">\n            <h3 className=\"text-gray-800 font-bold text-base flex items-center mb-3\">\n              <Users className=\"w-4 h-4 ml-2\" />\n              Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ({multiplayer.players.length})\n            </h3>\n\n            <div className=\"space-y-2\">\n              {multiplayer.players.map((player) => {\n                const isHost = player.id === multiplayer.hostId;\n                const isYou = player.id === multiplayer.playerId;\n                \n                return (\n                  <div\n                    key={player.id}\n                    className={`p-3 rounded-xl flex items-center justify-between transition-all duration-200 ${\n                      isYou\n                        ? \"bg-gradient-to-r from-blue-100 to-purple-100 border-2 border-blue-300 shadow-md\"\n                        : \"bg-white border border-gray-300\"\n                    }`}\n                  >\n                    <span className=\"text-gray-800 font-medium flex items-center\">\n                      {isHost && (\n                        <Crown className=\"w-4 h-4 ml-2 text-yellow-500 fill-yellow-500\" />\n                      )}\n                      {!isHost && (\n                        <span className=\"w-4 h-4 ml-2 bg-purple-600 text-white rounded-full flex items-center justify-center text-xs\">\n                          ğŸ‘¤\n                        </span>\n                      )}\n                      <span className=\"font-bold text-sm\">{player.name}</span>\n                      {isYou && (\n                        <span className=\"mr-2 text-blue-700 text-xs bg-blue-200 px-2 py-0.5 rounded-lg font-semibold\">\n                          (Ø£Ù†Øª)\n                        </span>\n                      )}\n                      {isHost && (\n                        <span className=\"mr-2 text-yellow-700 text-xs bg-yellow-200 px-2 py-0.5 rounded-lg font-semibold\">\n                          (Ø§Ù„Ù…Ø¶ÙŠÙ)\n                        </span>\n                      )}\n                    </span>\n                  </div>\n                );\n              })}\n            </div>\n\n            {multiplayer.players.length < 2 && (\n              <div className=\"bg-gradient-to-br from-blue-50 to-cyan-50 p-3 rounded-xl border-2 border-blue-300 mt-3\">\n                <p className=\"text-blue-800 text-center font-medium text-sm\">\n                  ğŸ•’ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¢Ø®Ø±ÙŠÙ†... (ÙŠØªØ·Ù„Ø¨ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)\n                </p>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Action Buttons */}\n        <div className=\"p-4 border-t border-gray-200 space-y-2 flex-shrink-0\">\n          {multiplayer.isHost && (\n            <Button\n              onClick={handleStartGame}\n              disabled={multiplayer.players.length < 2}\n              className=\"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white font-bold py-3 rounded-xl shadow-lg flex items-center justify-center gap-2 transition-all\"\n            >\n              <Play className=\"w-5 h-5\" />\n              Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©\n            </Button>\n          )}\n\n          {!multiplayer.isHost && (\n            <div className=\"bg-gradient-to-br from-purple-50 to-pink-50 p-3 rounded-xl border-2 border-purple-300\">\n              <p className=\"text-purple-800 text-center font-semibold text-sm\">\n                â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¶ÙŠÙ Ù„Ù„Ø¹Ø¨Ø©...\n              </p>\n            </div>\n          )}\n\n          <Button\n            onClick={handleLeaveRoom}\n            className=\"w-full bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-semibold py-3 rounded-xl shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center justify-center gap-2\"\n          >\n            <LogOut className=\"w-4 h-4\" />\n            Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØºØ±ÙØ©\n          </Button>\n        </div>\n      </div>\n\n      <FriendsDialog\n        isOpen={showFriends}\n        onClose={() => setShowFriends(false)}\n        roomId={multiplayer.roomId}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":11737,"size_tokens":null},"client/src/components/game/GameScene.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport * as THREE from \"three\";\nimport { Canvas } from \"@react-three/fiber\";\nimport { KeyboardControls, Text, RoundedBox } from \"@react-three/drei\";\nimport { FirstPersonControls, Controls } from \"./FirstPersonControls\";\nimport { NumberPanel } from \"./NumberPanel\";\nimport { DisplayPanel } from \"./DisplayPanel\";\nimport { FeedbackPanel } from \"./FeedbackPanel\";\nimport { AttemptsHistory } from \"./AttemptsHistory\";\nimport { CurrentGuessDisplay } from \"./CurrentGuessDisplay\";\nimport { Crosshair } from \"../ui/Crosshair\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { ChallengeDoor } from \"./ChallengeDoor\";\n\nfunction BackWallStatus() {\n  return null;\n}\n\nfunction PendingWinStatus() {\n  return null;\n}\n\nfunction Scene({ onLockChange, isPointerLocked = false, onEnterChallenge }: { onLockChange?: (locked: boolean) => void; isPointerLocked?: boolean; onEnterChallenge?: () => void }) {\n  const mode = useNumberGame((state) => state.mode);\n\n  useEffect(() => {\n    const handlePointerLockChange = () => {\n      const isLocked = document.pointerLockElement !== null;\n      onLockChange?.(isLocked);\n    };\n\n    document.addEventListener(\"pointerlockchange\", handlePointerLockChange);\n    return () => {\n      document.removeEventListener(\"pointerlockchange\", handlePointerLockChange);\n    };\n  }, [onLockChange]);\n\n  return (\n    <>\n      {/* Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ ÙØ§ØªØ­Ø© */}\n      <color attach=\"background\" args={[\"#f8f9fa\"]} />\n      \n      {/* Ø¥Ø¶Ø§Ø¡Ø© Ù…Ø­ÙŠØ·Ø© Ù†Ø§Ø¹Ù…Ø© */}\n      <ambientLight intensity={2.0} />\n      \n      {/* Ø¥Ø¶Ø§Ø¡Ø© Ø±Ø¦ÙŠØ³ÙŠØ© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ */}\n      <directionalLight \n        position={[0, 10, 0]} \n        intensity={3.5} \n        color=\"#ffffff\"\n        castShadow\n      />\n      \n      {/* Ø¥Ø¶Ø§Ø¡Ø© Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ù†Ø¹ÙƒØ§Ø³Ø§Øª */}\n      <pointLight position={[8, 3, 0]} intensity={1.5} color=\"#ffedd5\" />\n      <pointLight position={[-8, 3, 0]} intensity={1.5} color=\"#dbeafe\" />\n      <pointLight position={[0, 3, 8]} intensity={1.2} color=\"#ffffff\" />\n      <pointLight position={[0, 3, -8]} intensity={1.2} color=\"#ffffff\" />\n      \n      {/* Ø£Ø±Ø¶ÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ Ù…Ø¹ Ø§Ù†Ø¹ÙƒØ§Ø³ */}\n      <mesh \n        position={[0, 0, 0]} \n        rotation={[-Math.PI / 2, 0, 0]}\n        receiveShadow\n      >\n        <planeGeometry args={[30, 30]} />\n        <meshStandardMaterial \n          color=\"#ffffff\" \n          metalness={0.2}\n          roughness={0.05}\n          envMapIntensity={1}\n        />\n      </mesh>\n\n      {/* Ø§Ù„Ø­Ø§Ø¦Ø· Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ (Ø§Ù„Ø°ÙŠ ÙŠÙˆØ§Ø¬Ù‡ Ø§Ù„Ù„Ø§Ø¹Ø¨) - Ø³ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… */}\n      <mesh position={[0, 4, -13]} receiveShadow>\n        <boxGeometry args={[27, 8, 0.5]} />\n        <meshStandardMaterial \n          color=\"#e0e7ff\" \n          metalness={0.2}\n          roughness={0.4}\n        />\n      </mesh>\n\n      {/* Ø§Ù„Ø­Ø§Ø¦Ø· Ø§Ù„Ø®Ù„ÙÙŠ */}\n      <mesh position={[0, 4, 13]} receiveShadow>\n        <boxGeometry args={[27, 8, 0.5]} />\n        <meshStandardMaterial \n          color=\"#e0e7ff\" \n          metalness={0.2}\n          roughness={0.4}\n        />\n      </mesh>\n\n      {/* Ø§Ù„Ø­Ø§Ø¦Ø· Ø§Ù„Ø£ÙŠÙ…Ù† */}\n      <mesh position={[13, 4, 0]} rotation={[0, Math.PI / 2, 0]} receiveShadow>\n        <boxGeometry args={[27, 8, 0.5]} />\n        <meshStandardMaterial \n          color=\"#e0e7ff\" \n          metalness={0.2}\n          roughness={0.4}\n        />\n      </mesh>\n\n      {/* Ø§Ù„Ø­Ø§Ø¦Ø· Ø§Ù„Ø£ÙŠØ³Ø± */}\n      <mesh position={[-13, 4, 0]} rotation={[0, Math.PI / 2, 0]} receiveShadow>\n        <boxGeometry args={[27, 8, 0.5]} />\n        <meshStandardMaterial \n          color=\"#e0e7ff\" \n          metalness={0.2}\n          roughness={0.4}\n        />\n      </mesh>\n\n      {/* Ø§Ù„Ø³Ù‚Ù */}\n      <mesh position={[0, 8, 0]} rotation={[Math.PI / 2, 0, 0]} receiveShadow>\n        <planeGeometry args={[27, 27]} />\n        <meshStandardMaterial \n          color=\"#fafafa\" \n          metalness={0.1}\n          roughness={0.4}\n        />\n      </mesh>\n\n      <NumberPanel isPointerLocked={isPointerLocked} />\n      <FeedbackPanel />\n      <AttemptsHistory />\n      <CurrentGuessDisplay />\n      <BackWallStatus />\n      \n      {mode === \"singleplayer\" && onEnterChallenge && (\n        <ChallengeDoor onEnterChallenge={onEnterChallenge} />\n      )}\n      \n      <FirstPersonControls />\n    </>\n  );\n}\n\nconst keyMap = [\n  { name: Controls.forward, keys: [\"ArrowUp\", \"KeyW\"] },\n  { name: Controls.back, keys: [\"ArrowDown\", \"KeyS\"] },\n  { name: Controls.left, keys: [\"ArrowLeft\", \"KeyA\"] },\n  { name: Controls.right, keys: [\"ArrowRight\", \"KeyD\"] },\n];\n\nexport function GameScene({ onEnterChallenge }: { onEnterChallenge?: () => void }) {\n  const [isLocked, setIsLocked] = useState(false);\n\n  return (\n    <>\n      <KeyboardControls map={keyMap}>\n        <Canvas\n          camera={{\n            position: [0, 1.6, 0],\n            fov: 60,\n            near: 0.1,\n            far: 1000,\n          }}\n          gl={{\n            antialias: true,\n          }}\n          onCreated={({ gl }) => {\n            const canvas = gl.domElement;\n            \n            const handleClick = () => {\n              if (!document.pointerLockElement) {\n                canvas.requestPointerLock();\n              }\n            };\n            \n            canvas.addEventListener('click', handleClick);\n            \n            return () => {\n              canvas.removeEventListener('click', handleClick);\n            };\n          }}\n        >\n          <Scene onLockChange={setIsLocked} isPointerLocked={isLocked} onEnterChallenge={onEnterChallenge} />\n        </Canvas>\n      </KeyboardControls>\n      {!isLocked && (\n        <div className=\"fixed inset-0 flex flex-col items-center justify-start pointer-events-none z-40 pt-8\">\n          <div className=\"text-white text-sm bg-black bg-opacity-50 p-4 rounded\">\n            <p className=\"mb-2\">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù‚ÙÙ„ Ø§Ù„Ù…Ø¤Ø´Ø±</p>\n          </div>\n        </div>\n      )}\n      \n      <Crosshair />\n    </>\n  );\n}\n","path":null,"size_bytes":6059,"size_tokens":null},"client/src/components/mobile/MobileMultiplayer.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport { MultiplayerResults } from \"../ui/MultiplayerResults\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { useAudio } from \"@/lib/stores/useAudio\";\nimport { useCards } from \"@/lib/stores/useCards\";\nimport { send, connectWebSocket, disconnect } from \"@/lib/websocket\";\nimport { Home, Check, X, Users, Copy, Crown, Play, Settings, RefreshCw, Eye, Trophy, Maximize2, Minimize2, LogOut } from \"lucide-react\";\nimport { GameSettings } from \"../ui/GameSettings\";\nimport { clearSession } from \"@/lib/websocket\";\nimport { CardHand, CardEffectDisplay } from \"../game/cards/CardSystem\";\nimport { MultiplayerChallenge } from \"../game/MultiplayerChallenge\";\n\ninterface MobileMultiplayerProps {\n  joinRoomIdFromUrl?: string;\n}\n\nexport function MobileMultiplayer({ joinRoomIdFromUrl }: MobileMultiplayerProps) {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const {\n    multiplayer,\n    setMode,\n    resetMultiplayer,\n    addMultiplayerDigit,\n    deleteMultiplayerDigit,\n    submitMultiplayerGuess,\n    setShowPreGameChallenge,\n    isConnecting,\n    setIsConnecting,\n    connectionError,\n    setConnectionError,\n  } = useNumberGame();\n\n  const { playDigit, playDelete, playConfirm, playError, successSound } = useAudio();\n  const { cardSettings, hasActiveEffect, removeExpiredEffects, revealedDigits, burnedNumbers, playerCards } = useCards();\n  const [playerName, setPlayerName] = useState(\"\");\n  const [joinRoomId, setJoinRoomId] = useState(\"\");\n  const [showJoinForm, setShowJoinForm] = useState(false);\n  const [isJoining, setIsJoining] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [selectedPlayer, setSelectedPlayer] = useState<string | null>(null);\n  const [copied, setCopied] = useState(false);\n  const [linkCopied, setLinkCopied] = useState(false);\n  const [expandedAttempts, setExpandedAttempts] = useState(false);\n  const [currentTime, setCurrentTime] = useState(Date.now());\n\n  const [input, setInput] = useState<string[]>([]);\n  const [focusedIndex, setFocusedIndex] = useState(0);\n\n  const numDigits = multiplayer.settings.numDigits;\n\n  useEffect(() => {\n    const savedName = localStorage.getItem(\"lastPlayerName\");\n    if (savedName) {\n      setPlayerName(savedName);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (playerName.trim()) {\n      localStorage.setItem(\"lastPlayerName\", playerName);\n    }\n  }, [playerName]);\n\n  useEffect(() => {\n    setInput(new Array(numDigits).fill(\"\"));\n    setFocusedIndex(0);\n  }, [numDigits]);\n\n  useEffect(() => {\n    if (multiplayer.currentGuess.length < numDigits) {\n      const newInput = [...multiplayer.currentGuess.map(String), ...new Array(numDigits - multiplayer.currentGuess.length).fill(\"\")];\n      setInput(newInput);\n      setFocusedIndex(multiplayer.currentGuess.length);\n    } else if (multiplayer.currentGuess.length === numDigits) {\n      setInput(multiplayer.currentGuess.map(String));\n      setFocusedIndex(numDigits);\n    }\n  }, [multiplayer.currentGuess, numDigits]);\n\n  // Live timer update\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setCurrentTime(Date.now());\n    }, 100);\n    return () => clearInterval(interval);\n  }, []);\n\n  const handleCreateRoom = () => {\n    if (!playerName.trim()) return;\n    connectWebSocket(playerName.trim());\n  };\n\n  const handleJoinRoom = () => {\n    if (!playerName.trim() || !joinRoomId.trim()) return;\n    connectWebSocket(playerName.trim(), joinRoomId.trim().toUpperCase());\n  };\n\n  const handleStartGame = () => {\n    if (multiplayer.isHost && multiplayer.players.length >= 2) {\n      send({ type: \"start_game\" });\n    }\n  };\n\n  const isPlayerFrozen = () => {\n    removeExpiredEffects();\n    return hasActiveEffect(multiplayer.playerId, \"freeze\");\n  };\n\n  const getRevealedDigitAtPosition = (position: number): number | null => {\n    const revealed = revealedDigits.find(r => r.position === position);\n    return revealed ? revealed.digit : null;\n  };\n\n  const isBurnedNumber = (num: number): boolean => {\n    return burnedNumbers.includes(num);\n  };\n  \n  const getParityAtPosition = (position: number): { isEven: boolean } | null => {\n    const player = playerCards.find(p => p.playerId === multiplayer.playerId);\n    if (!player) return null;\n    \n    const parityEffect = player.activeEffects.find(e => e.cardType === \"revealParity\" && e.expiresAt > Date.now());\n    if (!parityEffect || !parityEffect.value) return null;\n    \n    const parityInfos = parityEffect.value as { position: number; isEven: boolean }[];\n    const parityInfo = parityInfos.find(p => p.position === position);\n    return parityInfo ? { isEven: parityInfo.isEven } : null;\n  };\n\n  const handleNumberInput = (num: string) => {\n    if (multiplayer.gameStatus !== \"playing\" || multiplayer.phase !== \"playing\") return;\n    if (focusedIndex >= numDigits) return;\n    \n    if (isPlayerFrozen()) {\n      playError();\n      return;\n    }\n\n    // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù…Ø­Ø±ÙˆÙ‚\n    if (isBurnedNumber(parseInt(num))) {\n      playError();\n      return;\n    }\n\n    // ØªØ®Ø·ÙŠ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØ´ÙˆÙØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹\n    let targetIndex = focusedIndex;\n    while (targetIndex < numDigits && getRevealedDigitAtPosition(targetIndex) !== null) {\n      targetIndex++;\n    }\n    \n    if (targetIndex >= numDigits) {\n      playError();\n      return;\n    }\n\n    playDigit(parseInt(num));\n    addMultiplayerDigit(parseInt(num));\n    \n    // ØªØ­Ø¯ÙŠØ« focusedIndex Ù„Ù„Ø®Ø§Ù†Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©\n    let nextIndex = targetIndex + 1;\n    while (nextIndex < numDigits && getRevealedDigitAtPosition(nextIndex) !== null) {\n      nextIndex++;\n    }\n    setFocusedIndex(nextIndex);\n  };\n\n  const handleBackspace = () => {\n    if (multiplayer.gameStatus !== \"playing\" || multiplayer.phase !== \"playing\") return;\n    if (focusedIndex === 0) return;\n\n    playDelete();\n    deleteMultiplayerDigit();\n    \n    // Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØºÙŠØ± Ø§Ù„Ù…ÙƒØ´ÙˆÙØ©\n    let prevIndex = focusedIndex - 1;\n    while (prevIndex >= 0 && getRevealedDigitAtPosition(prevIndex) !== null) {\n      prevIndex--;\n    }\n    setFocusedIndex(Math.max(0, prevIndex));\n  };\n\n  const handleSubmit = () => {\n    if (multiplayer.gameStatus !== \"playing\" || multiplayer.phase !== \"playing\") return;\n    \n    if (isPlayerFrozen()) {\n      playError();\n      return;\n    }\n\n    // Check if all non-revealed positions are filled\n    let filledCount = 0;\n    for (let i = 0; i < numDigits; i++) {\n      const revealedDigit = getRevealedDigitAtPosition(i);\n      if (revealedDigit !== null) {\n        filledCount++; // Revealed digit counts as filled\n      } else if (filledCount - revealedDigits.length < multiplayer.currentGuess.length) {\n        // User entered digit\n        filledCount++;\n      }\n    }\n\n    // Verify we have all required digits\n    const totalNonRevealed = numDigits - revealedDigits.length;\n    if (multiplayer.currentGuess.length < totalNonRevealed) {\n      playError();\n      return;\n    }\n\n    playConfirm();\n    send({\n      type: \"submit_guess\",\n      guess: multiplayer.currentGuess,\n    });\n    submitMultiplayerGuess();\n  };\n\n  const handleLeaveRoom = () => {\n    send({ type: \"leave_room\" });\n    clearSession();\n    disconnect();\n    resetMultiplayer();\n  };\n\n  const handleHome = () => {\n    if (multiplayer.roomId) {\n      handleLeaveRoom();\n    }\n    navigate(\"/\");\n  };\n\n  const handleCopyRoomId = () => {\n    navigator.clipboard.writeText(multiplayer.roomId);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  const handleCopyLink = () => {\n    const roomLink = `${window.location.origin}/room/${multiplayer.roomId}`;\n    navigator.clipboard.writeText(roomLink);\n    setLinkCopied(true);\n    setTimeout(() => setLinkCopied(false), 2000);\n  };\n\n  const handleRematchVote = (accepted: boolean) => {\n    send({ type: \"rematch_vote\", accepted });\n  };\n\n  const formatDuration = (ms: number) => {\n    const seconds = Math.floor(ms / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const remainingSeconds = seconds % 60;\n    if (minutes > 0) {\n      return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;\n    }\n    return `${seconds}s`;\n  };\n\n  const getRemainingTime = () => {\n    if (multiplayer.gameStatus === \"playing\") {\n      // Get round duration from multiplayer settings (from server) or cardSettings (from store)\n      const roundDuration = multiplayer.settings?.cardSettings?.roundDuration ?? cardSettings.roundDuration ?? 5;\n      if (multiplayer.startTime > 0) {\n        // Game has started - calculate remaining time\n        const elapsed = currentTime - multiplayer.startTime;\n        const totalDuration = roundDuration * 60 * 1000;\n        const remaining = totalDuration - elapsed;\n        return Math.max(0, remaining);\n      } else {\n        // Waiting for challenges to complete (startTime is 0)\n        return roundDuration * 60 * 1000;\n      }\n    }\n    const roundDuration = multiplayer.settings?.cardSettings?.roundDuration ?? cardSettings.roundDuration ?? 5;\n    return roundDuration * 60 * 1000;\n  };\n\n  const isTimeWarning = () => {\n    const remaining = getRemainingTime();\n    return remaining <= 30000; // Last 30 seconds\n  };\n\n  const playerDetails = selectedPlayer \n    ? [...multiplayer.winners, ...multiplayer.losers].find(p => p.playerId === selectedPlayer)\n    : null;\n\n  // Check if current player has finished\n  const playerFinished = multiplayer.phase === \"won\" || multiplayer.phase === \"lost\";\n  \n  // Check if game is finished (all players done)\n  const gameFinished = multiplayer.gameStatus === \"finished\";\n  \n  // Show results screen if explicitly requested OR if game is finished and player has finished\n  const shouldShowResults = multiplayer.showResults || (gameFinished && playerFinished);\n\n  // Initialize spectator mode when player finishes\n  // Watching mode when player finishes\n  useEffect(() => {\n    if (playerFinished && !multiplayer.showResults) {\n      // Player finished but results not shown yet - just wait\n      console.log(\"Player finished, waiting for results...\");\n    }\n  }, [playerFinished, multiplayer.showResults]);\n\n  // Note: GameSettings handles sending update_settings with full cardSettings\n  if (showSettings && multiplayer.isHost && multiplayer.gameStatus === \"waiting\") {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4\">\n        <GameSettings\n          onConfirm={() => {\n            setShowSettings(false);\n          }}\n          isMultiplayer={true}\n        />\n      </div>\n    );\n  }\n\n  if (shouldShowResults) {\n    return <MultiplayerResults />;\n  }\n\n  if (multiplayer.gameStatus === \"playing\" && multiplayer.showPreGameChallenge) {\n    return (\n      <MultiplayerChallenge \n        onComplete={(won) => {\n          console.log(\"Challenge completed, won:\", won);\n          setShowPreGameChallenge(false);\n          send({ type: \"challenge_completed\" });\n        }}\n      />\n    );\n  }\n\n  // Waiting for other players to finish challenges\n  if (multiplayer.gameStatus === \"playing\" && multiplayer.sharedSecret.length > 0 && multiplayer.startTime === 0) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 overflow-y-auto pb-safe\">\n        <div className=\"max-w-lg mx-auto w-full p-4 flex items-center justify-center min-h-screen\">\n          <div className=\"text-center space-y-6\">\n            <div className=\"flex justify-center\">\n              <div className=\"relative w-20 h-20\">\n                <div className=\"absolute inset-0 bg-blue-500 rounded-full animate-pulse\"></div>\n                <div className=\"absolute inset-2 bg-white rounded-full flex items-center justify-center\">\n                  <span className=\"text-3xl\">â³</span>\n                </div>\n              </div>\n            </div>\n            <h2 className=\"text-2xl font-bold text-gray-800\">Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹</h2>\n            <p className=\"text-gray-600\">\n              Ø§Ù†ØªÙ‡ÙŠØª Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠ! Ø§Ù„Ù„Ø¹Ø¨Ø© Ø³ØªØ¨Ø¯Ø£ Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ†ØªÙ‡ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ§ØªÙ‡Ù….\n            </p>\n            <div className=\"space-y-2 mt-6\">\n              <p className=\"text-sm text-gray-500\">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†: {multiplayer.players.length}</p>\n              <div className=\"flex flex-wrap gap-2 justify-center\">\n                {multiplayer.players.map((player) => (\n                  <div\n                    key={player.id}\n                    className=\"px-3 py-1 bg-blue-100 text-blue-800 rounded-lg text-sm font-semibold\"\n                  >\n                    {player.name === multiplayer.playerName ? `${player.name} âœ“` : player.name}\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (selectedPlayer && playerDetails) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4\">\n        <div className=\"max-w-2xl mx-auto space-y-4\">\n          <div className=\"flex items-center justify-between bg-white rounded-xl p-4 shadow-md\">\n            <button\n              onClick={() => setSelectedPlayer(null)}\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n            >\n              <X className=\"w-6 h-6 text-gray-700\" />\n            </button>\n            <h2 className=\"text-xl font-bold text-gray-800\">{playerDetails.playerName}</h2>\n          </div>\n\n          <div className=\"bg-white rounded-xl p-6 shadow-md\">\n            <div className=\"space-y-4\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-gray-600\">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª:</span>\n                <span className=\"text-2xl font-bold text-blue-600\">{playerDetails.attempts}</span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-gray-600\">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚:</span>\n                <span className=\"text-xl font-bold text-green-600\">{formatDuration(playerDetails.duration)}</span>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-xl p-4 shadow-md\">\n            <h3 className=\"text-lg font-bold text-gray-800 mb-4\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</h3>\n            <div className=\"space-y-3\">\n              {playerDetails.attemptsDetails.map((attempt, idx) => (\n                <div\n                  key={idx}\n                  className=\"flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-xl border border-gray-200 flex-row-reverse\"\n                >\n                  <span className=\"font-mono text-2xl font-bold text-gray-800\">\n                    {attempt.guess.join(\"\")}\n                  </span>\n                  <div className=\"flex gap-3\">\n                    <div className=\"flex flex-col items-center\">\n                      <span className=\"text-2xl font-bold text-blue-600\">{attempt.correctCount}</span>\n                      <span className=\"text-xs text-blue-600\">ØµØ­</span>\n                    </div>\n                    <div className=\"flex flex-col items-center\">\n                      <span className=\"text-2xl font-bold text-green-600\">{attempt.correctPositionCount}</span>\n                      <span className=\"text-xs text-green-600\">Ù…ÙƒØ§Ù†Ù‡Ù…</span>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (false) { // Removed old finished game screen - use results component instead\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4\">\n        <div className=\"max-w-2xl mx-auto space-y-4\">\n          <div className=\"bg-white rounded-xl p-6 shadow-md text-center\">\n            <div className=\"text-6xl mb-4\">ğŸ†</div>\n            <h2 className=\"text-3xl font-bold text-purple-600 mb-6\">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>\n            \n            {multiplayer.winners.length > 0 && (\n              <div className=\"mb-6\">\n                <h3 className=\"text-xl font-bold text-green-600 mb-3 flex items-center justify-center gap-2\">\n                  <Trophy className=\"w-6 h-6\" />\n                  Ø§Ù„ÙØ§Ø¦Ø²ÙˆÙ†\n                </h3>\n                <div className=\"space-y-2\">\n                  {multiplayer.winners.map((winner, idx) => (\n                    <button\n                      key={winner.playerId}\n                      onClick={() => setSelectedPlayer(winner.playerId)}\n                      className=\"w-full flex items-center justify-between bg-gradient-to-r from-yellow-100 to-green-100 p-4 rounded-xl border-2 border-green-400 hover:border-green-600 transition-colors\"\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <span className=\"text-2xl font-bold text-purple-600\">#{idx + 1}</span>\n                        <Crown className=\"w-6 h-6 text-yellow-500\" />\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"font-bold text-gray-800\">{winner.playerName}</p>\n                        <p className=\"text-sm text-gray-600\">\n                          {winner.attempts} Ù…Ø­Ø§ÙˆÙ„Ø§Øª Â· {formatDuration(winner.duration)}\n                        </p>\n                      </div>\n                      <Eye className=\"w-5 h-5 text-gray-500\" />\n                    </button>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {multiplayer.losers.length > 0 && (\n              <div className=\"mb-6\">\n                <h3 className=\"text-xl font-bold text-red-600 mb-3\">Ù„Ù… ÙŠÙƒÙ…Ù„ÙˆØ§</h3>\n                <div className=\"space-y-2\">\n                  {multiplayer.losers.map((loser) => (\n                    <button\n                      key={loser.playerId}\n                      onClick={() => setSelectedPlayer(loser.playerId)}\n                      className=\"w-full flex items-center justify-between bg-gray-100 p-4 rounded-xl border-2 border-gray-300 hover:border-gray-400 transition-colors\"\n                    >\n                      <span className=\"font-bold text-gray-700\">{loser.playerName}</span>\n                      <Eye className=\"w-5 h-5 text-gray-500\" />\n                    </button>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {multiplayer.rematchState.requested && (\n              <div className=\"bg-blue-50 border-2 border-blue-300 rounded-xl p-4 mb-4\">\n                <p className=\"text-lg font-bold text-blue-800 mb-3\">Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©ØŸ</p>\n                <div className=\"flex gap-3\">\n                  <button\n                    onClick={() => handleRematchVote(true)}\n                    className=\"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl transition-colors\"\n                  >\n                    Ù†Ø¹Ù…\n                  </button>\n                  <button\n                    onClick={() => handleRematchVote(false)}\n                    className=\"flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl transition-colors\"\n                  >\n                    Ù„Ø§\n                  </button>\n                </div>\n              </div>\n            )}\n\n            <button\n              onClick={handleHome}\n              className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors\"\n            >\n              Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Show game while playing\n  if (multiplayer.gameStatus === \"playing\" && multiplayer.sharedSecret.length > 0) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 overflow-y-auto pb-safe\">\n        <div className=\"max-w-lg mx-auto w-full p-4 space-y-4\">\n          {/* Header */}\n          <div className=\"flex flex-row-reverse items-center justify-between bg-white rounded-xl p-3 shadow-md gap-3 sticky top-0 z-10\">\n            <button\n              onClick={() => {\n                handleLeaveRoom();\n                navigate(\"/\");\n              }}\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors flex-shrink-0\"\n              title=\"Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\"\n            >\n              <Home className=\"w-5 h-5 text-gray-700\" />\n            </button>\n            <div className=\"text-right flex-1\">\n              <p className=\"text-xs text-gray-600\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</p>\n              <p className=\"text-xl font-bold text-blue-600\">{multiplayer.settings.maxAttempts - multiplayer.attempts.length}/{multiplayer.settings.maxAttempts}</p>\n            </div>\n            <div className=\"text-right flex-1 border-l-2 border-gray-300 pl-3\">\n              <p className=\"text-xs text-gray-600\">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</p>\n              <p className={`text-xl font-bold ${isTimeWarning() ? 'text-red-600 animate-pulse' : 'text-green-600'}`}>{formatDuration(getRemainingTime())}</p>\n            </div>\n          </div>\n\n          {/* Number Input Section */}\n          <div className=\"bg-white rounded-xl p-4 shadow-md\">\n            <h3 className=\"text-base font-bold text-gray-800 mb-3 text-center\">Ø£Ø¯Ø®Ù„ {numDigits} Ø£Ø±Ù‚Ø§Ù…</h3>\n            \n            <div className=\"flex gap-2 justify-center mb-4\" dir=\"ltr\">\n              {input.map((digit, idx) => {\n                const revealedDigit = getRevealedDigitAtPosition(idx);\n                const isRevealed = revealedDigit !== null;\n                const parityInfo = getParityAtPosition(idx);\n                \n                return (\n                  <div\n                    key={idx}\n                    className={`relative w-12 h-14 border-2 rounded-xl flex items-center justify-center text-2xl font-bold transition-all ${\n                      isRevealed\n                        ? \"border-purple-500 bg-purple-50\"\n                        : focusedIndex === idx\n                        ? \"border-blue-500 bg-blue-50\"\n                        : \"border-gray-300 bg-white\"\n                    }`}\n                    title={isRevealed ? \"Ø±Ù‚Ù… Ù…ÙƒØ´ÙˆÙ\" : parityInfo ? (parityInfo.isEven ? \"Ø±Ù‚Ù… Ø²ÙˆØ¬ÙŠ\" : \"Ø±Ù‚Ù… ÙØ±Ø¯ÙŠ\") : undefined}\n                  >\n                    {isRevealed && digit === \"\" && (\n                      <span className=\"absolute inset-0 flex items-center justify-center text-2xl font-bold opacity-40 text-purple-600 pointer-events-none\">\n                        {revealedDigit}\n                      </span>\n                    )}\n                    {parityInfo && !isRevealed && digit === \"\" && (\n                      <span className={`absolute inset-0 flex items-center justify-center text-sm font-medium opacity-40 pointer-events-none ${\n                        parityInfo.isEven ? \"text-green-600\" : \"text-orange-600\"\n                      }`}>\n                        {parityInfo.isEven ? \"Ø²ÙˆØ¬ÙŠ\" : \"ÙØ±Ø¯ÙŠ\"}\n                      </span>\n                    )}\n                    <span className=\"relative z-10\">{digit}</span>\n                    {isRevealed && (\n                      <span className=\"absolute -top-1 -right-1 w-4 h-4 bg-purple-500 rounded-full flex items-center justify-center\">\n                        <Eye className=\"w-2.5 h-2.5 text-white\" />\n                      </span>\n                    )}\n                    {parityInfo && !isRevealed && (\n                      <span className={`absolute -bottom-1 -right-1 w-4 h-4 rounded-full flex items-center justify-center text-[8px] text-white ${\n                        parityInfo.isEven ? \"bg-green-500\" : \"bg-orange-500\"\n                      }`}>\n                        {parityInfo.isEven ? \"Ø²\" : \"Ù\"}\n                      </span>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n\n            {/* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…Ø­Ø±ÙˆÙ‚Ø© */}\n            {burnedNumbers.length > 0 && (\n              <div className=\"flex items-center justify-center gap-1 mb-3 text-xs text-red-600\">\n                <X className=\"w-3 h-3\" />\n                <span>Ø£Ø±Ù‚Ø§Ù… Ù…Ø­Ø±ÙˆÙ‚Ø©: {burnedNumbers.join(\"ØŒ \")}</span>\n              </div>\n            )}\n\n            <div className=\"grid grid-cols-3 gap-2 max-w-[280px] mx-auto\" dir=\"ltr\">\n              {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => {\n                const isBurned = isBurnedNumber(num);\n                return (\n                  <button\n                    key={num}\n                    onClick={() => handleNumberInput(num.toString())}\n                    disabled={isBurned}\n                    className={`h-14 text-xl font-bold rounded-xl shadow-md active:scale-95 transition-all ${\n                      isBurned\n                        ? \"bg-gradient-to-br from-red-300 to-red-400 text-red-100 cursor-not-allowed line-through\"\n                        : \"bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white\"\n                    }`}\n                  >\n                    {num}\n                  </button>\n                );\n              })}\n              <button\n                onClick={handleBackspace}\n                className=\"h-14 bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold rounded-xl shadow-md active:scale-95 transition-all flex items-center justify-center\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n              <button\n                onClick={() => handleNumberInput(\"0\")}\n                disabled={isBurnedNumber(0)}\n                className={`h-14 text-xl font-bold rounded-xl shadow-md active:scale-95 transition-all ${\n                  isBurnedNumber(0)\n                    ? \"bg-gradient-to-br from-red-300 to-red-400 text-red-100 cursor-not-allowed line-through\"\n                    : \"bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white\"\n                }`}\n              >\n                0\n              </button>\n              <button\n                onClick={handleSubmit}\n                disabled={input.some((val, idx) => val === \"\" && getRevealedDigitAtPosition(idx) === null)}\n                className=\"h-14 bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white font-bold rounded-xl shadow-md active:scale-95 transition-all flex items-center justify-center\"\n              >\n                <Check className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Attempts Section - Always visible, scrollable */}\n          <div className=\"bg-white rounded-xl p-4 shadow-md\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h3 className=\"text-lg font-bold text-gray-800\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ({multiplayer.attempts.length} / {multiplayer.settings.maxAttempts})</h3>\n              {multiplayer.attempts.length > 3 && (\n                <button\n                  onClick={() => setExpandedAttempts(true)}\n                  className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                >\n                  <Maximize2 className=\"w-5 h-5 text-gray-600\" />\n                </button>\n              )}\n            </div>\n            <div className=\"space-y-2 max-h-[200px] overflow-y-auto\">\n              {multiplayer.attempts.length === 0 ? (\n                <p className=\"text-gray-500 text-center py-4\">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¨Ø¹Ø¯</p>\n              ) : (\n                [...multiplayer.attempts].reverse().map((attempt, idx) => (\n                  <div\n                    key={idx}\n                    className=\"flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-green-50 rounded-xl border border-gray-200 flex-row-reverse\"\n                  >\n                    <span className=\"font-mono text-lg font-bold text-gray-800\">\n                      {attempt.guess.join(\"\")}\n                    </span>\n                    <div className=\"flex gap-2 text-xs\">\n                      <span className=\"bg-blue-100 text-blue-800 px-2 py-1 rounded-lg font-semibold\">\n                        {attempt.correctCount} ØµØ­\n                      </span>\n                      <span className=\"bg-green-100 text-green-800 px-2 py-1 rounded-lg font-semibold\">\n                        {attempt.correctPositionCount} Ù…ÙƒØ§Ù†\n                      </span>\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n          </div>\n\n          {/* Expanded Attempts Modal */}\n          {expandedAttempts && (\n            <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n              <div className=\"w-full max-w-md bg-white rounded-2xl shadow-2xl flex flex-col max-h-[85vh]\">\n                <div className=\"flex items-center justify-between p-4 border-b flex-shrink-0\">\n                  <h3 className=\"text-xl font-bold text-gray-800\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ({multiplayer.attempts.length} / {multiplayer.settings.maxAttempts})</h3>\n                  <button\n                    onClick={() => setExpandedAttempts(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                  >\n                    <Minimize2 className=\"w-6 h-6 text-gray-600\" />\n                  </button>\n                </div>\n                <div className=\"overflow-y-auto flex-1 p-4\">\n                  <div className=\"space-y-3\">\n                    {[...multiplayer.attempts].reverse().map((attempt, idx) => (\n                      <div\n                        key={idx}\n                        className=\"flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-xl border border-gray-200 flex-row-reverse\"\n                      >\n                        <span className=\"font-mono text-2xl font-bold text-gray-800\">\n                          {attempt.guess.join(\"\")}\n                        </span>\n                        <div className=\"flex gap-3\">\n                          <div className=\"flex flex-col items-center\">\n                            <span className=\"text-xl font-bold text-blue-600\">{attempt.correctCount}</span>\n                            <span className=\"text-xs text-blue-600\">ØµØ­</span>\n                          </div>\n                          <div className=\"flex flex-col items-center\">\n                            <span className=\"text-xl font-bold text-green-600\">{attempt.correctPositionCount}</span>\n                            <span className=\"text-xs text-green-600\">Ù…ÙƒØ§Ù†</span>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n                <button\n                  onClick={() => setExpandedAttempts(false)}\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 m-4 rounded-xl transition-colors flex-shrink-0\"\n                >\n                  Ø¥ØºÙ„Ø§Ù‚\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Cards System UI */}\n        {multiplayer.settings.cardsEnabled && (\n          <>\n            <CardEffectDisplay playerId={multiplayer.playerId} revealNumberShowPosition={cardSettings.revealNumberShowPosition} currentPlayerName={multiplayer.playerName} />\n            <CardHand\n              playerId={multiplayer.playerId}\n              onUseCard={(cardId, targetPlayerId) => {\n                const cardsState = useCards.getState();\n                const playerCardsData = cardsState.playerCards.find(p => p.playerId === multiplayer.playerId);\n                const card = playerCardsData?.cards.find(c => c.id === cardId);\n                \n                if (!card) return;\n                \n                // Ø­ÙØ¸ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ÙƒØ´ÙˆÙØ© Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…\n                const prevRevealedCount = cardsState.revealedDigits.length;\n                \n                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¹Ø¨Ø± Ø§Ù„Ù…ØªØ¬Ø± - ÙŠØªÙ… Ø­Ø³Ø§Ø¨ ÙƒÙ„ Ø´ÙŠØ¡ Ù‡Ù†Ø§Ùƒ\n                const success = cardsState.useCard(\n                  multiplayer.playerId, \n                  cardId, \n                  targetPlayerId, \n                  multiplayer.sharedSecret,\n                  multiplayer.settings.numDigits\n                );\n                \n                if (success) {\n                  // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ£Ø«ÙŠØ± Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±\n                  const updatedCardsState = useCards.getState();\n                  const updatedPlayerCards = updatedCardsState.playerCards.find(p => p.playerId === multiplayer.playerId);\n                  const latestEffect = updatedPlayerCards?.activeEffects[updatedPlayerCards.activeEffects.length - 1];\n                  \n                  // Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© revealNumber Ù…Ø¹ Ø¥Ø¸Ù‡Ø§Ø± ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø©ØŒ Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ù† revealedDigits\n                  let effectValue: any = latestEffect?.value;\n                  if (card.type === \"revealNumber\" && updatedCardsState.cardSettings.revealNumberShowPosition) {\n                    const newRevealed = updatedCardsState.revealedDigits[updatedCardsState.revealedDigits.length - 1];\n                    if (newRevealed && updatedCardsState.revealedDigits.length > prevRevealedCount) {\n                      effectValue = { position: newRevealed.position, digit: newRevealed.digit };\n                    }\n                  }\n                  \n                  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¹Ø¨Ø± WebSocket\n                  send({\n                    type: \"use_card\",\n                    cardId,\n                    cardType: card.type,\n                    targetPlayerId,\n                    effectDuration: latestEffect ? latestEffect.expiresAt - Date.now() : 30000,\n                    effectValue,\n                  });\n                  console.log(\"Card used successfully:\", card.type, effectValue);\n                }\n              }}\n              otherPlayers={multiplayer.players\n                .filter(p => p.id !== multiplayer.playerId)\n                .map(p => ({ id: p.id, name: p.name }))}\n            />\n          </>\n        )}\n      </div>\n    );\n  }\n\n  // Handle join from URL - show join form when accessing room link directly\n  const handleJoinFromUrl = () => {\n    if (!playerName.trim() || !joinRoomIdFromUrl) return;\n    \n    // Validate room ID format (should be 6 characters)\n    const normalizedRoomId = joinRoomIdFromUrl.toUpperCase().trim();\n    if (normalizedRoomId.length !== 6) {\n      setConnectionError(\"Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± ØµØ§Ù„Ø­\");\n      return;\n    }\n    \n    setIsJoining(true);\n    localStorage.setItem(\"lastPlayerName\", playerName.trim());\n    setIsConnecting(true);\n    connectWebSocket(playerName.trim(), normalizedRoomId);\n  };\n\n  // Show join form when accessing a room link but not in the room yet\n  if (joinRoomIdFromUrl && !multiplayer.roomId && !multiplayer.playerId) {\n    return (\n      <div className=\"min-h-screen p-6 flex items-center justify-center\">\n        {/* Connection Error */}\n        {connectionError && (\n          <div className=\"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-red-50 via-white to-red-50 z-50 p-4\">\n            <div className=\"text-center relative max-w-md mx-4\">\n              <div className=\"inline-flex items-center justify-center mb-4\">\n                <div className=\"text-6xl\">âŒ</div>\n              </div>\n              <p className=\"text-gray-800 text-xl font-semibold mb-4\">{connectionError}</p>\n              <button\n                onClick={() => {\n                  setConnectionError(null);\n                  resetMultiplayer();\n                  navigate(\"/\");\n                }}\n                className=\"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg font-semibold transition-colors\"\n              >\n                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* Connecting Spinner */}\n        {isConnecting && !connectionError && (\n          <div className=\"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50 z-50\">\n            <div className=\"text-center relative\">\n              <div className=\"inline-flex items-center justify-center mb-4\">\n                <div className=\"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-500\"></div>\n              </div>\n              <p className=\"text-gray-800 text-xl font-semibold\">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</p>\n              <p className=\"text-gray-600 text-sm mt-2\">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p>\n            </div>\n          </div>\n        )}\n\n        {/* Join Form */}\n        {!isConnecting && !connectionError && (\n          <div className=\"w-full max-w-md bg-white rounded-2xl shadow-2xl p-6 text-center space-y-6\">\n            <div className=\"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-2xl flex items-center justify-center mx-auto shadow-lg\">\n              <span className=\"text-3xl\">ğŸ®</span>\n            </div>\n            <h2 className=\"text-2xl font-bold text-gray-800\">Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ©</h2>\n            <p className=\"text-gray-600\">Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©: <span className=\"font-mono font-bold text-blue-600\">{joinRoomIdFromUrl}</span></p>\n            \n            <div className=\"space-y-4\">\n              <input\n                type=\"text\"\n                placeholder=\"Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ\"\n                value={playerName}\n                onChange={(e) => setPlayerName(e.target.value)}\n                className=\"w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-center font-semibold focus:border-blue-500 focus:outline-none transition-colors\"\n                maxLength={20}\n              />\n              <button\n                onClick={handleJoinFromUrl}\n                disabled={!playerName.trim() || isJoining}\n                className=\"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 disabled:from-gray-400 disabled:to-gray-500 text-white font-bold py-3 rounded-xl transition-all\"\n              >\n                {isJoining ? \"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…...\" : \"Ø§Ù†Ø¶Ù… Ù„Ù„ØºØ±ÙØ©\"}\n              </button>\n              <button\n                onClick={() => navigate(\"/\")}\n                className=\"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-3 rounded-xl transition-colors\"\n              >\n                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  if (!multiplayer.roomId) {\n    return (\n      <div className=\"min-h-screen p-6 flex items-center justify-center\">\n        <div className=\"w-full max-w-md space-y-4\">\n          <div className=\"bg-white rounded-2xl shadow-xl p-6 space-y-4\">\n            <button\n              onClick={handleHome}\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n            >\n              <Home className=\"w-6 h-6 text-gray-700\" />\n            </button>\n\n            <div className=\"text-center mb-6\">\n              <h2 className=\"text-2xl font-bold text-gray-800\">Ù„Ø¹Ø¨ Ø¬Ù…Ø§Ø¹ÙŠ</h2>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-bold text-gray-700 mb-2 text-right\">\n                Ø§Ø³Ù…Ùƒ\n              </label>\n              <input\n                type=\"text\"\n                value={playerName}\n                onChange={(e) => setPlayerName(e.target.value)}\n                placeholder=\"Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ\"\n                className=\"w-full px-4 py-3 border-2 border-gray-300 rounded-xl text-right focus:outline-none focus:border-blue-500\"\n                dir=\"rtl\"\n              />\n            </div>\n\n            <button\n              onClick={handleCreateRoom}\n              disabled={!playerName.trim()}\n              className=\"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-xl transition-all flex items-center justify-center gap-2\"\n            >\n              <Users className=\"w-5 h-5\" />\n              Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©\n            </button>\n\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <div className=\"w-full border-t border-gray-300\"></div>\n              </div>\n              <div className=\"relative flex justify-center text-sm\">\n                <span className=\"px-4 bg-white text-gray-500\">Ø£Ùˆ</span>\n              </div>\n            </div>\n\n            {!showJoinForm ? (\n              <button\n                onClick={() => setShowJoinForm(true)}\n                disabled={!playerName.trim()}\n                className=\"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-xl transition-colors\"\n              >\n                Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©\n              </button>\n            ) : (\n              <div className=\"space-y-3\">\n                <input\n                  type=\"text\"\n                  value={joinRoomId}\n                  onChange={(e) => setJoinRoomId(e.target.value.toUpperCase())}\n                  placeholder=\"Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©\"\n                  className=\"w-full px-4 py-3 border-2 border-gray-300 rounded-xl text-center focus:outline-none focus:border-blue-500 font-mono text-xl uppercase\"\n                  maxLength={6}\n                />\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={() => setShowJoinForm(false)}\n                    className=\"flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 rounded-xl transition-colors\"\n                  >\n                    Ø¥Ù„ØºØ§Ø¡\n                  </button>\n                  <button\n                    onClick={handleJoinRoom}\n                    disabled={!playerName.trim() || !joinRoomId.trim() || joinRoomId.length !== 6}\n                    className=\"flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold py-3 rounded-xl transition-colors\"\n                  >\n                    Ø§Ù†Ø¶Ù…Ø§Ù…\n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Mobile lobby screen (waiting for game to start)\n  if (multiplayer.gameStatus === \"waiting\") {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4\">\n        <div className=\"max-w-2xl mx-auto space-y-4\">\n          {/* Header */}\n          <div className=\"bg-white rounded-xl p-4 shadow-md\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <button\n                onClick={handleHome}\n                className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n              >\n                <Home className=\"w-6 h-6 text-gray-700\" />\n              </button>\n              {multiplayer.isHost && (\n                <button\n                  onClick={() => setShowSettings(true)}\n                  className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                >\n                  <Settings className=\"w-6 h-6 text-gray-700\" />\n                </button>\n              )}\n            </div>\n\n            {/* Room ID and Copy Link */}\n            <div className=\"space-y-3\">\n              <div className=\"text-center\">\n                <h3 className=\"text-sm text-gray-600 mb-2\">Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©</h3>\n                <div className=\"flex items-center justify-center gap-2\">\n                  <button\n                    onClick={handleCopyRoomId}\n                    className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                    title=\"Ù†Ø³Ø® Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©\"\n                  >\n                    {copied ? (\n                      <Check className=\"w-5 h-5 text-green-600\" />\n                    ) : (\n                      <Copy className=\"w-5 h-5 text-gray-600\" />\n                    )}\n                  </button>\n                  <p className=\"text-2xl font-mono font-bold text-blue-600\">{multiplayer.roomId}</p>\n                </div>\n              </div>\n\n              <button\n                onClick={handleCopyLink}\n                className=\"w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-2 px-4 rounded-lg transition-all flex items-center justify-center gap-2 text-sm\"\n                title=\"Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØºØ±ÙØ©\"\n              >\n                <Copy className=\"w-4 h-4\" />\n                {linkCopied ? \"âœ“ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·\" : \"Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØºØ±ÙØ©\"}\n              </button>\n            </div>\n\n            {/* Settings Display */}\n            <div className=\"bg-gray-100 rounded-lg p-3 text-center text-sm text-gray-600 mt-3 space-y-2\">\n              <div>\n                Ø£Ø±Ù‚Ø§Ù…: <span className=\"font-bold text-gray-800\">{multiplayer.settings.numDigits}</span> Â· Ù…Ø­Ø§ÙˆÙ„Ø§Øª: <span className=\"font-bold text-gray-800\">{multiplayer.settings.maxAttempts}</span>\n              </div>\n              <div className=\"flex items-center justify-center gap-2\">\n                <span className=\"text-gray-600\">Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª:</span>\n                <span className={`px-3 py-1 rounded-lg font-bold border ${\n                  multiplayer.settings.cardsEnabled \n                    ? \"bg-green-100 text-green-700 border-green-300\" \n                    : \"bg-gray-100 text-gray-600 border-gray-300\"\n                }`}>\n                  {multiplayer.settings.cardsEnabled ? \"Ù…ÙØ¹Ù‘Ù„Ø© âœ¨\" : \"Ù…Ø¹Ø·Ù‘Ù„Ø©\"}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          {/* Players List */}\n          <div className=\"bg-white rounded-xl p-4 shadow-md\">\n            <h3 className=\"text-lg font-bold text-gray-800 mb-4 flex items-center\">\n              <Users className=\"w-5 h-5 ml-2\" />\n              Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† ({multiplayer.players.length})\n            </h3>\n            <div className=\"space-y-2\">\n              {multiplayer.players.map((player) => {\n                const isHost = player.id === multiplayer.hostId;\n                const isYou = player.id === multiplayer.playerId;\n                \n                return (\n                  <div\n                    key={player.id}\n                    className={`p-3 rounded-xl flex items-center gap-3 ${\n                      isYou\n                        ? \"bg-gradient-to-r from-blue-100 to-purple-100 border-2 border-blue-300\"\n                        : \"bg-gray-50 border border-gray-200\"\n                    }`}\n                  >\n                    {isHost && (\n                      <Crown className=\"w-5 h-5 text-yellow-500 fill-yellow-500\" />\n                    )}\n                    {!isHost && (\n                      <span className=\"w-5 h-5 bg-purple-600 text-white rounded-full flex items-center justify-center text-xs\">\n                        ğŸ‘¤\n                      </span>\n                    )}\n                    <span className=\"font-bold text-gray-800\">{player.name}</span>\n                    {isYou && (\n                      <span className=\"text-xs bg-blue-200 text-blue-700 px-2 py-0.5 rounded-lg ml-auto\">\n                        (Ø£Ù†Øª)\n                      </span>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n            {multiplayer.players.length < 2 && (\n              <div className=\"bg-blue-50 p-3 rounded-xl border-2 border-blue-300 mt-3\">\n                <p className=\"text-blue-800 text-center font-medium text-sm\">\n                  ğŸ•’ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¢Ø®Ø±ÙŠÙ†...\n                </p>\n              </div>\n            )}\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"space-y-2\">\n            {multiplayer.isHost && multiplayer.players.length >= 2 && (\n              <button\n                onClick={handleStartGame}\n                className=\"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-3 rounded-xl shadow-lg flex items-center justify-center gap-2\"\n              >\n                <Play className=\"w-5 h-5\" />\n                Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©\n              </button>\n            )}\n\n            {!multiplayer.isHost && (\n              <div className=\"bg-purple-50 border-2 border-purple-300 rounded-xl p-3\">\n                <p className=\"text-purple-800 text-center font-semibold text-sm\">\n                  â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¶ÙŠÙ Ù„Ù„Ø¹Ø¨Ø©...\n                </p>\n              </div>\n            )}\n\n            <button\n              onClick={handleLeaveRoom}\n              className=\"w-full bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-3 rounded-xl shadow-lg flex items-center justify-center gap-2\"\n            >\n              <LogOut className=\"w-5 h-5\" />\n              Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØºØ±ÙØ©\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // If we reach here, something is wrong - return empty or fallback\n  return null;\n}\n","path":null,"size_bytes":49949,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":792,"size_tokens":null},"client/src/lib/stores/useAudio.tsx":{"content":"import { create } from \"zustand\";\n\n// Create an audio context for generating beep sounds\nlet audioContext: AudioContext | null = null;\n\nconst getAudioContext = () => {\n  if (!audioContext) {\n    audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n  }\n  return audioContext;\n};\n\n// Play a beep sound with a specific frequency\nconst playBeep = (frequency: number, duration: number = 0.1, volume: number = 0.15) => {\n  try {\n    const ctx = getAudioContext();\n    \n    // Resume context if it's suspended (browser autoplay policy)\n    if (ctx.state === 'suspended') {\n      ctx.resume();\n    }\n    \n    const oscillator = ctx.createOscillator();\n    const gainNode = ctx.createGain();\n    \n    oscillator.connect(gainNode);\n    gainNode.connect(ctx.destination);\n    \n    oscillator.frequency.value = frequency;\n    oscillator.type = 'sine';\n    \n    gainNode.gain.setValueAtTime(volume, ctx.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);\n    \n    oscillator.start(ctx.currentTime);\n    oscillator.stop(ctx.currentTime + duration);\n  } catch (error) {\n    // Silently fail if AudioContext is not supported\n    console.log(\"Audio playback failed:\", error);\n  }\n};\n\n// Frequency mapping for each digit (similar to DTMF but simplified)\nconst digitFrequencies: { [key: number]: number } = {\n  1: 697,\n  2: 770,\n  3: 852,\n  4: 941,\n  5: 1209,\n  6: 1336,\n  7: 1477,\n  8: 1633,\n  9: 1800,\n  0: 600,\n};\n\ninterface AudioState {\n  backgroundMusic: HTMLAudioElement | null;\n  successSound: HTMLAudioElement | null;\n  isMuted: boolean;\n  \n  // Setter functions\n  setBackgroundMusic: (music: HTMLAudioElement) => void;\n  setSuccessSound: (sound: HTMLAudioElement) => void;\n  \n  // Control functions\n  toggleMute: () => void;\n  playDigit: (digit: number) => void;\n  playDelete: () => void;\n  playError: () => void;\n  playSuccess: () => void;\n  playConfirm: () => void;\n}\n\nexport const useAudio = create<AudioState>((set, get) => ({\n  backgroundMusic: null,\n  successSound: null,\n  isMuted: false, // Start unmuted by default\n  \n  setBackgroundMusic: (music) => set({ backgroundMusic: music }),\n  setSuccessSound: (sound) => set({ successSound: sound }),\n  \n  toggleMute: () => {\n    const { isMuted } = get();\n    const newMutedState = !isMuted;\n    set({ isMuted: newMutedState });\n    console.log(`Sound ${newMutedState ? 'muted' : 'unmuted'}`);\n  },\n  \n  playDigit: (digit: number) => {\n    const { isMuted } = get();\n    if (isMuted) return;\n    \n    const frequency = digitFrequencies[digit] || 800;\n    playBeep(frequency, 0.08, 0.15);\n  },\n  \n  playDelete: () => {\n    const { isMuted } = get();\n    if (isMuted) return;\n    \n    // Play a lower frequency beep for delete\n    playBeep(300, 0.12, 0.2);\n  },\n  \n  playError: () => {\n    const { isMuted } = get();\n    if (isMuted) return;\n    \n    // Play a dissonant double beep for error\n    playBeep(200, 0.15, 0.25);\n    setTimeout(() => playBeep(180, 0.15, 0.25), 80);\n  },\n  \n  playSuccess: () => {\n    const { successSound, isMuted } = get();\n    if (isMuted) return;\n    \n    if (successSound) {\n      successSound.currentTime = 0;\n      successSound.play().catch(error => {\n        console.log(\"Success sound play prevented:\", error);\n      });\n    } else {\n      // Fallback: play a nice ascending tone\n      playBeep(523, 0.1, 0.2); // C\n      setTimeout(() => playBeep(659, 0.1, 0.2), 100); // E\n      setTimeout(() => playBeep(784, 0.2, 0.2), 200); // G\n    }\n  },\n  \n  playConfirm: () => {\n    const { isMuted } = get();\n    if (isMuted) return;\n    \n    // Play a pleasant double beep for confirm (higher pitched than digit sounds)\n    playBeep(1200, 0.08, 0.18);\n    setTimeout(() => playBeep(1400, 0.08, 0.18), 60);\n  }\n}));\n","path":null,"size_bytes":3759,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: cn(\n          \"relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md\",\n          props.mode === \"range\"\n            ? \"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md\"\n            : \"[&:has([aria-selected])]:rounded-md\"\n        ),\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-8 w-8 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_start: \"day-range-start\",\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2935,"size_tokens":null},"client/src/components/game/challenges/DirectionChallenge.tsx":{"content":"import { useEffect, useState, useRef, useCallback } from \"react\";\nimport { useChallenges, type DirectionType, type ColorDirection } from \"@/lib/stores/useChallenges\";\nimport { useAudio } from \"@/lib/stores/useAudio\";\nimport { ArrowLeft, ArrowRight, ArrowUp, ArrowDown, X, Check, Clock, AlertTriangle, Hand } from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\nconst useIsMobile = () => {\n  const [isMobile, setIsMobile] = useState(false);\n  \n  useEffect(() => {\n    const checkMobile = () => {\n      const hasTouchScreen = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n      const isSmallScreen = window.innerWidth < 768;\n      setIsMobile(hasTouchScreen && isSmallScreen);\n    };\n    \n    checkMobile();\n    window.addEventListener('resize', checkMobile);\n    return () => window.removeEventListener('resize', checkMobile);\n  }, []);\n  \n  return isMobile;\n};\n\nconst directionLabels: Record<DirectionType, string> = {\n  right: \"ÙŠÙ…ÙŠÙ†\",\n  left: \"ÙŠØ³Ø§Ø±\",\n  up: \"ÙÙˆÙ‚\",\n  down: \"ØªØ­Øª\",\n  notRight: \"Ù„ÙŠØ³ ÙŠÙ…ÙŠÙ†\",\n  notLeft: \"Ù„ÙŠØ³ ÙŠØ³Ø§Ø±\",\n  notUp: \"Ù„ÙŠØ³ ÙÙˆÙ‚\",\n  notDown: \"Ù„ÙŠØ³ ØªØ­Øª\",\n  notRed: \"Ù„ÙŠØ³ Ø£Ø­Ù…Ø±\",\n  notYellow: \"Ù„ÙŠØ³ Ø£ØµÙØ±\",\n  notGreen: \"Ù„ÙŠØ³ Ø£Ø®Ø¶Ø±\",\n  notBlue: \"Ù„ÙŠØ³ Ø£Ø²Ø±Ù‚\",\n  nothing: \"Ù„Ø§ ØªØªØ­Ø±Ùƒ\",\n};\n\nconst colorLabels: Record<ColorDirection, string> = {\n  green: \"Ø£Ø®Ø¶Ø±\",\n  yellow: \"Ø£ØµÙØ±\",\n  blue: \"Ø£Ø²Ø±Ù‚\",\n  red: \"Ø£Ø­Ù…Ø±\",\n};\n\nconst colorValues: Record<ColorDirection, string> = {\n  green: \"#22c55e\",\n  yellow: \"#eab308\",\n  blue: \"#3b82f6\",\n  red: \"#ef4444\",\n};\n\nexport function DirectionChallenge({ onExit, isMultiplayer = false }: { onExit?: () => void; isMultiplayer?: boolean } = {}) {\n  const {\n    directionChallenge,\n    directionNextRound,\n    directionHandleInput,\n    directionTimeOut,\n    resetToMenu,\n  } = useChallenges();\n\n  const { playConfirm, playError } = useAudio();\n  const isMobile = useIsMobile();\n  const [progress, setProgress] = useState(100);\n  const [showFeedback, setShowFeedback] = useState<\"correct\" | \"wrong\" | null>(null);\n  const [pulseDirection, setPulseDirection] = useState<string | null>(null);\n  const timerRef = useRef<NodeJS.Timeout | null>(null);\n  const progressRef = useRef<NodeJS.Timeout | null>(null);\n  const touchStartRef = useRef<{ x: number; y: number } | null>(null);\n  const hasInputRef = useRef(false);\n\n  const colorPositions = directionChallenge.colorPositions;\n\n  const handleInput = useCallback((input: \"right\" | \"left\" | \"up\" | \"down\" | \"none\") => {\n    if (hasInputRef.current) return;\n    hasInputRef.current = true;\n\n    const isCorrect = directionHandleInput(input);\n    \n    if (isCorrect) {\n      playConfirm();\n      setShowFeedback(\"correct\");\n      setPulseDirection(input);\n    } else {\n      playError();\n      setShowFeedback(\"wrong\");\n    }\n\n    if (timerRef.current) clearTimeout(timerRef.current);\n    if (progressRef.current) clearInterval(progressRef.current);\n\n    setTimeout(() => {\n      setShowFeedback(null);\n      setPulseDirection(null);\n      hasInputRef.current = false;\n      directionNextRound();\n    }, 400);\n  }, [directionHandleInput, directionNextRound, playConfirm, playError]);\n\n  const startRoundTimer = useCallback(() => {\n    hasInputRef.current = false;\n    setProgress(100);\n    \n    const startTime = Date.now();\n    const duration = directionChallenge.timePerRound;\n    \n    progressRef.current = setInterval(() => {\n      const elapsed = Date.now() - startTime;\n      const remaining = Math.max(0, 100 - (elapsed / duration) * 100);\n      setProgress(remaining);\n      \n      if (remaining <= 0) {\n        if (progressRef.current) clearInterval(progressRef.current);\n      }\n    }, 16);\n\n    timerRef.current = setTimeout(() => {\n      if (!hasInputRef.current) {\n        if (directionChallenge.currentDirection === \"nothing\") {\n          handleInput(\"none\");\n        } else {\n          directionTimeOut();\n          playError();\n          setShowFeedback(\"wrong\");\n          \n          setTimeout(() => {\n            setShowFeedback(null);\n            hasInputRef.current = false;\n            directionNextRound();\n          }, 400);\n        }\n      }\n    }, duration);\n  }, [directionChallenge.timePerRound, directionChallenge.currentDirection, directionTimeOut, directionNextRound, handleInput, playError]);\n\n  useEffect(() => {\n    if (directionChallenge.currentDirection) {\n      startRoundTimer();\n    }\n\n    return () => {\n      if (timerRef.current) clearTimeout(timerRef.current);\n      if (progressRef.current) clearInterval(progressRef.current);\n    };\n  }, [directionChallenge.currentRound, startRoundTimer]);\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (hasInputRef.current || showFeedback) return;\n      \n      const key = e.key.toLowerCase();\n      const code = e.code;\n      \n      if (key === \"arrowright\" || key === \"d\" || code === \"KeyD\") {\n        e.preventDefault();\n        handleInput(\"right\");\n        return;\n      }\n      if (key === \"arrowleft\" || key === \"a\" || code === \"KeyA\") {\n        e.preventDefault();\n        handleInput(\"left\");\n        return;\n      }\n      if (key === \"arrowup\" || key === \"w\" || code === \"KeyW\") {\n        e.preventDefault();\n        handleInput(\"up\");\n        return;\n      }\n      if (key === \"arrowdown\" || key === \"s\" || code === \"KeyS\") {\n        e.preventDefault();\n        handleInput(\"down\");\n        return;\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [handleInput, showFeedback]);\n\n  const handleTouchStart = useCallback((e: React.TouchEvent) => {\n    if (!isMobile) return;\n    const touch = e.touches[0];\n    touchStartRef.current = { x: touch.clientX, y: touch.clientY };\n  }, [isMobile]);\n\n  const handleTouchMove = useCallback((e: React.TouchEvent) => {\n    e.preventDefault();\n  }, []);\n\n  const handleTouchEnd = useCallback((e: React.TouchEvent) => {\n    if (!isMobile || !touchStartRef.current || hasInputRef.current) return;\n    \n    const endX = e.changedTouches[0].clientX;\n    const endY = e.changedTouches[0].clientY;\n    const diffX = endX - touchStartRef.current.x;\n    const diffY = endY - touchStartRef.current.y;\n    const minSwipeDistance = 30;\n\n    if (Math.abs(diffX) > Math.abs(diffY)) {\n      if (Math.abs(diffX) > minSwipeDistance) {\n        const direction = diffX > 0 ? \"right\" : \"left\";\n        handleInput(direction);\n      }\n    } else {\n      if (Math.abs(diffY) > minSwipeDistance) {\n        const direction = diffY > 0 ? \"down\" : \"up\";\n        handleInput(direction);\n      }\n    }\n\n    touchStartRef.current = null;\n  }, [isMobile, handleInput]);\n\n  const getDisplayText = () => {\n    if (directionChallenge.useColors && directionChallenge.currentColor) {\n      return colorLabels[directionChallenge.currentColor];\n    }\n    if (directionChallenge.currentDirection) {\n      return directionLabels[directionChallenge.currentDirection];\n    }\n    return \"\";\n  };\n\n  const getDirectionIcon = (dir: \"up\" | \"down\" | \"left\" | \"right\") => {\n    const iconClass = \"w-6 h-6 md:w-8 md:h-8\";\n    switch (dir) {\n      case \"up\": return <ArrowUp className={iconClass} />;\n      case \"down\": return <ArrowDown className={iconClass} />;\n      case \"left\": return <ArrowLeft className={iconClass} />;\n      case \"right\": return <ArrowRight className={iconClass} />;\n    }\n  };\n\n  const isColorMode = () => {\n    const { currentDirection } = directionChallenge;\n    return currentDirection?.startsWith('not') && \n           (currentDirection === 'notRed' || currentDirection === 'notYellow' || \n            currentDirection === 'notGreen' || currentDirection === 'notBlue');\n  };\n\n  const getColorForDirectionButton = (position: 'top' | 'bottom' | 'left' | 'right'): ColorDirection | null => {\n    // For \"not color\" mode\n    if (isColorMode()) {\n      const colorMap: Record<'top' | 'bottom' | 'left' | 'right', ColorDirection> = {\n        'top': 'red',\n        'left': 'yellow',\n        'right': 'green',\n        'bottom': 'blue',\n      };\n      return colorMap[position];\n    }\n    \n    // For regular color position mode\n    if (!colorPositions) return null;\n    for (const [color, pos] of Object.entries(colorPositions)) {\n      if (pos === position) return color as ColorDirection;\n    }\n    return null;\n  };\n\n  return (\n    <div \n      className=\"w-full h-full flex flex-col items-center justify-center p-4 md:p-6 lg:p-8 bg-gradient-to-br from-slate-900 via-purple-950 to-slate-900 select-none overflow-hidden relative\"\n      style={{ touchAction: 'none' }}\n      onTouchStart={handleTouchStart}\n      onTouchMove={handleTouchMove}\n      onTouchEnd={handleTouchEnd}\n    >\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute top-0 left-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl animate-pulse\" />\n        <div className=\"absolute bottom-0 right-1/4 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl animate-pulse\" style={{ animationDelay: '1s' }} />\n      </div>\n\n      {/* Header */}\n      <div className=\"w-full max-w-2xl z-10 mb-6 flex items-center justify-between\">\n        {!isMultiplayer && (\n          <button\n            onClick={() => {\n              resetToMenu();\n              onExit?.();\n            }}\n            className=\"flex items-center gap-2 bg-white/10 backdrop-blur-xl hover:bg-white/20 text-white px-4 py-2 rounded-xl transition-all shadow-lg border border-white/10\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n            <span className=\"font-bold text-sm\">Ø±Ø¬ÙˆØ¹</span>\n          </button>\n        )}\n        {isMultiplayer && <div />}\n\n        <div className=\"flex items-center gap-2 md:gap-3\">\n          <motion.div \n            className=\"bg-white/10 backdrop-blur-xl px-3 py-2 rounded-lg shadow-lg border border-white/10 flex items-center gap-2\"\n            animate={{ scale: directionChallenge.errors > 0 ? [1, 1.1, 1] : 1 }}\n          >\n            <AlertTriangle className=\"w-4 h-4 text-red-400\" />\n            <span className=\"text-sm font-bold text-white\">{directionChallenge.errors}/{directionChallenge.maxErrors}</span>\n          </motion.div>\n\n          <div className=\"bg-white/10 backdrop-blur-xl px-3 py-2 rounded-lg shadow-lg border border-white/10 flex items-center gap-2\">\n            <Check className=\"w-4 h-4 text-green-400\" />\n            <span className=\"text-sm font-bold text-white\">{directionChallenge.score}</span>\n          </div>\n\n          <div className=\"bg-white/10 backdrop-blur-xl px-3 py-2 rounded-lg shadow-lg border border-white/10 flex items-center gap-2\">\n            <Clock className=\"w-4 h-4 text-cyan-400\" />\n            <span className=\"text-sm font-bold text-white\">{directionChallenge.currentRound}/{directionChallenge.totalRounds}</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Progress bar */}\n      <div className=\"w-full max-w-2xl h-1.5 bg-white/10 rounded-full overflow-hidden backdrop-blur-xl mb-8 z-10\">\n        <motion.div\n          className=\"h-full rounded-full\"\n          style={{\n            width: `${progress}%`,\n            background: progress > 50 \n              ? 'linear-gradient(90deg, #06b6d4, #8b5cf6)' \n              : progress > 25 \n                ? 'linear-gradient(90deg, #eab308, #f97316)' \n                : 'linear-gradient(90deg, #ef4444, #dc2626)',\n          }}\n          transition={{ duration: 0.1 }}\n        />\n      </div>\n\n      {/* Game Area - Grid layout for perfect alignment */}\n      <div className=\"flex-1 flex items-center justify-center w-full z-10 px-4\">\n        <div \n          className=\"grid\"\n          dir=\"ltr\"\n          style={{\n            gridTemplateColumns: '70px 150px 70px',\n            gridTemplateRows: '70px 150px 70px',\n            gap: '24px',\n            placeItems: 'center',\n            width: 'fit-content',\n          }}\n        >\n          {/* Up Arrow - Grid position: row 0, col 1 */}\n          <motion.button\n            onClick={() => !hasInputRef.current && handleInput(\"up\")}\n            className=\"rounded-2xl flex items-center justify-center transition-all border-2 backdrop-blur-sm\"\n            style={{\n              gridColumn: '2',\n              gridRow: '1',\n              width: '70px',\n              height: '70px',\n              backgroundColor: (directionChallenge.useColors || isColorMode()) && getColorForDirectionButton('top') \n                ? `${colorValues[getColorForDirectionButton('top')!]}30` \n                : 'rgba(255,255,255,0.1)',\n              borderColor: (directionChallenge.useColors || isColorMode()) && getColorForDirectionButton('top')\n                ? colorValues[getColorForDirectionButton('top')!]\n                : 'rgba(255,255,255,0.3)',\n              boxShadow: pulseDirection === 'up' \n                ? `0 0 30px rgba(139, 92, 246, 0.8)`\n                : '0 4px 15px rgba(0,0,0,0.3)',\n            }}\n            animate={{\n              scale: pulseDirection === 'up' ? 1.15 : 1,\n            }}\n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.9 }}\n          >\n            <span style={{ color: (directionChallenge.useColors || isColorMode()) && getColorForDirectionButton('top') ? colorValues[getColorForDirectionButton('top')!] : 'white' }}>\n              {getDirectionIcon('up')}\n            </span>\n          </motion.button>\n          \n          {/* Left Arrow - Grid position: always column 1 (left side) */}\n          <motion.button\n            onClick={() => !hasInputRef.current && handleInput(\"left\")}\n            className=\"rounded-2xl flex items-center justify-center transition-all border-2 backdrop-blur-sm\"\n            style={{\n              gridColumn: '1',\n              gridRow: '2',\n              width: '70px',\n              height: '70px',\n              backgroundColor: (directionChallenge.useColors || isColorMode()) && getColorForDirectionButton('left') \n                ? `${colorValues[getColorForDirectionButton('left')!]}30` \n                : 'rgba(255,255,255,0.1)',\n              borderColor: (directionChallenge.useColors || isColorMode()) && getColorForDirectionButton('left')\n                ? colorValues[getColorForDirectionButton('left')!]\n                : 'rgba(255,255,255,0.3)',\n              boxShadow: pulseDirection === 'left' \n                ? `0 0 30px rgba(139, 92, 246, 0.8)`\n                : '0 4px 15px rgba(0,0,0,0.3)',\n            }}\n            animate={{\n              scale: pulseDirection === 'left' ? 1.15 : 1,\n            }}\n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.9 }}\n          >\n            <span style={{ color: (directionChallenge.useColors || isColorMode()) && getColorForDirectionButton('left') ? colorValues[getColorForDirectionButton('left')!] : 'white' }}>\n              {getDirectionIcon('left')}\n            </span>\n          </motion.button>\n\n          {/* Center card - Grid position: row 1, col 1 */}\n          <motion.div\n            className=\"rounded-2xl flex items-center justify-center overflow-hidden bg-slate-800/95 border-2 border-white/40 shadow-2xl\"\n            style={{\n              gridColumn: '2',\n              gridRow: '2',\n              width: '150px',\n              height: '150px',\n              boxShadow: '0 0 50px rgba(139, 92, 246, 0.4), inset 0 0 80px rgba(139, 92, 246, 0.2)',\n            }}\n            animate={{\n              scale: showFeedback ? 1.05 : 1,\n              rotate: showFeedback === \"wrong\" ? [0, -5, 5, -5, 5, 0] : 0,\n            }}\n            transition={{ duration: 0.3 }}\n          >\n            <div className=\"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent rounded-2xl\" />\n            \n            <span \n              className=\"text-xl md:text-2xl font-black text-white z-10 text-center px-3 leading-tight\"\n              style={{\n                textShadow: '0 0 20px rgba(255,255,255,0.3)',\n              }}\n            >\n              {getDisplayText()}\n            </span>\n\n          </motion.div>\n          \n          {/* Right Arrow - Grid position: always column 3 (right side) */}\n          <motion.button\n            onClick={() => !hasInputRef.current && handleInput(\"right\")}\n            className=\"rounded-2xl flex items-center justify-center transition-all border-2 backdrop-blur-sm\"\n            style={{\n              gridColumn: '3',\n              gridRow: '2',\n              width: '70px',\n              height: '70px',\n              backgroundColor: (directionChallenge.useColors || isColorMode()) && getColorForDirectionButton('right') \n                ? `${colorValues[getColorForDirectionButton('right')!]}30` \n                : 'rgba(255,255,255,0.1)',\n              borderColor: (directionChallenge.useColors || isColorMode()) && getColorForDirectionButton('right')\n                ? colorValues[getColorForDirectionButton('right')!]\n                : 'rgba(255,255,255,0.3)',\n              boxShadow: pulseDirection === 'right' \n                ? `0 0 30px rgba(139, 92, 246, 0.8)`\n                : '0 4px 15px rgba(0,0,0,0.3)',\n            }}\n            animate={{\n              scale: pulseDirection === 'right' ? 1.15 : 1,\n            }}\n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.9 }}\n          >\n            <span style={{ color: (directionChallenge.useColors || isColorMode()) && getColorForDirectionButton('right') ? colorValues[getColorForDirectionButton('right')!] : 'white' }}>\n              {getDirectionIcon('right')}\n            </span>\n          </motion.button>\n          \n          {/* Down Arrow - Grid position: row 2, col 1 */}\n          <motion.button\n            onClick={() => !hasInputRef.current && handleInput(\"down\")}\n            className=\"rounded-2xl flex items-center justify-center transition-all border-2 backdrop-blur-sm\"\n            style={{\n              gridColumn: '2',\n              gridRow: '3',\n              width: '70px',\n              height: '70px',\n              backgroundColor: (directionChallenge.useColors || isColorMode()) && getColorForDirectionButton('bottom') \n                ? `${colorValues[getColorForDirectionButton('bottom')!]}30` \n                : 'rgba(255,255,255,0.1)',\n              borderColor: (directionChallenge.useColors || isColorMode()) && getColorForDirectionButton('bottom')\n                ? colorValues[getColorForDirectionButton('bottom')!]\n                : 'rgba(255,255,255,0.3)',\n              boxShadow: pulseDirection === 'down' \n                ? `0 0 30px rgba(139, 92, 246, 0.8)`\n                : '0 4px 15px rgba(0,0,0,0.3)',\n            }}\n            animate={{\n              scale: pulseDirection === 'down' ? 1.15 : 1,\n            }}\n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.9 }}\n          >\n            <span style={{ color: (directionChallenge.useColors || isColorMode()) && getColorForDirectionButton('bottom') ? colorValues[getColorForDirectionButton('bottom')!] : 'white' }}>\n              {getDirectionIcon('down')}\n            </span>\n          </motion.button>\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"w-full max-w-lg z-10 mt-6\">\n        <div className=\"bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl p-4\">\n          <div className=\"flex items-center gap-3 justify-center text-white/70 text-xs md:text-sm\">\n            {isMobile ? (\n              <>\n                <Hand className=\"w-4 h-4\" />\n                <span>Ø§Ø³Ø­Ø¨ ÙÙŠ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</span>\n              </>\n            ) : (\n              <>\n                <span className=\"flex items-center gap-1\">\n                  <kbd className=\"px-2 py-1 bg-white/10 rounded text-xs\">â†‘</kbd>\n                  <kbd className=\"px-2 py-1 bg-white/10 rounded text-xs\">â†</kbd>\n                  <kbd className=\"px-2 py-1 bg-white/10 rounded text-xs\">â†“</kbd>\n                  <kbd className=\"px-2 py-1 bg-white/10 rounded text-xs\">â†’</kbd>\n                </span>\n                <span>Ø£Ùˆ Ø§Ù„Ø£Ø³Ù‡Ù…</span>\n              </>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":20160,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground shadow hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2\",\n        sm: \"h-8 rounded-md px-3 text-xs\",\n        lg: \"h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":1902,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":649,"size_tokens":null},"client/src/components/ui/ChallengeResultScreen.tsx":{"content":"export function ChallengeResultScreen({\n  won,\n  onClose,\n}: {\n  won: boolean;\n  onClose: () => void;\n}) {\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-[200]\">\n      <div className=\"bg-gradient-to-br from-white to-gray-50 rounded-3xl shadow-2xl p-10 max-w-md w-full mx-4 text-center space-y-6\">\n        <div className=\"text-8xl mb-4\">\n          {won ? \"ğŸ‰\" : \"ğŸ˜”\"}\n        </div>\n        \n        <h2 className=\"text-4xl font-bold\" style={{ color: won ? \"#22c55e\" : \"#ef4444\" }}>\n          {won ? \"ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ÙØ²Øª\" : \"Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\"}\n        </h2>\n        \n        <p className=\"text-gray-700 text-lg\">\n          {won \n            ? \"Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„ØªØ­Ø¯ÙŠ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø±Ø¤ÙŠØ© Ø§Ù„ØªÙ„Ù…ÙŠØ­ ÙÙˆÙ‚ Ø§Ù„Ø¨Ø§Ø¨\"\n            : \"Ù„Ù… ØªØ³ØªØ·Ø¹ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹\"}\n        </p>\n\n        <button\n          onClick={onClose}\n          className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl transition-all transform hover:scale-105 shadow-lg text-lg\"\n        >\n          {won ? \"Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØºØ±ÙØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\" : \"Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©\"}\n        </button>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":1306,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1037,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7224,"size_tokens":null},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, boolean, timestamp, varchar } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { relations } from \"drizzle-orm\";\n\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n});\n\nexport const accounts = pgTable(\"accounts\", {\n  id: serial(\"id\").primaryKey(),\n  displayName: varchar(\"display_name\", { length: 50 }).notNull(),\n  username: varchar(\"username\", { length: 30 }).notNull().unique(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  lastSeen: timestamp(\"last_seen\").defaultNow().notNull(),\n  isOnline: boolean(\"is_online\").default(false).notNull(),\n  currentRoomId: varchar(\"current_room_id\", { length: 10 }),\n});\n\nexport const accountRelations = relations(accounts, ({ many }) => ({\n  sentFriendRequests: many(friendRequests, { relationName: \"sentRequests\" }),\n  receivedFriendRequests: many(friendRequests, { relationName: \"receivedRequests\" }),\n  notifications: many(notifications),\n}));\n\nexport const friendRequests = pgTable(\"friend_requests\", {\n  id: serial(\"id\").primaryKey(),\n  fromUserId: integer(\"from_user_id\").notNull().references(() => accounts.id, { onDelete: \"cascade\" }),\n  toUserId: integer(\"to_user_id\").notNull().references(() => accounts.id, { onDelete: \"cascade\" }),\n  status: varchar(\"status\", { length: 20 }).default(\"pending\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const friendRequestRelations = relations(friendRequests, ({ one }) => ({\n  fromUser: one(accounts, {\n    fields: [friendRequests.fromUserId],\n    references: [accounts.id],\n    relationName: \"sentRequests\",\n  }),\n  toUser: one(accounts, {\n    fields: [friendRequests.toUserId],\n    references: [accounts.id],\n    relationName: \"receivedRequests\",\n  }),\n}));\n\nexport const friendships = pgTable(\"friendships\", {\n  id: serial(\"id\").primaryKey(),\n  userId1: integer(\"user_id_1\").notNull().references(() => accounts.id, { onDelete: \"cascade\" }),\n  userId2: integer(\"user_id_2\").notNull().references(() => accounts.id, { onDelete: \"cascade\" }),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const friendshipRelations = relations(friendships, ({ one }) => ({\n  user1: one(accounts, {\n    fields: [friendships.userId1],\n    references: [accounts.id],\n  }),\n  user2: one(accounts, {\n    fields: [friendships.userId2],\n    references: [accounts.id],\n  }),\n}));\n\nexport const notifications = pgTable(\"notifications\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => accounts.id, { onDelete: \"cascade\" }),\n  type: varchar(\"type\", { length: 50 }).notNull(),\n  title: text(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  data: text(\"data\"),\n  isRead: boolean(\"is_read\").default(false).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const notificationRelations = relations(notifications, ({ one }) => ({\n  user: one(accounts, {\n    fields: [notifications.userId],\n    references: [accounts.id],\n  }),\n}));\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n});\n\nexport const insertAccountSchema = createInsertSchema(accounts).pick({\n  displayName: true,\n  username: true,\n});\n\nexport const insertFriendRequestSchema = createInsertSchema(friendRequests).pick({\n  fromUserId: true,\n  toUserId: true,\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).pick({\n  userId: true,\n  type: true,\n  title: true,\n  message: true,\n  data: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type Account = typeof accounts.$inferSelect;\nexport type InsertAccount = z.infer<typeof insertAccountSchema>;\nexport type FriendRequest = typeof friendRequests.$inferSelect;\nexport type InsertFriendRequest = z.infer<typeof insertFriendRequestSchema>;\nexport type Friendship = typeof friendships.$inferSelect;\nexport type Notification = typeof notifications.$inferSelect;\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\n","path":null,"size_bytes":4239,"size_tokens":null},"client/src/hooks/use-is-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/mobile/MobileApp.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation, useNavigate, useParams } from \"react-router-dom\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { useAudio } from \"@/lib/stores/useAudio\";\nimport { reconnectToSession, connectWebSocket, reconnectWithRetry, clearSession, getLastRoomSession } from \"@/lib/websocket\";\nimport { MobileMenu } from \"./MobileMenu\";\nimport { MobileSingleplayer } from \"./MobileSingleplayer\";\nimport { MobileMultiplayer } from \"./MobileMultiplayer\";\nimport { ChallengesHub } from \"../game/ChallengesHub\";\nimport { useChallenges } from \"@/lib/stores/useChallenges\";\n\nexport function MobileApp() {\n  const location = useLocation();\n  const navigate = useNavigate();\n  const { mode, setMode, setPlayerName, setRoomId, setPlayerId, setIsConnecting, multiplayer, singleplayer, restartSingleplayer, resetMultiplayer } = useNumberGame();\n  const { setSuccessSound } = useAudio();\n  const [showChallengesHub, setShowChallengesHub] = useState(false);\n  const challenges = useChallenges();\n  const { hasWonAnyChallenge, resetChallengesHub, generateHint } = challenges;\n\n  useEffect(() => {\n    const successAudio = new Audio(\"/sounds/success.mp3\");\n    successAudio.load();\n    setSuccessSound(successAudio);\n  }, [setSuccessSound]);\n\n  useEffect(() => {\n    if (location.pathname === \"/\" || location.pathname === \"\") {\n      resetMultiplayer();\n      setMode(\"menu\");\n      clearSession();\n    } else if (location.pathname === \"/singleplayer\") {\n      setMode(\"singleplayer\");\n      if (!singleplayer.secretCode || singleplayer.secretCode.length === 0) {\n        restartSingleplayer();\n      }\n    } else if (location.pathname === \"/multiplayer\") {\n      setMode(\"multiplayer\");\n    } else if (location.pathname.startsWith(\"/room/\")) {\n      setMode(\"multiplayer\");\n      const roomId = location.pathname.split(\"/room/\")[1];\n      \n      if (multiplayer.roomId === roomId && multiplayer.playerId) {\n        return;\n      }\n\n      const session = reconnectToSession();\n      if (session && session.roomId === roomId && session.playerId) {\n        console.log(\"Reconnecting to room from session:\", roomId);\n        setPlayerName(session.playerName);\n        setIsConnecting(true);\n        reconnectWithRetry(session.playerName, session.playerId, session.roomId);\n        \n        setTimeout(() => {\n          if (useNumberGame.getState().isConnecting) {\n            console.error(\"Connection timeout\");\n            setIsConnecting(false);\n          }\n        }, 5000);\n        return;\n      }\n\n      const lastRoom = getLastRoomSession();\n      if (lastRoom && lastRoom.roomId === roomId && lastRoom.playerId) {\n        console.log(\"Reconnecting to last room:\", roomId);\n        setPlayerName(lastRoom.playerName);\n        setIsConnecting(true);\n        reconnectWithRetry(lastRoom.playerName, lastRoom.playerId, lastRoom.roomId);\n        \n        setTimeout(() => {\n          if (useNumberGame.getState().isConnecting) {\n            console.error(\"Connection timeout\");\n            setIsConnecting(false);\n          }\n        }, 5000);\n      }\n    }\n  }, [location.pathname]);\n\n  useEffect(() => {\n    if (multiplayer.roomId && location.pathname !== `/room/${multiplayer.roomId}`) {\n      navigate(`/room/${multiplayer.roomId}`, { replace: true });\n    }\n  }, [multiplayer.roomId, navigate, location.pathname]);\n\n  const handleExitChallengesHub = () => {\n    if (hasWonAnyChallenge()) {\n      generateHint(singleplayer.secretCode);\n    }\n    setShowChallengesHub(false);\n    resetChallengesHub();\n  };\n\n  if (showChallengesHub) {\n    return <ChallengesHub onExit={handleExitChallengesHub} />;\n  }\n\n  const isMenuPage = location.pathname === \"/\" || location.pathname === \"\";\n  const isSingleplayerPage = location.pathname === \"/singleplayer\";\n  const isMultiplayerPage = location.pathname === \"/multiplayer\" || location.pathname.startsWith(\"/room/\");\n\n  // Extract roomId from URL for join page - clean up any query/hash params\n  const urlRoomId = location.pathname.startsWith(\"/room/\") \n    ? location.pathname.split(\"/room/\")[1]?.split(/[?#]/)[0]?.replace(/\\/$/, \"\")?.toUpperCase() || undefined\n    : undefined;\n\n  return (\n    <div dir=\"rtl\" className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50\">\n      {isMenuPage && <MobileMenu />}\n      {isSingleplayerPage && (\n        <MobileSingleplayer \n          onStartChallenge={() => {\n            setShowChallengesHub(true);\n          }}\n        />\n      )}\n      {isMultiplayerPage && <MobileMultiplayer joinRoomIdFromUrl={urlRoomId} />}\n    </div>\n  );\n}\n","path":null,"size_bytes":4581,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-[0.8rem] text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-[0.8rem] font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4132,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1828,"size_tokens":null},"client/src/components/game/ChallengesHub.tsx":{"content":"import { useChallenges, type ChallengeType, type ChallengeCategory } from \"@/lib/stores/useChallenges\";\nimport { ArrowLeft, Brain, Target, Zap, Calculator } from \"lucide-react\";\nimport { GuessChallenge } from \"./challenges/GuessChallenge\";\nimport { MemoryChallenge } from \"./challenges/MemoryChallenge\";\nimport { DirectionChallenge } from \"./challenges/DirectionChallenge\";\nimport { RainDropsChallenge } from \"./challenges/RainDropsChallenge\";\n\ninterface ChallengeInfo {\n  id: ChallengeType;\n  name: string;\n  description: string;\n  icon: typeof Brain;\n  color: string;\n  borderColor: string;\n  category: ChallengeCategory;\n}\n\nconst challengeInfo: Record<ChallengeType, ChallengeInfo> = {\n  guess: {\n    id: \"guess\",\n    name: \"ØªØ­Ø¯ÙŠ ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ø¶ÙˆØ§Ø¡\",\n    description: \"ØªØ°ÙƒØ± Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„ØµØ­ÙŠØ­ Ù…Ù† Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ£Ø¹Ø¯Ù‡\",\n    icon: Brain,\n    color: \"from-blue-500 to-blue-600\",\n    borderColor: \"border-blue-500\",\n    category: \"memory\",\n  },\n  memory: {\n    id: \"memory\",\n    name: \"Ù„ÙˆØ­Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©\",\n    description: \"ØªØ°ÙƒØ± Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù…Ø¶ÙŠØ¦Ø© ÙˆØ§Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡Ø§\",\n    icon: Target,\n    color: \"from-purple-500 to-purple-600\",\n    borderColor: \"border-purple-500\",\n    category: \"memory\",\n  },\n  direction: {\n    id: \"direction\",\n    name: \"ØªØ±ØªÙŠØ¨ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª\",\n    description: \"Ø­Ø±Ùƒ Ø§Ù„Ù…ÙƒØ¹Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¨Ø³Ø±Ø¹Ø©\",\n    icon: Zap,\n    color: \"from-orange-500 to-orange-600\",\n    borderColor: \"border-orange-500\",\n    category: \"reaction\",\n  },\n  raindrops: {\n    id: \"raindrops\",\n    name: \"Ø­Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ø±\",\n    description: \"Ø­Ù„ Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ© Ù‚Ø¨Ù„ Ø£Ù† ØªØµÙ„ Ø§Ù„Ø­Ø¨Ø§Øª Ù„Ù„Ø£Ø³ÙÙ„\",\n    icon: Calculator,\n    color: \"from-cyan-500 to-blue-600\",\n    borderColor: \"border-cyan-500\",\n    category: \"math\",\n  },\n};\n\nconst categories: { id: ChallengeCategory; name: string; icon: typeof Brain }[] = [\n  { id: \"memory\", name: \"Ø§Ù„Ø°Ø§ÙƒØ±Ø©\", icon: Brain },\n  { id: \"reaction\", name: \"Ø±Ø¯ Ø§Ù„ÙØ¹Ù„\", icon: Zap },\n  { id: \"math\", name: \"Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª\", icon: Calculator },\n];\n\nexport function ChallengesHub({ onExit }: { onExit: () => void }) {\n  const {\n    selectedChallenge,\n    currentPhase,\n    selectChallenge,\n    startChallenge,\n    resetToMenu,\n    getRemainingAttempts,\n    hasWonAnyChallenge,\n    canPlayChallenge,\n  } = useChallenges();\n\n  if (selectedChallenge && currentPhase !== \"menu\") {\n    if (currentPhase === \"playing\") {\n      return (\n        <div className=\"fixed inset-0 bg-slate-950 flex items-center justify-center\">\n          {selectedChallenge === \"guess\" && <GuessChallenge onExit={onExit} />}\n          {selectedChallenge === \"memory\" && <MemoryChallenge onExit={onExit} />}\n          {selectedChallenge === \"direction\" && <DirectionChallenge onExit={onExit} />}\n          {selectedChallenge === \"raindrops\" && <RainDropsChallenge onExit={onExit} />}\n        </div>\n      );\n    }\n  }\n\n  if (currentPhase === \"won\" || currentPhase === \"lost\") {\n    return (\n      <div className=\"fixed inset-0 bg-slate-950 flex items-center justify-center p-6\">\n        <div\n          className={`w-full max-w-md bg-slate-900/90 backdrop-blur-xl rounded-3xl shadow-2xl border-2 ${\n            currentPhase === \"won\" ? \"border-green-500/30\" : \"border-red-500/30\"\n          } p-8 text-center space-y-6`}\n        >\n          <div className=\"text-8xl animate-bounce\">\n            {currentPhase === \"won\" ? \"ğŸ‰\" : \"ğŸ˜¢\"}\n          </div>\n          <h2\n            className={`text-4xl font-bold ${\n              currentPhase === \"won\" ? \"text-green-400\" : \"text-red-400\"\n            }`}\n          >\n            {currentPhase === \"won\" ? \"Ù…Ø¨Ø±ÙˆÙƒ! ÙØ²Øª\" : \"Ù„Ù„Ø£Ø³Ù! Ø®Ø³Ø±Øª\"}\n          </h2>\n          <p className=\"text-gray-300 text-lg\">\n            {currentPhase === \"won\"\n              ? \"Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„ØªØ­Ø¯ÙŠ Ø¨Ù†Ø¬Ø§Ø­!\"\n              : \"Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\"}\n          </p>\n          {currentPhase === \"won\" && (\n            <p className=\"text-green-300 font-semibold\">Ø³ÙŠØ¸Ù‡Ø± Ù„Ùƒ Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø§Ù„Ø¢Ù†</p>\n          )}\n          <div className=\"flex flex-col gap-3\">\n            {currentPhase === \"won\" && (\n              <button\n                onClick={() => {\n                  resetToMenu();\n                  onExit();\n                }}\n                className=\"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-4 px-6 rounded-xl transition-all shadow-lg\"\n              >\n                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø¨Ø©\n              </button>\n            )}\n            {currentPhase === \"lost\" && (\n              <>\n                {getRemainingAttempts() > 0 && (\n                  <button\n                    onClick={() => resetToMenu()}\n                    className=\"w-full bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-4 px-6 rounded-xl transition-all shadow-lg\"\n                  >\n                    Ø§Ø®ØªÙŠØ§Ø± ØªØ­Ø¯ÙŠ Ø¢Ø®Ø±\n                  </button>\n                )}\n                <button\n                  onClick={() => {\n                    resetToMenu();\n                    onExit();\n                  }}\n                  className=\"w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-bold py-4 px-6 rounded-xl transition-all shadow-lg\"\n                >\n                  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø¨Ø©\n                </button>\n              </>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const remainingAttempts = getRemainingAttempts();\n  const hasWon = hasWonAnyChallenge();\n\n  const getChallengesByCategory = (categoryId: ChallengeCategory) => {\n    return Object.values(challengeInfo).filter(c => c.category === categoryId);\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-6 overflow-y-auto\">\n      <div className=\"w-full max-w-6xl my-auto\">\n        <div className=\"flex items-center justify-between mb-8\">\n          <button\n            onClick={onExit}\n            className=\"flex items-center gap-2 bg-slate-800/80 hover:bg-slate-700/80 text-white px-6 py-3 rounded-xl transition-all shadow-lg\"\n          >\n            <ArrowLeft className=\"w-5 h-5\" />\n            <span className=\"font-bold\">Ø§Ù„Ø¹ÙˆØ¯Ø©</span>\n          </button>\n\n          <div className=\"bg-slate-800/80 backdrop-blur-xl px-8 py-4 rounded-2xl shadow-lg\">\n            <div className=\"flex items-center gap-3\">\n              <svg\n                className=\"w-6 h-6 text-yellow-400\"\n                fill=\"currentColor\"\n                viewBox=\"0 0 20 20\"\n              >\n                <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\n              </svg>\n              <span className=\"text-2xl font-bold text-white\">\n                {remainingAttempts} / 3\n              </span>\n              <span className=\"text-gray-300\">ÙØ±Øµ Ù…ØªØ¨Ù‚ÙŠØ©</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"mb-8 text-center\">\n          <h1 className=\"text-5xl font-bold text-white mb-3\">Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</h1>\n          <p className=\"text-gray-300 text-lg\">\n            {hasWon\n              ? \"Ù„Ù‚Ø¯ ÙØ²Øª Ø¨Ø£Ø­Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª! Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ù„Ø¹Ø¨ Ø§Ù„Ù…Ø²ÙŠØ¯\"\n              : remainingAttempts === 0\n              ? \"Ù„Ù‚Ø¯ Ø§Ø³ØªÙ†ÙØ°Øª Ø¬Ù…ÙŠØ¹ ÙØ±ØµÙƒ\"\n              : \"Ø§Ø®ØªØ± ØªØ­Ø¯ÙŠÙ‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ù„Ù„ÙÙˆØ² Ø¨Ø§Ù„ØªÙ„Ù…ÙŠØ­\"}\n          </p>\n        </div>\n\n        {categories.map((category) => {\n          const categoryChallenges = getChallengesByCategory(category.id);\n          if (categoryChallenges.length === 0) return null;\n\n          return (\n            <div key={category.id} className=\"mb-8\">\n              <div className=\"flex items-center gap-3 mb-4\">\n                <category.icon className=\"w-6 h-6 text-white\" />\n                <h2 className=\"text-2xl font-bold text-white\">{category.name}</h2>\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {categoryChallenges.map((challenge) => {\n                  const canPlay = canPlayChallenge(challenge.id);\n                  const Icon = challenge.icon;\n                  \n                  return (\n                    <div\n                      key={challenge.id}\n                      className={`bg-slate-800/50 backdrop-blur-xl rounded-2xl border-2 ${\n                        challenge.borderColor\n                      } p-6 transition-all transform ${\n                        canPlay && !hasWon\n                          ? \"hover:scale-105 cursor-pointer shadow-xl\"\n                          : \"opacity-50 cursor-not-allowed\"\n                      }`}\n                      onClick={() => {\n                        if (canPlay && !hasWon) {\n                          selectChallenge(challenge.id);\n                          startChallenge();\n                        }\n                      }}\n                    >\n                      <div\n                        className={`w-20 h-20 bg-gradient-to-br ${challenge.color} rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg`}\n                      >\n                        <Icon className=\"w-10 h-10 text-white\" />\n                      </div>\n\n                      <h3 className=\"text-2xl font-bold text-white mb-2 text-center\">\n                        {challenge.name}\n                      </h3>\n\n                      <p className=\"text-gray-300 text-center mb-4\">\n                        {challenge.description}\n                      </p>\n\n                      <button\n                        disabled={!canPlay || hasWon}\n                        className={`w-full py-3 rounded-xl font-bold transition-all shadow-lg ${\n                          canPlay && !hasWon\n                            ? `bg-gradient-to-r ${challenge.color} text-white hover:shadow-2xl`\n                            : \"bg-gray-700 text-gray-400 cursor-not-allowed\"\n                        }`}\n                      >\n                        {hasWon\n                          ? \"ÙØ²Øª Ø¨Ø§Ù„ÙØ¹Ù„\"\n                          : !canPlay\n                          ? \"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ù„Ø¹Ø¨\"\n                          : \"Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ\"}\n                      </button>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":10877,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path, { dirname } from \"path\";\nimport { fileURLToPath } from \"url\";\nimport { createServer as createViteServer, createLogger, type ServerOptions } from \"vite\";\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions: ServerOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        __dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2409,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1598,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1140,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"client/src/components/ui/interface.tsx":{"content":"import { useEffect } from \"react\";\nimport { useGame } from \"@/lib/stores/useGame\";\nimport { useAudio } from \"@/lib/stores/useAudio\";\nimport { Button } from \"./button\";\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from \"./card\";\nimport { VolumeX, Volume2, RotateCw, Trophy } from \"lucide-react\";\n\nexport function Interface() {\n  const restart = useGame((state) => state.restart);\n  const phase = useGame((state) => state.phase);\n  const { isMuted, toggleMute } = useAudio();\n\n  // Handle clicks on the interface in the ready phase to start the game\n  useEffect(() => {\n    if (phase === \"ready\") {\n      const handleClick = () => {\n        const activeElement = document.activeElement;\n        if (activeElement && 'blur' in activeElement) {\n          (activeElement as HTMLElement).blur();\n        }\n        const event = new KeyboardEvent(\"keydown\", { code: \"Space\" });\n        window.dispatchEvent(event);\n      };\n\n      window.addEventListener(\"click\", handleClick);\n      return () => window.removeEventListener(\"click\", handleClick);\n    }\n  }, [phase]);\n\n  return (\n    <>\n      {/* Top-right corner UI controls */}\n      <div className=\"fixed top-4 right-4 flex gap-2 z-10\">\n        <Button\n          variant=\"outline\"\n          size=\"icon\"\n          onClick={toggleMute}\n          title={isMuted ? \"Unmute\" : \"Mute\"}\n        >\n          {isMuted ? <VolumeX size={18} /> : <Volume2 size={18} />}\n        </Button>\n        \n        <Button\n          variant=\"outline\"\n          size=\"icon\"\n          onClick={restart}\n          title=\"Restart Game\"\n        >\n          <RotateCw size={18} />\n        </Button>\n      </div>\n      \n      {/* Game completion overlay */}\n      {phase === \"ended\" && (\n        <div className=\"fixed inset-0 flex items-center justify-center z-20 bg-black/30\">\n          <Card className=\"w-full max-w-md mx-4 shadow-lg\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center justify-center gap-2\">\n                <Trophy className=\"text-yellow-500\" />\n                Level Complete!\n              </CardTitle>\n            </CardHeader>\n            \n            <CardContent>\n              <p className=\"text-center text-muted-foreground\">\n                Congratulations! You successfully navigated the course.\n              </p>\n            </CardContent>\n            \n            <CardFooter className=\"flex justify-center\">\n              <Button onClick={restart} className=\"w-full\">\n                Play Again\n              </Button>\n            </CardFooter>\n          </Card>\n        </div>\n      )}\n      \n      {/* Instructions panel */}\n      <div className=\"fixed bottom-4 left-4 z-10\">\n        <Card className=\"w-auto max-w-xs bg-background/80 backdrop-blur-sm\">\n          <CardContent className=\"p-4\">\n            <h3 className=\"font-medium mb-2\">Controls:</h3>\n            <ul className=\"text-sm space-y-1 text-muted-foreground\">\n              <li>WASD or Arrow Keys: Move the ball</li>\n              <li>Space: Jump</li>\n              <li>R: Restart game</li>\n              <li>M: Toggle sound</li>\n            </ul>\n          </CardContent>\n        </Card>\n      </div>\n    </>\n  );\n}\n","path":null,"size_bytes":3180,"size_tokens":null},"client/src/lib/stores/useNumberGame.ts":{"content":"import { create } from \"zustand\";\nimport { subscribeWithSelector } from \"zustand/middleware\";\nimport { useChallenges } from \"./useChallenges\";\n\nexport type GameMode = \"menu\" | \"singleplayer\" | \"multiplayer\";\nexport type GamePhase = \"playing\" | \"won\" | \"lost\";\nexport type GameStatus = \"waiting\" | \"playing\" | \"finished\";\n\ninterface Attempt {\n  guess: number[];\n  correctCount: number;\n  correctPositionCount: number;\n}\n\ntype ChallengeType = \"memory\" | \"direction\" | \"raindrops\" | \"pattern\" | \"random\";\ntype CardTypeId = \"revealNumber\" | \"burnNumber\" | \"revealParity\" | \"freeze\" | \"shield\";\n\ninterface GameSettings {\n  numDigits: number;\n  maxAttempts: number;\n  cardsEnabled?: boolean;\n  selectedChallenge?: ChallengeType;\n  allowedCards?: CardTypeId[];\n}\n\ninterface SingleplayerState {\n  secretCode: number[];\n  currentGuess: number[];\n  attempts: Attempt[];\n  phase: GamePhase;\n  startTime: number;\n  endTime: number | null;\n  settings: GameSettings;\n}\n\ninterface PlayerResult {\n  playerId: string;\n  playerName: string;\n  attempts: number;\n  duration: number;\n  attemptsDetails: Attempt[];\n  rank?: number;\n}\n\ninterface RematchVote {\n  playerId: string;\n  accepted: boolean;\n}\n\ninterface RoundHistoryEntry {\n  roundNumber: number;\n  sharedSecret: number[];\n  winners: PlayerResult[];\n  losers: PlayerResult[];\n  timestamp: number;\n}\n\ninterface MultiplayerState {\n  roomId: string;\n  playerId: string;\n  playerName: string;\n  hostId: string;\n  isHost: boolean;\n  players: { id: string; name: string }[];\n  gameStatus: GameStatus;\n  sharedSecret: number[];\n  currentGuess: number[];\n  attempts: Attempt[];\n  phase: GamePhase;\n  startTime: number;\n  endTime: number | null;\n  winners: PlayerResult[];\n  losers: PlayerResult[];\n  stillPlaying: PlayerResult[];\n  showResults: boolean;\n  showPreGameChallenge: boolean;\n  challengeWinner: string | null;\n  rematchState: {\n    requested: boolean;\n    countdown: number | null;\n    votes: RematchVote[];\n  };\n  roundHistory: RoundHistoryEntry[];\n  settings: GameSettings & { cardsEnabled: boolean; selectedChallenge: ChallengeType; allowedCards: CardTypeId[] };\n}\n\ninterface NumberGameState {\n  mode: GameMode;\n  isConnecting: boolean;\n  connectionError: string | null;\n  singleplayer: SingleplayerState;\n  multiplayer: MultiplayerState;\n\n  // Mode actions\n  setMode: (mode: GameMode) => void;\n  setIsConnecting: (isConnecting: boolean) => void;\n  setConnectionError: (error: string | null) => void;\n\n  // Singleplayer actions\n  startSingleplayer: (settings: GameSettings) => void;\n  addDigitToGuess: (digit: number) => void;\n  deleteLastDigit: () => void;\n  submitGuess: () => void;\n  restartSingleplayer: () => void;\n  setSingleplayerSettings: (settings: GameSettings) => void;\n\n  // Multiplayer actions\n  setRoomId: (roomId: string) => void;\n  setPlayerId: (playerId: string) => void;\n  setPlayerName: (name: string) => void;\n  setHostId: (hostId: string) => void;\n  setIsHost: (isHost: boolean) => void;\n  setPlayers: (players: { id: string; name: string }[]) => void;\n  setGameStatus: (status: GameStatus) => void;\n  setSharedSecret: (secret: number[]) => void;\n  addMultiplayerDigit: (digit: number) => void;\n  deleteMultiplayerDigit: () => void;\n  submitMultiplayerGuess: () => void;\n  addMultiplayerAttempt: (attempt: Attempt) => void;\n  setMultiplayerPhase: (phase: GamePhase) => void;\n  setMultiplayerStartTime: () => void;\n  setMultiplayerStartTimeFromServer: (timestamp: number) => void;\n  setMultiplayerEndTime: () => void;\n  setGameResults: (winners: PlayerResult[], losers: PlayerResult[], sharedSecret: number[]) => void;\n  setShowResults: (show: boolean) => void;\n  setRematchRequested: (requested: boolean, countdown: number | null) => void;\n  setRematchVotes: (votes: RematchVote[]) => void;\n  setRematchCountdown: (countdown: number | null) => void;\n  resetMultiplayer: () => void;\n  resetMultiplayerGame: () => void;\n  setMultiplayerSettings: (settings: GameSettings) => void;\n  updateStillPlayingAttempt: (playerId: string, attempt: Attempt) => void;\n  setShowPreGameChallenge: (show: boolean) => void;\n  setChallengeWinner: (playerId: string | null) => void;\n  saveRoundToHistory: () => void;\n  clearRoundHistory: () => void;\n}\n\nconst generateSecretCode = (numDigits: number = 4): number[] => {\n  return Array.from({ length: numDigits }, () => Math.floor(Math.random() * 10));\n};\n\nconst checkGuess = (secret: number[], guess: number[]): { correctCount: number; correctPositionCount: number } => {\n  let correctCount = 0;\n  let correctPositionCount = 0;\n\n  const secretCopy = [...secret];\n  const guessCopy = [...guess];\n  const length = Math.min(secret.length, guess.length);\n\n  // First pass: check correct positions\n  for (let i = 0; i < length; i++) {\n    if (guessCopy[i] === secretCopy[i]) {\n      correctPositionCount++;\n      secretCopy[i] = -1;\n      guessCopy[i] = -2;\n    }\n  }\n\n  // Second pass: check correct digits in wrong positions\n  for (let i = 0; i < length; i++) {\n    if (guessCopy[i] !== -2) {\n      const index = secretCopy.indexOf(guessCopy[i]);\n      if (index !== -1) {\n        correctCount++;\n        secretCopy[index] = -1;\n      }\n    }\n  }\n\n  correctCount += correctPositionCount;\n\n  return { correctCount, correctPositionCount };\n};\n\nexport const useNumberGame = create<NumberGameState>()(\n  subscribeWithSelector((set, get) => ({\n    mode: \"menu\",\n    isConnecting: false,\n    connectionError: null,\n    singleplayer: {\n      secretCode: [],\n      currentGuess: [],\n      attempts: [],\n      phase: \"playing\",\n      startTime: 0,\n      endTime: null,\n      settings: { numDigits: 4, maxAttempts: 20 },\n    },\n    multiplayer: {\n      roomId: \"\",\n      playerId: \"\",\n      playerName: \"\",\n      hostId: \"\",\n      isHost: false,\n      players: [],\n      gameStatus: \"waiting\",\n      sharedSecret: [],\n      currentGuess: [],\n      attempts: [],\n      phase: \"playing\",\n      startTime: 0,\n      endTime: null,\n      winners: [],\n      losers: [],\n      stillPlaying: [],\n      showResults: false,\n      showPreGameChallenge: false,\n      challengeWinner: null,\n      rematchState: {\n        requested: false,\n        countdown: null,\n        votes: [],\n      },\n      roundHistory: [],\n      settings: { numDigits: 4, maxAttempts: 20, cardsEnabled: false, selectedChallenge: \"random\", allowedCards: [\"revealNumber\", \"burnNumber\", \"revealParity\", \"freeze\", \"shield\"] },\n    },\n\n    setMode: (mode) => set({ mode }),\n    setIsConnecting: (isConnecting) => set({ isConnecting }),\n    setConnectionError: (error) => set({ connectionError: error }),\n\n    startSingleplayer: (settings: GameSettings = { numDigits: 4, maxAttempts: 20 }) => {\n      const secretCode = generateSecretCode(settings.numDigits);\n      console.log(\"Secret code generated:\", secretCode);\n      set({\n        mode: \"singleplayer\",\n        singleplayer: {\n          secretCode,\n          currentGuess: [],\n          attempts: [],\n          phase: \"playing\",\n          startTime: Date.now(),\n          endTime: null,\n          settings,\n        },\n      });\n    },\n\n    addDigitToGuess: (digit) => {\n      const { singleplayer } = get();\n      if (singleplayer.currentGuess.length < singleplayer.settings.numDigits && singleplayer.phase === \"playing\" && singleplayer.attempts.length < singleplayer.settings.maxAttempts) {\n        set({\n          singleplayer: {\n            ...singleplayer,\n            currentGuess: [...singleplayer.currentGuess, digit],\n          },\n        });\n      }\n    },\n\n    deleteLastDigit: () => {\n      const { singleplayer } = get();\n      if (singleplayer.currentGuess.length > 0 && singleplayer.phase === \"playing\") {\n        set({\n          singleplayer: {\n            ...singleplayer,\n            currentGuess: singleplayer.currentGuess.slice(0, -1),\n          },\n        });\n      }\n    },\n\n    submitGuess: () => {\n      const { singleplayer } = get();\n      if (singleplayer.currentGuess.length === singleplayer.settings.numDigits && singleplayer.phase === \"playing\") {\n        const { correctCount, correctPositionCount } = checkGuess(\n          singleplayer.secretCode,\n          singleplayer.currentGuess\n        );\n\n        const newAttempt: Attempt = {\n          guess: singleplayer.currentGuess,\n          correctCount,\n          correctPositionCount,\n        };\n\n        const won = correctPositionCount === singleplayer.settings.numDigits;\n        const newAttempts = [...singleplayer.attempts, newAttempt];\n        const lost = newAttempts.length >= singleplayer.settings.maxAttempts && !won;\n\n        set({\n          singleplayer: {\n            ...singleplayer,\n            attempts: newAttempts,\n            currentGuess: [],\n            phase: won ? \"won\" : (lost ? \"lost\" : \"playing\"),\n            endTime: (won || lost) ? Date.now() : null,\n          },\n        });\n      }\n    },\n\n    restartSingleplayer: () => {\n      const { singleplayer } = get();\n      const challengesStore = useChallenges.getState();\n      if (challengesStore.resetChallengesHub) {\n        challengesStore.resetChallengesHub();\n      }\n      const newSecretCode = generateSecretCode(singleplayer.settings.numDigits);\n      console.log(\"Secret code generated:\", newSecretCode);\n      set({\n        singleplayer: {\n          secretCode: newSecretCode,\n          currentGuess: [],\n          attempts: [],\n          phase: \"playing\",\n          startTime: Date.now(),\n          endTime: null,\n          settings: singleplayer.settings,\n        },\n      });\n    },\n\n    setSingleplayerSettings: (settings) => set((state) => ({ singleplayer: { ...state.singleplayer, settings } })),\n\n    setRoomId: (roomId) => set((state) => ({ multiplayer: { ...state.multiplayer, roomId } })),\n    setPlayerId: (playerId) => set((state) => ({ multiplayer: { ...state.multiplayer, playerId } })),\n    setPlayerName: (playerName) => set((state) => ({ multiplayer: { ...state.multiplayer, playerName } })),\n    setHostId: (hostId) => set((state) => ({ \n      multiplayer: { \n        ...state.multiplayer, \n        hostId,\n        isHost: hostId === state.multiplayer.playerId,\n      } \n    })),\n    setIsHost: (isHost) => set((state) => ({ multiplayer: { ...state.multiplayer, isHost } })),\n    setPlayers: (players) => set((state) => ({ multiplayer: { ...state.multiplayer, players } })),\n    setGameStatus: (gameStatus) => set((state) => ({ multiplayer: { ...state.multiplayer, gameStatus } })),\n    setSharedSecret: (sharedSecret) => set((state) => ({ multiplayer: { ...state.multiplayer, sharedSecret } })),\n\n    addMultiplayerDigit: (digit) => {\n      const { multiplayer } = get();\n      if (multiplayer.currentGuess.length < multiplayer.settings.numDigits && \n          multiplayer.attempts.length < multiplayer.settings.maxAttempts &&\n          multiplayer.phase === \"playing\") {\n        set({\n          multiplayer: {\n            ...multiplayer,\n            currentGuess: [...multiplayer.currentGuess, digit],\n          },\n        });\n      }\n    },\n\n    deleteMultiplayerDigit: () => {\n      const { multiplayer } = get();\n      if (multiplayer.currentGuess.length > 0) {\n        set({\n          multiplayer: {\n            ...multiplayer,\n            currentGuess: multiplayer.currentGuess.slice(0, -1),\n          },\n        });\n      }\n    },\n\n    submitMultiplayerGuess: () => {\n      const { multiplayer } = get();\n      if (multiplayer.currentGuess.length === multiplayer.settings.numDigits) {\n        set({\n          multiplayer: {\n            ...multiplayer,\n            currentGuess: [],\n          },\n        });\n      }\n    },\n\n    addMultiplayerAttempt: (attempt) => {\n      const { multiplayer } = get();\n      set({\n        multiplayer: {\n          ...multiplayer,\n          attempts: [...multiplayer.attempts, attempt],\n        },\n      });\n    },\n\n    setMultiplayerPhase: (phase) => set((state) => ({ multiplayer: { ...state.multiplayer, phase } })),\n    setMultiplayerStartTime: () => set((state) => ({ multiplayer: { ...state.multiplayer, startTime: Date.now() } })),\n    setMultiplayerStartTimeFromServer: (timestamp: number) => set((state) => ({ multiplayer: { ...state.multiplayer, startTime: timestamp } })),\n    setMultiplayerEndTime: () => set((state) => ({ multiplayer: { ...state.multiplayer, endTime: Date.now() } })),\n    \n    setGameResults: (winners, losers, sharedSecret) => set((state) => ({ \n      multiplayer: { \n        ...state.multiplayer, \n        winners, \n        losers,\n        sharedSecret,\n        showResults: true,\n        gameStatus: \"finished\",\n      } \n    })),\n    \n    setShowResults: (showResults) => set((state) => ({ multiplayer: { ...state.multiplayer, showResults } })),\n    \n    setRematchRequested: (requested, countdown) => set((state) => ({ \n      multiplayer: { \n        ...state.multiplayer, \n        rematchState: {\n          ...state.multiplayer.rematchState,\n          requested,\n          countdown,\n        }\n      } \n    })),\n    \n    setRematchVotes: (votes) => set((state) => ({ \n      multiplayer: { \n        ...state.multiplayer, \n        rematchState: {\n          ...state.multiplayer.rematchState,\n          votes,\n        }\n      } \n    })),\n    \n    setRematchCountdown: (countdown) => set((state) => ({ \n      multiplayer: { \n        ...state.multiplayer, \n        rematchState: {\n          ...state.multiplayer.rematchState,\n          countdown,\n        }\n      } \n    })),\n\n    resetMultiplayer: () =>\n      set((state) => ({\n        multiplayer: {\n          ...state.multiplayer,\n          roomId: \"\",\n          playerId: \"\",\n          hostId: \"\",\n          isHost: false,\n          players: [],\n          gameStatus: \"waiting\",\n          sharedSecret: [],\n          currentGuess: [],\n          attempts: [],\n          phase: \"playing\",\n          startTime: 0,\n          endTime: null,\n          winners: [],\n          losers: [],\n          stillPlaying: [],\n          showResults: false,\n          showPreGameChallenge: false,\n          challengeWinner: null,\n          rematchState: {\n            requested: false,\n            countdown: null,\n            votes: [],\n          },\n          roundHistory: [],\n        },\n      })),\n    \n    resetMultiplayerGame: () =>\n      set((state) => ({\n        multiplayer: {\n          ...state.multiplayer,\n          gameStatus: \"waiting\",\n          sharedSecret: [],\n          currentGuess: [],\n          attempts: [],\n          phase: \"playing\",\n          startTime: 0,\n          endTime: null,\n          winners: [],\n          losers: [],\n          stillPlaying: [],\n          showResults: false,\n          showPreGameChallenge: false,\n          challengeWinner: null,\n          rematchState: {\n            requested: false,\n            countdown: null,\n            votes: [],\n          },\n        },\n      })),\n\n    setMultiplayerSettings: (settings) => set((state) => ({ \n      multiplayer: { \n        ...state.multiplayer, \n        settings: { \n          ...state.multiplayer.settings, \n          ...settings,\n          cardsEnabled: settings.cardsEnabled ?? state.multiplayer.settings.cardsEnabled ?? false,\n          selectedChallenge: settings.selectedChallenge ?? state.multiplayer.settings.selectedChallenge ?? \"random\",\n          allowedCards: settings.allowedCards ?? state.multiplayer.settings.allowedCards ?? [\"revealNumber\", \"burnNumber\", \"revealParity\", \"freeze\", \"shield\"]\n        } \n      } \n    })),\n\n    updateStillPlayingAttempt: (playerId, attempt) => {\n      const { multiplayer } = get();\n      const updatedStillPlaying = multiplayer.stillPlaying.map(player => {\n        if (player.playerId === playerId) {\n          return {\n            ...player,\n            attempts: player.attempts + 1,\n            attemptsDetails: [...(player.attemptsDetails || []), attempt],\n          };\n        }\n        return player;\n      });\n      set({\n        multiplayer: {\n          ...multiplayer,\n          stillPlaying: updatedStillPlaying,\n        },\n      });\n    },\n\n    setShowPreGameChallenge: (show) => set((state) => ({\n      multiplayer: {\n        ...state.multiplayer,\n        showPreGameChallenge: show,\n      },\n    })),\n\n    setChallengeWinner: (playerId) => set((state) => ({\n      multiplayer: {\n        ...state.multiplayer,\n        challengeWinner: playerId,\n      },\n    })),\n\n    saveRoundToHistory: () => set((state) => {\n      const { multiplayer } = state;\n      // Only save if there are results\n      if (multiplayer.winners.length === 0 && multiplayer.losers.length === 0) {\n        return state;\n      }\n      \n      const newRound: RoundHistoryEntry = {\n        roundNumber: multiplayer.roundHistory.length + 1,\n        sharedSecret: [...multiplayer.sharedSecret],\n        winners: [...multiplayer.winners],\n        losers: [...multiplayer.losers],\n        timestamp: Date.now(),\n      };\n      \n      return {\n        multiplayer: {\n          ...multiplayer,\n          roundHistory: [...multiplayer.roundHistory, newRound],\n        },\n      };\n    }),\n\n    clearRoundHistory: () => set((state) => ({\n      multiplayer: {\n        ...state.multiplayer,\n        roundHistory: [],\n      },\n    })),\n  }))\n);\n","path":null,"size_bytes":17038,"size_tokens":null},"client/src/lib/websocket.ts":{"content":"import { useNumberGame } from \"./stores/useNumberGame\";\nimport { useCards } from \"./stores/useCards\";\nimport { useChallenges } from \"./stores/useChallenges\";\nimport { toast } from \"sonner\";\n\nlet socket: WebSocket | null = null;\nlet reconnectAttempts = 0;\nlet reconnectTimeout: NodeJS.Timeout | null = null;\nlet isManualDisconnect = false;\nconst MAX_RECONNECT_ATTEMPTS = 5;\nconst RECONNECT_DELAY = 2000;\n\nconst saveSessionToStorage = (playerName: string, playerId: string, roomId: string) => {\n  const store = useNumberGame.getState();\n  const isInGame = store.multiplayer.gameStatus === \"playing\";\n  sessionStorage.setItem(\"multiplayerSession\", JSON.stringify({\n    playerName,\n    playerId,\n    roomId,\n    timestamp: Date.now(),\n    gameState: isInGame ? {\n      gameStatus: store.multiplayer.gameStatus,\n      sharedSecret: store.multiplayer.sharedSecret,\n      attempts: store.multiplayer.attempts,\n      startTime: store.multiplayer.startTime,\n      settings: store.multiplayer.settings,\n    } : null,\n  }));\n  localStorage.setItem(\"lastPlayerName\", playerName);\n  // Save room for persistent reconnection (for 24 hours)\n  localStorage.setItem(\"lastRoomSession\", JSON.stringify({\n    playerName,\n    playerId,\n    roomId,\n    timestamp: Date.now(),\n    startTime: store.multiplayer.startTime,\n  }));\n};\n\nexport const getLastPlayerName = () => {\n  return localStorage.getItem(\"lastPlayerName\") || \"\";\n};\n\nconst getSessionFromStorage = () => {\n  const session = sessionStorage.getItem(\"multiplayerSession\");\n  if (session) {\n    try {\n      const parsed = JSON.parse(session);\n      // Only consider sessions less than 30 seconds old as valid for reconnection\n      if (Date.now() - parsed.timestamp < 30 * 1000) {\n        return parsed;\n      } else {\n        sessionStorage.removeItem(\"multiplayerSession\");\n        return null;\n      }\n    } catch (e) {\n      return null;\n    }\n  }\n  return null;\n};\n\nconst attemptReconnect = () => {\n  const session = getSessionFromStorage();\n  if (!session || isManualDisconnect) {\n    console.log(\"No session to reconnect or manual disconnect\");\n    return;\n  }\n\n  if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n    console.log(\"Max reconnect attempts reached\");\n    toast.error(\"ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.\", {\n      duration: 5000,\n    });\n    useNumberGame.getState().setConnectionError(\"ÙØ´Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„\");\n    clearSession();\n    return;\n  }\n\n  reconnectAttempts++;\n  console.log(`Reconnect attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS}`);\n  \n  toast.loading(`Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„... (${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS})`, {\n    id: \"reconnect-toast\",\n    duration: RECONNECT_DELAY,\n  });\n\n  reconnectWithRetry(session.playerName, session.playerId, session.roomId);\n};\n\nexport const connectWebSocket = (playerName: string, roomId?: string) => {\n  const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n  const wsUrl = `${protocol}//${window.location.host}/game`;\n\n  isManualDisconnect = false;\n  reconnectAttempts = 0;\n  \n  if (reconnectTimeout) {\n    clearTimeout(reconnectTimeout);\n    reconnectTimeout = null;\n  }\n\n  socket = new WebSocket(wsUrl);\n\n  socket.onopen = () => {\n    console.log(\"WebSocket connected\");\n    reconnectAttempts = 0;\n    toast.dismiss(\"reconnect-toast\");\n    \n    if (roomId) {\n      send({ type: \"join_room\", roomId, playerName });\n    } else {\n      send({ type: \"create_room\", playerName });\n    }\n  };\n\n  socket.onmessage = (event) => {\n    const message = JSON.parse(event.data);\n    handleMessage(message);\n  };\n\n  socket.onclose = (event) => {\n    console.log(\"WebSocket disconnected\", event.code, event.reason);\n    \n    if (!isManualDisconnect && reconnectAttempts < MAX_RECONNECT_ATTEMPTS) {\n      const session = getSessionFromStorage();\n      if (session) {\n        console.log(\"Connection lost, attempting reconnect in\", RECONNECT_DELAY, \"ms\");\n        reconnectTimeout = setTimeout(attemptReconnect, RECONNECT_DELAY);\n      }\n    }\n  };\n\n  socket.onerror = (error) => {\n    console.error(\"WebSocket error:\", error);\n  };\n\n  return socket;\n};\n\nexport const send = (message: any) => {\n  if (socket && socket.readyState === WebSocket.OPEN) {\n    socket.send(JSON.stringify(message));\n  }\n};\n\nexport const clearSession = () => {\n  sessionStorage.removeItem(\"multiplayerSession\");\n};\n\nexport const clearPersistentRoom = () => {\n  localStorage.removeItem(\"lastRoomSession\");\n};\n\nexport const getLastRoomSession = () => {\n  const session = localStorage.getItem(\"lastRoomSession\");\n  if (session) {\n    try {\n      const parsed = JSON.parse(session);\n      // Valid for 24 hours\n      if (Date.now() - parsed.timestamp < 24 * 60 * 60 * 1000) {\n        return parsed;\n      } else {\n        localStorage.removeItem(\"lastRoomSession\");\n        return null;\n      }\n    } catch (e) {\n      return null;\n    }\n  }\n  return null;\n};\n\nexport const disconnect = () => {\n  isManualDisconnect = true;\n  if (reconnectTimeout) {\n    clearTimeout(reconnectTimeout);\n    reconnectTimeout = null;\n  }\n  if (socket) {\n    socket.close();\n    socket = null;\n  }\n  clearSession();\n  toast.dismiss(\"reconnect-toast\");\n};\n\nexport const reconnectToSession = () => {\n  const session = getSessionFromStorage();\n  if (session && session.playerId && session.roomId) {\n    return session;\n  }\n  return null;\n};\n\nexport const reconnectWithRetry = (playerName: string, playerId: string, roomId: string) => {\n  const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n  const wsUrl = `${protocol}//${window.location.host}/game`;\n\n  socket = new WebSocket(wsUrl);\n\n  socket.onopen = () => {\n    console.log(\"WebSocket connected - attempting reconnect\");\n    reconnectAttempts = 0;\n    toast.dismiss(\"reconnect-toast\");\n    toast.success(\"ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­!\", {\n      duration: 3000,\n    });\n    \n    send({ \n      type: \"reconnect\", \n      playerId, \n      playerName,\n      roomId \n    });\n  };\n\n  socket.onmessage = (event) => {\n    const message = JSON.parse(event.data);\n    handleMessage(message);\n  };\n\n  socket.onclose = (event) => {\n    console.log(\"WebSocket disconnected during reconnect\", event.code, event.reason);\n    \n    if (!isManualDisconnect && reconnectAttempts < MAX_RECONNECT_ATTEMPTS) {\n      const session = getSessionFromStorage();\n      if (session) {\n        console.log(\"Connection lost during reconnect, retrying in\", RECONNECT_DELAY, \"ms\");\n        reconnectTimeout = setTimeout(attemptReconnect, RECONNECT_DELAY);\n      }\n    }\n  };\n\n  socket.onerror = (error) => {\n    console.error(\"WebSocket error:\", error);\n  };\n\n  return socket;\n};\n\nconst handleMessage = (message: any) => {\n  const store = useNumberGame.getState();\n\n  console.log(\"Received message:\", message);\n\n  switch (message.type) {\n    case \"room_created\":\n      store.setRoomId(message.roomId);\n      store.setPlayerId(message.playerId);\n      if (message.hostId) {\n        store.setHostId(message.hostId);\n      }\n      if (message.players) {\n        store.setPlayers(message.players);\n      }\n      store.setIsConnecting(false);\n      saveSessionToStorage(store.multiplayer.playerName, message.playerId, message.roomId);\n      console.log(\"Room created:\", message.roomId, \"Host:\", message.hostId);\n      break;\n\n    case \"room_joined\":\n      store.setRoomId(message.roomId);\n      store.setPlayerId(message.playerId);\n      if (message.hostId) {\n        store.setHostId(message.hostId);\n      }\n      store.setPlayers(message.players);\n      store.setIsConnecting(false);\n      saveSessionToStorage(store.multiplayer.playerName, message.playerId, message.roomId);\n      console.log(\"Room joined:\", message.roomId, \"Host:\", message.hostId);\n      break;\n\n    case \"players_updated\":\n      store.setPlayers(message.players);\n      if (message.hostId) {\n        store.setHostId(message.hostId);\n      }\n      break;\n\n    case \"host_changed\":\n      store.setHostId(message.newHostId);\n      break;\n\n    case \"settings_updated\":\n      store.setMultiplayerSettings(message.settings);\n      // Update card settings for all players when host changes settings or joins room\n      if (message.settings.cardSettings) {\n        const cardsStore = useCards.getState();\n        cardsStore.setCardSettings(message.settings.cardSettings);\n        console.log(\"Card settings updated:\", message.settings.cardSettings);\n      }\n      break;\n\n    case \"game_started\": {\n      // Clear previous game data and start fresh\n      const cardsEnabled = message.settings?.cardsEnabled ?? store.multiplayer.settings.cardsEnabled;\n      const selectedChallenge = message.settings?.selectedChallenge ?? store.multiplayer.settings.selectedChallenge;\n      // Use server start time for synchronization (0 means waiting for challenges)\n      const serverGameStartTime = message.serverStartTime || (cardsEnabled ? 0 : Date.now());\n      \n      useNumberGame.setState((state) => ({\n        multiplayer: {\n          ...state.multiplayer,\n          gameStatus: \"playing\",\n          sharedSecret: message.sharedSecret,\n          phase: \"playing\",\n          startTime: serverGameStartTime,\n          endTime: null,\n          attempts: [],\n          currentGuess: [],\n          showResults: false,\n          showPreGameChallenge: cardsEnabled,\n          challengeWinner: null,\n          winners: [],\n          losers: [],\n          stillPlaying: [],\n          rematchState: {\n            requested: false,\n            countdown: null,\n            votes: [],\n          },\n          settings: message.settings ? {\n            ...state.multiplayer.settings,\n            ...message.settings,\n            cardsEnabled: cardsEnabled,\n            selectedChallenge: selectedChallenge\n          } : state.multiplayer.settings,\n        },\n      }));\n      \n      // Clear card award flag for new game\n      const cardAwardKeyToClear = `card_awarded_${store.multiplayer.roomId}_${store.multiplayer.playerId}`;\n      sessionStorage.removeItem(cardAwardKeyToClear);\n      \n      // Reset challenges state to prevent incorrect card awards from previous game\n      const challengesStore = useChallenges.getState();\n      challengesStore.resetChallengesHub();\n      console.log(\"Challenges state reset for new game\");\n      \n      // Initialize cards system if enabled\n      const cardsStore = useCards.getState();\n      \n      // Always clear revealed/burned and player cards for new game\n      cardsStore.clearRevealedAndBurned();\n      cardsStore.clearAllActiveEffects();\n      \n      // Clear existing player cards to prevent duplication\n      useCards.setState({ playerCards: [] });\n      \n      // Sync card settings from server for all players\n      if (message.settings?.cardSettings) {\n        cardsStore.setCardSettings(message.settings.cardSettings);\n      }\n      \n      if (cardsEnabled) {\n        cardsStore.enableCards();\n        cardsStore.initializePlayerCards(store.multiplayer.playerId);\n        console.log(\"Cards system initialized for player:\", store.multiplayer.playerId, \"Challenge:\", selectedChallenge);\n      } else {\n        cardsStore.resetCards();\n      }\n      \n      saveSessionToStorage(store.multiplayer.playerName, store.multiplayer.playerId, store.multiplayer.roomId);\n      console.log(\"Game started with shared secret, cardsEnabled:\", cardsEnabled, \"showPreGameChallenge:\", cardsEnabled, \"startTime:\", serverGameStartTime);\n      break;\n    }\n\n    case \"game_starting\": {\n      // All players completed challenges - use server timestamp for sync if provided\n      const gameStartTime = message.serverStartTime || Date.now();\n      useNumberGame.setState((state) => ({\n        multiplayer: {\n          ...state.multiplayer,\n          startTime: gameStartTime,\n        },\n      }));\n      console.log(\"All players completed challenges - game timer started, serverStartTime:\", gameStartTime);\n      toast.success(message.message || \"Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!\", {\n        duration: 3000,\n      });\n      break;\n    }\n\n    case \"room_rejoined\":\n      store.setRoomId(message.roomId);\n      store.setPlayerId(message.playerId);\n      store.setHostId(message.hostId);\n      store.setPlayers(message.players);\n      store.setIsConnecting(false);\n      console.log(\"Successfully reconnected to room\", message.roomId);\n      break;\n\n    case \"game_state\":\n      store.setGameStatus(message.status);\n      store.setSharedSecret(message.sharedSecret);\n      // Restore settings\n      if (message.settings) {\n        store.setMultiplayerSettings(message.settings);\n      }\n      // Restore startTime from server if provided\n      if (message.gameStartTime && message.gameStartTime > 0) {\n        store.setMultiplayerStartTimeFromServer(message.gameStartTime);\n        console.log(\"Restored game startTime from server:\", message.gameStartTime, \"Date:\", new Date(message.gameStartTime).toLocaleTimeString());\n      }\n      console.log(\"Received game state after reconnect\");\n      break;\n\n    case \"player_game_state\":\n      // Restore player's game data after reconnect\n      message.attempts.forEach((attempt: any) => {\n        store.addMultiplayerAttempt(attempt);\n      });\n      if (message.finished) {\n        if (message.won) {\n          store.setMultiplayerPhase(\"won\");\n        } else {\n          store.setMultiplayerPhase(\"lost\");\n        }\n      }\n      console.log(\"Restored player game state\");\n      break;\n\n    case \"player_disconnected\":\n      toast.info(`Ø§Ù„Ù„Ø§Ø¹Ø¨ ${message.playerName} Ø§Ù†Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„Ù‡`, {\n        duration: 5000,\n        icon: \"ğŸ“¡\",\n      });\n      break;\n\n    case \"player_reconnected\":\n      toast.success(`Ø§Ù„Ù„Ø§Ø¹Ø¨ ${message.playerName} Ø¹Ø§Ø¯ Ù„Ù„Ø¹Ø¨Ø© âœ…`, {\n        duration: 5000,\n      });\n      break;\n\n    case \"player_timeout\":\n      toast.warning(`Ø§Ù„Ù„Ø§Ø¹Ø¨ ${message.playerName} Ø§Ù†Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„Ù‡ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ (Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© 5 Ø¯Ù‚Ø§Ø¦Ù‚)`, {\n        duration: 7000,\n        icon: \"â±ï¸\",\n      });\n      break;\n\n    case \"guess_result\":\n      const attempt = {\n        guess: message.guess,\n        correctCount: message.correctCount,\n        correctPositionCount: message.correctPositionCount,\n      };\n      store.addMultiplayerAttempt(attempt);\n      \n      if (message.won) {\n        const wasAlreadyWon = store.multiplayer.phase === \"won\";\n        store.setMultiplayerPhase(\"won\");\n        store.setMultiplayerEndTime();\n        \n        // Award ONE card to the winner - only if not already won and card not already awarded in this game\n        const cardAwardKey = `card_awarded_${store.multiplayer.roomId}_${store.multiplayer.playerId}`;\n        const alreadyAwarded = sessionStorage.getItem(cardAwardKey) === \"true\";\n        \n        if (!wasAlreadyWon && !alreadyAwarded && store.multiplayer.settings.cardsEnabled) {\n          const cardsStore = useCards.getState();\n          const allowedCards = store.multiplayer.settings.allowedCards;\n          const awardedCard = cardsStore.awardWinnerCard(store.multiplayer.playerId, allowedCards);\n          if (awardedCard) {\n            sessionStorage.setItem(cardAwardKey, \"true\");\n            toast.success(`ğŸ´ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø© ${awardedCard.nameAr}!`, {\n              duration: 5000,\n            });\n          }\n        }\n      }\n      break;\n\n    case \"max_attempts_reached\":\n      store.setMultiplayerPhase(\"lost\");\n      store.setMultiplayerEndTime();\n      console.log(\"Max attempts reached - game lost, waiting for final results...\");\n      break;\n\n    case \"player_attempt\":\n      // Another player made an attempt - update spectators\n      console.log(`Player ${message.playerName} made attempt #${message.attemptNumber}${message.won ? ' and won!' : ''}`);\n      // Update the still playing player's attempts\n      if (message.guess && message.correctCount !== undefined && message.correctPositionCount !== undefined) {\n        const attempt = {\n          guess: message.guess,\n          correctCount: message.correctCount,\n          correctPositionCount: message.correctPositionCount,\n        };\n        store.updateStillPlayingAttempt(message.playerId, attempt);\n      }\n      break;\n\n    case \"player_quit\":\n      console.log(`Player ${message.playerName} quit the game`);\n      toast.info(`Ø§Ù„Ù„Ø§Ø¹Ø¨ ${message.playerName} Ø§Ù†Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©`, {\n        duration: 5000,\n        icon: \"ğŸšª\",\n      });\n      break;\n\n    case \"game_results\":\n      // Show results to finished players only\n      const currentState = useNumberGame.getState();\n      store.setGameResults(message.winners, message.losers, message.sharedSecret);\n      // Update still playing list\n      useNumberGame.setState({\n        multiplayer: {\n          ...currentState.multiplayer,\n          winners: message.winners,\n          losers: message.losers,\n          stillPlaying: message.stillPlaying || [],\n          sharedSecret: message.sharedSecret,\n          showResults: true,\n          gameStatus: \"finished\",\n        },\n      });\n      console.log(\"Game finished - results received\", { winners: message.winners.length, losers: message.losers.length, stillPlaying: message.stillPlaying?.length });\n      \n      // Clear session when results are shown to prevent reconnecting to finished game\n      clearSession();\n      \n      if (message.reason === \"time_expired\") {\n        toast.info(\"Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ğŸ•\", {\n          duration: 7000,\n        });\n      } else if (message.reason === \"all_finished\") {\n        toast.success(\"Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©! Ø£Ù†Ù‡Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙ‡Ù… âœ…\", {\n          duration: 7000,\n        });\n      } else if (message.reason === \"player_finished\") {\n        // Check if current player won or lost\n        const playerId = useNumberGame.getState().multiplayer.playerId;\n        const isWinner = message.winners.some((w: any) => w.playerId === playerId);\n        \n        if (isWinner) {\n          toast.success(\"ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ğŸ‰ Ù„Ù‚Ø¯ ÙØ²Øª! Ø¬Ø§Ø±ÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...\", {\n            duration: 5000,\n          });\n        } else {\n          toast.info(\"Ø§Ù†ØªÙ‡Øª Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ. Ø¬Ø§Ø±ÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠØ©...\", {\n            duration: 5000,\n          });\n        }\n      }\n      \n      // Save round to history when game is fully finished (all players finished or time expired)\n      if (message.reason === \"time_expired\" || message.reason === \"all_finished\") {\n        store.saveRoundToHistory();\n        console.log(\"Round saved to history\");\n      }\n      break;\n\n    case \"player_details\":\n      // Could store this in a temporary state for showing details modal\n      console.log(\"Player details received:\", message);\n      break;\n\n    case \"rematch_requested\":\n      store.setRematchRequested(true, message.countdown);\n      if (message.votes) {\n        store.setRematchVotes(message.votes);\n      }\n      if (message.requestedBy) {\n        toast.info(`${message.requestedBy} Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©! ğŸ”„`, {\n          duration: 5000,\n        });\n      }\n      break;\n\n    case \"rematch_countdown\":\n      store.setRematchCountdown(message.countdown);\n      store.setRematchVotes(message.votes);\n      break;\n\n    case \"rematch_vote_update\":\n      store.setRematchVotes(message.votes);\n      break;\n\n    case \"rematch_starting\":\n      // Round history is saved in game_results handler when game fully finishes\n      store.resetMultiplayerGame();\n      store.setPlayers(message.players);\n      \n      // Clear card award flag for new game\n      const cardAwardKeyForRematch = `card_awarded_${store.multiplayer.roomId}_${store.multiplayer.playerId}`;\n      sessionStorage.removeItem(cardAwardKeyForRematch);\n      \n      // Reset cards system for rematch - ALWAYS clear ALL state regardless of cardsEnabled\n      const cardsStoreRematch = useCards.getState();\n      const preservedCardSettings = { ...cardsStoreRematch.cardSettings };\n      \n      // Clear all player effects first\n      cardsStoreRematch.playerCards.forEach(player => {\n        cardsStoreRematch.clearAllActiveEffects(player.playerId);\n      });\n      \n      // Full reset of all card state - always reset revealedDigits, burnedNumbers, and playerCards\n      useCards.setState({\n        cardsEnabled: false,\n        playerCards: [],\n        revealedDigits: [],\n        burnedNumbers: [],\n        cardSettings: preservedCardSettings,\n      });\n      \n      // Also call explicit clear methods for any additional cleanup\n      cardsStoreRematch.clearRevealedAndBurned();\n      \n      // Reset challenges state to prevent incorrect card awards\n      const challengesStoreRematch = useChallenges.getState();\n      challengesStoreRematch.resetChallengesHub();\n      \n      console.log(\"Rematch starting - game, cards, challenges fully reset (settings preserved)\");\n      break;\n\n    case \"card_used\": {\n      const cardsStore = useCards.getState();\n      const currentPlayerId = store.multiplayer.playerId;\n      const currentCardSettings = cardsStore.cardSettings;\n      \n      console.log(`[Cards WS] Card used: ${message.cardType} from ${message.fromPlayerName} to ${message.targetPlayerName || \"self\"}`);\n      \n      // Handle revealNumber card - permanent effect, not expiring\n      if (message.cardType === \"revealNumber\" && message.fromPlayerId === currentPlayerId) {\n        // Only add to revealedDigits if this is my own card and effectValue has position/digit\n        if (message.effectValue && typeof message.effectValue === \"object\") {\n          const { position, digit } = message.effectValue as { position: number; digit: number };\n          if (position !== undefined && digit !== undefined) {\n            cardsStore.addRevealedDigit(position, digit);\n            toast.success(`ØªÙ… ÙƒØ´Ù Ø§Ù„Ø±Ù‚Ù… ${digit} ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø© ${position + 1}! ğŸ‘ï¸`, { duration: 3000 });\n          }\n        }\n        break;\n      }\n      \n      // Determine who receives the effect\n      const isAttackCard = [\"freeze\"].includes(message.cardType);\n      const effectRecipientId = isAttackCard && message.targetPlayerId\n        ? message.targetPlayerId\n        : message.fromPlayerId;\n      \n      // Initialize the recipient if not exists\n      cardsStore.initializePlayerCards(effectRecipientId);\n      \n      // Apply the effect (for cards that have duration like freeze, shield)\n      // Use the correct duration from card settings\n      if ([\"freeze\", \"shield\"].includes(message.cardType)) {\n        // For shield cards used by the current player, the effect is already added locally\n        // Skip adding it again from websocket to prevent duplicate notifications\n        if (message.cardType === \"shield\" && message.fromPlayerId === currentPlayerId) {\n          break;\n        }\n        \n        let effectDuration = message.effectDuration || 30000;\n        \n        // Use card settings for freeze duration\n        if (message.cardType === \"freeze\") {\n          effectDuration = (currentCardSettings.freezeDuration || 30) * 1000;\n        } else if (message.cardType === \"shield\") {\n          effectDuration = (currentCardSettings.shieldDuration || 120) * 1000;\n        }\n        \n        const effect = {\n          cardType: message.cardType,\n          targetPlayerId: message.targetPlayerId,\n          sourcePlayerId: message.fromPlayerId,\n          sourcePlayerName: message.fromPlayerName,\n          expiresAt: Date.now() + effectDuration,\n          value: message.effectValue,\n        };\n        \n        cardsStore.addActiveEffect(effectRecipientId, effect);\n      }\n      \n      // Show notification based on who used the card\n      if (message.fromPlayerId === currentPlayerId) {\n        // I used the card\n        if (message.targetPlayerId && message.targetPlayerName) {\n          if (message.cardType === \"freeze\") {\n            const freezeSecs = currentCardSettings.freezeDuration || 30;\n            toast.success(`ØªÙ… ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ø®ØµÙ… ${message.targetPlayerName} Ù„Ù…Ø¯Ø© ${freezeSecs} Ø«Ø§Ù†ÙŠØ©! â„ï¸`, { duration: 3000 });\n          } else {\n            toast.success(`Ø§Ø³ØªØ®Ø¯Ù…Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¶Ø¯ ${message.targetPlayerName}! ğŸ´`, { duration: 3000 });\n          }\n        }\n      } else if (message.targetPlayerId === currentPlayerId) {\n        // Card was used against me\n        if (message.cardType === \"freeze\") {\n          const freezeSecs = currentCardSettings.freezeDuration || 30;\n          toast.error(`${message.fromPlayerName} Ø¬Ù…Ù‘Ø¯Ùƒ Ù„Ù…Ø¯Ø© ${freezeSecs} Ø«Ø§Ù†ÙŠØ©! â„ï¸`, { duration: 5000 });\n        }\n      }\n      break;\n    }\n\n    case \"rematch_cancelled\":\n      store.setRematchRequested(false, null);\n      console.log(\"Rematch cancelled:\", message.message);\n      break;\n\n    case \"kicked_from_room\":\n      console.log(\"Kicked from room:\", message.message);\n      store.resetMultiplayer();\n      store.setMode(\"menu\");\n      break;\n\n    case \"room_deleted\":\n      console.log(\"Room deleted:\", message.message);\n      toast.warning(message.message, { duration: 5000 });\n      clearSession();\n      store.resetMultiplayer();\n      store.setMode(\"menu\");\n      break;\n\n    case \"error\":\n      console.error(\"Server error:\", message.message);\n      \n      // Map server errors to user-friendly Arabic messages\n      let errorMessage = message.message;\n      if (message.message.includes(\"Room not found\")) {\n        errorMessage = \"âŒ Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ØºØ§Ø¯Ø±ÙˆØ§ Ø§Ù„Ù„Ø¹Ø¨Ø©\";\n      } else if (message.message.includes(\"full\")) {\n        errorMessage = \"âŒ Ø§Ù„ØºØ±ÙØ© Ù…Ù…ØªÙ„Ø¦Ø© - Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…\";\n      } else if (message.message.includes(\"session not found\")) {\n        errorMessage = \"âŒ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù†ØªÙ‡Øª - ÙŠØ±Ø¬Ù‰ Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\";\n      }\n      \n      store.setConnectionError(errorMessage);\n      store.setIsConnecting(false);\n      store.setRoomId(\"\");\n      store.setPlayerId(\"\");\n      clearSession();\n      break;\n\n    default:\n      console.log(\"Unknown message type:\", message.type);\n  }\n};\n","path":null,"size_bytes":26009,"size_tokens":null},"client/src/components/game/cards/CardSystem.tsx":{"content":"import { motion, AnimatePresence } from \"framer-motion\";\nimport { useState, useEffect } from \"react\";\nimport { useCards, Card, CardType, CardIconType, CARD_DEFINITIONS } from \"@/lib/stores/useCards\";\nimport { X, Target, Eye, XCircle, Hash, Snowflake, Shield, EyeOff, Sparkles } from \"lucide-react\";\n\nconst CARD_ICONS: Record<CardIconType, React.FC<{ className?: string }>> = {\n  eye: Eye,\n  \"x-circle\": XCircle,\n  hash: Hash,\n  snowflake: Snowflake,\n  shield: Shield,\n  \"eye-off\": EyeOff,\n};\n\nfunction CardIcon({ icon, className }: { icon: CardIconType; className?: string }) {\n  const IconComponent = CARD_ICONS[icon];\n  return <IconComponent className={className} />;\n}\n\ninterface CardComponentProps {\n  card: Card;\n  onUse: (cardId: string, targetPlayerId?: string) => void;\n  isSelectable: boolean;\n  otherPlayers?: { id: string; name: string }[];\n  disabled?: boolean;\n}\n\nfunction CardComponent({ card, onUse, isSelectable, otherPlayers = [], disabled }: CardComponentProps) {\n  const [showTargetSelector, setShowTargetSelector] = useState(false);\n  const [isFlipped, setIsFlipped] = useState(false);\n\n  const needsTarget = card.type === \"freeze\";\n\n  const handleClick = () => {\n    if (disabled || !isSelectable) return;\n\n    if (needsTarget && otherPlayers.length > 0) {\n      setShowTargetSelector(true);\n    } else {\n      onUse(card.id);\n    }\n  };\n\n  const handleTargetSelect = (targetId: string) => {\n    onUse(card.id, targetId);\n    setShowTargetSelector(false);\n  };\n\n  return (\n    <>\n      <motion.div\n        className={`relative cursor-pointer select-none ${disabled ? \"opacity-50 cursor-not-allowed\" : \"\"}`}\n        initial={{ scale: 0, rotateY: 180 }}\n        animate={{ scale: 1, rotateY: isFlipped ? 180 : 0 }}\n        exit={{ scale: 0, rotateY: -180 }}\n        whileHover={!disabled ? { scale: 1.05, y: -5 } : {}}\n        whileTap={!disabled ? { scale: 0.95 } : {}}\n        onClick={handleClick}\n        transition={{ type: \"spring\", stiffness: 300, damping: 20 }}\n      >\n        <div className={`w-20 h-28 sm:w-24 sm:h-32 rounded-xl bg-gradient-to-br ${card.color} shadow-lg border-2 border-white/30 overflow-hidden`}>\n          <div className=\"absolute inset-0 bg-gradient-to-t from-black/40 to-transparent\" />\n          \n          <div className=\"absolute inset-0 flex flex-col items-center justify-center p-2 text-white\">\n            <motion.div \n              className=\"mb-1\"\n              animate={{ \n                scale: [1, 1.2, 1],\n                rotate: [0, 5, -5, 0] \n              }}\n              transition={{ \n                duration: 2, \n                repeat: Infinity, \n                ease: \"easeInOut\" \n              }}\n            >\n              <CardIcon icon={card.icon} className=\"w-6 h-6 sm:w-8 sm:h-8\" />\n            </motion.div>\n            <span className=\"text-xs sm:text-sm font-bold text-center leading-tight drop-shadow-lg\">\n              {card.nameAr}\n            </span>\n          </div>\n\n          <motion.div\n            className=\"absolute inset-0 bg-white/20\"\n            initial={{ x: \"-100%\", opacity: 0 }}\n            whileHover={{ x: \"100%\", opacity: 1 }}\n            transition={{ duration: 0.5 }}\n          />\n        </div>\n\n        {needsTarget && (\n          <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center shadow-lg\">\n            <Target className=\"w-3 h-3 text-white\" />\n          </div>\n        )}\n      </motion.div>\n\n      <AnimatePresence>\n        {showTargetSelector && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"\n            onClick={() => setShowTargetSelector(false)}\n          >\n            <motion.div\n              initial={{ scale: 0.8, y: 20 }}\n              animate={{ scale: 1, y: 0 }}\n              exit={{ scale: 0.8, y: 20 }}\n              className=\"bg-white rounded-2xl p-6 shadow-2xl max-w-sm w-full mx-4\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-xl font-bold text-gray-800\">Ø§Ø®ØªØ± Ù‡Ø¯ÙÙƒ</h3>\n                <button\n                  onClick={() => setShowTargetSelector(false)}\n                  className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                >\n                  <X className=\"w-5 h-5 text-gray-600\" />\n                </button>\n              </div>\n\n              <div className=\"space-y-2\">\n                {otherPlayers.map((player) => (\n                  <button\n                    key={player.id}\n                    onClick={() => handleTargetSelect(player.id)}\n                    className=\"w-full p-4 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-bold rounded-xl transition-all\"\n                  >\n                    {player.name}\n                  </button>\n                ))}\n              </div>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </>\n  );\n}\n\ninterface CardHandProps {\n  playerId: string;\n  onUseCard: (cardId: string, targetPlayerId?: string) => void;\n  otherPlayers?: { id: string; name: string }[];\n  disabled?: boolean;\n}\n\nexport function CardHand({ playerId, onUseCard, otherPlayers = [], disabled }: CardHandProps) {\n  const { playerCards } = useCards();\n  const playerData = playerCards.find((p) => p.playerId === playerId);\n\n  if (!playerData || playerData.cards.length === 0) {\n    return null;\n  }\n\n  return (\n    <motion.div\n      className=\"fixed bottom-4 left-1/2 -translate-x-1/2 z-40\"\n      initial={{ y: 100 }}\n      animate={{ y: 0 }}\n      transition={{ type: \"spring\", stiffness: 300, damping: 25 }}\n    >\n      <div className=\"bg-slate-900/80 backdrop-blur-xl rounded-2xl p-3 shadow-2xl border border-white/10\">\n        <div className=\"flex items-center gap-2 mb-2\">\n          <Sparkles className=\"w-4 h-4 text-yellow-400\" />\n          <span className=\"text-white/80 text-xs font-medium\">Ø¨Ø·Ø§Ù‚Ø§ØªÙƒ</span>\n        </div>\n        <div className=\"flex gap-2 sm:gap-3\">\n          <AnimatePresence mode=\"popLayout\">\n            {playerData.cards.map((card, index) => (\n              <motion.div\n                key={card.id}\n                initial={{ opacity: 0, y: 50, rotateZ: -10 }}\n                animate={{ \n                  opacity: 1, \n                  y: 0, \n                  rotateZ: (index - (playerData.cards.length - 1) / 2) * 5 \n                }}\n                exit={{ opacity: 0, y: 50, scale: 0.5 }}\n                transition={{ delay: index * 0.1 }}\n              >\n                <CardComponent\n                  card={card}\n                  onUse={onUseCard}\n                  isSelectable={true}\n                  otherPlayers={otherPlayers}\n                  disabled={disabled}\n                />\n              </motion.div>\n            ))}\n          </AnimatePresence>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\ninterface CardEffectDisplayProps {\n  playerId: string;\n  revealNumberShowPosition?: boolean;\n  currentPlayerName?: string;\n}\n\nexport function CardEffectDisplay({ playerId, revealNumberShowPosition = true, currentPlayerName = \"\" }: CardEffectDisplayProps) {\n  const { playerCards, removeExpiredEffects } = useCards();\n  const [forceUpdate, setForceUpdate] = useState(0);\n  const playerData = playerCards.find((p) => p.playerId === playerId);\n  const otherPlayers = playerCards.filter(p => p.playerId !== playerId);\n\n  // Force update when playerCards changes\n  useEffect(() => {\n    setForceUpdate(prev => prev + 1);\n  }, [playerCards]);\n\n  if (!playerData || playerData.activeEffects.length === 0) {\n    return null;\n  }\n\n  // Log for debugging\n  playerData.activeEffects.forEach(effect => {\n    if (effect.cardType === \"freeze\") {\n      console.log(`[CardEffectDisplay] Freeze effect - source: ${effect.sourcePlayerName} (${effect.sourcePlayerId}), target: ${effect.targetPlayerId}`);\n    }\n  });\n\n  const getEffectValueDisplay = (effect: { cardType: CardType; value?: number | string | number[] | { position: number; isEven: boolean }[] }) => {\n    if (!effect.value) return null;\n    \n    switch (effect.cardType) {\n      case \"revealNumber\":\n        if (Array.isArray(effect.value) && effect.value.length === 2) {\n          const [position, digit] = effect.value as number[];\n          if (!revealNumberShowPosition) {\n            return (\n              <div className=\"mt-1 bg-white/20 rounded-lg px-2 py-1\">\n                <span className=\"text-sm font-bold\">\n                  {digit}\n                </span>\n              </div>\n            );\n          }\n          return (\n            <div className=\"mt-1 bg-white/20 rounded-lg px-2 py-1\">\n              <span className=\"text-sm font-bold\">\n                Ø§Ù„Ø®Ø§Ù†Ø© {position + 1}: {digit}\n              </span>\n            </div>\n          );\n        }\n        return null;\n        \n      case \"burnNumber\":\n        if (Array.isArray(effect.value)) {\n          return (\n            <div className=\"mt-1 bg-white/20 rounded-lg px-2 py-1 space-y-1\">\n              {(effect.value as number[]).map((num, idx) => (\n                <div key={idx} className=\"text-sm font-bold\">\n                  âŒ Ø§Ù„Ø±Ù‚Ù… {num} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯\n                </div>\n              ))}\n            </div>\n          );\n        }\n        return (\n          <div className=\"mt-1 bg-white/20 rounded-lg px-2 py-1\">\n            <span className=\"text-sm font-bold\">\n              âŒ Ø§Ù„Ø±Ù‚Ù… {effect.value} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯\n            </span>\n          </div>\n        );\n        \n      case \"revealParity\":\n        if (Array.isArray(effect.value)) {\n          const parityInfo = effect.value as { position: number; isEven: boolean }[];\n          return (\n            <div className=\"mt-1 bg-white/20 rounded-lg px-2 py-1 space-y-1\">\n              {parityInfo.map((info, idx) => (\n                <div key={idx} className=\"text-sm font-bold\">\n                  Ø§Ù„Ø®Ø§Ù†Ø© {info.position + 1}: {info.isEven ? \"Ø²ÙˆØ¬ÙŠ\" : \"ÙØ±Ø¯ÙŠ\"}\n                </div>\n              ))}\n            </div>\n          );\n        }\n        return null;\n        \n      case \"freeze\": {\n        const sourceName = effect.sourcePlayerName || effect.sourcePlayerId || \"Ø®ØµÙ…\";\n        \n        // Only show to frozen player\n        if (effect.targetPlayerId === playerId) {\n          return (\n            <div className=\"mt-1 bg-white/20 rounded-lg px-2 py-1\">\n              <span className=\"text-sm font-bold\">\n                Ù‚Ø§Ù… {sourceName} Ø¨ØªØ¬Ù…ÙŠØ¯Ùƒ\n              </span>\n            </div>\n          );\n        }\n        \n        return null;\n      }\n\n      case \"shield\":\n        return (\n          <div className=\"mt-1 bg-white/20 rounded-lg px-2 py-1\">\n            <span className=\"text-sm font-bold\">\n              Ø£Ù†Øª Ù…Ø­Ù…ÙŠ\n            </span>\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  // Filter out burnNumber and revealParity effects - they work in the background without notifications\n  // (revealParity info is shown directly in the input fields)\n  const displayableEffects = playerData.activeEffects.filter(\n    effect => effect.cardType !== \"burnNumber\" && effect.cardType !== \"revealParity\"\n  );\n\n  if (displayableEffects.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed bottom-4 right-4 z-40 space-y-2\">\n      <AnimatePresence>\n        {displayableEffects.map((effect, index) => {\n          const cardDef = CARD_DEFINITIONS.find((c) => c.type === effect.cardType);\n          if (!cardDef) return null;\n\n          const remainingTime = Math.max(0, Math.ceil((effect.expiresAt - Date.now()) / 1000));\n          const valueDisplay = getEffectValueDisplay(effect);\n          const showTimer = effect.cardType !== \"revealNumber\" && effect.cardType !== \"burnNumber\";\n\n          return (\n            <motion.div\n              key={`${effect.cardType}_${effect.expiresAt}`}\n              initial={{ x: 100, opacity: 0 }}\n              animate={{ x: 0, opacity: 1 }}\n              exit={{ x: 100, opacity: 0 }}\n              className={`bg-gradient-to-r ${cardDef.color} rounded-xl p-3 shadow-lg text-white min-w-[180px]`}\n            >\n              <div className=\"flex items-center gap-3\">\n                <CardIcon icon={cardDef.icon} className=\"w-6 h-6\" />\n                <div>\n                  <span className=\"font-bold text-sm block\">{cardDef.nameAr}</span>\n                  {showTimer && <span className=\"text-xs opacity-80\">{remainingTime}s</span>}\n                </div>\n              </div>\n              {valueDisplay}\n            </motion.div>\n          );\n        })}\n      </AnimatePresence>\n    </div>\n  );\n}\n\ninterface CardUsedAnimationProps {\n  cardType: CardType;\n  userName: string;\n  targetName?: string;\n  onComplete: () => void;\n}\n\nexport function CardUsedAnimation({ cardType, userName, targetName, onComplete }: CardUsedAnimationProps) {\n  const cardDef = CARD_DEFINITIONS.find((c) => c.type === cardType);\n\n  if (!cardDef) return null;\n\n  return (\n    <motion.div\n      className=\"fixed inset-0 z-50 flex items-center justify-center pointer-events-none\"\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      onAnimationComplete={() => {\n        setTimeout(onComplete, 1500);\n      }}\n    >\n      <motion.div\n        className={`bg-gradient-to-br ${cardDef.color} rounded-3xl p-8 shadow-2xl text-white text-center`}\n        initial={{ scale: 0, rotate: -180 }}\n        animate={{ scale: 1, rotate: 0 }}\n        exit={{ scale: 0, rotate: 180 }}\n        transition={{ type: \"spring\", stiffness: 300, damping: 20 }}\n      >\n        <motion.div\n          className=\"mb-4 flex justify-center\"\n          animate={{ \n            scale: [1, 1.3, 1],\n            rotate: [0, 10, -10, 0] \n          }}\n          transition={{ \n            duration: 0.5, \n            repeat: 2,\n            ease: \"easeInOut\" \n          }}\n        >\n          <CardIcon icon={cardDef.icon} className=\"w-16 h-16\" />\n        </motion.div>\n        <h2 className=\"text-2xl font-bold mb-2\">{cardDef.nameAr}</h2>\n        <p className=\"text-lg opacity-90\">\n          {userName}\n          {targetName && (\n            <>\n              <span className=\"mx-2\">â†</span>\n              {targetName}\n            </>\n          )}\n        </p>\n      </motion.div>\n    </motion.div>\n  );\n}\n\ninterface CardDrawAnimationProps {\n  card: Card;\n  onComplete: () => void;\n}\n\nexport function CardDrawAnimation({ card, onComplete }: CardDrawAnimationProps) {\n  return (\n    <motion.div\n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/30\"\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      onClick={onComplete}\n    >\n      <motion.div\n        className={`w-40 h-56 rounded-2xl bg-gradient-to-br ${card.color} shadow-2xl border-4 border-white/40 flex flex-col items-center justify-center p-4 text-white cursor-pointer`}\n        initial={{ scale: 0, rotateY: 180, y: 100 }}\n        animate={{ scale: 1, rotateY: 0, y: 0 }}\n        exit={{ scale: 0, y: 100 }}\n        transition={{ type: \"spring\", stiffness: 200, damping: 15 }}\n        whileHover={{ scale: 1.05 }}\n      >\n        <motion.div\n          className=\"mb-4\"\n          animate={{ \n            scale: [1, 1.3, 1],\n            rotate: [0, 15, -15, 0] \n          }}\n          transition={{ \n            duration: 1, \n            repeat: Infinity,\n            ease: \"easeInOut\" \n          }}\n        >\n          <CardIcon icon={card.icon} className=\"w-12 h-12\" />\n        </motion.div>\n        <h3 className=\"text-xl font-bold text-center mb-2\">{card.nameAr}</h3>\n        <p className=\"text-sm text-center opacity-90\">{card.descriptionAr}</p>\n        \n        <motion.div\n          className=\"absolute inset-0 bg-gradient-to-r from-white/0 via-white/30 to-white/0\"\n          initial={{ x: \"-100%\" }}\n          animate={{ x: \"200%\" }}\n          transition={{ \n            duration: 1.5, \n            repeat: Infinity,\n            ease: \"linear\" \n          }}\n        />\n      </motion.div>\n    </motion.div>\n  );\n}\n\nexport { CardComponent };\n","path":null,"size_bytes":16320,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationLink,\n  PaginationItem,\n  PaginationPrevious,\n  PaginationNext,\n  PaginationEllipsis,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/game/ChallengeDoor.tsx":{"content":"import { useRef, useState, useEffect } from \"react\";\nimport { Text } from \"@react-three/drei\";\nimport { useFrame, useThree } from \"@react-three/fiber\";\nimport * as THREE from \"three\";\nimport { useChallenge } from \"@/lib/stores/useChallenge\";\nimport { useChallenges } from \"@/lib/stores/useChallenges\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\n\nexport function ChallengeDoor({ onEnterChallenge }: { onEnterChallenge: () => void }) {\n  const buttonRef = useRef<THREE.Mesh>(null);\n  const hintBoxRef = useRef<THREE.Mesh>(null);\n  const { camera } = useThree();\n  const [isHovering, setIsHovering] = useState(false);\n  const hint = useChallenges((state) => state.hint);\n  const hasWon = useChallenges((state) => state.hasWonAnyChallenge());\n  const { generateHint } = useChallenges();\n  const { singleplayer } = useNumberGame();\n  const raycasterRef = useRef(new THREE.Raycaster());\n\n  useEffect(() => {\n    if (hasWon && !hint && singleplayer.secretCode) {\n      console.log(\"ğŸšª Door: Generating hint, secretCode:\", singleplayer.secretCode);\n      generateHint(singleplayer.secretCode);\n    }\n  }, [hasWon, hint, generateHint, singleplayer.secretCode]);\n\n  useEffect(() => {\n    console.log(\"ğŸšª Door state - hasWonChallenge:\", hasWon, \"hint:\", hint);\n  }, [hasWon, hint]);\n\n  useEffect(() => {\n    const handlePointerDown = () => {\n      if (hasWon) return;\n      \n      raycasterRef.current.setFromCamera(new THREE.Vector2(0, 0), camera);\n      raycasterRef.current.far = Infinity;\n      \n      let clickedButton = false;\n      if (buttonRef.current) {\n        const intersectsButton = raycasterRef.current.intersectObject(buttonRef.current, true);\n        if (intersectsButton.length > 0) clickedButton = true;\n      }\n      if (hintBoxRef.current && !clickedButton) {\n        const intersectsHint = raycasterRef.current.intersectObject(hintBoxRef.current, true);\n        if (intersectsHint.length > 0) clickedButton = true;\n      }\n      \n      if (clickedButton) {\n        onEnterChallenge();\n      }\n    };\n\n    window.addEventListener('pointerdown', handlePointerDown);\n    return () => window.removeEventListener('pointerdown', handlePointerDown);\n  }, [onEnterChallenge, camera, hasWon]);\n\n  useFrame((state) => {\n    if (!buttonRef.current && !hintBoxRef.current) return;\n\n    raycasterRef.current.setFromCamera(new THREE.Vector2(0, 0), camera);\n    raycasterRef.current.far = Infinity;\n    \n    let isHover = false;\n    if (buttonRef.current) {\n      const intersectsButton = raycasterRef.current.intersectObject(buttonRef.current, true);\n      if (intersectsButton.length > 0) isHover = true;\n    }\n    if (hintBoxRef.current) {\n      const intersectsHint = raycasterRef.current.intersectObject(hintBoxRef.current, true);\n      if (intersectsHint.length > 0) isHover = true;\n    }\n    \n    if (isHover !== isHovering) {\n      setIsHovering(isHover);\n    }\n\n    if (buttonRef.current) {\n      const targetScale = isHovering && !hasWon ? 1.1 : 1.0;\n      buttonRef.current.scale.lerp(\n        new THREE.Vector3(targetScale, targetScale, targetScale),\n        0.15\n      );\n    }\n  });\n\n  const handleDoorClick = () => {\n    onEnterChallenge();\n  };\n\n  const hintText = hint\n    ? hint.type === \"digit\"\n      ? `${hint.value}`\n      : String(hint.value)\n    : \"\";\n\n  return (\n    <group position={[11, 2, 0.2]} rotation={[0, -Math.PI / 2, 0]}>\n      {/* Ù…Ø±Ø¨Ø¹ Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø§Ù„Ø´ÙØ§Ù */}\n      <group position={[0, 2.0, 0]}>\n        {/* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø´ÙØ§ÙØ© */}\n        <mesh ref={hintBoxRef}>\n          <boxGeometry args={[2.3, 1.3, 0.15]} />\n          <meshStandardMaterial\n            color=\"#6366f1\"\n            transparent\n            opacity={0.3}\n            metalness={0.3}\n            roughness={0.4}\n          />\n        </mesh>\n\n        {/* Ø­Ø¯ÙˆØ¯ Ø°Ù‡Ø¨ÙŠØ© Ø¹Ù„ÙˆÙŠØ© */}\n        <mesh position={[0, 0, 0.08]}>\n          <boxGeometry args={[2.4, 1.4, 0.05]} />\n          <meshStandardMaterial\n            color=\"#fbbf24\"\n            metalness={1}\n            roughness={0.1}\n            emissive=\"#fbbf24\"\n            emissiveIntensity={0.7}\n          />\n        </mesh>\n\n        {/* Ø§Ù„Ù†Øµ */}\n        {hasWon ? (\n          <>\n            <Text\n              position={[0, 0.35, 0.15]}\n              fontSize={0.2}\n              color=\"#fbbf24\"\n              anchorX=\"center\"\n              anchorY=\"middle\"\n              fontWeight=\"bold\"\n            >\n              Ø§Ù„ØªÙ„Ù…ÙŠØ­:\n            </Text>\n            {hint && (\n              <Text\n                position={[0, -0.15, 0.15]}\n                fontSize={0.16}\n                color=\"#fbbf24\"\n                anchorX=\"center\"\n                anchorY=\"middle\"\n                maxWidth={2.1}\n                lineHeight={1.3}\n                fontWeight=\"bold\"\n              >\n                {hintText}\n              </Text>\n            )}\n          </>\n        ) : (\n          <Text\n            position={[0, 0, 0.15]}\n            fontSize={0.24}\n            color=\"#ffffff\"\n            anchorX=\"center\"\n            anchorY=\"middle\"\n            fontWeight=\"bold\"\n          >\n            Ø§Ù„ØªÙ„Ù…ÙŠØ­\n          </Text>\n        )}\n      </group>\n\n      {/* Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ø·Ø§ÙÙŠ Ø§Ù„Ø´ÙØ§Ù */}\n      <mesh \n        ref={buttonRef}\n        position={[0, 0, 0.1]}\n      >\n        <boxGeometry args={[2.0, 2.0, 0.15]} />\n        <meshStandardMaterial\n          color={hasWon ? \"#999999\" : isHovering ? \"#8b5cf6\" : \"#6366f1\"}\n          transparent\n          opacity={0.85}\n          metalness={0.6}\n          roughness={0.2}\n          emissive={hasWon ? \"#999999\" : isHovering ? \"#8b5cf6\" : \"#4f46e5\"}\n          emissiveIntensity={hasWon ? 0.3 : isHovering ? 0.8 : 0.5}\n        />\n      </mesh>\n\n      {/* Ø­Ø¯ÙˆØ¯ Ø°Ù‡Ø¨ÙŠØ© Ù„Ù„Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */}\n      <mesh position={[0, 0, 0.11]}>\n        <boxGeometry args={[2.1, 2.1, 0.04]} />\n        <meshStandardMaterial\n          color=\"#fbbf24\"\n          metalness={1}\n          roughness={0.1}\n          emissive=\"#fbbf24\"\n          emissiveIntensity={0.8}\n        />\n      </mesh>\n\n      {/* Ø±Ù…Ø² Ø§Ù„Ù…ØµØ¨Ø§Ø­ */}\n      <Text\n        position={[0, 0.4, 0.2]}\n        fontSize={0.55}\n        color=\"#fbbf24\"\n        anchorX=\"center\"\n        anchorY=\"middle\"\n      >\n        ğŸ’¡\n      </Text>\n\n      {/* Ù†Øµ \"ØªÙ„Ù…ÙŠØ­\" */}\n      <Text\n        position={[0, -0.45, 0.2]}\n        fontSize={0.32}\n        color=\"#ffffff\"\n        anchorX=\"center\"\n        anchorY=\"middle\"\n        fontWeight=\"bold\"\n      >\n        ØªÙ„Ù…ÙŠØ­\n      </Text>\n    </group>\n  );\n}\n","path":null,"size_bytes":6573,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4873,"size_tokens":null},"replit.md":{"content":"# Ù„Ø¹Ø¨Ø© ØªØ®Ù…ÙŠÙ† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©\n\n## Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©\n\nÙ„Ø¹Ø¨Ø© ØªØ®Ù…ÙŠÙ† Ø£Ø±Ù‚Ø§Ù… ØªÙØ§Ø¹Ù„ÙŠØ© Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¹ ÙˆØ§Ø¬Ù‡Ø© 2D Ø­Ø¯ÙŠØ«Ø©. Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† ÙŠØ®Ù…Ù†ÙˆÙ† Ø±Ù‚Ù…Ø§Ù‹ Ø³Ø±ÙŠØ§Ù‹ ÙˆÙŠØªÙ„Ù‚ÙˆÙ† ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¹Ù„Ù‰ Ø¯Ù‚Ø© Ø§Ù„ØªØ®Ù…ÙŠÙ†. ØªØ¯Ø¹Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ±Ø¯ÙŠ ÙˆØ§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ù…Ø¹ ØªÙˆØ§ØµÙ„ ÙÙˆØ±ÙŠ Ø¹Ø¨Ø± WebSocket ÙˆØªØ­Ø¯ÙŠØ§Øª ØµØºÙŠØ±Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙ„Ù…ÙŠØ­Ø§Øª. Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…ØµÙ…Ù…Ø© Ù„Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„Ø­Ø§Ø³ÙˆØ¨ Ø¨Ø³Ù„Ø§Ø³Ø©.\n\n## ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…\n\nØ£Ø³Ù„ÙˆØ¨ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…ÙØ¶Ù„: Ù„ØºØ© Ø¨Ø³ÙŠØ·Ø© ÙˆØ³Ù‡Ù„Ø© Ø§Ù„ÙÙ‡Ù….\n\n## Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©\n\n### Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© (Frontend)\n\n**Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª:**\n- React 18 Ù…Ø¹ TypeScript\n- Vite Ù„Ù„Ø¨Ù†Ø§Ø¡ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±\n- TailwindCSS Ù„Ù„ØªØµÙ…ÙŠÙ…\n- Radix UI Ù„Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©\n- Zustand Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø©\n\n**Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶:**\n- **Ø¯ÙŠØ³ÙƒØªÙˆØ¨**: ÙˆØ§Ø¬Ù‡Ø© ÙƒØ§Ù…Ù„Ø© Ù…Ø¹ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø§Ù†Ø¨\n- **Ù…ÙˆØ¨Ø§ÙŠÙ„**: ÙˆØ§Ø¬Ù‡Ø© Ù…Ø­Ø³Ù†Ø© Ù…Ø¹ Ù„ÙˆØ­Ø© Ø£Ø±Ù‚Ø§Ù… Ù…Ø®ØµØµØ©ØŒ ÙƒØ´Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ 768px\n\n**Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:**\n- `MobileSingleplayer` Ùˆ `DesktopSingleplayer`: ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„ÙØ±Ø¯ÙŠ (Ù…ÙˆØ­Ø¯Ø© Ø§Ù„ØªØµÙ…ÙŠÙ…)\n- `MultiplayerLobby`: ØºØ±ÙØ© Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ\n- `MultiplayerGame2D`: ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ (Ø¯ÙŠØ³ÙƒØªÙˆØ¨) Ùˆ `MobileMultiplayer` (Ù…ÙˆØ¨Ø§ÙŠÙ„)\n- `RainDropsChallenge`, `DirectionChallenge`, `MemoryChallenge`, `GuessChallenge`: Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©\n- `CardSystem`: Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø­ØµØ±ÙŠ Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ\n\n**Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø©:**\n- `useNumberGame`: Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø¹Ø¨Ø© (ÙˆØ¶Ø¹ ÙØ±Ø¯ÙŠ ÙˆØ¬Ù…Ø§Ø¹ÙŠ)\n- `useChallenges`: Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª ÙˆØ§Ù„ØªÙ„Ù…ÙŠØ­Ø§Øª\n- `useCards`: Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø®Ø§Øµ\n- `useAudio`: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©\n\n**Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ø®Ø§Ø¯Ù…:**\n- WebSocket Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ø§Ù„ÙÙˆØ±ÙŠ\n- Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¹Ø¨Ø± sessionStorage Ù„Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯\n- Ø±Ø³Ø§Ø¦Ù„: challenge_completed, start_game, submit_guess, ÙˆØºÙŠØ±Ù‡Ø§\n\n### Ø§Ù„Ø®Ø§Ø¯Ù… (Backend)\n\n**Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª:**\n- Express.js Ù…Ø¹ TypeScript\n- WebSocket (ws) Ù„Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„ÙÙˆØ±ÙŠ\n- Neon PostgreSQL Ù…Ø¹ Drizzle ORM (Ù…ØªÙˆÙØ± Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ)\n\n**Ø¨Ù†ÙŠØ© Ø§Ù„Ø®Ø§Ø¯Ù…:**\n- `server/index.ts`: Ø¥Ø¹Ø¯Ø§Ø¯ Express ÙˆØ§Ù„Ù€ middleware\n- `server/routes.ts`: Ø®Ø§Ø¯Ù… WebSocket ÙˆÙ…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨Ø©\n- `server/db.ts`: Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\n- `server/storage.ts`: ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† (ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹)\n\n**Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨Ø©:**\n- Ù†Ø¸Ø§Ù… ØºØ±Ù Ù…Ø¹ Ù…Ø¹Ø±ÙØ§Øª ÙØ±ÙŠØ¯Ø©\n- Ù„Ø¹Ø¨ Ù…Ø³ØªÙ‚Ù„ ÙˆÙÙˆØ±ÙŠ (Ø§Ù„Ø§Ø«Ù†Ø§Ù† ÙŠÙ„Ø¹Ø¨Ø§Ù† Ø¨Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª)\n- Ø£ÙƒÙˆØ§Ø² Ø³Ø±ÙŠØ© Ù…Ø´ØªØ±ÙƒØ© ØªÙˆÙ„Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹\n- ØªØ­Ø¯ÙŠØ§Øª Ù…Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø©: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙŠÙƒÙ…Ù„ÙˆÙ† Ø§Ù„ØªØ­Ø¯ÙŠ Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª\n- Ù†Ø¸Ø§Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§ØªØµØ§Ù„ Ø´Ø§Ù…Ù„:\n  - ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹ÙŠÙ† Ù…Ø¹ timeout 5 Ø¯Ù‚Ø§Ø¦Ù‚\n  - Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© (Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙˆØ§Ù„Ù†Ù‚Ø§Ø·)\n  - ØªÙ†Ø¸ÙŠÙ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØºØ±Ù Ø§Ù„Ù…Ù‡Ø¬ÙˆØ±Ø©\n  - Ù…Ø²Ø§Ù…Ù†Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨ÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡\n\n## ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\n\n**Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:**\n- PostgreSQL Ø¹Ø¨Ø± Neon (Ù…ÙØ¹Ø¯ Ù„ÙƒÙ† Ù„Ù… ÙŠÙØ³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø¹Ø¯)\n- Drizzle ORM Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø¢Ù…Ù†Ø©\n\n**Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª:**\n- ØªØªØ¨Ø¹ Ø§ØªØµØ§Ù„Ø§Øª WebSocket Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨\n- Ø­Ø§Ù„Ø© Ø§Ù„ØºØ±ÙØ© Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø®Ø§Ø¯Ù… (Map)\n- ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ø­Ù„ÙŠ Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ« (Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø¨Ø¹Ø¯ 30 Ø¯Ù‚ÙŠÙ‚Ø©)\n- Ø§Ù†Ù‚Ø·Ø§Ø¹ 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹ÙŠÙ† ÙÙŠ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù†Ø´Ø·Ø©\n\n## Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠ\n\n**ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:**\n- ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ Ù„ÙƒÙ„ Ù…Ù† Ø¯ÙŠØ³ÙƒØªÙˆØ¨ ÙˆÙ…ÙˆØ¨Ø§ÙŠÙ„\n- ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù…Ø¹ ØªØ®Ø·ÙŠØ· Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø±\n- Ù†Ø¸Ø§Ù… Ø§Ù„ØªØµÙˆÙŠØª Ø¹Ù„Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø¹ Ø¨Ø¯Ø¡ Ù„Ø­Ø¸ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©\n- Ø´Ø§Ø´Ø© Ù†ØªØ§Ø¦Ø¬ Ù…Ø­Ø³Ù†Ø© Ù…Ø¹ Ø±ØªØ¨ ÙˆØ­Ø±ÙƒØ§Øª Ø§Ø­ØªÙØ§Ù„\n- Ø´Ø§Ø´Ø© Ø§Ù†ØªØ¸Ø§Ø± Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ†ØªÙ‡ÙŠ Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†\n\n**Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ©:**\n- Ù…Ø¤Ù‚Øª Ø­ÙŠ Ù…Ø¹ ØªØ­Ø¯ÙŠØ«Ø§Øª 100ms ÙˆTimeout 5 Ø¯Ù‚Ø§Ø¦Ù‚\n- ÙƒØ´Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª\n- Ù†Ø¸Ø§Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§ØªØµØ§Ù„ Ù‚ÙˆÙŠ ÙŠØ³ØªØ¹ÙŠØ¯ ÙƒÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©\n- ØªØ­Ø¯ÙŠØ§Øª ØµØºÙŠØ±Ø©: \"ØªØ­Ø¯ÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©\" Ùˆ\"ØªØ­Ø¯ÙŠ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª\" Ùˆ\"ØªØ­Ø¯ÙŠ Ø­Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ø±\" Ùˆ\"ØªØ­Ø¯ÙŠ Ø§Ù„ØªØ³Ù„Ø³Ù„\" Ù…Ø¹ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨ØµØ±ÙŠØ© ÙˆØ³Ù…Ø¹ÙŠØ©\n- Ù†Ø¸Ø§Ù… Ø¨Ø·Ø§Ù‚Ø§Øª ÙØ±ÙŠØ¯ Ù…Ø¹ 6 Ø£Ù†ÙˆØ§Ø¹ (Ø¥Ø¸Ù‡Ø§Ø± Ø±Ù‚Ù…ØŒ Ø­Ø±Ù‚ Ø±Ù‚Ù…ØŒ ÙƒØ´Ù Ø²ÙˆØ¬ÙŠ/ÙØ±Ø¯ÙŠØŒ ØªØ¬Ù…ÙŠØ¯ØŒ Ø¯Ø±Ø¹ØŒ ØªØ¹Ø·ÙŠÙ„ Ø¹Ø±Ø¶)\n\n## Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©\n\n### Ø¥ØµÙ„Ø§Ø­ 29 Ù†ÙˆÙÙ…Ø¨Ø± (3):\n1. **Ø³Ø±Ø¹Ø© ØªØ­Ø¯ÙŠ Ø­Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ø±**: Ø¥Ø²Ø§Ù„Ø© ØªØ³Ø§Ø±Ø¹ Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù…ÙØ±Ø· ÙÙŠ Ø¢Ø®Ø± 10-15 Ø«Ø§Ù†ÙŠØ©\n2. **Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª**: ØªØºÙŠÙŠØ± Ù…ÙˆØ¶Ø¹ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ù…Ù† Ø£Ø¹Ù„Ù‰-ÙˆØ³Ø· Ø¥Ù„Ù‰ Ø£Ø³ÙÙ„-ÙˆØ³Ø· Ù…Ø¹ z-index Ù…Ù†Ø§Ø³Ø¨\n3. **Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØºØ±ÙØ©**: Ø¥Ø¶Ø§ÙØ© localStorage Ù„Ø­ÙØ¸ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø¬Ù„Ø³Ø§Øª\n4. **Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ø¤Ù‚Øª**: Ø¥Ø¶Ø§ÙØ© timestamp Ø§Ù„Ø®Ø§Ø¯Ù… ÙÙŠ Ø±Ø³Ø§Ù„Ø© game_starting Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©\n5. **Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¤Ù‚Øª**: ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ø±Ø¶ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¥Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ù‚Ø¶ÙŠ\n6. **Ø¹Ø±Ø¶ Ø²ÙˆØ¬ÙŠ/ÙØ±Ø¯ÙŠ**: Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙƒØ§ÙØ¤ ÙƒÙ†Øµ Ø®Ù„ÙÙŠØ© ÙÙŠ Ø®Ø§Ù†Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Ø¯ÙŠØ³ÙƒØªÙˆØ¨ ÙˆÙ…ÙˆØ¨Ø§ÙŠÙ„)\n7. **Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª**: Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨ Ø¨Ù…Ø³Ø­ playerCards\n8. **Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª**: Ø­ÙØ¸ cardSettings Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†Ù‡Ø§\n\n### Ø¥ØµÙ„Ø§Ø­ 29 Ù†ÙˆÙÙ…Ø¨Ø± (2):\n1. **Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¤Ù‚Øª Ø§Ù„Ø¬ÙˆÙ„Ø©**: Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø¹Ø¯Ù… ØªØ²Ø§Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¶ÙŠÙ Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª\n2. **Ø¥Ø®ÙØ§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø±Ù‚**: Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØªØ¹Ù…Ù„ Ù„ÙƒÙ† Ø¯ÙˆÙ† Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…\n3. **Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨**: Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­\n4. **Ø³Ø¬Ù„ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª**: Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù„Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ Ø¹Ø±Ø¶ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ† ÙˆØ§Ù„Ø®Ø§Ø³Ø±ÙŠÙ†\n\n### Ø¥ØµÙ„Ø§Ø­ 29 Ù†ÙˆÙÙ…Ø¨Ø± (1):\n1. **ØªØµØ­ÙŠØ­ CardIcon**: Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø¢Ù† Ù…Ø·Ø§Ø¨Ù‚Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (eye, x-circle, hash, snowflake, shield, eye-off)\n2. **ØªÙˆØ­ÙŠØ¯ ØªØµÙ…ÙŠÙ… UI**: MobileSingleplayer Ùˆ MobileMultiplayer Ø§Ù„Ø¢Ù† Ø¨Ù†ÙØ³ Ø§Ù„Ù‡ÙŠÙƒÙ„ ÙˆØ§Ù„ØªØµÙ…ÙŠÙ…\n3. **Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±**: Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø± Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ†ØªÙ‡ÙŠ Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†\n4. **Ø±Ø³Ø§Ù„Ø© challenge_completed**: Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø®Ø§Ø¯Ù… Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠ\n\n## Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©\n\n**Ù…ÙƒØªØ¨Ø© Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©:**\n- `@radix-ui/*`: Ù…Ø¬Ù…ÙˆØ¹Ø© Ø´Ø§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¢Ù…Ù†Ø©\n- `lucide-react`: Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©\n\n**Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø®Ø§Ø¯Ù…:**\n- `@neondatabase/serverless`, `drizzle-orm`, `drizzle-kit`, `ws`\n\n**Ø§Ù„ØªØµÙ…ÙŠÙ…:**\n- `tailwindcss`, `class-variance-authority`, `clsx`, `tailwind-merge`\n\n**Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:**\n- `@tanstack/react-query`, `zustand`\n\n**Ø§Ù„ÙˆØ³Ø§Ø¦Ø· ÙˆØ§Ù„Ø£ØµÙˆØ§Øª:**\n- `@fontsource/inter`, `howler`, `react-confetti`, `framer-motion`\n\n**Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ·ÙˆÙŠØ±:**\n- `@replit/vite-plugin-runtime-error-modal`, `tsx`, `esbuild`, `vite`\n\n## Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªØ·ÙˆÙŠØ±\n\n### Ù†Ù‚Ø§Ø· Ù…Ù‡Ù…Ø©:\n1. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª ÙŠÙ…ÙƒÙ† ØªÙ…Ø±ÙŠØ±Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ù„Ø¹Ø¨\n2. Ø§Ù„Ø£Ø³Ù‡Ù… ÙÙŠ ØªØ­Ø¯ÙŠ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª Ù…Ø¹ÙƒÙˆØ³Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± (RTL) Ù„ÙƒÙ† ØµØ­ÙŠØ­Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„\n3. Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ØªÙ†Ù‚Øµ Ø§Ù„ÙØ±Øµ Ù…Ù† 3 Ø¥Ù„Ù‰ 2 Ø¥Ù„Ù‰ 1\n4. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø­ØµØ±ÙŠ Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ ÙÙ‚Ø·\n5. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØµÙˆØµ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©\n6. Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ØªØ¸Ù‡Ø± Ø¹Ù†Ø¯Ù…Ø§ startTime === 0 (Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†)\n\n### Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù‡Ù…Ø©:\n- `client/src/components/mobile/MobileSingleplayer.tsx` (Ù…ÙˆØ­Ø¯ Ù…Ø¹ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø¢Ù†)\n- `client/src/components/desktop/DesktopSingleplayer.tsx`\n- `client/src/components/mobile/MobileMultiplayer.tsx` (Ù…Ø¹ Ø´Ø§Ø´Ø© Ø§Ù†ØªØ¸Ø§Ø±)\n- `client/src/components/desktop/MultiplayerGame2D.tsx` (Ù…Ø¹ Ø´Ø§Ø´Ø© Ø§Ù†ØªØ¸Ø§Ø±)\n- `client/src/components/game/challenges/`\n- `client/src/lib/stores/useChallenges.ts`\n- `client/src/lib/stores/useCards.ts`\n- `client/src/components/game/cards/CardSystem.tsx` (Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù…ØµØ­Ø­Ø©)\n- `server/routes.ts`\n","path":null,"size_bytes":9437,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3849,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport { BrowserRouter } from \"react-router-dom\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(\n  <BrowserRouter>\n    <App />\n  </BrowserRouter>\n);\n","path":null,"size_bytes":250,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":768,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/MultiplayerResults.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { send, clearSession, clearPersistentRoom, disconnect } from \"@/lib/websocket\";\nimport { Trophy, Medal, XCircle, RefreshCw, Home, Eye, Crown, LogOut, Clock, Target, X, Check, History, ChevronLeft, ChevronRight } from \"lucide-react\";\nimport Confetti from \"react-confetti\";\n\nexport function MultiplayerResults() {\n  const navigate = useNavigate();\n  const { multiplayer, setMode, resetMultiplayer, setShowResults, setGameStatus } = useNumberGame();\n  const [selectedPlayer, setSelectedPlayer] = useState<string | null>(null);\n  const [showConfetti, setShowConfetti] = useState(true);\n  const [currentTime, setCurrentTime] = useState(Date.now());\n  const [showHistory, setShowHistory] = useState(false);\n  const [historyIndex, setHistoryIndex] = useState(0);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setCurrentTime(Date.now());\n    }, 100);\n    return () => clearInterval(interval);\n  }, []);\n\n  const isWinner = multiplayer.winners.some(w => w.playerId === multiplayer.playerId);\n  const isLoser = multiplayer.losers.some(l => l.playerId === multiplayer.playerId);\n  const myResult = [...multiplayer.winners, ...multiplayer.losers].find(r => r.playerId === multiplayer.playerId);\n  const hasNoWinners = multiplayer.winners.length === 0;\n\n  const handleRequestRematch = () => {\n    send({ type: \"request_rematch\" });\n  };\n\n  const handleBackToLobby = () => {\n    console.log(\"Back to lobby clicked\");\n    send({ type: \"request_rematch_state\" });\n    setShowResults(false);\n    setGameStatus(\"waiting\");\n  };\n\n  const handleBackToMenu = () => {\n    send({ type: \"leave_room\" });\n    clearSession();\n    clearPersistentRoom();\n    disconnect();\n    resetMultiplayer();\n    setMode(\"menu\");\n    navigate(\"/\");\n  };\n\n  const formatDuration = (ms: number) => {\n    const seconds = Math.floor(ms / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const remainingSeconds = seconds % 60;\n    if (minutes > 0) {\n      return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;\n    }\n    return `${seconds}s`;\n  };\n\n  const playerDetails = selectedPlayer \n    ? [...multiplayer.winners, ...multiplayer.losers, ...(multiplayer.stillPlaying || [])].find(p => p.playerId === selectedPlayer)\n    : null;\n\n  const getLiveDuration = (player: typeof multiplayer.winners[0]) => {\n    if (multiplayer.stillPlaying.some(p => p.playerId === player.playerId)) {\n      return currentTime - multiplayer.startTime;\n    }\n    return player.duration;\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 z-50 p-4 overflow-y-auto flex flex-col items-center justify-start\">\n      {showConfetti && isWinner && (\n        <Confetti\n          width={window.innerWidth}\n          height={window.innerHeight}\n          recycle={false}\n          numberOfPieces={500}\n          onConfettiComplete={() => setShowConfetti(false)}\n        />\n      )}\n\n      <div className=\"w-full max-w-2xl py-8\">\n        <div className=\"bg-slate-800/90 backdrop-blur-xl rounded-3xl shadow-2xl border border-slate-700 overflow-hidden\">\n          <div className={`p-6 text-center ${\n            isWinner \n              ? 'bg-gradient-to-r from-emerald-600/30 to-green-600/30' \n              : isLoser \n              ? 'bg-gradient-to-r from-red-600/30 to-orange-600/30'\n              : 'bg-gradient-to-r from-blue-600/30 to-purple-600/30'\n          }`}>\n            <div className=\"flex justify-center mb-4\">\n              {isWinner ? (\n                <div className=\"w-24 h-24 bg-gradient-to-br from-yellow-400 to-amber-500 rounded-full flex items-center justify-center shadow-lg shadow-yellow-500/30 animate-pulse\">\n                  <Trophy className=\"w-12 h-12 text-white\" />\n                </div>\n              ) : isLoser ? (\n                <div className=\"w-24 h-24 bg-gradient-to-br from-red-500 to-rose-600 rounded-full flex items-center justify-center shadow-lg\">\n                  <XCircle className=\"w-12 h-12 text-white\" />\n                </div>\n              ) : (\n                <div className=\"w-24 h-24 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center shadow-lg\">\n                  <Clock className=\"w-12 h-12 text-white animate-spin\" style={{ animationDuration: '3s' }} />\n                </div>\n              )}\n            </div>\n            \n            <h1 className={`text-3xl md:text-4xl font-bold mb-2 ${\n              isWinner ? 'text-emerald-400' : isLoser ? 'text-red-400' : 'text-blue-400'\n            }`}>\n              {isWinner ? 'Ù…Ø¨Ø±ÙˆÙƒ! ÙØ²Øª Ø¨Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©!' : isLoser ? 'Ù„Ù„Ø£Ø³Ù Ø®Ø³Ø±Øª Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø©' : 'Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø¬Ø§Ø±ÙŠØ©...'}\n            </h1>\n\n            {myResult && (\n              <div className=\"flex flex-wrap justify-center gap-3 mt-4\">\n                <div className=\"bg-slate-800/60 px-4 py-2 rounded-xl flex items-center gap-2\">\n                  <Target className=\"w-5 h-5 text-blue-400\" />\n                  <span className=\"text-white font-bold\">{myResult.attempts} Ù…Ø­Ø§ÙˆÙ„Ø§Øª</span>\n                </div>\n                <div className=\"bg-slate-800/60 px-4 py-2 rounded-xl flex items-center gap-2\">\n                  <Clock className=\"w-5 h-5 text-purple-400\" />\n                  <span className=\"text-white font-bold\">{formatDuration(myResult.duration)}</span>\n                </div>\n                {myResult.rank && (\n                  <div className=\"bg-slate-800/60 px-4 py-2 rounded-xl flex items-center gap-2\">\n                    <Medal className=\"w-5 h-5 text-yellow-400\" />\n                    <span className=\"text-white font-bold\">#{myResult.rank}</span>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n\n          <div className=\"p-6 border-b border-slate-700/50 bg-gradient-to-b from-slate-800/60 to-slate-900/60\">\n            <p className=\"text-center text-gray-400 text-sm mb-4\">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ÙƒØ§Ù†:</p>\n            <div className=\"flex justify-center gap-3\" dir=\"ltr\">\n              {multiplayer.sharedSecret.map((digit, idx) => (\n                <div\n                  key={idx}\n                  className=\"relative group\"\n                >\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl blur-md opacity-50 group-hover:opacity-70 transition-opacity\"></div>\n                  <div className=\"relative w-14 h-16 md:w-16 md:h-20 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 rounded-2xl flex items-center justify-center text-2xl md:text-3xl font-bold text-white shadow-xl transform group-hover:scale-105 transition-transform\">\n                    {digit}\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {multiplayer.winners.length > 0 && (\n            <div className=\"p-4 border-b border-slate-700/50\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <Trophy className=\"w-5 h-5 text-yellow-500\" />\n                <h3 className=\"text-lg font-bold text-yellow-400\">Ø§Ù„ÙØ§Ø¦Ø²ÙˆÙ†</h3>\n                <span className=\"text-slate-400 text-sm\">({multiplayer.winners.length})</span>\n              </div>\n              <div className=\"space-y-2\">\n                {multiplayer.winners.map((winner) => (\n                  <div\n                    key={winner.playerId}\n                    className={`flex items-center justify-between p-3 rounded-xl transition-all ${\n                      winner.playerId === multiplayer.playerId \n                        ? 'bg-emerald-600/20 border border-emerald-500/50' \n                        : 'bg-slate-700/30 hover:bg-slate-700/50'\n                    }`}\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className={`w-10 h-10 rounded-xl flex items-center justify-center font-bold shadow-lg ${\n                        winner.rank === 1 ? 'bg-gradient-to-br from-yellow-400 to-amber-500 text-black' :\n                        winner.rank === 2 ? 'bg-gradient-to-br from-gray-300 to-gray-400 text-black' :\n                        'bg-gradient-to-br from-orange-400 to-orange-500 text-white'\n                      }`}>\n                        #{winner.rank || 1}\n                      </div>\n                      <div>\n                        <p className=\"text-white font-semibold flex items-center gap-2\">\n                          {winner.playerName}\n                          {winner.playerId === multiplayer.playerId && (\n                            <span className=\"text-xs bg-blue-500/30 text-blue-300 px-2 py-0.5 rounded\">Ø£Ù†Øª</span>\n                          )}\n                          {winner.playerId === multiplayer.hostId && (\n                            <Crown className=\"w-4 h-4 text-yellow-400\" />\n                          )}\n                        </p>\n                        <p className=\"text-gray-400 text-sm\">\n                          {winner.attempts} Ù…Ø­Ø§ÙˆÙ„Ø§Øª â€¢ {formatDuration(winner.duration)}\n                        </p>\n                      </div>\n                    </div>\n                    <button\n                      onClick={() => setSelectedPlayer(winner.playerId)}\n                      className=\"p-2.5 bg-slate-600/50 hover:bg-purple-600 rounded-xl transition-all hover:scale-105\"\n                    >\n                      <Eye className=\"w-5 h-5 text-gray-300\" />\n                    </button>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {multiplayer.losers.length > 0 && (\n            <div className=\"p-4 border-b border-slate-700/50\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <XCircle className=\"w-5 h-5 text-red-500\" />\n                <h3 className=\"text-lg font-bold text-red-400\">Ø§Ù„Ø®Ø§Ø³Ø±ÙˆÙ†</h3>\n                <span className=\"text-slate-400 text-sm\">({multiplayer.losers.length})</span>\n              </div>\n              <div className=\"space-y-2\">\n                {multiplayer.losers.map((loser) => (\n                  <div\n                    key={loser.playerId}\n                    className={`flex items-center justify-between p-3 rounded-xl transition-all ${\n                      loser.playerId === multiplayer.playerId \n                        ? 'bg-red-600/20 border border-red-500/50' \n                        : 'bg-slate-700/30 hover:bg-slate-700/50'\n                    }`}\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-10 h-10 rounded-xl bg-red-600/30 flex items-center justify-center\">\n                        <XCircle className=\"w-5 h-5 text-red-400\" />\n                      </div>\n                      <div>\n                        <p className=\"text-white font-semibold flex items-center gap-2\">\n                          {loser.playerName}\n                          {loser.playerId === multiplayer.playerId && (\n                            <span className=\"text-xs bg-blue-500/30 text-blue-300 px-2 py-0.5 rounded\">Ø£Ù†Øª</span>\n                          )}\n                          {loser.playerId === multiplayer.hostId && (\n                            <Crown className=\"w-4 h-4 text-yellow-400\" />\n                          )}\n                        </p>\n                        <p className=\"text-gray-400 text-sm\">\n                          {loser.attempts} Ù…Ø­Ø§ÙˆÙ„Ø§Øª â€¢ {formatDuration(loser.duration)}\n                        </p>\n                      </div>\n                    </div>\n                    <button\n                      onClick={() => setSelectedPlayer(loser.playerId)}\n                      className=\"p-2.5 bg-slate-600/50 hover:bg-purple-600 rounded-xl transition-all hover:scale-105\"\n                    >\n                      <Eye className=\"w-5 h-5 text-gray-300\" />\n                    </button>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {multiplayer.stillPlaying.length > 0 && (\n            <div className=\"p-4 border-b border-slate-700/50\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <span className=\"text-xl\">ğŸ®</span>\n                <h3 className=\"text-lg font-bold text-blue-400\">Ù„Ø§ ÙŠØ²Ø§Ù„ÙˆÙ† ÙŠÙ„Ø¹Ø¨ÙˆÙ†</h3>\n                <span className=\"text-slate-400 text-sm\">({multiplayer.stillPlaying.length})</span>\n              </div>\n              <div className=\"space-y-2\">\n                {multiplayer.stillPlaying.map((player) => (\n                  <div\n                    key={player.playerId}\n                    className=\"flex items-center justify-between p-3 rounded-xl bg-blue-600/10 border border-blue-500/30\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-10 h-10 rounded-xl bg-blue-600/30 flex items-center justify-center animate-pulse\">\n                        <span className=\"text-xl\">â³</span>\n                      </div>\n                      <div>\n                        <p className=\"text-white font-semibold flex items-center gap-2\">\n                          {player.playerName}\n                          {player.playerId === multiplayer.playerId && (\n                            <span className=\"text-xs bg-blue-500/30 text-blue-300 px-2 py-0.5 rounded\">Ø£Ù†Øª</span>\n                          )}\n                          {player.playerId === multiplayer.hostId && (\n                            <Crown className=\"w-4 h-4 text-yellow-400\" />\n                          )}\n                        </p>\n                        <p className=\"text-gray-400 text-sm\">\n                          {player.attempts} Ù…Ø­Ø§ÙˆÙ„Ø§Øª â€¢ {formatDuration(getLiveDuration(player))}\n                        </p>\n                      </div>\n                    </div>\n                    <button\n                      onClick={() => setSelectedPlayer(player.playerId)}\n                      className=\"px-4 py-2 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 rounded-xl transition-all flex items-center gap-2 shadow-lg hover:scale-105\"\n                    >\n                      <Eye className=\"w-4 h-4 text-white\" />\n                      <span className=\"text-white text-sm font-medium\">Ù…Ø´Ø§Ù‡Ø¯Ø©</span>\n                    </button>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {hasNoWinners && !isWinner && multiplayer.stillPlaying.length === 0 && (\n            <div className=\"p-6 text-center\">\n              <p className=\"text-xl text-gray-300\">Ù„Ù… ÙŠÙØ² Ø£Ø­Ø¯ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©</p>\n            </div>\n          )}\n\n          <div className=\"p-5 space-y-3 bg-slate-900/50\">\n            {(isWinner || isLoser) && !multiplayer.rematchState.requested && multiplayer.stillPlaying.length === 0 && (\n              <button\n                onClick={handleRequestRematch}\n                className=\"w-full bg-gradient-to-r from-emerald-500 via-green-500 to-teal-500 hover:from-emerald-600 hover:via-green-600 hover:to-teal-600 text-white font-bold py-4 rounded-2xl shadow-lg shadow-green-500/25 flex items-center justify-center gap-3 transition-all transform hover:scale-[1.02] active:scale-[0.98]\"\n              >\n                <RefreshCw className=\"w-6 h-6\" />\n                <span className=\"text-lg\">Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©</span>\n              </button>\n            )}\n\n            {multiplayer.roundHistory.length > 0 && (\n              <button\n                onClick={() => {\n                  setHistoryIndex(multiplayer.roundHistory.length - 1);\n                  setShowHistory(true);\n                }}\n                className=\"w-full bg-gradient-to-r from-amber-500 via-orange-500 to-amber-600 hover:from-amber-600 hover:via-orange-600 hover:to-amber-700 text-white font-bold py-4 rounded-2xl shadow-lg shadow-orange-500/25 flex items-center justify-center gap-3 transition-all transform hover:scale-[1.02] active:scale-[0.98]\"\n              >\n                <History className=\"w-6 h-6\" />\n                <span className=\"text-lg\">Ø³Ø¬Ù„ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª ({multiplayer.roundHistory.length})</span>\n              </button>\n            )}\n\n            {multiplayer.roomId && multiplayer.stillPlaying.length === 0 && (\n              <button\n                onClick={handleBackToLobby}\n                className=\"w-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 hover:from-indigo-600 hover:via-purple-600 hover:to-pink-600 text-white font-bold py-4 rounded-2xl shadow-lg shadow-purple-500/25 flex items-center justify-center gap-3 transition-all transform hover:scale-[1.02] active:scale-[0.98]\"\n              >\n                <Home className=\"w-6 h-6\" />\n                <span className=\"text-lg\">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©</span>\n              </button>\n            )}\n\n            <button\n              onClick={handleBackToMenu}\n              className=\"w-full bg-slate-700/80 hover:bg-slate-600 text-white font-bold py-4 rounded-2xl shadow-lg flex items-center justify-center gap-3 transition-all transform hover:scale-[1.02] active:scale-[0.98] border border-slate-600\"\n            >\n              <LogOut className=\"w-5 h-5\" />\n              <span className=\"text-lg\">Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ØºØ±ÙØ©</span>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {multiplayer.rematchState.requested && multiplayer.rematchState.countdown !== null && (\n        <div className=\"fixed inset-0 flex items-center justify-center bg-black/70 z-[60] p-4\">\n          <div className=\"w-full max-w-lg bg-slate-800 rounded-2xl shadow-2xl border border-slate-700 p-6 text-center space-y-5\">\n            <div className=\"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center mx-auto\">\n              <RefreshCw className=\"w-8 h-8 text-white\" />\n            </div>\n            \n            <h2 className=\"text-2xl font-bold text-white\">Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©ØŸ</h2>\n            <p className=\"text-gray-400\">\n              Ù…ØªØ¨Ù‚ÙŠ <span className=\"font-bold text-blue-400\">{multiplayer.rematchState.countdown}s</span>\n            </p>\n\n            {!multiplayer.rematchState.votes.some(v => v.playerId === multiplayer.playerId) && (\n              <div className=\"flex gap-3\">\n                <button\n                  onClick={() => send({ type: \"rematch_vote\", accepted: true })}\n                  className=\"flex-1 bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 rounded-xl transition-all\"\n                >\n                  âœ“ Ù…ÙˆØ§ÙÙ‚\n                </button>\n                <button\n                  onClick={() => send({ type: \"rematch_vote\", accepted: false })}\n                  className=\"flex-1 bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-3 rounded-xl transition-all\"\n                >\n                  âœ— Ø±Ø§ÙØ¶\n                </button>\n              </div>\n            )}\n\n            <div className=\"grid grid-cols-2 gap-3\">\n              {multiplayer.players.map(player => {\n                const vote = multiplayer.rematchState.votes.find(v => v.playerId === player.id);\n                return (\n                  <div\n                    key={player.id}\n                    className={`p-3 rounded-xl border-2 ${\n                      vote?.accepted\n                        ? 'bg-green-600/20 border-green-500'\n                        : vote?.accepted === false\n                        ? 'bg-red-600/20 border-red-500'\n                        : 'bg-slate-700/50 border-slate-600'\n                    }`}\n                  >\n                    <p className=\"text-white font-semibold text-sm flex items-center justify-center gap-2\">\n                      {player.name}\n                      {player.id === multiplayer.playerId && (\n                        <span className=\"text-xs text-blue-300\">(Ø£Ù†Øª)</span>\n                      )}\n                    </p>\n                    <p className={`text-xs mt-1 ${\n                      vote?.accepted ? 'text-green-400' : vote?.accepted === false ? 'text-red-400' : 'text-gray-400'\n                    }`}>\n                      {vote?.accepted ? 'âœ“ Ù…ÙˆØ§ÙÙ‚' : vote?.accepted === false ? 'âœ— Ø±Ø§ÙØ¶' : 'â³ ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}\n                    </p>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {playerDetails && (\n        <div \n          className=\"fixed inset-0 bg-black/70 flex items-center justify-center z-[60] p-4\"\n          onClick={() => setSelectedPlayer(null)}\n        >\n          <div \n            className=\"bg-slate-800 rounded-2xl shadow-2xl border border-slate-700 max-w-md w-full p-6 max-h-[85vh] overflow-y-auto\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-xl font-bold text-white flex items-center gap-2\">\n                {playerDetails.playerName}\n                {playerDetails.playerId === multiplayer.hostId && (\n                  <Crown className=\"w-5 h-5 text-yellow-400\" />\n                )}\n              </h2>\n              <button \n                onClick={() => setSelectedPlayer(null)}\n                className=\"w-8 h-8 bg-slate-700 hover:bg-slate-600 rounded-lg flex items-center justify-center transition-colors\"\n              >\n                <X className=\"w-5 h-5 text-gray-400\" />\n              </button>\n            </div>\n\n            <div className=\"space-y-4\">\n              <div className={`p-4 rounded-xl ${\n                multiplayer.stillPlaying.some(p => p.playerId === playerDetails.playerId)\n                  ? 'bg-blue-600/20 border border-blue-500/50'\n                  : playerDetails.rank \n                  ? 'bg-emerald-600/20 border border-emerald-500/50'\n                  : 'bg-red-600/20 border border-red-500/50'\n              }`}>\n                <p className=\"text-gray-400 text-sm mb-1\">Ø§Ù„Ù†ØªÙŠØ¬Ø©</p>\n                <p className=\"text-xl font-bold text-white flex items-center gap-2\">\n                  {multiplayer.stillPlaying.some(p => p.playerId === playerDetails.playerId) \n                    ? (\n                      <>\n                        <Clock className=\"w-5 h-5 text-blue-400 animate-pulse\" />\n                        Ù„Ø§ ÙŠØ²Ø§Ù„ ÙŠÙ„Ø¹Ø¨...\n                      </>\n                    )\n                    : playerDetails.rank ? (\n                      <>\n                        <Trophy className=\"w-5 h-5 text-yellow-400\" />\n                        #{playerDetails.rank} - ÙØ§Ø¦Ø²\n                      </>\n                    ) : (\n                      <>\n                        <XCircle className=\"w-5 h-5 text-red-400\" />\n                        Ø®Ø§Ø³Ø±\n                      </>\n                    )}\n                </p>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div className=\"bg-slate-700/50 p-4 rounded-xl\">\n                  <p className=\"text-gray-400 text-sm mb-1\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</p>\n                  <p className=\"text-2xl font-bold text-blue-400\">{playerDetails.attempts}</p>\n                </div>\n                <div className=\"bg-slate-700/50 p-4 rounded-xl\">\n                  <p className=\"text-gray-400 text-sm mb-1\">Ø§Ù„ÙˆÙ‚Øª</p>\n                  <p className=\"text-2xl font-bold text-purple-400\">{formatDuration(getLiveDuration(playerDetails))}</p>\n                </div>\n              </div>\n\n              <div>\n                <p className=\"text-gray-400 text-sm mb-3 flex items-center gap-2\">\n                  <Target className=\"w-4 h-4\" />\n                  Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª:\n                </p>\n                {playerDetails.attemptsDetails && playerDetails.attemptsDetails.length > 0 ? (\n                  <div className=\"space-y-2 max-h-[250px] overflow-y-auto pr-1\">\n                    {playerDetails.attemptsDetails.map((attempt: any, idx: number) => (\n                      <div key={idx} className=\"bg-slate-700/30 p-3 rounded-xl flex items-center justify-between\" dir=\"ltr\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-gray-500 text-sm w-6\">#{idx + 1}</span>\n                          <div className=\"flex gap-1\">\n                            {attempt.guess.map((digit: number, i: number) => (\n                              <span key={i} className=\"w-9 h-9 bg-slate-600 rounded-lg flex items-center justify-center text-white font-bold\">\n                                {digit}\n                              </span>\n                            ))}\n                          </div>\n                        </div>\n                        <div className=\"flex gap-2 items-center\">\n                          <div className=\"flex items-center gap-1 bg-green-600/20 px-2 py-1 rounded-lg\">\n                            <Check className=\"w-3.5 h-3.5 text-green-400\" />\n                            <span className=\"text-green-400 font-bold text-sm\">{attempt.correctPositionCount}</span>\n                          </div>\n                          <div className=\"flex items-center gap-1 bg-blue-600/20 px-2 py-1 rounded-lg\">\n                            <span className=\"text-blue-400 font-bold text-sm\">{attempt.correctCount}</span>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"bg-slate-700/30 p-6 rounded-xl text-center\">\n                    <p className=\"text-gray-500\">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…Ø³Ø¬Ù„Ø©</p>\n                    <p className=\"text-gray-600 text-sm mt-1\">Ù‚Ø¯ ØªÙƒÙˆÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</p>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {showHistory && multiplayer.roundHistory.length > 0 && (\n        <div \n          className=\"fixed inset-0 bg-black/70 flex items-center justify-center z-[60] p-4\"\n          onClick={() => setShowHistory(false)}\n        >\n          <div \n            className=\"bg-slate-800 rounded-2xl shadow-2xl border border-slate-700 max-w-lg w-full p-6 max-h-[85vh] overflow-y-auto\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-xl font-bold text-white flex items-center gap-2\">\n                <History className=\"w-5 h-5 text-amber-400\" />\n                Ø³Ø¬Ù„ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª\n              </h2>\n              <button \n                onClick={() => setShowHistory(false)}\n                className=\"w-8 h-8 bg-slate-700 hover:bg-slate-600 rounded-lg flex items-center justify-center transition-colors\"\n              >\n                <X className=\"w-5 h-5 text-gray-400\" />\n              </button>\n            </div>\n\n            <div className=\"flex items-center justify-between mb-4\">\n              <button\n                onClick={() => setHistoryIndex(Math.max(0, historyIndex - 1))}\n                disabled={historyIndex === 0}\n                className=\"p-2 bg-slate-700 hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg transition-colors\"\n              >\n                <ChevronRight className=\"w-5 h-5 text-white\" />\n              </button>\n              <span className=\"text-white font-bold\">\n                Ø¬ÙˆÙ„Ø© {multiplayer.roundHistory[historyIndex]?.roundNumber} Ù…Ù† {multiplayer.roundHistory.length}\n              </span>\n              <button\n                onClick={() => setHistoryIndex(Math.min(multiplayer.roundHistory.length - 1, historyIndex + 1))}\n                disabled={historyIndex === multiplayer.roundHistory.length - 1}\n                className=\"p-2 bg-slate-700 hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg transition-colors\"\n              >\n                <ChevronLeft className=\"w-5 h-5 text-white\" />\n              </button>\n            </div>\n\n            {multiplayer.roundHistory[historyIndex] && (\n              <div className=\"space-y-4\">\n                <div className=\"bg-slate-700/50 p-4 rounded-xl\">\n                  <p className=\"text-gray-400 text-sm mb-2 text-center\">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ</p>\n                  <div className=\"flex justify-center gap-2\" dir=\"ltr\">\n                    {multiplayer.roundHistory[historyIndex].sharedSecret.map((digit, idx) => (\n                      <div\n                        key={idx}\n                        className=\"w-12 h-14 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 rounded-xl flex items-center justify-center text-xl font-bold text-white shadow-lg\"\n                      >\n                        {digit}\n                      </div>\n                    ))}\n                  </div>\n                </div>\n\n                {multiplayer.roundHistory[historyIndex].winners.length > 0 && (\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <Trophy className=\"w-4 h-4 text-yellow-500\" />\n                      <span className=\"text-yellow-400 font-bold text-sm\">Ø§Ù„ÙØ§Ø¦Ø²ÙˆÙ†</span>\n                    </div>\n                    {multiplayer.roundHistory[historyIndex].winners.map((winner) => (\n                      <div key={winner.playerId} className=\"bg-emerald-600/20 border border-emerald-500/50 p-3 rounded-xl\">\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center gap-2\">\n                            <div className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold ${\n                              winner.rank === 1 ? 'bg-gradient-to-br from-yellow-400 to-amber-500 text-black' :\n                              winner.rank === 2 ? 'bg-gradient-to-br from-gray-300 to-gray-400 text-black' :\n                              'bg-gradient-to-br from-orange-400 to-orange-500 text-white'\n                            }`}>\n                              #{winner.rank || 1}\n                            </div>\n                            <span className=\"text-white font-semibold\">{winner.playerName}</span>\n                          </div>\n                          <span className=\"text-emerald-400 text-sm\">{winner.attempts} Ù…Ø­Ø§ÙˆÙ„Ø§Øª</span>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n\n                {multiplayer.roundHistory[historyIndex].losers.length > 0 && (\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <XCircle className=\"w-4 h-4 text-red-500\" />\n                      <span className=\"text-red-400 font-bold text-sm\">Ø§Ù„Ø®Ø§Ø³Ø±ÙˆÙ†</span>\n                    </div>\n                    {multiplayer.roundHistory[historyIndex].losers.map((loser) => (\n                      <div key={loser.playerId} className=\"bg-red-600/20 border border-red-500/50 p-3 rounded-xl\">\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-white font-semibold\">{loser.playerName}</span>\n                          <span className=\"text-red-400 text-sm\">{loser.attempts} Ù…Ø­Ø§ÙˆÙ„Ø§Øª</span>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n\n                <div className=\"text-center text-gray-500 text-xs mt-4\">\n                  {new Date(multiplayer.roundHistory[historyIndex].timestamp).toLocaleString('ar-EG')}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":32255,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-primary/10\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":266,"size_tokens":null},"client/src/components/ui/GameOverScreen.tsx":{"content":"import { Button } from \"./button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"./card\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { send } from \"@/lib/websocket\";\nimport { useState } from \"react\";\n\nexport function GameOverScreen() {\n  const { multiplayer, setMode, resetMultiplayer, setChallengeStatus, setOpponentId, setOpponentName, setMySecretCode } = useNumberGame();\n  const [showOpponentAttempts, setShowOpponentAttempts] = useState(false);\n\n  const isTie = multiplayer.gameResult === \"tie\";\n  const isWinner = multiplayer.phase === \"won\" && !isTie;\n  \n  // When you win, subtract 1 because the last attempt was correct\n  // When you lose or tie, show full count or subtract 1 for opponent who won\n  let myAttempts = multiplayer.attempts.length;\n  let opponentAttempts = multiplayer.opponentAttempts.length;\n  \n  if (isWinner) {\n    // I won - my last attempt was correct, so subtract 1\n    myAttempts = Math.max(0, myAttempts - 1);\n  } else if (isTie) {\n    // Tie - both our last attempts were correct, subtract 1 from each\n    myAttempts = Math.max(0, myAttempts - 1);\n    opponentAttempts = Math.max(0, opponentAttempts - 1);\n  } else {\n    // I lost - opponent's last attempt was correct, subtract 1 from opponent\n    opponentAttempts = Math.max(0, opponentAttempts - 1);\n  }\n  \n  const timeElapsed = multiplayer.endTime && multiplayer.startTime\n    ? Math.floor((multiplayer.endTime - multiplayer.startTime) / 1000)\n    : 0;\n  const minutes = Math.floor(timeElapsed / 60);\n  const seconds = timeElapsed % 60;\n\n  const handleRematch = () => {\n    if (multiplayer.opponentId) {\n      send({ type: \"request_rematch\", opponentId: multiplayer.opponentId });\n    }\n  };\n\n  if (showOpponentAttempts) {\n    return (\n      <div className=\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-80 z-50 overflow-auto\" dir=\"rtl\">\n        <Card className=\"w-full max-w-lg mx-4 my-6 bg-gradient-to-br from-purple-900 to-pink-900 border-2 border-purple-500\">\n          <CardHeader>\n            <CardTitle className=\"text-center text-white text-2xl\">Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø®ØµÙ… ğŸ”</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4 max-h-96 overflow-y-auto\">\n            {multiplayer.opponentAttempts.length === 0 ? (\n              <p className=\"text-center text-gray-300\">Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø­Ø§ÙˆÙ„Ø§Øª</p>\n            ) : (\n              multiplayer.opponentAttempts.map((attempt, index) => (\n                <div key={index} className=\"bg-purple-800 bg-opacity-50 p-3 rounded-lg text-right\">\n                  <p className=\"text-purple-200 text-sm\">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© {index + 1}</p>\n                  <p className=\"text-white text-2xl font-bold tracking-widest\">\n                    {attempt.guess.length > 0 ? attempt.guess.map(d => d).reverse().join(\" \") : \"Ù…Ø­Ø§ÙˆÙ„Ø© ÙØ§Ø±ØºØ©\"}\n                  </p>\n                  <div className=\"text-purple-300 text-sm mt-2 space-y-1\">\n                    <p>âœ“ ÙÙŠ Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„ØµØ­ÙŠØ­: <span className=\"text-white font-bold\">{attempt.correctPositionCount}</span></p>\n                    <p>âœ“ Ø§Ù„Ø±Ù‚Ù… ØµØ­ÙŠØ­ Ù„ÙƒÙ† Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø®Ø·Ø£: <span className=\"text-white font-bold\">{Math.max(0, attempt.correctCount - attempt.correctPositionCount)}</span></p>\n                  </div>\n                </div>\n              ))\n            )}\n          </CardContent>\n          <div className=\"p-4 border-t border-purple-500\">\n            <Button\n              onClick={() => setShowOpponentAttempts(false)}\n              className=\"w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold\"\n            >\n              Ø§Ù„Ø¹ÙˆØ¯Ø©\n            </Button>\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-80 z-50 overflow-auto\" dir=\"rtl\">\n      <Card\n        className={`w-full max-w-lg mx-4 my-6 ${\n          isTie\n            ? \"bg-gradient-to-br from-yellow-900 to-yellow-950 border-yellow-600\"\n            : isWinner\n            ? \"bg-gradient-to-br from-green-900 to-green-950 border-green-600\"\n            : \"bg-gradient-to-br from-red-900 to-red-950 border-red-600\"\n        }`}\n      >\n        <CardHeader>\n          <CardTitle className=\"text-center text-white text-3xl\">\n            {isTie ? \"ğŸ¤ ØªØ¹Ø§Ø¯Ù„!\" : isWinner ? \"ğŸ‰ ÙØ²Øª! ğŸ‰\" : \"ğŸ˜” Ø®Ø³Ø±Øª\"}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"text-center space-y-4\">\n            <div\n              className={`${\n                isTie ? \"bg-yellow-800\" : isWinner ? \"bg-green-800\" : \"bg-red-800\"\n              } bg-opacity-50 p-4 rounded-lg`}\n            >\n              <p\n                className={`${\n                  isTie ? \"text-yellow-200\" : isWinner ? \"text-green-200\" : \"text-red-200\"\n                } text-lg`}\n              >\n                Ø¹Ø¯Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ\n              </p>\n              <p className=\"text-white text-4xl font-bold\">{myAttempts}</p>\n            </div>\n\n            {timeElapsed > 0 && (\n              <div\n                className={`${\n                  isTie ? \"bg-yellow-800\" : isWinner ? \"bg-green-800\" : \"bg-red-800\"\n                } bg-opacity-50 p-4 rounded-lg`}\n              >\n                <p\n                  className={`${\n                    isTie ? \"text-yellow-200\" : isWinner ? \"text-green-200\" : \"text-red-200\"\n                  } text-lg`}\n                >\n                  Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚\n                </p>\n                <p className=\"text-white text-4xl font-bold\">\n                  {minutes > 0 ? `${minutes}:${seconds.toString().padStart(2, \"0\")}` : `${seconds}s`}\n                </p>\n              </div>\n            )}\n\n            <div\n              className={`${\n                isTie ? \"bg-yellow-800\" : isWinner ? \"bg-green-800\" : \"bg-red-800\"\n              } bg-opacity-50 p-4 rounded-lg`}\n            >\n              <p\n                className={`${\n                  isTie ? \"text-yellow-200\" : isWinner ? \"text-green-200\" : \"text-red-200\"\n                } text-lg`}\n              >\n                Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„ØµØ­ÙŠØ­ ÙƒØ§Ù†\n              </p>\n              <p className=\"text-white text-4xl font-bold tracking-wider\">\n                {multiplayer.opponentSecretCode.length > 0 \n                  ? [...multiplayer.opponentSecretCode].reverse().join(\" \") \n                  : \"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ\"}\n              </p>\n            </div>\n\n            <div\n              className={`${\n                isTie ? \"bg-yellow-800\" : isWinner ? \"bg-green-800\" : \"bg-red-800\"\n              } bg-opacity-50 p-4 rounded-lg`}\n            >\n              <p\n                className={`${\n                  isTie ? \"text-yellow-200\" : isWinner ? \"text-green-200\" : \"text-red-200\"\n                } text-lg`}\n              >\n                Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø®ØµÙ…\n              </p>\n              <p className=\"text-white text-4xl font-bold\">{opponentAttempts}</p>\n            </div>\n\n            <Button\n              onClick={() => setShowOpponentAttempts(true)}\n              className={`w-full font-bold ${\n                isTie ? \"bg-yellow-600 hover:bg-yellow-700\" : isWinner ? \"bg-green-600 hover:bg-green-700\" : \"bg-red-600 hover:bg-red-700\"\n              } text-white`}\n            >\n              ğŸ‘€ Ø¹Ø±Ø¶ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø®ØµÙ… Ø¨Ø§Ù„ØªÙØµÙŠÙ„\n            </Button>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Button\n              onClick={handleRematch}\n              className={`w-full ${\n                isTie\n                  ? \"bg-yellow-600 hover:bg-yellow-700\"\n                  : isWinner\n                  ? \"bg-green-600 hover:bg-green-700\"\n                  : \"bg-red-600 hover:bg-red-700\"\n              } text-white font-semibold`}\n              size=\"lg\"\n            >\n              <span className=\"mr-2\">ğŸ”„</span>\n              Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©\n            </Button>\n\n            <Button\n              onClick={() => {\n                setChallengeStatus(\"none\");\n                setOpponentId(null);\n                setOpponentName(\"\");\n                setMySecretCode([]);\n                resetMultiplayer();\n              }}\n              className={`w-full ${\n                isTie\n                  ? \"bg-yellow-600 hover:bg-yellow-700\"\n                  : isWinner\n                  ? \"bg-green-600 hover:bg-green-700\"\n                  : \"bg-red-600 hover:bg-red-700\"\n              } text-white`}\n              size=\"lg\"\n            >\n              Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØºØ±ÙØ©\n            </Button>\n\n            <Button\n              onClick={() => {\n                const { resetMultiplayer } = useNumberGame.getState();\n                resetMultiplayer();\n                setMode(\"menu\");\n                setTimeout(() => {\n                  window.location.reload();\n                }, 300);\n              }}\n              className={`w-full ${\n                isTie\n                  ? \"bg-yellow-700 hover:bg-yellow-800\"\n                  : isWinner\n                  ? \"bg-green-700 hover:bg-green-800\"\n                  : \"bg-red-700 hover:bg-red-800\"\n              } text-white`}\n              size=\"lg\"\n            >\n              Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":9495,"size_tokens":null},"client/src/lib/stores/useCards.ts":{"content":"import { create } from \"zustand\";\n\nexport type CardType = \n  | \"revealNumber\"    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ù‚Ù… ÙˆÙ…ÙƒØ§Ù†Ù‡\n  | \"burnNumber\"      // Ø­Ø±Ù‚ Ø±Ù‚Ù… (Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯)\n  | \"revealParity\"    // Ø¥Ø¸Ù‡Ø§Ø± Ø²ÙˆØ¬ÙŠ/ÙØ±Ø¯ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø§Ù†Ø§Øª\n  | \"freeze\"          // ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ø®ØµÙ…\n  | \"shield\";         // Ø¯Ø±Ø¹ Ø§Ù„Ø¯ÙØ§Ø¹\n\n// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª\nexport interface CardSettings {\n  revealNumberShowPosition: boolean; // true = Ø¥Ø¸Ù‡Ø§Ø± ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø§ØªØŒ false = Ø¥Ø´Ø¹Ø§Ø± ÙÙ‚Ø·\n  burnNumberCount: number; // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…Ø­Ø±ÙˆÙ‚Ø© (Ø§ÙØªØ±Ø§Ø¶ÙŠ 1)\n  revealParitySlots: number; // Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØ´ÙˆÙØ© (Ø§ÙØªØ±Ø§Ø¶ÙŠ = Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…)\n  freezeDuration: number; // Ù…Ø¯Ø© Ø§Ù„ØªØ¬Ù…ÙŠØ¯ Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ (Ø§ÙØªØ±Ø§Ø¶ÙŠ 30)\n  shieldDuration: number; // Ù…Ø¯Ø© Ø§Ù„Ø¯Ø±Ø¹ Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ (Ø§ÙØªØ±Ø§Ø¶ÙŠ 120)\n  roundDuration: number; // Ù…Ø¯Ø© Ø§Ù„Ø¬ÙˆÙ„Ø© Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ (Ø§ÙØªØ±Ø§Ø¶ÙŠ 5)\n}\n\nconst DEFAULT_CARD_SETTINGS: CardSettings = {\n  revealNumberShowPosition: true,\n  burnNumberCount: 1,\n  revealParitySlots: 4,\n  freezeDuration: 30,\n  shieldDuration: 120,\n  roundDuration: 5,\n};\n\nexport type CardIconType = \"eye\" | \"x-circle\" | \"hash\" | \"snowflake\" | \"shield\";\n\nexport interface Card {\n  id: string;\n  type: CardType;\n  name: string;\n  nameAr: string;\n  description: string;\n  descriptionAr: string;\n  icon: CardIconType;\n  color: string;\n  isUsed: boolean;\n  cooldown: number;\n}\n\nexport interface ParityInfo {\n  position: number;\n  isEven: boolean;\n}\n\nexport interface ActiveCardEffect {\n  cardType: CardType;\n  targetPlayerId?: string;\n  sourcePlayerId?: string;\n  sourcePlayerName?: string;\n  expiresAt: number;\n  value?: number | string | number[] | ParityInfo[];\n}\n\nexport interface PlayerCards {\n  playerId: string;\n  cards: Card[];\n  activeEffects: ActiveCardEffect[];\n}\n\ninterface CardState {\n  cardsEnabled: boolean;\n  playerCards: PlayerCards[];\n  cardSettings: CardSettings;\n  revealedDigits: { position: number; digit: number }[]; // Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ÙƒØ´ÙˆÙØ© Ø§Ù„Ø«Ø§Ø¨ØªØ© ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø§Øª\n  burnedNumbers: number[]; // Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…Ø­Ø±ÙˆÙ‚Ø©\n  \n  enableCards: () => void;\n  disableCards: () => void;\n  setCardSettings: (settings: Partial<CardSettings>) => void;\n  \n  initializePlayerCards: (playerId: string) => void;\n  awardWinnerCard: (playerId: string, allowedTypes?: CardType[]) => Card | null;\n  drawCard: (playerId: string, allowedTypes?: CardType[]) => Card | null;\n  useCard: (playerId: string, cardId: string, targetPlayerId?: string, secretNumber?: number[], numDigits?: number) => boolean;\n  \n  addActiveEffect: (playerId: string, effect: ActiveCardEffect) => void;\n  removeExpiredEffects: () => void;\n  hasActiveEffect: (playerId: string, cardType: CardType) => boolean;\n  getActiveEffect: (playerId: string, cardType: CardType) => ActiveCardEffect | null;\n  clearAllActiveEffects: () => void; // ØªÙ†Ø¸ÙŠÙ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª\n  \n  addRevealedDigit: (position: number, digit: number) => void;\n  removeRevealedDigit: (position: number) => void;\n  addBurnedNumber: (num: number) => void;\n  clearRevealedAndBurned: () => void;\n  \n  resetCards: () => void;\n  getPlayerCards: (playerId: string) => Card[];\n}\n\nconst CARD_DEFINITIONS: Omit<Card, \"id\" | \"isUsed\" | \"cooldown\">[] = [\n  {\n    type: \"revealNumber\",\n    name: \"Reveal Number\",\n    nameAr: \"Ø¥Ø¸Ù‡Ø§Ø± Ø±Ù‚Ù…\",\n    description: \"Reveals one digit and its exact position in the secret number\",\n    descriptionAr: \"ÙŠÙƒØ´Ù Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ ÙˆÙ…ÙƒØ§Ù†Ù‡ Ø§Ù„ØµØ­ÙŠØ­ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠ\",\n    icon: \"eye\",\n    color: \"from-purple-500 to-purple-700\",\n  },\n  {\n    type: \"burnNumber\",\n    name: \"Burn Number\",\n    nameAr: \"Ø­Ø±Ù‚ Ø±Ù‚Ù…\",\n    description: \"Shows a number that is NOT in the secret code\",\n    descriptionAr: \"ÙŠØ¸Ù‡Ø± Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠ\",\n    icon: \"x-circle\",\n    color: \"from-red-500 to-red-700\",\n  },\n  {\n    type: \"revealParity\",\n    name: \"Reveal Parity\",\n    nameAr: \"ÙƒØ´Ù Ø§Ù„Ø²ÙˆØ¬ÙŠ ÙˆØ§Ù„ÙØ±Ø¯ÙŠ\",\n    description: \"Shows if two positions have even or odd numbers\",\n    descriptionAr: \"ÙŠØ¸Ù‡Ø± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø®Ø§Ù†ØªÙŠÙ† ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… Ø²ÙˆØ¬ÙŠØ© Ø£Ùˆ ÙØ±Ø¯ÙŠØ©\",\n    icon: \"hash\",\n    color: \"from-green-500 to-green-700\",\n  },\n  {\n    type: \"freeze\",\n    name: \"Freeze\",\n    nameAr: \"ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ø®ØµÙ…\",\n    description: \"Freeze opponent for 30 seconds - they cannot guess\",\n    descriptionAr: \"ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ø®ØµÙ… Ù„Ù…Ø¯Ø© 30 Ø«Ø§Ù†ÙŠØ© - Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„ØªØ®Ù…ÙŠÙ†\",\n    icon: \"snowflake\",\n    color: \"from-cyan-500 to-cyan-700\",\n  },\n  {\n    type: \"shield\",\n    name: \"Shield\",\n    nameAr: \"Ø¯Ø±Ø¹ Ø§Ù„Ø¯ÙØ§Ø¹\",\n    description: \"Blocks the next attack card used against you\",\n    descriptionAr: \"ÙŠØ¨Ø·Ù„ Ù…ÙØ¹ÙˆÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø§Ù„ØªÙŠ ØªÙØ³ØªØ®Ø¯Ù… Ø¶Ø¯Ùƒ\",\n    icon: \"shield\",\n    color: \"from-blue-500 to-blue-700\",\n  },\n];\n\nfunction generateUniqueId(): string {\n  return `card_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\nconst ALL_CARD_TYPES: CardType[] = [\"revealNumber\", \"burnNumber\", \"revealParity\", \"freeze\", \"shield\"];\n\nfunction createRandomCard(allowedTypes?: CardType[]): Card {\n  let availableDefinitions = CARD_DEFINITIONS;\n  \n  const typesToUse = (allowedTypes && allowedTypes.length > 0) ? allowedTypes : ALL_CARD_TYPES;\n  availableDefinitions = CARD_DEFINITIONS.filter(def => typesToUse.includes(def.type));\n  \n  if (availableDefinitions.length === 0) {\n    availableDefinitions = CARD_DEFINITIONS;\n    console.warn(\"[Cards] No allowed card types found, falling back to all types\");\n  }\n  \n  const randomDef = availableDefinitions[Math.floor(Math.random() * availableDefinitions.length)];\n  return {\n    ...randomDef,\n    id: generateUniqueId(),\n    isUsed: false,\n    cooldown: 0,\n  };\n}\n\nconst useCards = create<CardState>((set, get) => ({\n  cardsEnabled: false,\n  playerCards: [],\n  cardSettings: { ...DEFAULT_CARD_SETTINGS },\n  revealedDigits: [],\n  burnedNumbers: [],\n\n  enableCards: () => set({ cardsEnabled: true }),\n  disableCards: () => set({ cardsEnabled: false }),\n  setCardSettings: (settings) => set((state) => ({ \n    cardSettings: { ...state.cardSettings, ...settings } \n  })),\n\n  initializePlayerCards: (playerId: string) => {\n    const { playerCards } = get();\n    const existingPlayer = playerCards.find((p) => p.playerId === playerId);\n    \n    if (!existingPlayer) {\n      set({\n        playerCards: [\n          ...playerCards,\n          {\n            playerId,\n            cards: [],\n            activeEffects: [],\n          },\n        ],\n      });\n      console.log(`[Cards] Initialized player ${playerId} with empty cards`);\n    }\n  },\n\n  awardWinnerCard: (playerId: string, allowedTypes?: CardType[]) => {\n    const { playerCards, cardsEnabled } = get();\n    if (!cardsEnabled) {\n      console.log(\"[Cards] Cards not enabled, skipping award\");\n      return null;\n    }\n    \n    const effectiveAllowedTypes = (allowedTypes && allowedTypes.length > 0) ? allowedTypes : ALL_CARD_TYPES;\n    console.log(`[Cards] Awarding card from types: ${effectiveAllowedTypes.join(\", \")}`);\n    \n    let playerIndex = playerCards.findIndex((p) => p.playerId === playerId);\n    \n    if (playerIndex === -1) {\n      set({\n        playerCards: [\n          ...playerCards,\n          {\n            playerId,\n            cards: [],\n            activeEffects: [],\n          },\n        ],\n      });\n      playerIndex = playerCards.length;\n    }\n    \n    const newCard = createRandomCard(effectiveAllowedTypes);\n    const currentCards = get().playerCards;\n    const updatedPlayerCards = [...currentCards];\n    const pIndex = updatedPlayerCards.findIndex((p) => p.playerId === playerId);\n    \n    if (pIndex !== -1 && updatedPlayerCards[pIndex].cards.length < 5) {\n      updatedPlayerCards[pIndex] = {\n        ...updatedPlayerCards[pIndex],\n        cards: [...updatedPlayerCards[pIndex].cards, newCard],\n      };\n      set({ playerCards: updatedPlayerCards });\n      console.log(`[Cards] Awarded winner card to ${playerId}:`, newCard.nameAr);\n      return newCard;\n    }\n    \n    return null;\n  },\n\n  drawCard: (playerId: string, allowedTypes?: CardType[]) => {\n    const { playerCards } = get();\n    const playerIndex = playerCards.findIndex((p) => p.playerId === playerId);\n    \n    if (playerIndex === -1) return null;\n    \n    const effectiveAllowedTypes = (allowedTypes && allowedTypes.length > 0) ? allowedTypes : ALL_CARD_TYPES;\n    const newCard = createRandomCard(effectiveAllowedTypes);\n    const updatedPlayerCards = [...playerCards];\n    \n    if (updatedPlayerCards[playerIndex].cards.length < 5) {\n      updatedPlayerCards[playerIndex] = {\n        ...updatedPlayerCards[playerIndex],\n        cards: [...updatedPlayerCards[playerIndex].cards, newCard],\n      };\n      set({ playerCards: updatedPlayerCards });\n      return newCard;\n    }\n    \n    return null;\n  },\n\n  useCard: (playerId: string, cardId: string, targetPlayerId?: string, secretNumber?: number[], numDigits?: number) => {\n    const { playerCards, cardSettings, revealedDigits, burnedNumbers } = get();\n    const playerIndex = playerCards.findIndex((p) => p.playerId === playerId);\n    \n    if (playerIndex === -1) return false;\n    \n    const cardIndex = playerCards[playerIndex].cards.findIndex((c) => c.id === cardId);\n    if (cardIndex === -1) return false;\n    \n    const card = playerCards[playerIndex].cards[cardIndex];\n    if (card.isUsed || card.cooldown > 0) return false;\n    \n    // Check if target has shield for attack cards (only if shield was activated BEFORE the attack)\n    const attackCards: CardType[] = [\"freeze\"];\n    const targetPlayer = targetPlayerId \n      ? playerCards.find((p) => p.playerId === targetPlayerId) \n      : null;\n    \n    if (targetPlayerId && attackCards.includes(card.type) && targetPlayer?.activeEffects.some((e) => e.cardType === \"shield\" && e.expiresAt > Date.now())) {\n      // Shield blocks the attack\n      const targetIndex = playerCards.findIndex((p) => p.playerId === targetPlayerId);\n      if (targetIndex !== -1) {\n        const updatedPlayerCards = [...playerCards];\n        // Remove shield effect from target\n        updatedPlayerCards[targetIndex] = {\n          ...updatedPlayerCards[targetIndex],\n          activeEffects: updatedPlayerCards[targetIndex].activeEffects.filter(\n            (e) => e.cardType !== \"shield\"\n          ),\n        };\n        \n        // Remove card from attacker\n        updatedPlayerCards[playerIndex] = {\n          ...updatedPlayerCards[playerIndex],\n          cards: updatedPlayerCards[playerIndex].cards.filter((c) => c.id !== cardId),\n        };\n        \n        set({ playerCards: updatedPlayerCards });\n        console.log(`[Cards] Card ${card.type} blocked by shield!`);\n        return false;\n      }\n    }\n    \n    const updatedPlayerCards = [...playerCards];\n    // Remove the card after use\n    updatedPlayerCards[playerIndex] = {\n      ...updatedPlayerCards[playerIndex],\n      cards: updatedPlayerCards[playerIndex].cards.filter((c) => c.id !== cardId),\n    };\n    \n    let effectDuration = 0;\n    let effectValue: number | string | number[] | ParityInfo[] | undefined;\n    \n    switch (card.type) {\n      case \"revealNumber\":\n        // Reveal one random position and its value (excluding already revealed positions)\n        if (secretNumber && secretNumber.length > 0) {\n          const alreadyRevealedPositions = revealedDigits.map(r => r.position);\n          const availablePositions = Array.from({ length: secretNumber.length }, (_, i) => i)\n            .filter(pos => !alreadyRevealedPositions.includes(pos));\n          \n          if (availablePositions.length > 0) {\n            const randomPos = availablePositions[Math.floor(Math.random() * availablePositions.length)];\n            effectValue = [randomPos, secretNumber[randomPos]];\n            effectDuration = 600000; // Show for 10 minutes (effectively permanent for the round)\n            \n            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…ÙƒØ´ÙˆÙ Ù„Ù„Ø®Ø§Ù†Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØ¹Ù„\n            if (cardSettings.revealNumberShowPosition) {\n              get().addRevealedDigit(randomPos, secretNumber[randomPos]);\n            }\n          }\n        }\n        break;\n        \n      case \"burnNumber\":\n        // Find numbers that are NOT in the secret (based on settings)\n        if (secretNumber) {\n          const possibleNumbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];\n          const alreadyBurned = burnedNumbers;\n          const notInSecret = possibleNumbers.filter(n => \n            !secretNumber.includes(n) && !alreadyBurned.includes(n)\n          );\n          \n          if (notInSecret.length > 0) {\n            const burnCount = Math.min(cardSettings.burnNumberCount, notInSecret.length);\n            const burnedNums: number[] = [];\n            \n            for (let i = 0; i < burnCount; i++) {\n              const idx = Math.floor(Math.random() * (notInSecret.length - i));\n              const num = notInSecret.splice(idx, 1)[0];\n              burnedNums.push(num);\n              get().addBurnedNumber(num);\n            }\n            \n            effectValue = burnedNums.length === 1 ? burnedNums[0] : burnedNums;\n            effectDuration = 600000;\n          }\n        }\n        break;\n        \n      case \"revealParity\":\n        // Reveal even/odd for ALL positions (based on settings)\n        if (secretNumber && secretNumber.length >= 1) {\n          const slotsToReveal = Math.min(\n            cardSettings.revealParitySlots || secretNumber.length, \n            secretNumber.length\n          );\n          const positions: ParityInfo[] = [];\n          \n          // Ø¥Ø¸Ù‡Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨\n          for (let i = 0; i < slotsToReveal; i++) {\n            positions.push({\n              position: i,\n              isEven: secretNumber[i] % 2 === 0\n            });\n          }\n          \n          effectValue = positions;\n          effectDuration = 600000;\n        }\n        break;\n        \n      case \"freeze\":\n        effectDuration = cardSettings.freezeDuration * 1000;\n        break;\n        \n      case \"shield\":\n        effectDuration = cardSettings.shieldDuration * 1000;\n        break;\n    }\n    \n    // Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø±Ù‚Ù… Ù…Ø¹ Ø¥Ø¸Ù‡Ø§Ø± ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø© Ù„Ø§ ØªØ­ØªØ§Ø¬ Ù„ØªØ£Ø«ÙŠØ± Ù†Ø´Ø· (Ù…Ø¤Ù‚Øª)\n    // Ø§Ù„Ø±Ù‚Ù… ÙŠØ¸Ù‡Ø± Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù… ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø© Ø¹Ø¨Ø± revealedDigits\n    const skipActiveEffect = card.type === \"revealNumber\" && cardSettings.revealNumberShowPosition;\n    \n    if (!skipActiveEffect && effectDuration > 0) {\n      const newEffect: ActiveCardEffect = {\n        cardType: card.type,\n        targetPlayerId,\n        sourcePlayerId: playerId,\n        expiresAt: Date.now() + effectDuration,\n        value: effectValue,\n      };\n      \n      // For attack cards (freeze), apply to target\n      // For self cards (shield, reveal), apply to self\n      const effectTargetId = [\"freeze\"].includes(card.type) && targetPlayerId \n        ? targetPlayerId \n        : playerId;\n      \n      let effectTargetIndex = updatedPlayerCards.findIndex((p) => p.playerId === effectTargetId);\n      \n      // If target player doesn't exist in playerCards, add them first\n      if (effectTargetIndex === -1) {\n        updatedPlayerCards.push({\n          playerId: effectTargetId,\n          cards: [],\n          activeEffects: [],\n        });\n        effectTargetIndex = updatedPlayerCards.length - 1;\n        console.log(`[Cards] Initialized target player ${effectTargetId} for effect`);\n      }\n      \n      updatedPlayerCards[effectTargetIndex] = {\n        ...updatedPlayerCards[effectTargetIndex],\n        activeEffects: [...updatedPlayerCards[effectTargetIndex].activeEffects, newEffect],\n      };\n    }\n    \n    set({ playerCards: updatedPlayerCards });\n    console.log(`[Cards] Card ${card.type} used by ${playerId} on ${targetPlayerId || \"self\"}`);\n    return true;\n  },\n\n  addActiveEffect: (playerId: string, effect: ActiveCardEffect) => {\n    const { playerCards } = get();\n    const playerIndex = playerCards.findIndex((p) => p.playerId === playerId);\n    \n    if (playerIndex !== -1) {\n      const updatedPlayerCards = [...playerCards];\n      updatedPlayerCards[playerIndex] = {\n        ...updatedPlayerCards[playerIndex],\n        activeEffects: [...updatedPlayerCards[playerIndex].activeEffects, effect],\n      };\n      set({ playerCards: updatedPlayerCards });\n    }\n  },\n\n  removeExpiredEffects: () => {\n    const { playerCards } = get();\n    const now = Date.now();\n    \n    const updatedPlayerCards = playerCards.map((player) => ({\n      ...player,\n      activeEffects: player.activeEffects.filter((e) => e.expiresAt > now),\n    }));\n    \n    set({ playerCards: updatedPlayerCards });\n  },\n\n  hasActiveEffect: (playerId: string, cardType: CardType) => {\n    const { playerCards } = get();\n    const player = playerCards.find((p) => p.playerId === playerId);\n    if (!player) return false;\n    \n    const now = Date.now();\n    return player.activeEffects.some((e) => e.cardType === cardType && e.expiresAt > now);\n  },\n\n  getActiveEffect: (playerId: string, cardType: CardType) => {\n    const { playerCards } = get();\n    const player = playerCards.find((p) => p.playerId === playerId);\n    if (!player) return null;\n    \n    const now = Date.now();\n    return player.activeEffects.find((e) => e.cardType === cardType && e.expiresAt > now) || null;\n  },\n\n  getPlayerCards: (playerId: string) => {\n    const { playerCards } = get();\n    const player = playerCards.find((p) => p.playerId === playerId);\n    return player?.cards || [];\n  },\n\n  clearAllActiveEffects: () => {\n    const { playerCards } = get();\n    const updatedPlayerCards = playerCards.map((player) => ({\n      ...player,\n      activeEffects: [],\n    }));\n    set({ playerCards: updatedPlayerCards });\n    console.log(\"[Cards] Cleared all active effects\");\n  },\n\n  addRevealedDigit: (position: number, digit: number) => {\n    const { revealedDigits } = get();\n    // Ù„Ø§ ØªØ¶ÙŠÙ Ù†ÙØ³ Ø§Ù„Ù…ÙˆØ¶Ø¹ Ù…Ø±ØªÙŠÙ†\n    if (!revealedDigits.some(r => r.position === position)) {\n      set({ revealedDigits: [...revealedDigits, { position, digit }] });\n      console.log(`[Cards] Added revealed digit: position ${position}, digit ${digit}`);\n    }\n  },\n\n  removeRevealedDigit: (position: number) => {\n    const { revealedDigits } = get();\n    set({ revealedDigits: revealedDigits.filter(r => r.position !== position) });\n    console.log(`[Cards] Removed revealed digit at position ${position}`);\n  },\n\n  addBurnedNumber: (num: number) => {\n    const { burnedNumbers } = get();\n    if (!burnedNumbers.includes(num)) {\n      set({ burnedNumbers: [...burnedNumbers, num] });\n      console.log(`[Cards] Added burned number: ${num}`);\n    }\n  },\n\n  clearRevealedAndBurned: () => {\n    set({ revealedDigits: [], burnedNumbers: [] });\n    console.log(\"[Cards] Cleared revealed digits and burned numbers\");\n  },\n\n  resetCards: () => {\n    set({\n      cardsEnabled: false,\n      playerCards: [],\n      revealedDigits: [],\n      burnedNumbers: [],\n      cardSettings: { ...DEFAULT_CARD_SETTINGS },\n    });\n    console.log(\"[Cards] Full reset completed\");\n  },\n}));\n\nexport { useCards, CARD_DEFINITIONS, ALL_CARD_TYPES, DEFAULT_CARD_SETTINGS };\n","path":null,"size_bytes":19300,"size_tokens":null},"client/src/components/game/challenges/MemoryChallenge.tsx":{"content":"import { useEffect, useState, useRef } from \"react\";\nimport { useChallenges } from \"@/lib/stores/useChallenges\";\nimport { useAudio } from \"@/lib/stores/useAudio\";\nimport { ArrowLeft, Check, X, Minus } from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\nexport function MemoryChallenge({ onExit }: { onExit?: () => void } = {}) {\n  const {\n    memoryChallenge,\n    memoryFlashCells,\n    memorySelectCell,\n    memoryCheckSelection,\n    memoryNextLevel,\n    memorySetScanner,\n    memorySetSuccess,\n    resetToMenu,\n  } = useChallenges();\n\n  const { playConfirm, playError, playSuccess } = useAudio();\n  const [showingPhase, setShowingPhase] = useState(false);\n  const [flashingCells, setFlashingCells] = useState<number[]>([]);\n  const [selectionComplete, setSelectionComplete] = useState(false);\n  const [results, setResults] = useState<{cell: number; status: 'correct' | 'wrong' | 'missed'}[]>([]);\n  const [scannerPosition, setScannerPosition] = useState(0);\n  const [showLevelSuccess, setShowLevelSuccess] = useState(false);\n  const scannerRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    startLevel();\n  }, [memoryChallenge.currentLevel]);\n\n  const startLevel = () => {\n    setShowingPhase(true);\n    setSelectionComplete(false);\n    setResults([]);\n    setShowLevelSuccess(false);\n    setScannerPosition(0);\n    \n    const gridSize = 5;\n    const totalCells = gridSize * gridSize;\n    const flashCounts = [4, 6, 8, 11, 11];\n    const numFlash = flashCounts[Math.min(memoryChallenge.currentLevel - 1, 4)];\n    \n    const cells: number[] = [];\n    while (cells.length < numFlash) {\n      const cell = Math.floor(Math.random() * totalCells);\n      if (!cells.includes(cell)) {\n        cells.push(cell);\n      }\n    }\n\n    memoryFlashCells(cells);\n    setFlashingCells(cells);\n    \n    setTimeout(() => {\n      setFlashingCells([]);\n      setShowingPhase(false);\n    }, 2000);\n  };\n\n  const playScannerSound = () => {\n    const ctx = new (window.AudioContext || (window as any).webkitAudioContext)();\n    const oscillator = ctx.createOscillator();\n    const gainNode = ctx.createGain();\n    \n    oscillator.connect(gainNode);\n    gainNode.connect(ctx.destination);\n    \n    oscillator.frequency.value = 800;\n    oscillator.type = 'sine';\n    \n    gainNode.gain.setValueAtTime(0.1, ctx.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);\n    \n    oscillator.start(ctx.currentTime);\n    oscillator.stop(ctx.currentTime + 0.5);\n  };\n\n  const playSuccessChime = () => {\n    const ctx = new (window.AudioContext || (window as any).webkitAudioContext)();\n    const notes = [523, 659, 784, 1047];\n    \n    notes.forEach((freq, i) => {\n      const oscillator = ctx.createOscillator();\n      const gainNode = ctx.createGain();\n      \n      oscillator.connect(gainNode);\n      gainNode.connect(ctx.destination);\n      \n      oscillator.frequency.value = freq;\n      oscillator.type = 'sine';\n      \n      const startTime = ctx.currentTime + i * 0.1;\n      gainNode.gain.setValueAtTime(0.15, startTime);\n      gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);\n      \n      oscillator.start(startTime);\n      oscillator.stop(startTime + 0.3);\n    });\n  };\n\n  const handleCellClick = (cell: number, e?: React.MouseEvent) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    if (showingPhase || selectionComplete) return;\n    \n    if (memoryChallenge.selectedCells.includes(cell)) return;\n    \n    const isCorrect = memoryChallenge.flashedCells.includes(cell);\n    if (isCorrect) {\n      playConfirm();\n    } else {\n      playError();\n    }\n    \n    memorySelectCell(cell);\n\n    const newSelectedCells = [...memoryChallenge.selectedCells, cell];\n\n    if (newSelectedCells.length === memoryChallenge.flashedCells.length) {\n      const allSelected = newSelectedCells;\n      \n      let allCorrect = true;\n      for (const selectedCell of allSelected) {\n        if (!memoryChallenge.flashedCells.includes(selectedCell)) {\n          allCorrect = false;\n          break;\n        }\n      }\n\n      const newResults: {cell: number; status: 'correct' | 'wrong' | 'missed'}[] = [];\n      \n      for (const selectedCell of allSelected) {\n        if (memoryChallenge.flashedCells.includes(selectedCell)) {\n          newResults.push({ cell: selectedCell, status: 'correct' });\n        } else {\n          newResults.push({ cell: selectedCell, status: 'wrong' });\n        }\n      }\n\n      for (const flashedCell of memoryChallenge.flashedCells) {\n        if (!allSelected.includes(flashedCell)) {\n          newResults.push({ cell: flashedCell, status: 'missed' });\n        }\n      }\n\n      setResults(newResults);\n      setSelectionComplete(true);\n\n      if (allCorrect) {\n        memorySetScanner(true);\n        playScannerSound();\n        \n        let pos = 0;\n        scannerRef.current = setInterval(() => {\n          pos += 5;\n          setScannerPosition(pos);\n          if (pos >= 100) {\n            if (scannerRef.current) clearInterval(scannerRef.current);\n            memorySetScanner(false);\n            \n            setTimeout(() => {\n              setShowLevelSuccess(true);\n              memorySetSuccess(true);\n              playSuccessChime();\n              \n              setTimeout(() => {\n                setShowLevelSuccess(false);\n                memorySetSuccess(false);\n                memoryNextLevel();\n              }, 1500);\n            }, 200);\n          }\n        }, 20);\n      } else {\n        setTimeout(() => {\n          memoryCheckSelection();\n        }, 1500);\n      }\n    }\n  };\n\n  useEffect(() => {\n    return () => {\n      if (scannerRef.current) clearInterval(scannerRef.current);\n    };\n  }, []);\n\n  const getCellStatus = (cell: number) => {\n    if (showingPhase && flashingCells.includes(cell)) return \"flashing\";\n    if (selectionComplete) {\n      const result = results.find(r => r.cell === cell);\n      if (result) return result.status;\n    }\n    if (memoryChallenge.selectedCells.includes(cell)) return \"selected\";\n    return \"normal\";\n  };\n\n  const getCellColor = (status: string) => {\n    if (status === \"flashing\") return \"bg-yellow-500 shadow-lg shadow-yellow-500/50\";\n    if (status === \"correct\") return \"bg-green-500\";\n    if (status === \"wrong\") return \"bg-red-500\";\n    if (status === \"missed\") return \"bg-orange-500\";\n    if (status === \"selected\") return \"bg-blue-400\";\n    return \"bg-slate-700 hover:bg-slate-600\";\n  };\n\n  const getCellIcon = (status: string) => {\n    if (status === \"correct\") return <Check className=\"w-6 h-6 sm:w-8 sm:h-8 text-white\" />;\n    if (status === \"wrong\") return <X className=\"w-6 h-6 sm:w-8 sm:h-8 text-white\" />;\n    if (status === \"missed\") return <Minus className=\"w-6 h-6 sm:w-8 sm:h-8 text-white\" />;\n    return null;\n  };\n\n  return (\n    <div className=\"w-full h-full flex flex-col items-center justify-center p-4 sm:p-8 bg-slate-950\">\n      <div className=\"w-full max-w-2xl\">\n        <div className=\"flex items-center justify-between mb-6 sm:mb-8\">\n          <button\n            onClick={() => {\n              resetToMenu();\n              onExit?.();\n            }}\n            className=\"flex items-center gap-2 bg-slate-800/80 hover:bg-slate-700/80 text-white px-4 py-2 sm:px-6 sm:py-3 rounded-xl transition-all shadow-lg\"\n          >\n            <ArrowLeft className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n            <span className=\"font-bold text-sm sm:text-base\">Ø±Ø¬ÙˆØ¹</span>\n          </button>\n\n          <div className=\"text-center\">\n            <h2 className=\"text-xl sm:text-2xl lg:text-4xl font-bold text-white mb-1\">\n              Ù„ÙˆØ­Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©\n            </h2>\n            <p className=\"text-sm sm:text-base lg:text-lg text-gray-400\">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ {memoryChallenge.currentLevel} / 5</p>\n          </div>\n\n          <div className=\"w-16 sm:w-24\"></div>\n        </div>\n\n        <div className=\"text-center mb-6 sm:mb-8\">\n          {showingPhase ? (\n            <p className=\"text-base sm:text-lg lg:text-2xl font-bold text-yellow-400 animate-pulse\">\n              Ø±Ø§Ù‚Ø¨ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù…Ø¶ÙŠØ¦Ø©...\n            </p>\n          ) : (\n            <div>\n              <p className=\"text-sm sm:text-base lg:text-xl text-white mb-2\">\n                Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„ØªÙŠ Ø¶Ø§Ø¡Øª\n              </p>\n              <p className=\"text-xs sm:text-sm lg:text-lg text-gray-400\">\n                {memoryChallenge.selectedCells.length} / {memoryChallenge.flashedCells.length}\n              </p>\n            </div>\n          )}\n        </div>\n\n        <div className=\"relative flex justify-center\">\n          <div \n            className=\"grid gap-2 sm:gap-3\"\n            style={{\n              gridTemplateColumns: `repeat(5, minmax(0, 1fr))`,\n              width: 'min(90vw, 320px)',\n              maxWidth: '320px'\n            }}\n          >\n            {Array.from({ length: 25 }).map((_, i) => {\n              const status = getCellStatus(i);\n              const color = getCellColor(status);\n              const icon = getCellIcon(status);\n\n              return (\n                <motion.button\n                  key={i}\n                  onClick={(e) => handleCellClick(i, e)}\n                  disabled={showingPhase || selectionComplete}\n                  className={`aspect-square rounded-lg transition-all transform ${color} ${\n                    !showingPhase && !selectionComplete\n                      ? \"hover:scale-105 cursor-pointer\"\n                      : \"cursor-not-allowed\"\n                  } flex items-center justify-center shadow-lg`}\n                  whileTap={{ scale: 0.95 }}\n                  animate={\n                    status === \"selected\" && !selectionComplete\n                      ? { scale: [1, 1.1, 1] }\n                      : {}\n                  }\n                  transition={{ duration: 0.2 }}\n                >\n                  <AnimatePresence>\n                    {icon && (\n                      <motion.div\n                        initial={{ scale: 0, rotate: -180 }}\n                        animate={{ scale: 1, rotate: 0 }}\n                        exit={{ scale: 0 }}\n                        transition={{ type: \"spring\", stiffness: 300, damping: 20 }}\n                      >\n                        {icon}\n                      </motion.div>\n                    )}\n                  </AnimatePresence>\n                </motion.button>\n              );\n            })}\n          </div>\n\n          <AnimatePresence>\n            {memoryChallenge.showingScanner && (\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"absolute inset-0 pointer-events-none overflow-hidden rounded-xl\"\n              >\n                <motion.div\n                  className=\"absolute left-0 right-0 h-1 bg-gradient-to-r from-transparent via-cyan-400 to-transparent shadow-lg shadow-cyan-400/50\"\n                  style={{ top: `${scannerPosition}%` }}\n                />\n                <div \n                  className=\"absolute inset-0 bg-gradient-to-b from-cyan-500/10 to-transparent\"\n                  style={{ height: `${scannerPosition}%` }}\n                />\n              </motion.div>\n            )}\n          </AnimatePresence>\n\n          <AnimatePresence>\n            {showLevelSuccess && (\n              <motion.div\n                initial={{ scale: 0, opacity: 0 }}\n                animate={{ scale: 1, opacity: 1 }}\n                exit={{ scale: 0, opacity: 0 }}\n                className=\"absolute inset-0 flex items-center justify-center bg-black/50 rounded-xl\"\n              >\n                <motion.div\n                  initial={{ scale: 0 }}\n                  animate={{ scale: [0, 1.2, 1] }}\n                  transition={{ duration: 0.5 }}\n                  className=\"w-24 h-24 sm:w-32 sm:h-32 bg-green-500 rounded-full flex items-center justify-center shadow-2xl shadow-green-500/50\"\n                >\n                  <Check className=\"w-16 h-16 sm:w-20 sm:h-20 text-white\" />\n                </motion.div>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n\n        {selectionComplete && !memoryChallenge.showingScanner && !showLevelSuccess && (\n          <motion.div \n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"mt-6 sm:mt-8 text-center\"\n          >\n            <div className=\"flex flex-wrap items-center justify-center gap-3 sm:gap-6\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-4 h-4 sm:w-6 sm:h-6 bg-green-500 rounded\"></div>\n                <span className=\"text-xs sm:text-base text-white\">ØµØ­ÙŠØ­</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-4 h-4 sm:w-6 sm:h-6 bg-red-500 rounded\"></div>\n                <span className=\"text-xs sm:text-base text-white\">Ø®Ø·Ø£</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-4 h-4 sm:w-6 sm:h-6 bg-orange-500 rounded\"></div>\n                <span className=\"text-xs sm:text-base text-white\">ÙØ§Ø¦Øª</span>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":13360,"size_tokens":null},"client/src/components/game/NumberPanel.tsx":{"content":"import { useRef, useState, useEffect, useCallback } from \"react\";\nimport { useFrame, ThreeEvent, useThree } from \"@react-three/fiber\";\nimport { Text, RoundedBox } from \"@react-three/drei\";\nimport * as THREE from \"three\";\nimport { useNumberGame, GamePhase } from \"@/lib/stores/useNumberGame\";\nimport { useAudio } from \"@/lib/stores/useAudio\";\nimport { send } from \"@/lib/websocket\";\nimport { toast } from \"sonner\";\nimport { DisplayPanel } from \"./DisplayPanel\";\n\ninterface ButtonProps {\n  position: [number, number, number];\n  digit: number;\n  onClick: (digit: number) => void;\n}\n\ninterface NumberButtonProps extends ButtonProps {\n  isPointerLocked?: boolean;\n  ref?: React.Ref<THREE.Mesh>;\n}\n\nconst NumberButton = ({ position, digit, onClick, isPointerLocked }: NumberButtonProps) => {\n  const [hovered, setHovered] = useState(false);\n  const [isHoveredByCenter, setIsHoveredByCenter] = useState(false);\n  const [buttonZ, setButtonZ] = useState(0);\n  const meshRef = useRef<THREE.Mesh>(null);\n  const raycaster = useRef(new THREE.Raycaster());\n  const { camera } = useThree();\n\n  useFrame(() => {\n    if (isPointerLocked && meshRef.current) {\n      const normalizedCoords = new THREE.Vector2(0, 0);\n      raycaster.current.setFromCamera(normalizedCoords, camera);\n      const intersects = raycaster.current.intersectObject(meshRef.current);\n      \n      if (intersects.length > 0) {\n        setIsHoveredByCenter(true);\n        meshRef.current.scale.setScalar(1.08);\n        meshRef.current.position.z = 0.12;\n        setButtonZ(0.12);\n      } else {\n        setIsHoveredByCenter(false);\n        meshRef.current.scale.setScalar(1);\n        meshRef.current.position.z = 0;\n        setButtonZ(0);\n      }\n    } else if (meshRef.current && hovered && !isPointerLocked) {\n      meshRef.current.scale.setScalar(1.08);\n      meshRef.current.position.z = 0.12;\n      setButtonZ(0.12);\n    } else if (meshRef.current) {\n      meshRef.current.scale.setScalar(1);\n      meshRef.current.position.z = 0;\n      setButtonZ(0);\n    }\n  });\n\n  // Keyboard and mouse listener for center crosshair click\n  useEffect(() => {\n    if (!isPointerLocked || !isHoveredByCenter) return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.code === \"Space\" || e.code === \"Enter\") {\n        e.preventDefault();\n        onClick(digit);\n      }\n    };\n\n    const handleMouseDown = (e: MouseEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n      onClick(digit);\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown, { passive: false });\n    window.addEventListener(\"mousedown\", handleMouseDown, { passive: false });\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyDown);\n      window.removeEventListener(\"mousedown\", handleMouseDown);\n    };\n  }, [isPointerLocked, isHoveredByCenter, digit, onClick]);\n\n  return (\n    <group position={position}>\n      <RoundedBox\n        ref={meshRef}\n        args={[0.85, 0.85, 0.25]}\n        radius={0.15}\n        smoothness={6}\n        onClick={(e: ThreeEvent<MouseEvent>) => {\n          if (!isPointerLocked) {\n            e.stopPropagation();\n            onClick(digit);\n          }\n        }}\n        onPointerOver={(e: ThreeEvent<PointerEvent>) => {\n          if (!isPointerLocked) {\n            e.stopPropagation();\n            setHovered(true);\n          }\n        }}\n        onPointerOut={(e: ThreeEvent<PointerEvent>) => {\n          setHovered(false);\n        }}\n        castShadow\n      >\n        <meshStandardMaterial \n          color={hovered ? \"#7c3aed\" : \"#8b5cf6\"}\n          metalness={0.2}\n          roughness={0.4}\n          emissive={hovered ? \"#5b21b6\" : \"#000000\"}\n          emissiveIntensity={hovered ? 0.4 : 0}\n        />\n      </RoundedBox>\n      <Text\n        position={[0, 0, 0.16 + buttonZ]}\n        fontSize={0.48}\n        color=\"white\"\n        anchorX=\"center\"\n        anchorY=\"middle\"\n        fontWeight=\"bold\"\n      >\n        {digit}\n      </Text>\n    </group>\n  );\n};\n\ninterface DeleteButtonProps {\n  position: [number, number, number];\n  onClick: () => void;\n  isPointerLocked?: boolean;\n}\n\nconst DeleteButton = ({ position, onClick, isPointerLocked }: DeleteButtonProps) => {\n  const [hovered, setHovered] = useState(false);\n  const [isHoveredByCenter, setIsHoveredByCenter] = useState(false);\n  const [buttonZ, setButtonZ] = useState(0);\n  const meshRef = useRef<THREE.Mesh>(null);\n  const raycaster = useRef(new THREE.Raycaster());\n  const { camera } = useThree();\n\n  useFrame(() => {\n    if (isPointerLocked && meshRef.current) {\n      const normalizedCoords = new THREE.Vector2(0, 0);\n      raycaster.current.setFromCamera(normalizedCoords, camera);\n      const intersects = raycaster.current.intersectObject(meshRef.current);\n      \n      if (intersects.length > 0) {\n        setIsHoveredByCenter(true);\n        meshRef.current.scale.setScalar(1.08);\n        meshRef.current.position.z = 0.12;\n        setButtonZ(0.12);\n      } else {\n        setIsHoveredByCenter(false);\n        meshRef.current.scale.setScalar(1);\n        meshRef.current.position.z = 0;\n        setButtonZ(0);\n      }\n    } else if (meshRef.current && hovered && !isPointerLocked) {\n      meshRef.current.scale.setScalar(1.08);\n      meshRef.current.position.z = 0.12;\n      setButtonZ(0.12);\n    } else if (meshRef.current) {\n      meshRef.current.scale.setScalar(1);\n      meshRef.current.position.z = 0;\n      setButtonZ(0);\n    }\n  });\n\n  useEffect(() => {\n    if (!isPointerLocked || !isHoveredByCenter) return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.code === \"Space\" || e.code === \"Enter\") {\n        e.preventDefault();\n        onClick();\n      }\n    };\n\n    const handleMouseDown = (e: MouseEvent) => {\n      e.preventDefault();\n      onClick();\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    window.addEventListener(\"mousedown\", handleMouseDown);\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyDown);\n      window.removeEventListener(\"mousedown\", handleMouseDown);\n    };\n  }, [isPointerLocked, isHoveredByCenter, onClick]);\n\n  return (\n    <group position={position}>\n      <RoundedBox\n        ref={meshRef}\n        args={[0.85, 0.85, 0.25]}\n        radius={0.15}\n        smoothness={6}\n        onClick={(e: ThreeEvent<MouseEvent>) => {\n          if (!isPointerLocked) {\n            e.stopPropagation();\n            onClick();\n          }\n        }}\n        onPointerOver={(e: ThreeEvent<PointerEvent>) => {\n          if (!isPointerLocked) {\n            e.stopPropagation();\n            setHovered(true);\n          }\n        }}\n        onPointerOut={(e: ThreeEvent<PointerEvent>) => {\n          setHovered(false);\n        }}\n        castShadow\n      >\n        <meshStandardMaterial \n          color={hovered ? \"#dc2626\" : \"#ef4444\"}\n          metalness={0.2}\n          roughness={0.4}\n          emissive={hovered ? \"#991b1b\" : \"#000000\"}\n          emissiveIntensity={hovered ? 0.4 : 0}\n        />\n      </RoundedBox>\n      <Text\n        position={[0, 0, 0.16 + buttonZ]}\n        fontSize={0.42}\n        color=\"white\"\n        anchorX=\"center\"\n        anchorY=\"middle\"\n        fontWeight=\"bold\"\n      >\n        âœ•\n      </Text>\n    </group>\n  );\n};\n\ninterface ConfirmButtonProps {\n  position: [number, number, number];\n  onClick: () => void;\n  enabled: boolean;\n  isPointerLocked?: boolean;\n}\n\nconst ConfirmButton = ({ position, onClick, enabled, isPointerLocked }: ConfirmButtonProps) => {\n  const [hovered, setHovered] = useState(false);\n  const [isHoveredByCenter, setIsHoveredByCenter] = useState(false);\n  const [buttonZ, setButtonZ] = useState(0);\n  const meshRef = useRef<THREE.Mesh>(null);\n  const raycaster = useRef(new THREE.Raycaster());\n  const { camera } = useThree();\n\n  useFrame(() => {\n    if (isPointerLocked && meshRef.current && enabled) {\n      const normalizedCoords = new THREE.Vector2(0, 0);\n      raycaster.current.setFromCamera(normalizedCoords, camera);\n      const intersects = raycaster.current.intersectObject(meshRef.current);\n      \n      if (intersects.length > 0) {\n        setIsHoveredByCenter(true);\n        meshRef.current.scale.setScalar(1.08);\n        meshRef.current.position.z = 0.12;\n        setButtonZ(0.12);\n      } else {\n        setIsHoveredByCenter(false);\n        meshRef.current.scale.setScalar(1);\n        meshRef.current.position.z = 0;\n        setButtonZ(0);\n      }\n    } else if (meshRef.current && hovered && enabled && !isPointerLocked) {\n      meshRef.current.scale.setScalar(1.08);\n      meshRef.current.position.z = 0.12;\n      setButtonZ(0.12);\n    } else if (meshRef.current) {\n      meshRef.current.scale.setScalar(1);\n      meshRef.current.position.z = 0;\n      setButtonZ(0);\n    }\n  });\n\n  useEffect(() => {\n    if (!isPointerLocked || !isHoveredByCenter || !enabled) return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.code === \"Space\" || e.code === \"Enter\") {\n        e.preventDefault();\n        onClick();\n      }\n    };\n\n    const handleMouseDown = (e: MouseEvent) => {\n      e.preventDefault();\n      onClick();\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    window.addEventListener(\"mousedown\", handleMouseDown);\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyDown);\n      window.removeEventListener(\"mousedown\", handleMouseDown);\n    };\n  }, [isPointerLocked, isHoveredByCenter, enabled, onClick]);\n\n  return (\n    <group position={position}>\n      <RoundedBox\n        ref={meshRef}\n        args={[0.85, 0.85, 0.25]}\n        radius={0.15}\n        smoothness={6}\n        onClick={(e: ThreeEvent<MouseEvent>) => {\n          if (!isPointerLocked && enabled) {\n            e.stopPropagation();\n            onClick();\n          }\n        }}\n        onPointerOver={(e: ThreeEvent<PointerEvent>) => {\n          if (!isPointerLocked) {\n            e.stopPropagation();\n            if (enabled) {\n              setHovered(true);\n            }\n          }\n        }}\n        onPointerOut={(e: ThreeEvent<PointerEvent>) => {\n          setHovered(false);\n        }}\n        castShadow\n      >\n        <meshStandardMaterial \n          color={enabled ? (hovered ? \"#059669\" : \"#10b981\") : \"#9ca3af\"}\n          metalness={0.2}\n          roughness={0.4}\n          emissive={enabled && hovered ? \"#047857\" : \"#000000\"}\n          emissiveIntensity={enabled && hovered ? 0.4 : 0}\n        />\n      </RoundedBox>\n      <Text\n        position={[0, 0, 0.16 + buttonZ]}\n        fontSize={0.42}\n        color=\"white\"\n        anchorX=\"center\"\n        anchorY=\"middle\"\n        fontWeight=\"bold\"\n      >\n        âœ“\n      </Text>\n    </group>\n  );\n};\n\ninterface NumberPanelProps {\n  isPointerLocked?: boolean;\n}\n\nexport function NumberPanel({ isPointerLocked = false }: NumberPanelProps) {\n  const { mode, singleplayer, multiplayer, addDigitToGuess, deleteLastDigit, submitGuess, addMultiplayerDigit, deleteMultiplayerDigit, submitMultiplayerGuess } = useNumberGame();\n  const { playDigit, playDelete, playSuccess, playError, playConfirm } = useAudio();\n  \n  const numDigits = mode === \"singleplayer\" ? singleplayer.settings.numDigits : multiplayer.settings.numDigits;\n\n  // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ù†Ø¬Ø§Ø­ Ø¹Ù†Ø¯ Ø§Ù„ÙÙˆØ²\n  const [wonSoundPlayed, setWonSoundPlayed] = useState(false);\n  const prevPhaseRef = useRef<GamePhase | null>(null);\n  \n  useEffect(() => {\n    let currentPhase: GamePhase | null = null;\n    \n    if (mode === \"singleplayer\") {\n      currentPhase = singleplayer.phase;\n    } else if (mode === \"multiplayer\") {\n      currentPhase = multiplayer.phase;\n    }\n    \n    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙ„ Ø¥Ù„Ù‰ \"won\" Ù…Ù† Ø­Ø§Ù„Ø© Ø£Ø®Ø±Ù‰\n    if (currentPhase === \"won\" && prevPhaseRef.current !== \"won\" && !wonSoundPlayed) {\n      playSuccess();\n      setWonSoundPlayed(true);\n    }\n    \n    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ù„Ù… Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©\n    if (currentPhase === \"playing\" && prevPhaseRef.current !== \"playing\") {\n      setWonSoundPlayed(false);\n    }\n    \n    prevPhaseRef.current = currentPhase;\n  }, [mode, singleplayer.phase, multiplayer.phase, playSuccess, wonSoundPlayed]);\n\n  const handleDigitClick = useCallback((digit: number) => {\n    if (mode === \"singleplayer\") {\n      if (singleplayer.phase === \"playing\") {\n        playDigit(digit);\n        addDigitToGuess(digit);\n      }\n    } else if (mode === \"multiplayer\") {\n      if (multiplayer.gameStatus !== \"playing\" || multiplayer.phase !== \"playing\") {\n        toast.warning(\"Ø§Ù„Ù„Ø¹Ø¨Ø© ØºÙŠØ± Ù†Ø´Ø·Ø©\", { duration: 3000 });\n        return;\n      }\n      playDigit(digit);\n      addMultiplayerDigit(digit);\n    }\n  }, [mode, playDigit, addDigitToGuess, addMultiplayerDigit, multiplayer.gameStatus, multiplayer.phase, singleplayer.phase]);\n\n  const handleDeleteClick = useCallback(() => {\n    if (mode === \"singleplayer\") {\n      if (singleplayer.phase === \"playing\") {\n        playDelete();\n        deleteLastDigit();\n      }\n    } else if (mode === \"multiplayer\") {\n      if (multiplayer.gameStatus !== \"playing\" || multiplayer.phase !== \"playing\") {\n        return;\n      }\n      playDelete();\n      deleteMultiplayerDigit();\n    }\n  }, [mode, playDelete, deleteLastDigit, deleteMultiplayerDigit, multiplayer.gameStatus, multiplayer.phase, singleplayer.phase]);\n\n  const handleConfirmClick = useCallback(() => {\n    if (mode === \"singleplayer\") {\n      if (singleplayer.phase !== \"playing\") {\n        return;\n      }\n      const currentGuess = singleplayer.currentGuess;\n      if (currentGuess.length === numDigits) {\n        playConfirm();\n        submitGuess();\n      } else {\n        playError();\n      }\n    } else if (mode === \"multiplayer\") {\n      if (multiplayer.gameStatus !== \"playing\" || multiplayer.phase !== \"playing\") {\n        toast.warning(\"Ø§Ù„Ù„Ø¹Ø¨Ø© ØºÙŠØ± Ù†Ø´Ø·Ø©\", { duration: 3000 });\n        return;\n      }\n      const currentGuess = multiplayer.currentGuess;\n      if (currentGuess.length === numDigits) {\n        playConfirm();\n        const guessToSend = [...currentGuess];\n        submitMultiplayerGuess();\n        send({\n          type: \"submit_guess\",\n          guess: guessToSend,\n        });\n      } else {\n        playError();\n      }\n    }\n  }, [mode, singleplayer.currentGuess, singleplayer.phase, multiplayer.gameStatus, multiplayer.phase, multiplayer.currentGuess, numDigits, playConfirm, playError, submitGuess, submitMultiplayerGuess]);\n\n  // Keyboard input listener\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Check if game is active\n      const isGameActive = mode === \"singleplayer\" || \n                          (mode === \"multiplayer\" && multiplayer.gameStatus === \"playing\");\n      \n      if (!isGameActive) return;\n      \n      // Numbers 0-9\n      if (e.key >= \"0\" && e.key <= \"9\") {\n        e.preventDefault();\n        handleDigitClick(parseInt(e.key));\n      }\n      // Backspace or Delete\n      else if (e.key === \"Backspace\" || e.key === \"Delete\") {\n        e.preventDefault();\n        handleDeleteClick();\n      }\n      // Enter or Space for submit\n      else if (e.key === \"Enter\" || e.code === \"Space\") {\n        e.preventDefault();\n        handleConfirmClick();\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [mode, multiplayer.gameStatus, handleDigitClick, handleDeleteClick, handleConfirmClick]);\n\n  const currentGuess = mode === \"singleplayer\" ? singleplayer.currentGuess : multiplayer.currentGuess;\n  const canConfirm = currentGuess.length === numDigits && (mode === \"singleplayer\" || multiplayer.gameStatus === \"playing\");\n\n  return (\n    <group position={[0, 3.5, -12.3]}>\n      <DisplayPanel />\n\n      {[1, 2, 3].map((digit, idx) => (\n        <NumberButton\n          key={digit}\n          position={[(idx - 1) * 1.05, 0.8, -0.1]}\n          digit={digit}\n          onClick={handleDigitClick}\n          isPointerLocked={isPointerLocked}\n        />\n      ))}\n      \n      {[4, 5, 6].map((digit, idx) => (\n        <NumberButton\n          key={digit}\n          position={[(idx - 1) * 1.05, -0.3, -0.1]}\n          digit={digit}\n          onClick={handleDigitClick}\n          isPointerLocked={isPointerLocked}\n        />\n      ))}\n\n      {[7, 8, 9].map((digit, idx) => (\n        <NumberButton\n          key={digit}\n          position={[(idx - 1) * 1.05, -1.4, -0.1]}\n          digit={digit}\n          onClick={handleDigitClick}\n          isPointerLocked={isPointerLocked}\n        />\n      ))}\n\n      <DeleteButton position={[-1.05, -2.5, -0.1]} onClick={handleDeleteClick} isPointerLocked={isPointerLocked} />\n      <NumberButton\n        position={[0, -2.5, -0.1]}\n        digit={0}\n        onClick={handleDigitClick}\n        isPointerLocked={isPointerLocked}\n      />\n      <ConfirmButton position={[1.05, -2.5, -0.1]} onClick={handleConfirmClick} enabled={canConfirm} isPointerLocked={isPointerLocked} />\n    </group>\n  );\n}\n","path":null,"size_bytes":16903,"size_tokens":null},"client/src/components/game/CurrentGuessDisplay.tsx":{"content":"import { Text } from \"@react-three/drei\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\n\nexport function CurrentGuessDisplay() {\n  const { mode, singleplayer, multiplayer } = useNumberGame();\n\n  let feedbackText = \"\";\n  let feedbackColor = \"#4338ca\";\n  \n  if (mode === \"singleplayer\" && singleplayer.attempts.length > 0) {\n    const lastAttempt = singleplayer.attempts[singleplayer.attempts.length - 1];\n    const correctCount = lastAttempt.correctCount;\n    const correctPositionCount = lastAttempt.correctPositionCount;\n    const numDigits = singleplayer.settings.numDigits;\n    \n    if (correctCount === 0) {\n      feedbackText = \"ÙˆÙ„Ø§ Ø±Ù‚Ù… ØµØ­\";\n      feedbackColor = \"#ef4444\";\n    } else if (correctPositionCount === numDigits) {\n      feedbackText = \"ÙÙˆØ²!\";\n      feedbackColor = \"#10b981\";\n    } else if (correctPositionCount === 0) {\n      feedbackText = `${correctCount} ØµØ­ - Ù…ÙƒØ§Ù† ØºÙ„Ø·`;\n      feedbackColor = \"#f97316\";\n    } else if (correctCount === correctPositionCount) {\n      feedbackText = `${correctPositionCount} ØµØ­ - Ù…ÙƒØ§Ù† ØµØ­`;\n      feedbackColor = \"#10b981\";\n    } else {\n      feedbackText = `${correctCount} ØµØ­ - ${correctPositionCount} Ù…ÙƒØ§Ù† ØµØ­`;\n      feedbackColor = \"#f97316\";\n    }\n  } else if (mode === \"multiplayer\" && multiplayer.attempts.length > 0) {\n    const lastAttempt = multiplayer.attempts[multiplayer.attempts.length - 1];\n    const correctCount = lastAttempt.correctCount;\n    const correctPositionCount = lastAttempt.correctPositionCount;\n    const numDigits = multiplayer.settings.numDigits;\n    \n    if (correctCount === 0) {\n      feedbackText = \"ÙˆÙ„Ø§ Ø±Ù‚Ù… ØµØ­\";\n      feedbackColor = \"#ef4444\";\n    } else if (correctPositionCount === numDigits) {\n      feedbackText = \"ÙÙˆØ²!\";\n      feedbackColor = \"#10b981\";\n    } else if (correctPositionCount === 0) {\n      feedbackText = `${correctCount} ØµØ­ - Ù…ÙƒØ§Ù† ØºÙ„Ø·`;\n      feedbackColor = \"#f97316\";\n    } else if (correctCount === correctPositionCount) {\n      feedbackText = `${correctPositionCount} ØµØ­ - Ù…ÙƒØ§Ù† ØµØ­`;\n      feedbackColor = \"#10b981\";\n    } else {\n      feedbackText = `${correctCount} ØµØ­ - ${correctPositionCount} Ù…ÙƒØ§Ù† ØµØ­`;\n      feedbackColor = \"#f97316\";\n    }\n  }\n\n  if (!feedbackText) return null;\n\n  return (\n    <Text\n      position={[0, 0.5, -7.9]}\n      fontSize={0.4}\n      color={feedbackColor}\n      anchorX=\"center\"\n      anchorY=\"middle\"\n      fontWeight=\"bold\"\n      maxWidth={8}\n    >\n      {feedbackText}\n    </Text>\n  );\n}\n","path":null,"size_bytes":2523,"size_tokens":null},"client/src/components/game/FeedbackPanel.tsx":{"content":"import { Text } from \"@react-three/drei\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\n\nfunction getFeedbackText(correctCount: number, correctPositionCount: number, numDigits: number): string {\n  if (correctCount === 0) {\n    return \"ÙˆÙ„Ø§ Ø±Ù‚Ù… ØµØ­\";\n  }\n  \n  const correctInWrongPosition = correctCount - correctPositionCount;\n  \n  if (correctPositionCount === numDigits) {\n    return \"ÙƒÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØµØ­ÙŠØ­Ø©!\";\n  }\n  \n  if (correctPositionCount === 0 && correctCount > 0) {\n    if (correctCount === 1) return \"Ø±Ù‚Ù… ØµØ­ ÙˆÙ…ÙƒØ§Ù†Ù‡ ØºÙ„Ø·\";\n    if (correctCount === 2) return \"Ø±Ù‚Ù…ÙŠÙ† ØµØ­ ÙˆÙ…ÙƒØ§Ù†Ù‡Ù… ØºÙ„Ø·\";\n    if (correctCount === 3) return \"3 ØµØ­ ÙˆÙ…ÙƒØ§Ù†Ù‡Ù… ØºÙ„Ø·\";\n    return `${correctCount} ØµØ­ ÙˆÙ…ÙƒØ§Ù†Ù‡Ù… ØºÙ„Ø·`;\n  }\n  \n  if (correctPositionCount > 0 && correctInWrongPosition === 0) {\n    if (correctPositionCount === 1) return \"Ø±Ù‚Ù… ØµØ­ ÙˆÙ…ÙƒØ§Ù†Ù‡ ØµØ­\";\n    if (correctPositionCount === 2) return \"Ø±Ù‚Ù…ÙŠÙ† ØµØ­ ÙˆÙ…ÙƒØ§Ù†Ù‡Ù… ØµØ­\";\n    if (correctPositionCount === 3) return \"3 ØµØ­ ÙˆÙ…ÙƒØ§Ù†Ù‡Ù… ØµØ­\";\n  }\n  \n  if (correctPositionCount === 1 && correctInWrongPosition === 1) {\n    return \"Ø±Ù‚Ù…ÙŠÙ† ØµØ­ Ùˆ ÙˆØ§Ø­Ø¯ Ù…ÙƒØ§Ù†Ù‡ ØµØ­\";\n  }\n  \n  return `${correctCount} ØµØ­ Ùˆ ${correctPositionCount} Ù…ÙƒØ§Ù†Ù‡Ù… ØµØ­`;\n}\n\nexport function FeedbackPanel() {\n  return null;\n}\n","path":null,"size_bytes":1349,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1198,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      \"p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2859,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8522,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  console.warn(\"DATABASE_URL not set - database operations will be unavailable\");\n  process.env.DATABASE_URL = \"postgresql://placeholder\";\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":393,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { VariantProps, cva } from \"class-variance-authority\";\nimport { PanelLeft } from \"lucide-react\";\n\nimport { useIsMobile } from \"@/hooks/use-is-mobile\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\";\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;\nconst SIDEBAR_WIDTH = \"16rem\";\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\";\nconst SIDEBAR_WIDTH_ICON = \"3rem\";\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\";\n\ntype SidebarContext = {\n  state: \"expanded\" | \"collapsed\";\n  open: boolean;\n  setOpen: (open: boolean) => void;\n  openMobile: boolean;\n  setOpenMobile: (open: boolean) => void;\n  isMobile: boolean;\n  toggleSidebar: () => void;\n};\n\nconst SidebarContext = React.createContext<SidebarContext | null>(null);\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext);\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\");\n  }\n\n  return context;\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean;\n    open?: boolean;\n    onOpenChange?: (open: boolean) => void;\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref,\n  ) => {\n    const isMobile = useIsMobile();\n    const [openMobile, setOpenMobile] = React.useState(false);\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen);\n    const open = openProp ?? _open;\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value;\n        if (setOpenProp) {\n          setOpenProp(openState);\n        } else {\n          _setOpen(openState);\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;\n      },\n      [setOpenProp, open],\n    );\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open);\n    }, [isMobile, setOpen, setOpenMobile]);\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault();\n          toggleSidebar();\n        }\n      };\n\n      window.addEventListener(\"keydown\", handleKeyDown);\n      return () => window.removeEventListener(\"keydown\", handleKeyDown);\n    }, [toggleSidebar]);\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\";\n\n    const contextValue = React.useMemo<SidebarContext>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      ],\n    );\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className,\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    );\n  },\n);\nSidebarProvider.displayName = \"SidebarProvider\";\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\";\n    variant?: \"sidebar\" | \"floating\" | \"inset\";\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\";\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref,\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar();\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className,\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      );\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      );\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\",\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className,\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    );\n  },\n);\nSidebar.displayName = \"Sidebar\";\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar();\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event);\n        toggleSidebar();\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  );\n});\nSidebarTrigger.displayName = \"SidebarTrigger\";\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar();\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarRail.displayName = \"SidebarRail\";\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarInset.displayName = \"SidebarInset\";\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarInput.displayName = \"SidebarInput\";\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  );\n});\nSidebarHeader.displayName = \"SidebarHeader\";\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  );\n});\nSidebarFooter.displayName = \"SidebarFooter\";\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  );\n});\nSidebarSeparator.displayName = \"SidebarSeparator\";\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarContent.displayName = \"SidebarContent\";\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  );\n});\nSidebarGroup.displayName = \"SidebarGroup\";\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\";\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\";\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\";\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarGroupAction.displayName = \"SidebarGroupAction\";\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n));\nSidebarGroupContent.displayName = \"SidebarGroupContent\";\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n));\nSidebarMenu.displayName = \"SidebarMenu\";\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n));\nSidebarMenuItem.displayName = \"SidebarMenuItem\";\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean;\n    isActive?: boolean;\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>;\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref,\n  ) => {\n    const Comp = asChild ? Slot : \"button\";\n    const { isMobile, state } = useSidebar();\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    );\n\n    if (!tooltip) {\n      return button;\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      };\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    );\n  },\n);\nSidebarMenuButton.displayName = \"SidebarMenuButton\";\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean;\n    showOnHover?: boolean;\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\";\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarMenuAction.displayName = \"SidebarMenuAction\";\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className,\n    )}\n    {...props}\n  />\n));\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\";\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean;\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`;\n  }, []);\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  );\n});\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\";\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className,\n    )}\n    {...props}\n  />\n));\nSidebarMenuSub.displayName = \"SidebarMenuSub\";\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />);\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\";\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean;\n    size?: \"sm\" | \"md\";\n    isActive?: boolean;\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\";\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\";\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n};\n","path":null,"size_bytes":23790,"size_tokens":null},"client/src/components/game/FirstPersonControls.tsx":{"content":"import { useRef, useEffect } from \"react\";\nimport { useThree, useFrame } from \"@react-three/fiber\";\nimport { useKeyboardControls } from \"@react-three/drei\";\nimport * as THREE from \"three\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\n\nexport enum Controls {\n  forward = \"forward\",\n  back = \"back\",\n  left = \"left\",\n  right = \"right\",\n}\n\nexport function FirstPersonControls() {\n  const { camera, gl } = useThree();\n  const isLocked = useRef(false);\n  const firstMoveAfterLock = useRef(false);\n  const velocity = useRef(new THREE.Vector3());\n  const direction = useRef(new THREE.Vector3());\n  const euler = useRef(new THREE.Euler(0, 0, 0, 'YXZ'));\n  const initialLook = useRef(false);\n  \n  const { singleplayer, multiplayer, mode } = useNumberGame();\n  const [, getKeys] = useKeyboardControls<Controls>();\n\n  useEffect(() => {\n    const canvas = gl.domElement;\n    if (!canvas) return;\n\n    const handleMouseMove = (e: MouseEvent) => {\n      // Double check pointer lock is still active\n      if (!isLocked.current || !document.pointerLockElement) return;\n\n      // Skip the very first movement after lock to avoid large jump\n      if (firstMoveAfterLock.current) {\n        firstMoveAfterLock.current = false;\n        // The pointer lock API automatically centers the cursor\n        // We skip this first movement event to prevent jumping\n        return;\n      }\n\n      const movementX = e.movementX || (e as any).mozMovementX || 0;\n      const movementY = e.movementY || (e as any).mozMovementY || 0;\n\n      // Get current euler angles\n      euler.current.setFromQuaternion(camera.quaternion);\n      euler.current.order = 'YXZ';\n\n      // Update pitch (vertical rotation, clamped)\n      euler.current.x -= movementY * 0.002;\n      euler.current.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, euler.current.x));\n\n      // Update yaw (horizontal rotation, unclamped for free rotation)\n      euler.current.y -= movementX * 0.002;\n\n      // Apply the rotation to camera\n      camera.quaternion.setFromEuler(euler.current);\n    };\n\n    const handlePointerLockChange = () => {\n      isLocked.current = document.pointerLockElement === canvas;\n      if (isLocked.current) {\n        firstMoveAfterLock.current = true;\n        \n        // ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„ØªÙ†Ø¸Ø± Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„\n        if (!initialLook.current) {\n          initialLook.current = true;\n          // ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù„Ù†Ø¸Ø± Ù„Ù„Ø£Ù…Ø§Ù… Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ù„Ø£Ø³ÙÙ„ (Ù†Ø­Ùˆ Ø§Ù„Ø£Ø²Ø±Ø§Ø±)\n          euler.current.set(-0.1, 0, 0, 'YXZ');\n          camera.quaternion.setFromEuler(euler.current);\n        }\n        \n        console.log('Pointer lock activated - cursor automatically centered');\n      } else {\n        console.log('Pointer lock released');\n      }\n    };\n\n    const handlePointerLockError = () => {\n      console.error('Pointer lock error');\n      isLocked.current = false;\n    };\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        // Only exit pointer lock if it's actually locked\n        if (document.pointerLockElement) {\n          document.exitPointerLock?.();\n        }\n      }\n    };\n\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('pointerlockchange', handlePointerLockChange);\n    document.addEventListener('pointerlockerror', handlePointerLockError);\n    document.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('pointerlockchange', handlePointerLockChange);\n      document.removeEventListener('pointerlockerror', handlePointerLockError);\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [camera, gl]);\n\n  // Ø¹Ù†Ø¯Ù…Ø§ ØªÙ†ØªÙ‡ÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø© (ÙÙˆØ² Ø£Ùˆ Ø®Ø³Ø§Ø±Ø©) Ù†Ø³Ø±Ø­ Ø§Ù„Ù…Ø§ÙˆØ³ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹\n  useEffect(() => {\n    const canvas = gl.domElement;\n    if (!canvas) return;\n\n    const currentPhase = mode === \"singleplayer\" ? singleplayer.phase : multiplayer.phase;\n    \n    if ((currentPhase === \"won\" || currentPhase === \"lost\") && document.pointerLockElement) {\n      document.exitPointerLock?.();\n    }\n  }, [singleplayer.phase, multiplayer.phase, mode, gl]);\n\n  useFrame((state, delta) => {\n    if (!isLocked.current) return;\n\n    const { forward, back, left, right } = getKeys();\n    const speed = 6;\n    \n    direction.current.set(0, 0, 0);\n\n    if (forward) direction.current.z -= 1;\n    if (back) direction.current.z += 1;\n    if (left) direction.current.x -= 1;\n    if (right) direction.current.x += 1;\n\n    if (direction.current.length() > 0) {\n      direction.current.normalize();\n      direction.current.applyQuaternion(camera.quaternion);\n      direction.current.y = 0;\n      direction.current.normalize();\n\n      velocity.current.copy(direction.current).multiplyScalar(speed * delta);\n\n      const newPosition = camera.position.clone().add(velocity.current);\n      \n      const roomBounds = 12;\n      newPosition.x = Math.max(-roomBounds, Math.min(roomBounds, newPosition.x));\n      newPosition.z = Math.max(-roomBounds, Math.min(roomBounds, newPosition.z));\n      newPosition.y = 1.6;\n      \n      camera.position.copy(newPosition);\n    }\n  });\n\n  return null;\n}\n","path":null,"size_bytes":5272,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/game/challenges/GuessChallenge.tsx":{"content":"import { useEffect, useState, useRef } from \"react\";\nimport { useChallenges } from \"@/lib/stores/useChallenges\";\nimport { ArrowLeft } from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\nconst BUTTON_COLORS = [\n  { color: \"#ef4444\", sound: 261.63 },\n  { color: \"#3b82f6\", sound: 293.66 },\n  { color: \"#22c55e\", sound: 329.63 },\n  { color: \"#eab308\", sound: 349.23 },\n  { color: \"#a855f7\", sound: 392.00 },\n  { color: \"#f97316\", sound: 440.00 },\n  { color: \"#ec4899\", sound: 493.88 },\n  { color: \"#06b6d4\", sound: 523.25 },\n];\n\nexport function GuessChallenge({ onExit }: { onExit?: () => void } = {}) {\n  const {\n    guessChallenge,\n    guessAddToSequence,\n    guessSetShowingSequence,\n    resetToMenu,\n  } = useChallenges();\n\n  const [activeButton, setActiveButton] = useState<number | null>(null);\n  const [isProcessingClick, setIsProcessingClick] = useState(false);\n  const audioContextRef = useRef<AudioContext | null>(null);\n\n  useEffect(() => {\n    audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)();\n    \n    return () => {\n      if (audioContextRef.current) {\n        audioContextRef.current.close();\n      }\n    };\n  }, []);\n\n  const playSound = (frequency: number, duration: number = 0.3) => {\n    if (!audioContextRef.current) return;\n\n    const oscillator = audioContextRef.current.createOscillator();\n    const gainNode = audioContextRef.current.createGain();\n\n    oscillator.connect(gainNode);\n    gainNode.connect(audioContextRef.current.destination);\n\n    oscillator.frequency.value = frequency;\n    oscillator.type = 'sine';\n\n    gainNode.gain.setValueAtTime(0.3, audioContextRef.current.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(\n      0.01,\n      audioContextRef.current.currentTime + duration\n    );\n\n    oscillator.start(audioContextRef.current.currentTime);\n    oscillator.stop(audioContextRef.current.currentTime + duration);\n  };\n\n  useEffect(() => {\n    if (guessChallenge.isShowingSequence && guessChallenge.sequence.length > 0) {\n      let index = 0;\n      const delay = Math.max(600 - guessChallenge.currentLevel * 50, 300);\n\n      const showNext = () => {\n        if (index < guessChallenge.sequence.length) {\n          const buttonIndex = guessChallenge.sequence[index];\n          setActiveButton(buttonIndex);\n          playSound(BUTTON_COLORS[buttonIndex].sound);\n\n          setTimeout(() => {\n            setActiveButton(null);\n            index++;\n            setTimeout(showNext, delay);\n          }, 500);\n        } else {\n          guessSetShowingSequence(false);\n        }\n      };\n\n      setTimeout(showNext, 1000);\n    }\n  }, [guessChallenge.isShowingSequence, guessChallenge.sequence, guessChallenge.currentLevel]);\n\n  const handleButtonClick = (index: number, e?: React.PointerEvent) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    if (guessChallenge.isShowingSequence || isProcessingClick) return;\n    \n    setIsProcessingClick(true);\n    setActiveButton(index);\n    playSound(BUTTON_COLORS[index].sound);\n    guessAddToSequence(index);\n\n    setTimeout(() => {\n      setActiveButton(null);\n      setIsProcessingClick(false);\n    }, 350);\n  };\n\n  return (\n    <div className=\"w-full h-full flex flex-col items-center justify-center p-8 bg-slate-950\">\n      <div className=\"w-full max-w-4xl flex flex-col h-full\">\n        <div className=\"flex items-center justify-between mb-8\">\n          <button\n            onClick={() => {\n              resetToMenu();\n              onExit?.();\n            }}\n            className=\"flex items-center gap-2 bg-slate-800/80 hover:bg-slate-700/80 text-white px-6 py-3 rounded-xl transition-all shadow-lg\"\n          >\n            <ArrowLeft className=\"w-5 h-5\" />\n            <span className=\"font-bold\">Ø±Ø¬ÙˆØ¹</span>\n          </button>\n\n          <div className=\"text-center\">\n            <h2 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-white mb-1\">\n              ØªØ­Ø¯ÙŠ ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ø¶ÙˆØ§Ø¡\n            </h2>\n            <p className=\"text-sm sm:text-base lg:text-lg text-gray-400\">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ {guessChallenge.currentLevel + 1} / 5</p>\n          </div>\n\n          <div className=\"w-24\"></div>\n        </div>\n\n        <div className=\"flex-1 flex flex-col items-center justify-center\">\n          {guessChallenge.isShowingSequence && (\n            <div className=\"text-center mb-8\">\n              <p className=\"text-xl sm:text-2xl lg:text-3xl font-bold text-yellow-400 animate-pulse\">\n                Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªØ³Ù„Ø³Ù„...\n              </p>\n            </div>\n          )}\n\n          {!guessChallenge.isShowingSequence && (\n            <div className=\"text-center mb-8\">\n              <p className=\"text-base sm:text-lg lg:text-xl text-white\">\n                ÙƒØ±Ø± Ø§Ù„ØªØ³Ù„Ø³Ù„: {guessChallenge.playerSequence.length} / {guessChallenge.sequence.length}\n              </p>\n            </div>\n          )}\n\n          <div className=\"w-full flex flex-col items-center justify-center gap-8\">\n            {/* Top row */}\n            <div className=\"flex gap-2 sm:gap-3 md:gap-4 lg:gap-6 xl:gap-8\">\n              {BUTTON_COLORS.slice(0, 4).map((btn, index) => {\n                const isActive = activeButton === index;\n                \n                return (\n                  <motion.button\n                    key={index}\n                    onPointerDown={(e) => handleButtonClick(index, e)}\n                    disabled={guessChallenge.isShowingSequence || isProcessingClick}\n                    className={`w-14 h-14 sm:w-20 sm:h-20 md:w-24 md:h-24 lg:w-28 lg:h-28 xl:w-32 xl:h-32 font-bold text-white touch-none rounded-2xl border-4 ${\n                      guessChallenge.isShowingSequence || isProcessingClick ? \"cursor-not-allowed\" : \"cursor-pointer\"\n                    }`}\n                    style={{\n                      backgroundColor: btn.color,\n                      borderColor: isActive ? \"rgba(255, 255, 255, 0.9)\" : `${btn.color}80`,\n                    }}\n                    animate={{\n                      scale: isActive ? 1.15 : 1,\n                      boxShadow: isActive \n                        ? `0 0 60px ${btn.color}, 0 0 100px ${btn.color}, 0 0 20px ${btn.color}, inset 0 0 20px rgba(255, 255, 255, 0.5)` \n                        : `0 4px 20px rgba(0, 0, 0, 0.3), inset 0 2px 0 rgba(255, 255, 255, 0.15)`,\n                      filter: isActive ? \"brightness(1.4)\" : \"brightness(1)\",\n                      opacity: (guessChallenge.isShowingSequence && !isActive) ? 0.5 : 1,\n                    }}\n                    transition={{ \n                      type: \"spring\", \n                      stiffness: 400, \n                      damping: 20 \n                    }}\n                    whileHover={!(guessChallenge.isShowingSequence || isProcessingClick) ? { scale: 1.08 } : {}}\n                    whileTap={!(guessChallenge.isShowingSequence || isProcessingClick) ? { scale: 0.95 } : {}}\n                  />\n                );\n              })}\n            </div>\n\n            {/* Bottom row */}\n            <div className=\"flex gap-2 sm:gap-3 md:gap-4 lg:gap-6 xl:gap-8\">\n              {BUTTON_COLORS.slice(4, 8).map((btn, index) => {\n                const actualIndex = index + 4;\n                const isActive = activeButton === actualIndex;\n                \n                return (\n                  <motion.button\n                    key={actualIndex}\n                    onPointerDown={(e) => handleButtonClick(actualIndex, e)}\n                    disabled={guessChallenge.isShowingSequence || isProcessingClick}\n                    className={`w-14 h-14 sm:w-20 sm:h-20 md:w-24 md:h-24 lg:w-28 lg:h-28 xl:w-32 xl:h-32 font-bold text-white touch-none rounded-2xl border-4 ${\n                      guessChallenge.isShowingSequence || isProcessingClick ? \"cursor-not-allowed\" : \"cursor-pointer\"\n                    }`}\n                    style={{\n                      backgroundColor: btn.color,\n                      borderColor: isActive ? \"rgba(255, 255, 255, 0.9)\" : `${btn.color}80`,\n                    }}\n                    animate={{\n                      scale: isActive ? 1.15 : 1,\n                      boxShadow: isActive \n                        ? `0 0 60px ${btn.color}, 0 0 100px ${btn.color}, 0 0 20px ${btn.color}, inset 0 0 20px rgba(255, 255, 255, 0.5)` \n                        : `0 4px 20px rgba(0, 0, 0, 0.3), inset 0 2px 0 rgba(255, 255, 255, 0.15)`,\n                      filter: isActive ? \"brightness(1.4)\" : \"brightness(1)\",\n                      opacity: (guessChallenge.isShowingSequence && !isActive) ? 0.5 : 1,\n                    }}\n                    transition={{ \n                      type: \"spring\", \n                      stiffness: 400, \n                      damping: 20 \n                    }}\n                    whileHover={!(guessChallenge.isShowingSequence || isProcessingClick) ? { scale: 1.08 } : {}}\n                    whileTap={!(guessChallenge.isShowingSequence || isProcessingClick) ? { scale: 0.95 } : {}}\n                  />\n                );\n              })}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9175,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"â€¦\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on port 5000\n  // this serves both the API and the client\n  const port = 5000;\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","path":null,"size_bytes":1871,"size_tokens":null},"client/src/components/ui/OpponentAttemptsDialog.tsx":{"content":"import { Dialog, DialogContent, DialogHeader, DialogTitle } from \"./dialog\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { X } from \"lucide-react\";\n\nexport function OpponentAttemptsDialog() {\n  const showOpponentAttempts = useNumberGame((state) => state.multiplayer.showOpponentAttempts);\n  const setShowOpponentAttempts = useNumberGame((state) => state.setShowOpponentAttempts);\n  const opponentAttempts = useNumberGame((state) => state.multiplayer.opponentAttempts);\n\n  return (\n    <Dialog open={showOpponentAttempts} onOpenChange={setShowOpponentAttempts}>\n      <DialogContent className=\"max-w-md max-h-96 overflow-y-auto bg-white border-2 border-gray-200 rounded-2xl shadow-2xl p-0\">\n        <DialogHeader className=\"p-6 pb-0 border-b border-gray-200\">\n          <div className=\"flex items-center justify-between\">\n            <DialogTitle className=\"text-2xl font-bold text-gray-800\">Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø®ØµÙ…</DialogTitle>\n            <button\n              onClick={() => setShowOpponentAttempts(false)}\n              className=\"text-gray-500 hover:text-gray-700\"\n            >\n              <X className=\"w-6 h-6\" />\n            </button>\n          </div>\n        </DialogHeader>\n        <div className=\"p-6 space-y-2 max-h-80 overflow-y-auto\">\n          {opponentAttempts.length > 0 ? (\n            opponentAttempts.map((attempt, index) => {\n              const positionText = \n                attempt.correctPositionCount === 0 ? '0 Ù…ÙƒØ§Ù†Ùˆ ØµØ­' :\n                attempt.correctPositionCount === 1 ? '1 Ù…ÙƒØ§Ù†Ùˆ ØµØ­' :\n                `${attempt.correctPositionCount} Ù…ÙƒØ§Ù†Ù‡Ù… ØµØ­`;\n\n              return (\n                <div\n                  key={index}\n                  className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg flex-row-reverse border border-gray-200\"\n                >\n                  <span className=\"font-mono text-lg font-bold text-gray-800\">\n                    {attempt.guess.join(\"\")}\n                  </span>\n                  <div className=\"flex gap-2 text-sm\">\n                    <span className=\"bg-blue-100 text-blue-800 px-3 py-1 rounded-lg font-semibold\">\n                      {attempt.correctCount} ØµØ­\n                    </span>\n                    <span className=\"bg-green-100 text-green-800 px-3 py-1 rounded-lg font-semibold\">\n                      {positionText}\n                    </span>\n                  </div>\n                </div>\n              );\n            })\n          ) : (\n            <p className=\"text-center text-gray-500 py-4\">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª</p>\n          )}\n        </div>\n        <div className=\"p-6 pt-4 border-t border-gray-200\">\n          <button\n            onClick={() => setShowOpponentAttempts(false)}\n            className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors\"\n          >\n            Ø§Ù„Ø¹ÙˆØ¯Ø©\n          </button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":2992,"size_tokens":null},"client/src/components/game/challenges/RainDropsChallenge.tsx":{"content":"import { useEffect, useRef, useCallback, useState, useMemo } from \"react\";\nimport { useChallenges, type RainDrop } from \"@/lib/stores/useChallenges\";\nimport { useAudio } from \"@/lib/stores/useAudio\";\nimport { Pause, X, Play, ArrowLeft } from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\nfunction RainBackground() {\n  const rainDrops = useMemo(() => {\n    const drops = [];\n    for (let i = 0; i < 80; i++) {\n      drops.push({\n        id: i,\n        left: Math.random() * 100,\n        delay: Math.random() * 2,\n        duration: 1 + Math.random() * 1,\n        opacity: 0.1 + Math.random() * 0.2,\n      });\n    }\n    return drops;\n  }, []);\n\n  return (\n    <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n      {rainDrops.map((drop) => (\n        <motion.div\n          key={drop.id}\n          className=\"absolute w-[2px] bg-gradient-to-b from-white/40 to-transparent\"\n          style={{\n            left: `${drop.left}%`,\n            height: '20px',\n            opacity: drop.opacity,\n          }}\n          animate={{\n            y: ['0vh', '100vh'],\n          }}\n          transition={{\n            duration: drop.duration,\n            repeat: Infinity,\n            delay: drop.delay,\n            ease: 'linear',\n          }}\n        />\n      ))}\n    </div>\n  );\n}\n\nfunction WaterWaves() {\n  return (\n    <div className=\"absolute bottom-0 left-0 right-0 h-16 overflow-hidden\">\n      <svg \n        viewBox=\"0 0 1200 60\" \n        preserveAspectRatio=\"none\"\n        className=\"absolute bottom-0 w-full h-full\"\n      >\n        <path\n          d=\"M0,30 L30,45 L60,30 L90,45 L120,30 L150,45 L180,30 L210,45 L240,30 L270,45 L300,30 L330,45 L360,30 L390,45 L420,30 L450,45 L480,30 L510,45 L540,30 L570,45 L600,30 L630,45 L660,30 L690,45 L720,30 L750,45 L780,30 L810,45 L840,30 L870,45 L900,30 L930,45 L960,30 L990,45 L1020,30 L1050,45 L1080,30 L1110,45 L1140,30 L1170,45 L1200,30 L1200,60 L0,60 Z\"\n          fill=\"url(#waveGradient)\"\n        />\n        <defs>\n          <linearGradient id=\"waveGradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n            <stop offset=\"0%\" stopColor=\"#4338ca\" stopOpacity=\"0.8\" />\n            <stop offset=\"100%\" stopColor=\"#1e1b4b\" stopOpacity=\"1\" />\n          </linearGradient>\n        </defs>\n      </svg>\n      <svg \n        viewBox=\"0 0 1200 60\" \n        preserveAspectRatio=\"none\"\n        className=\"absolute bottom-0 w-full h-full opacity-50\"\n        style={{ transform: 'translateX(-15px)' }}\n      >\n        <path\n          d=\"M0,35 L30,50 L60,35 L90,50 L120,35 L150,50 L180,35 L210,50 L240,35 L270,50 L300,35 L330,50 L360,35 L390,50 L420,35 L450,50 L480,35 L510,50 L540,35 L570,50 L600,35 L630,50 L660,35 L690,50 L720,35 L750,50 L780,35 L810,50 L840,35 L870,50 L900,35 L930,50 L960,35 L990,50 L1020,35 L1050,50 L1080,35 L1110,50 L1140,35 L1170,50 L1200,35 L1200,60 L0,60 Z\"\n          fill=\"#6366f1\"\n          opacity=\"0.3\"\n        />\n      </svg>\n    </div>\n  );\n}\n\ninterface EquationBubbleProps {\n  drop: RainDrop;\n  containerHeight: number;\n  containerWidth: number;\n}\n\nfunction EquationBubble({ drop, containerHeight, containerWidth }: EquationBubbleProps) {\n  const parts = drop.equation.match(/(\\d+)\\s*([+\\-Ã—Ã·])\\s*(\\d+)/);\n  \n  if (!parts) {\n    return (\n      <div className=\"bg-slate-900/95 rounded-full w-16 h-16 md:w-20 md:h-20 lg:w-24 lg:h-24 flex items-center justify-center shadow-2xl border-2 border-slate-700\">\n        <span className=\"text-white font-bold text-lg\">{drop.equation}</span>\n      </div>\n    );\n  }\n\n  const [, num1, operator, num2] = parts;\n\n  return (\n    <motion.div\n      className=\"absolute\"\n      style={{\n        left: `${drop.x}%`,\n        top: `${(drop.y / 100) * containerHeight}px`,\n        transform: 'translate(-50%, -50%)',\n      }}\n      initial={{ scale: 0, opacity: 0 }}\n      animate={{ scale: 1, opacity: 1 }}\n      exit={{ scale: 0, opacity: 0 }}\n    >\n      <div className=\"bg-slate-900/95 rounded-full w-16 h-16 md:w-20 md:h-20 lg:w-24 lg:h-24 flex flex-col items-center justify-center shadow-2xl border-2 border-slate-700/50 backdrop-blur-sm\">\n        <span className=\"text-white font-bold text-sm md:text-base lg:text-lg leading-none\">{num1}</span>\n        <div className=\"flex items-center gap-0.5 my-0.5\">\n          <span className=\"text-cyan-400 font-bold text-lg md:text-xl lg:text-2xl leading-none\">{operator}</span>\n        </div>\n        <span className=\"text-white font-bold text-sm md:text-base lg:text-lg leading-none\">{num2}</span>\n      </div>\n    </motion.div>\n  );\n}\n\nexport function RainDropsChallenge({ onExit }: { onExit?: () => void } = {}) {\n  const {\n    raindropsChallenge,\n    raindropsAddDrop,\n    raindropsUpdateDrops,\n    raindropsSetInput,\n    raindropsSubmitAnswer,\n    raindropsMissedDrop,\n    raindropsRemoveDrop,\n    raindropsUpdateTime,\n    resetToMenu,\n    completeChallenge,\n  } = useChallenges();\n\n  const { playConfirm, playError } = useAudio();\n  const [showFeedback, setShowFeedback] = useState<\"correct\" | \"wrong\" | null>(null);\n  const [isPaused, setIsPaused] = useState(false);\n  const gameLoopRef = useRef<number | null>(null);\n  const lastTimeRef = useRef<number>(Date.now());\n  const dropSpawnRef = useRef<NodeJS.Timeout | null>(null);\n  const timerRef = useRef<NodeJS.Timeout | null>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [containerHeight, setContainerHeight] = useState(400);\n  const [containerWidth, setContainerWidth] = useState(400);\n  const [isDesktop, setIsDesktop] = useState(false);\n\n  useEffect(() => {\n    const updateDimensions = () => {\n      if (containerRef.current) {\n        setContainerHeight(containerRef.current.clientHeight);\n        setContainerWidth(containerRef.current.clientWidth);\n      }\n      const isLandscape = window.innerHeight < window.innerWidth;\n      const isLargeScreen = window.innerWidth >= 1024;\n      setIsDesktop(isLargeScreen || (window.innerWidth >= 768 && !isLandscape));\n    };\n    \n    updateDimensions();\n    window.addEventListener('resize', updateDimensions);\n    window.addEventListener('orientationchange', updateDimensions);\n    return () => {\n      window.removeEventListener('resize', updateDimensions);\n      window.removeEventListener('orientationchange', updateDimensions);\n    };\n  }, []);\n\n  const handleSubmit = useCallback(() => {\n    if (!raindropsChallenge.currentInput || isPaused) return;\n    \n    const success = raindropsSubmitAnswer();\n    if (success) {\n      playConfirm();\n      setShowFeedback(\"correct\");\n    } else {\n      playError();\n      setShowFeedback(\"wrong\");\n    }\n    \n    setTimeout(() => setShowFeedback(null), 300);\n  }, [raindropsChallenge.currentInput, raindropsSubmitAnswer, playConfirm, playError, isPaused]);\n\n  const handleNumberPress = useCallback((num: string) => {\n    if (isPaused) return;\n    if (raindropsChallenge.currentInput.length < 4) {\n      raindropsSetInput(raindropsChallenge.currentInput + num);\n    }\n  }, [raindropsChallenge.currentInput, raindropsSetInput, isPaused]);\n\n  const handleDelete = useCallback(() => {\n    if (isPaused) return;\n    raindropsSetInput(raindropsChallenge.currentInput.slice(0, -1));\n  }, [raindropsChallenge.currentInput, raindropsSetInput, isPaused]);\n\n  const togglePause = useCallback(() => {\n    setIsPaused(prev => !prev);\n  }, []);\n\n  useEffect(() => {\n    if (!raindropsChallenge.isGameActive || isPaused) return;\n\n    const gameLoop = () => {\n      const now = Date.now();\n      const deltaTime = now - lastTimeRef.current;\n      lastTimeRef.current = now;\n\n      raindropsUpdateDrops(deltaTime);\n\n      const { drops, errors, maxErrors } = useChallenges.getState().raindropsChallenge;\n      \n      drops.forEach((drop) => {\n        if (drop.y >= 95) {\n          raindropsMissedDrop();\n          raindropsRemoveDrop(drop.id);\n          playError();\n        }\n      });\n\n      const currentErrors = useChallenges.getState().raindropsChallenge.errors;\n      if (currentErrors >= maxErrors) {\n        completeChallenge(false);\n        return;\n      }\n\n      gameLoopRef.current = requestAnimationFrame(gameLoop);\n    };\n\n    lastTimeRef.current = Date.now();\n    gameLoopRef.current = requestAnimationFrame(gameLoop);\n\n    return () => {\n      if (gameLoopRef.current) {\n        cancelAnimationFrame(gameLoopRef.current);\n      }\n    };\n  }, [raindropsChallenge.isGameActive, isPaused, raindropsUpdateDrops, raindropsMissedDrop, raindropsRemoveDrop, playError, completeChallenge]);\n\n  useEffect(() => {\n    if (!raindropsChallenge.isGameActive || isPaused) return;\n\n    const spawnDrop = () => {\n      raindropsAddDrop();\n      const baseInterval = 4000;\n      const minInterval = 2000;\n      const difficultyReduction = raindropsChallenge.difficulty * 150;\n      const nextInterval = Math.max(minInterval, baseInterval - difficultyReduction);\n      \n      dropSpawnRef.current = setTimeout(spawnDrop, nextInterval);\n    };\n\n    dropSpawnRef.current = setTimeout(spawnDrop, 1500);\n\n    return () => {\n      if (dropSpawnRef.current) {\n        clearTimeout(dropSpawnRef.current);\n      }\n    };\n  }, [raindropsChallenge.isGameActive, raindropsChallenge.difficulty, raindropsAddDrop, isPaused]);\n\n  useEffect(() => {\n    if (!raindropsChallenge.isGameActive || isPaused) return;\n\n    timerRef.current = setInterval(() => {\n      const { timeRemaining } = useChallenges.getState().raindropsChallenge;\n      if (timeRemaining <= 1) {\n        completeChallenge(true);\n      } else {\n        raindropsUpdateTime(timeRemaining - 1);\n      }\n    }, 1000);\n\n    return () => {\n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n      }\n    };\n  }, [raindropsChallenge.isGameActive, raindropsUpdateTime, completeChallenge, isPaused]);\n\n  // Keyboard support for desktop\n  useEffect(() => {\n    if (!raindropsChallenge.isGameActive || isPaused || !isDesktop) return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Number keys (0-9)\n      if (e.key >= '0' && e.key <= '9') {\n        handleNumberPress(e.key);\n        e.preventDefault();\n      }\n      // Numpad keys\n      else if (e.code >= 'Numpad0' && e.code <= 'Numpad9') {\n        handleNumberPress(e.key);\n        e.preventDefault();\n      }\n      // Enter key to submit\n      else if (e.key === 'Enter') {\n        handleSubmit();\n        e.preventDefault();\n      }\n      // Backspace to delete\n      else if (e.key === 'Backspace') {\n        handleDelete();\n        e.preventDefault();\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [raindropsChallenge.isGameActive, isPaused, isDesktop, handleNumberPress, handleSubmit, handleDelete]);\n\n  return (\n    <div className=\"w-full h-full flex flex-col md:flex-row bg-gradient-to-b from-indigo-600 via-purple-600 to-indigo-900 select-none overflow-hidden relative\">\n      <RainBackground />\n      \n      {/* Desktop: Side panel for controls */}\n      <div className={`${isDesktop ? 'w-64 order-2 flex flex-col' : 'hidden'} bg-slate-900/95 backdrop-blur-xl z-20 relative`}>\n        {/* Header for desktop */}\n        <div className=\"flex items-center justify-between p-3 border-b border-purple-500/30\">\n          <button\n            onClick={() => {\n              resetToMenu();\n              onExit?.();\n            }}\n            className=\"flex items-center gap-2 bg-white/10 hover:bg-white/20 text-white px-3 py-2 rounded-xl transition-all text-sm\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n            <span className=\"font-bold\">Ø±Ø¬ÙˆØ¹</span>\n          </button>\n        </div>\n\n        {/* Stats for desktop - only show time and errors */}\n        <div className=\"p-3 space-y-3\">\n          <div className=\"bg-gradient-to-br from-cyan-600/50 to-blue-600/50 rounded-xl p-3 text-center border border-cyan-400/30\">\n            <span className=\"text-white/70 text-xs block mb-1\">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</span>\n            <span className=\"text-3xl font-bold text-white\">{raindropsChallenge.timeRemaining}s</span>\n          </div>\n          <div className=\"bg-gradient-to-br from-red-600/50 to-orange-600/50 rounded-xl p-3 text-center border border-red-400/30\">\n            <span className=\"text-white/70 text-xs block mb-1\">Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</span>\n            <span className=\"text-3xl font-bold text-white\">{raindropsChallenge.errors}/{raindropsChallenge.maxErrors}</span>\n          </div>\n        </div>\n\n        {/* Desktop numpad - full visibility */}\n        <div className=\"flex-1 p-3 flex flex-col\">\n          <div className=\"flex items-center gap-2 mb-3\">\n            <div className=\"flex-1 bg-purple-300/30 rounded-xl px-3 py-3 text-center border border-purple-400/30\">\n              <span className=\"text-2xl font-bold text-white font-mono\">\n                {raindropsChallenge.currentInput || 'â€'}\n              </span>\n            </div>\n            <button\n              onClick={handleDelete}\n              className=\"w-12 h-12 bg-purple-400/30 hover:bg-purple-400/50 text-white font-bold rounded-xl transition-all flex items-center justify-center border border-purple-400/30\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          </div>\n\n          <div className=\"grid grid-cols-3 gap-2 mb-2\" dir=\"ltr\">\n            {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (\n              <button\n                key={num}\n                onClick={() => handleNumberPress(num.toString())}\n                className=\"h-12 bg-purple-600/80 hover:bg-purple-500/80 text-white text-xl font-bold rounded-xl shadow-lg active:scale-95 transition-all border border-purple-400/30\"\n              >\n                {num}\n              </button>\n            ))}\n          </div>\n          \n          <div className=\"grid grid-cols-2 gap-2\" dir=\"ltr\">\n            <button\n              onClick={() => handleNumberPress('0')}\n              className=\"h-12 bg-purple-600/80 hover:bg-purple-500/80 text-white text-xl font-bold rounded-xl shadow-lg active:scale-95 transition-all border border-purple-400/30\"\n            >\n              0\n            </button>\n            <button\n              onClick={handleSubmit}\n              disabled={!raindropsChallenge.currentInput}\n              className=\"h-12 bg-indigo-500/80 hover:bg-indigo-400/80 disabled:bg-gray-600/50 disabled:cursor-not-allowed text-white text-base font-bold rounded-xl shadow-lg active:scale-95 transition-all border border-indigo-400/30\"\n            >\n              Ø¥Ø¯Ø®Ø§Ù„\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Main game area */}\n      <div className={`flex-1 flex flex-col ${isDesktop ? 'order-1' : ''}`}>\n        {/* Mobile header - simplified without score/stop */}\n        {!isDesktop && (\n          <div className=\"flex items-center justify-between p-3 z-20 relative\">\n            <button\n              onClick={resetToMenu}\n              className=\"flex items-center gap-2 bg-white/20 backdrop-blur-xl hover:bg-white/30 text-white px-3 py-2 rounded-xl transition-all text-sm\"\n            >\n              <ArrowLeft className=\"w-4 h-4\" />\n              <span className=\"font-bold text-sm\">Ø±Ø¬ÙˆØ¹</span>\n            </button>\n\n            <div className=\"flex items-center gap-3\">\n              <div className=\"bg-slate-800/80 backdrop-blur-xl px-3 py-1 rounded-full shadow-lg flex items-center gap-1\">\n                <span className=\"text-white/70 text-xs\">Ø§Ù„ÙˆÙ‚Øª</span>\n                <span className=\"text-base font-bold text-cyan-400\">{raindropsChallenge.timeRemaining}s</span>\n              </div>\n              <div className=\"bg-slate-800/80 backdrop-blur-xl px-3 py-1 rounded-full shadow-lg flex items-center gap-1\">\n                <span className=\"text-white/70 text-xs\">Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</span>\n                <span className=\"text-base font-bold text-red-400\">{raindropsChallenge.errors}/{raindropsChallenge.maxErrors}</span>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Game container */}\n        <div \n          ref={containerRef}\n          className={`flex-1 relative overflow-hidden z-10 ${isDesktop ? 'min-h-[60vh]' : ''}`}\n          style={{ minHeight: isDesktop ? '60vh' : '45vh' }}\n        >\n          <AnimatePresence>\n            {raindropsChallenge.drops.map((drop) => (\n              <EquationBubble \n                key={drop.id} \n                drop={drop} \n                containerHeight={containerHeight}\n                containerWidth={containerWidth}\n              />\n            ))}\n          </AnimatePresence>\n\n          <AnimatePresence>\n            {showFeedback && (\n              <motion.div\n                initial={{ scale: 0, opacity: 0 }}\n                animate={{ scale: 1.2, opacity: 1 }}\n                exit={{ scale: 0, opacity: 0 }}\n                className={`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-16 md:w-20 md:h-20 rounded-full flex items-center justify-center z-30 ${\n                  showFeedback === \"correct\"\n                    ? \"bg-gradient-to-br from-green-400 to-green-600 shadow-lg shadow-green-500/50\"\n                    : \"bg-gradient-to-br from-red-400 to-red-600 shadow-lg shadow-red-500/50\"\n                }`}\n              >\n                {showFeedback === \"correct\" ? (\n                  <span className=\"text-white text-2xl md:text-3xl\">âœ“</span>\n                ) : (\n                  <X className=\"w-8 h-8 md:w-10 md:h-10 text-white\" />\n                )}\n              </motion.div>\n            )}\n          </AnimatePresence>\n\n          {isPaused && (\n            <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center z-40\">\n              <div className=\"bg-slate-800/90 backdrop-blur-xl rounded-2xl p-8 text-center\">\n                <h2 className=\"text-2xl md:text-3xl font-bold text-white mb-4\">Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</h2>\n                <div className=\"flex gap-4\">\n                  <button\n                    onClick={togglePause}\n                    className=\"px-6 py-3 md:px-8 md:py-4 bg-green-500 hover:bg-green-600 text-white font-bold rounded-xl transition-all text-lg\"\n                  >\n                    Ø§Ø³ØªÙ…Ø±Ø§Ø±\n                  </button>\n                  <button\n                    onClick={resetToMenu}\n                    className=\"px-6 py-3 md:px-8 md:py-4 bg-red-500 hover:bg-red-600 text-white font-bold rounded-xl transition-all text-lg\"\n                  >\n                    Ø®Ø±ÙˆØ¬\n                  </button>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        <WaterWaves />\n      </div>\n\n      {/* Mobile numpad */}\n      {!isDesktop && (\n        <div className=\"bg-slate-900/95 backdrop-blur-xl p-3 z-20 relative\">\n          <div className=\"max-w-sm mx-auto\">\n            <div className=\"flex items-center gap-2 mb-3\" dir=\"ltr\">\n              <div className=\"flex-1 bg-purple-300/30 rounded-xl px-4 py-3 text-center border border-purple-400/30\">\n                <span className=\"text-2xl font-bold text-white font-mono\">\n                  {raindropsChallenge.currentInput || ''}\n                </span>\n              </div>\n              <button\n                onClick={handleDelete}\n                className=\"w-12 h-12 bg-purple-400/30 hover:bg-purple-400/50 text-white font-bold rounded-xl transition-all flex items-center justify-center border border-purple-400/30\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n\n            <div className=\"grid grid-cols-3 gap-2 mb-2\" dir=\"ltr\">\n              {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (\n                <button\n                  key={num}\n                  onClick={() => handleNumberPress(num.toString())}\n                  className=\"h-12 bg-purple-600/80 hover:bg-purple-500/80 text-white text-xl font-bold rounded-xl shadow-lg active:scale-95 transition-all border border-purple-400/30\"\n                >\n                  {num}\n                </button>\n              ))}\n            </div>\n            \n            <div className=\"grid grid-cols-2 gap-2\" dir=\"ltr\">\n              <button\n                onClick={() => handleNumberPress('0')}\n                className=\"h-12 bg-purple-600/80 hover:bg-purple-500/80 text-white text-xl font-bold rounded-xl shadow-lg active:scale-95 transition-all border border-purple-400/30\"\n              >\n                0\n              </button>\n              <button\n                onClick={handleSubmit}\n                disabled={!raindropsChallenge.currentInput}\n                className=\"h-12 bg-indigo-500/80 hover:bg-indigo-400/80 disabled:bg-gray-600/50 disabled:cursor-not-allowed text-white text-base font-bold rounded-xl shadow-lg active:scale-95 transition-all border border-indigo-400/30\"\n              >\n                Ø¥Ø¯Ø®Ø§Ù„\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":20902,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Portal>\n    <TooltipPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </TooltipPrimitive.Portal>\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1217,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/game/MultiplayerChallenge.tsx":{"content":"import { useEffect, useState, useRef } from \"react\";\nimport { useNumberGame } from \"@/lib/stores/useNumberGame\";\nimport { useCards } from \"@/lib/stores/useCards\";\nimport { useChallenges, type ChallengeType } from \"@/lib/stores/useChallenges\";\nimport { send } from \"@/lib/websocket\";\nimport { Brain, Target, Zap, Calculator, Shuffle, Trophy, Sparkles } from \"lucide-react\";\nimport { GuessChallenge } from \"./challenges/GuessChallenge\";\nimport { MemoryChallenge } from \"./challenges/MemoryChallenge\";\nimport { DirectionChallenge } from \"./challenges/DirectionChallenge\";\nimport { RainDropsChallenge } from \"./challenges/RainDropsChallenge\";\n\ninterface ChallengeInfo {\n  id: ChallengeType;\n  name: string;\n  description: string;\n  icon: React.ReactNode;\n  bgColor: string;\n}\n\nconst challengeInfoMap: Record<ChallengeType | \"random\", ChallengeInfo> = {\n  guess: {\n    id: \"guess\",\n    name: \"ØªØ­Ø¯ÙŠ ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ø¶ÙˆØ§Ø¡\",\n    description: \"ØªØ°ÙƒØ± Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„ØµØ­ÙŠØ­ Ù…Ù† Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ£Ø¹Ø¯Ù‡\",\n    icon: <Brain className=\"w-8 h-8\" />,\n    bgColor: \"#3b82f6\",\n  },\n  memory: {\n    id: \"memory\",\n    name: \"Ù„ÙˆØ­Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©\",\n    description: \"ØªØ°ÙƒØ± Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù…Ø¶ÙŠØ¦Ø© ÙˆØ§Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡Ø§\",\n    icon: <Target className=\"w-8 h-8\" />,\n    bgColor: \"#a855f7\",\n  },\n  direction: {\n    id: \"direction\",\n    name: \"ØªØ±ØªÙŠØ¨ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª\",\n    description: \"Ø­Ø±Ùƒ Ø§Ù„Ù…ÙƒØ¹Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¨Ø³Ø±Ø¹Ø©\",\n    icon: <Zap className=\"w-8 h-8\" />,\n    bgColor: \"#f97316\",\n  },\n  raindrops: {\n    id: \"raindrops\",\n    name: \"Ø­Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ø±\",\n    description: \"Ø­Ù„ Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ© Ù‚Ø¨Ù„ Ø£Ù† ØªØµÙ„ Ø§Ù„Ø­Ø¨Ø§Øª Ù„Ù„Ø£Ø³ÙÙ„\",\n    icon: <Calculator className=\"w-8 h-8\" />,\n    bgColor: \"#06b6d4\",\n  },\n  random: {\n    id: \"guess\",\n    name: \"Ø¹Ø´ÙˆØ§Ø¦ÙŠ\",\n    description: \"ØªØ­Ø¯ÙŠ Ø¹Ø´ÙˆØ§Ø¦ÙŠ\",\n    icon: <Shuffle className=\"w-8 h-8\" />,\n    bgColor: \"#f97316\",\n  },\n};\n\ninterface MultiplayerChallengeProps {\n  onComplete: (won: boolean) => void;\n}\n\nexport function MultiplayerChallenge({ onComplete }: MultiplayerChallengeProps) {\n  const { multiplayer } = useNumberGame();\n  const { awardWinnerCard } = useCards();\n  const { \n    currentPhase, \n    selectChallenge, \n    startChallenge, \n    resetToMenu,\n    resetChallengesHub \n  } = useChallenges();\n  \n  const [phase, setPhase] = useState<\"intro\" | \"playing\" | \"result\">(\"intro\");\n  const [countdown, setCountdown] = useState(3);\n  const [hasWon, setHasWon] = useState(false);\n  const hasStartedRef = useRef(false);\n  const hasCompletedRef = useRef(false);\n\n  const selectedChallenge = multiplayer.settings.selectedChallenge || \"random\";\n  const [actualChallenge] = useState<ChallengeType>(() => {\n    if (selectedChallenge === \"random\") {\n      const challenges: ChallengeType[] = [\"guess\", \"memory\", \"direction\", \"raindrops\"];\n      return challenges[Math.floor(Math.random() * challenges.length)];\n    }\n    return selectedChallenge as ChallengeType;\n  });\n  \n  const challengeInfo = challengeInfoMap[actualChallenge] || challengeInfoMap.guess;\n\n  // Watch for challenge phase changes (won/lost)\n  // Only award cards if: playing phase, challenge actually started (hasStartedRef), and not already completed\n  useEffect(() => {\n    if (phase === \"playing\" && hasStartedRef.current && !hasCompletedRef.current) {\n      if (currentPhase === \"won\") {\n        console.log(\"Challenge won! Awarding card...\");\n        hasCompletedRef.current = true;\n        setHasWon(true);\n        const allowedCards = multiplayer.settings.allowedCards;\n        awardWinnerCard(multiplayer.playerId, allowedCards);\n        setPhase(\"result\");\n      } else if (currentPhase === \"lost\") {\n        console.log(\"Challenge lost!\");\n        hasCompletedRef.current = true;\n        setHasWon(false);\n        setPhase(\"result\");\n      }\n    }\n  }, [currentPhase, phase, awardWinnerCard, multiplayer.playerId, multiplayer.settings.allowedCards]);\n\n  // Intro countdown\n  useEffect(() => {\n    if (phase === \"intro\") {\n      const timer = setInterval(() => {\n        setCountdown((prev) => {\n          if (prev <= 1) {\n            clearInterval(timer);\n            // Start the actual challenge\n            if (!hasStartedRef.current) {\n              hasStartedRef.current = true;\n              console.log(\"Starting challenge:\", actualChallenge);\n              resetChallengesHub();\n              setTimeout(() => {\n                selectChallenge(actualChallenge);\n                startChallenge();\n                setPhase(\"playing\");\n              }, 100);\n            }\n            return 0;\n          }\n          return prev - 1;\n        });\n      }, 1000);\n      return () => clearInterval(timer);\n    }\n  }, [phase, actualChallenge, selectChallenge, startChallenge, resetChallengesHub]);\n\n  const handleContinue = () => {\n    console.log(\"Continuing with result:\", hasWon);\n    resetToMenu();\n    // Notify server that this player completed challenges\n    send({ type: \"challenges_completed\" });\n    onComplete(hasWon);\n  };\n\n  // Intro Phase\n  if (phase === \"intro\") {\n    return (\n      <div className=\"fixed inset-0 bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center z-50\">\n        <div className=\"text-center space-y-8 p-8\">\n          <div \n            className=\"w-24 h-24 mx-auto rounded-3xl flex items-center justify-center shadow-2xl animate-pulse\"\n            style={{ backgroundColor: challengeInfo.bgColor }}\n          >\n            <div className=\"text-white\">{challengeInfo.icon}</div>\n          </div>\n          \n          <div>\n            <h1 className=\"text-4xl font-bold text-white mb-2\">{challengeInfo.name}</h1>\n            <p className=\"text-xl text-gray-300\">{challengeInfo.description}</p>\n          </div>\n          \n          <div className=\"flex items-center justify-center gap-4 text-gray-300\">\n            <Sparkles className=\"w-6 h-6 text-yellow-400\" />\n            <span className=\"text-lg\">Ø§Ù„ÙØ§Ø¦Ø² ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©!</span>\n          </div>\n          \n          <div className=\"text-8xl font-bold text-white animate-bounce\">\n            {countdown}\n          </div>\n          \n          <p className=\"text-gray-400\">Ø§Ø³ØªØ¹Ø¯...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Playing Phase - Render actual challenge components\n  if (phase === \"playing\" && currentPhase === \"playing\") {\n    return (\n      <div className=\"fixed inset-0 bg-slate-950 z-50\">\n        {actualChallenge === \"guess\" && <GuessChallenge />}\n        {actualChallenge === \"memory\" && <MemoryChallenge />}\n        {actualChallenge === \"direction\" && <DirectionChallenge isMultiplayer={true} />}\n        {actualChallenge === \"raindrops\" && <RainDropsChallenge />}\n      </div>\n    );\n  }\n\n  // Result Phase\n  if (phase === \"result\" || currentPhase === \"won\" || currentPhase === \"lost\") {\n    const won = hasWon || currentPhase === \"won\";\n    \n    return (\n      <div className=\"fixed inset-0 bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center z-50 p-4\">\n        <div className=\"w-full max-w-md bg-slate-800/90 backdrop-blur-xl rounded-3xl p-8 text-center space-y-6\">\n          <div className=\"text-8xl animate-bounce\">\n            {won ? \"ğŸ‰\" : \"ğŸ˜¢\"}\n          </div>\n          \n          <h2 className={`text-4xl font-bold ${won ? \"text-green-400\" : \"text-red-400\"}`}>\n            {won ? \"Ø£Ø­Ø³Ù†Øª! ÙØ²Øª!\" : \"Ù„Ù„Ø£Ø³Ù! Ù„Ù… ØªÙ†Ø¬Ø­\"}\n          </h2>\n          \n          {won && (\n            <div className=\"flex items-center justify-center gap-3 bg-yellow-500/20 border border-yellow-500/50 rounded-xl p-4\">\n              <Trophy className=\"w-8 h-8 text-yellow-400\" />\n              <span className=\"text-xl text-yellow-300 font-bold\">Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©!</span>\n            </div>\n          )}\n          \n          <p className=\"text-gray-300\">\n            {won \n              ? \"Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø© - ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©\"\n              : \"Ù„Ø§ ØªÙ‚Ù„Ù‚ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù„Ø¹Ø¨ Ø¨Ø¯ÙˆÙ† Ø¨Ø·Ø§Ù‚Ø§Øª\"}\n          </p>\n          \n          <button\n            onClick={handleContinue}\n            className=\"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-4 px-6 rounded-xl transition-all shadow-lg text-xl\"\n          >\n            Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¢Ù†\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  // Loading state while challenge is starting\n  return (\n    <div className=\"fixed inset-0 bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center z-50\">\n      <div className=\"text-center space-y-4\">\n        <div className=\"w-16 h-16 border-4 border-white/20 border-t-white rounded-full animate-spin mx-auto\"></div>\n        <p className=\"text-white text-xl\">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠ...</p>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":8997,"size_tokens":null},"client/src/components/ui/OfflineDialog.tsx":{"content":"import { WifiOff } from \"lucide-react\";\n\ninterface OfflineDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport function OfflineDialog({ isOpen, onClose }: OfflineDialogProps) {\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center bg-black/50 z-50 p-4\" dir=\"rtl\">\n      <div className=\"bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full text-center space-y-4 animate-in fade-in zoom-in duration-200\">\n        <div className=\"w-16 h-16 bg-gradient-to-br from-red-500 to-orange-500 rounded-full flex items-center justify-center mx-auto shadow-lg\">\n          <WifiOff className=\"w-8 h-8 text-white\" />\n        </div>\n        \n        <h2 className=\"text-xl font-bold text-gray-800\">\n          Ø£Ù†Øª ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª\n        </h2>\n        \n        <p className=\"text-gray-600 text-sm\">\n          Ù„Ø¹Ø¨ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙŠØªØ·Ù„Ø¨ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù„Ø¹Ø¨ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ±Ø¯ÙŠ Ø­ØªÙ‰ ÙŠØ¹ÙˆØ¯ Ø§Ù„Ø§ØªØµØ§Ù„.\n        </p>\n        \n        <button\n          onClick={onClose}\n          className=\"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-all duration-200 hover:shadow-xl\"\n        >\n          Ù…ÙˆØ§ÙÙ‚\n        </button>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":1390,"size_tokens":null},"client/src/hooks/use-online-status.tsx":{"content":"import { useState, useEffect, useCallback } from \"react\";\n\nexport function useOnlineStatus() {\n  const [isOnline, setIsOnline] = useState(() => {\n    if (typeof navigator !== 'undefined') {\n      return navigator.onLine;\n    }\n    return true;\n  });\n\n  const handleOnline = useCallback(() => {\n    console.log('[Network] Online');\n    setIsOnline(true);\n  }, []);\n\n  const handleOffline = useCallback(() => {\n    console.log('[Network] Offline');\n    setIsOnline(false);\n  }, []);\n\n  useEffect(() => {\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    setIsOnline(navigator.onLine);\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, [handleOnline, handleOffline]);\n\n  return isOnline;\n}\n","path":null,"size_bytes":850,"size_tokens":null},"client/src/components/ui/RoomInviteDialog.tsx":{"content":"import { useNavigate } from \"react-router-dom\";\nimport { Users, X, Check } from \"lucide-react\";\n\ninterface RoomInviteDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n  roomId: string;\n  fromUserName: string;\n}\n\nexport function RoomInviteDialog({ isOpen, onClose, roomId, fromUserName }: RoomInviteDialogProps) {\n  const navigate = useNavigate();\n\n  if (!isOpen) return null;\n\n  const handleAccept = () => {\n    onClose();\n    navigate(`/room/${roomId}`);\n  };\n\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center bg-black/50 z-50 p-4\" dir=\"rtl\">\n      <div className=\"bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full text-center space-y-4 animate-in fade-in zoom-in duration-200\">\n        <div className=\"w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full flex items-center justify-center mx-auto shadow-lg\">\n          <Users className=\"w-8 h-8 text-white\" />\n        </div>\n        \n        <h2 className=\"text-xl font-bold text-gray-800\">\n          Ø¯Ø¹ÙˆØ© Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©\n        </h2>\n        \n        <p className=\"text-gray-600\">\n          <span className=\"font-bold text-blue-600\">{fromUserName}</span> ÙŠØ¯Ø¹ÙˆÙƒ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ ØºØ±ÙØªÙ‡\n        </p>\n        \n        <p className=\"text-sm text-gray-500 font-mono\">\n          Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©: {roomId}\n        </p>\n        \n        <div className=\"flex gap-3\">\n          <button\n            onClick={handleAccept}\n            className=\"flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-all duration-200 flex items-center justify-center gap-2\"\n          >\n            <Check className=\"w-5 h-5\" />\n            Ù‚Ø¨ÙˆÙ„\n          </button>\n          <button\n            onClick={onClose}\n            className=\"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-3 px-6 rounded-xl transition-all duration-200 flex items-center justify-center gap-2\"\n          >\n            <X className=\"w-5 h-5\" />\n            Ø±ÙØ¶\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":2141,"size_tokens":null},"client/src/components/ui/AccountDialog.tsx":{"content":"import { useState } from \"react\";\nimport { User, UserPlus, LogIn, X } from \"lucide-react\";\nimport { useAccount, createAccount, checkAccount } from \"@/lib/stores/useAccount\";\nimport { toast } from \"sonner\";\n\ninterface AccountDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess?: () => void;\n}\n\nexport function AccountDialog({ isOpen, onClose, onSuccess }: AccountDialogProps) {\n  const { setAccount } = useAccount();\n  const [mode, setMode] = useState<\"login\" | \"create\">(\"login\");\n  const [displayName, setDisplayName] = useState(\"\");\n  const [username, setUsername] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  if (!isOpen) return null;\n\n  const handleLogin = async () => {\n    if (!username.trim()) {\n      setError(\"Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…\");\n      return;\n    }\n\n    setIsLoading(true);\n    setError(\"\");\n\n    try {\n      const result = await checkAccount(username.trim());\n      if (result.exists && result.account) {\n        setAccount(result.account);\n        toast.success(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${result.account.displayName}!`);\n        onSuccess?.();\n        onClose();\n      } else {\n        setError(\"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯\");\n      }\n    } catch (err) {\n      setError(\"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleCreate = async () => {\n    if (!displayName.trim() || !username.trim()) {\n      setError(\"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…\");\n      return;\n    }\n\n    if (username.length < 3) {\n      setError(\"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„\");\n      return;\n    }\n\n    if (!/^[a-zA-Z0-9_]+$/.test(username)) {\n      setError(\"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·\");\n      return;\n    }\n\n    setIsLoading(true);\n    setError(\"\");\n\n    try {\n      const account = await createAccount(displayName.trim(), username.trim());\n      toast.success(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ù…Ø±Ø­Ø¨Ø§Ù‹ ${account.displayName}`);\n      onSuccess?.();\n      onClose();\n    } catch (err: any) {\n      setError(err.message || \"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center bg-black/50 z-50 p-4\" dir=\"rtl\">\n      <div className=\"bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full space-y-6 animate-in fade-in zoom-in duration-200\">\n        <div className=\"flex items-center justify-between\">\n          <h2 className=\"text-xl font-bold text-gray-800\">\n            {mode === \"login\" ? \"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„\" : \"Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯\"}\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n          >\n            <X className=\"w-5 h-5 text-gray-500\" />\n          </button>\n        </div>\n\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => { setMode(\"login\"); setError(\"\"); }}\n            className={`flex-1 py-2 px-4 rounded-lg font-semibold transition-colors flex items-center justify-center gap-2 ${\n              mode === \"login\"\n                ? \"bg-blue-500 text-white\"\n                : \"bg-gray-100 text-gray-700 hover:bg-gray-200\"\n            }`}\n          >\n            <LogIn className=\"w-4 h-4\" />\n            Ø¯Ø®ÙˆÙ„\n          </button>\n          <button\n            onClick={() => { setMode(\"create\"); setError(\"\"); }}\n            className={`flex-1 py-2 px-4 rounded-lg font-semibold transition-colors flex items-center justify-center gap-2 ${\n              mode === \"create\"\n                ? \"bg-blue-500 text-white\"\n                : \"bg-gray-100 text-gray-700 hover:bg-gray-200\"\n            }`}\n          >\n            <UserPlus className=\"w-4 h-4\" />\n            Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯\n          </button>\n        </div>\n\n        <div className=\"space-y-4\">\n          {mode === \"create\" && (\n            <div>\n              <label className=\"block text-sm font-bold text-gray-700 mb-2\">\n                Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¸Ø§Ù‡Ø±\n              </label>\n              <input\n                type=\"text\"\n                value={displayName}\n                onChange={(e) => setDisplayName(e.target.value)}\n                placeholder=\"Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯\"\n                className=\"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-500\"\n                maxLength={50}\n              />\n            </div>\n          )}\n\n          <div>\n            <label className=\"block text-sm font-bold text-gray-700 mb-2\">\n              Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…\n            </label>\n            <input\n              type=\"text\"\n              value={username}\n              onChange={(e) => setUsername(e.target.value.replace(/[^a-zA-Z0-9_]/g, \"\"))}\n              placeholder=\"Ù…Ø«Ø§Ù„: mohamed_123\"\n              className=\"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 font-mono\"\n              dir=\"ltr\"\n              maxLength={30}\n            />\n            <p className=\"text-xs text-gray-500 mt-1\">\n              Ø£Ø­Ø±Ù Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·\n            </p>\n          </div>\n\n          {error && (\n            <p className=\"text-red-500 text-sm text-center\">{error}</p>\n          )}\n\n          <button\n            onClick={mode === \"login\" ? handleLogin : handleCreate}\n            disabled={isLoading}\n            className=\"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 disabled:from-gray-400 disabled:to-gray-500 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-all duration-200\"\n          >\n            {isLoading ? \"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...\" : mode === \"login\" ? \"Ø¯Ø®ÙˆÙ„\" : \"Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨\"}\n          </button>\n        </div>\n\n        <p className=\"text-center text-sm text-gray-500\">\n          Ø§Ù„Ø­Ø³Ø§Ø¨ ÙŠØªÙŠØ­ Ù„Ùƒ Ø¥Ø¶Ø§ÙØ© Ø£ØµØ¯Ù‚Ø§Ø¡ ÙˆØ¯Ø¹ÙˆØªÙ‡Ù… Ù„Ù„ØºØ±Ù\n        </p>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6165,"size_tokens":null},"client/src/lib/stores/useAccount.ts":{"content":"import { create } from \"zustand\";\nimport { persist } from \"zustand/middleware\";\n\nexport interface Account {\n  id: number;\n  displayName: string;\n  username: string;\n  isOnline?: boolean;\n  currentRoomId?: string | null;\n}\n\nexport interface FriendRequest {\n  id: number;\n  fromUserId: number;\n  toUserId: number;\n  status: string;\n  createdAt: string;\n  fromUser?: Account;\n  toUser?: Account;\n}\n\nexport interface Notification {\n  id: number;\n  userId: number;\n  type: string;\n  title: string;\n  message: string;\n  data?: string;\n  isRead: boolean;\n  createdAt: string;\n}\n\ninterface AccountState {\n  account: Account | null;\n  friends: Account[];\n  friendRequests: FriendRequest[];\n  notifications: Notification[];\n  unreadCount: number;\n  isLoading: boolean;\n  \n  setAccount: (account: Account | null) => void;\n  setFriends: (friends: Account[]) => void;\n  addFriend: (friend: Account) => void;\n  removeFriend: (friendId: number) => void;\n  setFriendRequests: (requests: FriendRequest[]) => void;\n  addFriendRequest: (request: FriendRequest) => void;\n  removeFriendRequest: (requestId: number) => void;\n  setNotifications: (notifications: Notification[]) => void;\n  addNotification: (notification: Notification) => void;\n  markNotificationAsRead: (notificationId: number) => void;\n  setUnreadCount: (count: number) => void;\n  setLoading: (loading: boolean) => void;\n  logout: () => void;\n}\n\nexport const useAccount = create<AccountState>()(\n  persist(\n    (set) => ({\n      account: null,\n      friends: [],\n      friendRequests: [],\n      notifications: [],\n      unreadCount: 0,\n      isLoading: false,\n\n      setAccount: (account) => set({ account }),\n      \n      setFriends: (friends) => set({ friends }),\n      \n      addFriend: (friend) => set((state) => ({\n        friends: [...state.friends, friend],\n      })),\n      \n      removeFriend: (friendId) => set((state) => ({\n        friends: state.friends.filter((f) => f.id !== friendId),\n      })),\n      \n      setFriendRequests: (friendRequests) => set({ friendRequests }),\n      \n      addFriendRequest: (request) => set((state) => ({\n        friendRequests: [...state.friendRequests, request],\n      })),\n      \n      removeFriendRequest: (requestId) => set((state) => ({\n        friendRequests: state.friendRequests.filter((r) => r.id !== requestId),\n      })),\n      \n      setNotifications: (notifications) => set({ notifications }),\n      \n      addNotification: (notification) => set((state) => ({\n        notifications: [notification, ...state.notifications],\n        unreadCount: state.unreadCount + 1,\n      })),\n      \n      markNotificationAsRead: (notificationId) => set((state) => ({\n        notifications: state.notifications.map((n) =>\n          n.id === notificationId ? { ...n, isRead: true } : n\n        ),\n        unreadCount: Math.max(0, state.unreadCount - 1),\n      })),\n      \n      setUnreadCount: (unreadCount) => set({ unreadCount }),\n      \n      setLoading: (isLoading) => set({ isLoading }),\n      \n      logout: () => set({\n        account: null,\n        friends: [],\n        friendRequests: [],\n        notifications: [],\n        unreadCount: 0,\n      }),\n    }),\n    {\n      name: \"account-storage\",\n      partialize: (state) => ({ account: state.account }),\n    }\n  )\n);\n\nexport async function createAccount(displayName: string, username: string): Promise<Account> {\n  const response = await fetch(\"/api/accounts/create\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ displayName, username }),\n  });\n  \n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error || \"ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨\");\n  }\n  \n  const account = await response.json();\n  useAccount.getState().setAccount(account);\n  return account;\n}\n\nexport async function checkAccount(username: string): Promise<{ exists: boolean; account?: Account }> {\n  const response = await fetch(`/api/accounts/check/${encodeURIComponent(username)}`);\n  return response.json();\n}\n\nexport async function searchAccounts(query: string): Promise<Account[]> {\n  const response = await fetch(`/api/accounts/search?q=${encodeURIComponent(query)}`);\n  return response.json();\n}\n\nexport async function loadFriends(userId: number): Promise<Account[]> {\n  const response = await fetch(`/api/friends/${userId}`);\n  const friends = await response.json();\n  useAccount.getState().setFriends(friends);\n  return friends;\n}\n\nexport async function sendFriendRequest(fromUserId: number, toUserId: number): Promise<void> {\n  const response = await fetch(\"/api/friends/request\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ fromUserId, toUserId }),\n  });\n  \n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error || \"ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØµØ¯Ø§Ù‚Ø©\");\n  }\n}\n\nexport async function loadFriendRequests(userId: number): Promise<FriendRequest[]> {\n  const response = await fetch(`/api/friends/requests/${userId}`);\n  const requests = await response.json();\n  useAccount.getState().setFriendRequests(requests);\n  return requests;\n}\n\nexport async function acceptFriendRequest(requestId: number, userId: number): Promise<void> {\n  const response = await fetch(\"/api/friends/accept\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ requestId, userId }),\n  });\n  \n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error || \"ÙØ´Ù„ Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ Ø§Ù„ØµØ¯Ø§Ù‚Ø©\");\n  }\n  \n  useAccount.getState().removeFriendRequest(requestId);\n}\n\nexport async function rejectFriendRequest(requestId: number): Promise<void> {\n  await fetch(\"/api/friends/reject\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ requestId }),\n  });\n  \n  useAccount.getState().removeFriendRequest(requestId);\n}\n\nexport async function removeFriend(userId1: number, userId2: number): Promise<void> {\n  await fetch(\"/api/friends/remove\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ userId1, userId2 }),\n  });\n  \n  useAccount.getState().removeFriend(userId2);\n}\n\nexport async function loadNotifications(userId: number): Promise<Notification[]> {\n  const response = await fetch(`/api/notifications/${userId}`);\n  const notifications = await response.json();\n  useAccount.getState().setNotifications(notifications);\n  return notifications;\n}\n\nexport async function loadUnreadCount(userId: number): Promise<number> {\n  const response = await fetch(`/api/notifications/unread/${userId}`);\n  const { count } = await response.json();\n  useAccount.getState().setUnreadCount(count);\n  return count;\n}\n\nexport async function markNotificationRead(notificationId: number): Promise<void> {\n  await fetch(\"/api/notifications/markRead\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ notificationId }),\n  });\n  \n  useAccount.getState().markNotificationAsRead(notificationId);\n}\n\nexport async function markAllNotificationsRead(userId: number): Promise<void> {\n  await fetch(\"/api/notifications/markAllRead\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ userId }),\n  });\n  \n  const state = useAccount.getState();\n  state.setNotifications(state.notifications.map((n) => ({ ...n, isRead: true })));\n  state.setUnreadCount(0);\n}\n\nexport async function sendRoomInvite(fromUserId: number, toUserId: number, roomId: string): Promise<{ success: boolean; isOnline: boolean }> {\n  const response = await fetch(\"/api/invite/send\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ fromUserId, toUserId, roomId }),\n  });\n  \n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error || \"ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¯Ø¹ÙˆØ©\");\n  }\n  \n  return response.json();\n}\n","path":null,"size_bytes":8007,"size_tokens":null},"client/src/components/ui/NotificationsDropdown.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Bell, X, Check, Users, UserPlus } from \"lucide-react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useAccount, loadNotifications, markNotificationRead, markAllNotificationsRead, loadUnreadCount } from \"@/lib/stores/useAccount\";\n\nexport function NotificationsDropdown() {\n  const navigate = useNavigate();\n  const { account, notifications, unreadCount, setNotifications, setUnreadCount } = useAccount();\n  const [isOpen, setIsOpen] = useState(false);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (account) {\n      loadNotifications(account.id);\n      loadUnreadCount(account.id);\n    }\n  }, [account]);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, []);\n\n  if (!account) return null;\n\n  const handleNotificationClick = async (notification: typeof notifications[0]) => {\n    if (!notification.isRead) {\n      await markNotificationRead(notification.id);\n    }\n\n    if (notification.type === \"room_invite\" && notification.data) {\n      try {\n        const data = JSON.parse(notification.data);\n        if (data.roomId) {\n          navigate(`/room/${data.roomId}`);\n          setIsOpen(false);\n        }\n      } catch (err) {\n        console.error(\"Error parsing notification data:\", err);\n      }\n    }\n  };\n\n  const handleMarkAllRead = async () => {\n    await markAllNotificationsRead(account.id);\n  };\n\n  const getNotificationIcon = (type: string) => {\n    switch (type) {\n      case \"friend_request\":\n        return <UserPlus className=\"w-5 h-5 text-blue-500\" />;\n      case \"friend_accepted\":\n        return <Check className=\"w-5 h-5 text-green-500\" />;\n      case \"room_invite\":\n        return <Users className=\"w-5 h-5 text-purple-500\" />;\n      default:\n        return <Bell className=\"w-5 h-5 text-gray-500\" />;\n    }\n  };\n\n  return (\n    <div className=\"relative\" ref={dropdownRef}>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"relative p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n      >\n        <Bell className=\"w-6 h-6 text-gray-700\" />\n        {unreadCount > 0 && (\n          <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold\">\n            {unreadCount > 9 ? \"9+\" : unreadCount}\n          </span>\n        )}\n      </button>\n\n      {isOpen && (\n        <div className=\"absolute left-0 mt-2 w-80 bg-white rounded-xl shadow-2xl border border-gray-200 overflow-hidden z-50\" dir=\"rtl\">\n          <div className=\"flex items-center justify-between p-3 bg-gray-50 border-b\">\n            <h3 className=\"font-bold text-gray-800\">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>\n            {unreadCount > 0 && (\n              <button\n                onClick={handleMarkAllRead}\n                className=\"text-sm text-blue-600 hover:underline\"\n              >\n                Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒÙ„\n              </button>\n            )}\n          </div>\n\n          <div className=\"max-h-80 overflow-y-auto\">\n            {notifications.length === 0 ? (\n              <div className=\"p-6 text-center text-gray-500\">\n                <Bell className=\"w-10 h-10 mx-auto mb-2 opacity-50\" />\n                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</p>\n              </div>\n            ) : (\n              notifications.slice(0, 10).map((notification) => (\n                <div\n                  key={notification.id}\n                  onClick={() => handleNotificationClick(notification)}\n                  className={`p-3 border-b cursor-pointer hover:bg-gray-50 transition-colors ${\n                    !notification.isRead ? \"bg-blue-50\" : \"\"\n                  }`}\n                >\n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"flex-shrink-0 mt-1\">\n                      {getNotificationIcon(notification.type)}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"font-semibold text-gray-800 text-sm\">{notification.title}</p>\n                      <p className=\"text-gray-600 text-sm\">{notification.message}</p>\n                      <p className=\"text-xs text-gray-400 mt-1\">\n                        {new Date(notification.createdAt).toLocaleDateString(\"ar-EG\", {\n                          hour: \"2-digit\",\n                          minute: \"2-digit\",\n                        })}\n                      </p>\n                    </div>\n                    {!notification.isRead && (\n                      <div className=\"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0\" />\n                    )}\n                  </div>\n                </div>\n              ))\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":5053,"size_tokens":null},"client/public/sw.js":{"content":"const CACHE_NAME = 'guess-game-v1';\nconst STATIC_CACHE = 'guess-game-static-v1';\nconst DYNAMIC_CACHE = 'guess-game-dynamic-v1';\n\nconst STATIC_ASSETS = [\n  '/',\n  '/index.html',\n  '/favicon.svg',\n  '/sounds/background.mp3',\n  '/sounds/hit.mp3',\n  '/sounds/success.mp3',\n  '/textures/asphalt.png',\n  '/textures/grass.png',\n  '/textures/sand.jpg',\n  '/textures/sky.png',\n  '/textures/wood.jpg',\n  '/fonts/inter.json',\n  '/geometries/heart.gltf'\n];\n\nself.addEventListener('install', (event) => {\n  console.log('[SW] Installing Service Worker');\n  event.waitUntil(\n    caches.open(STATIC_CACHE).then((cache) => {\n      console.log('[SW] Caching static assets');\n      return cache.addAll(STATIC_ASSETS.map(url => {\n        return new Request(url, { cache: 'reload' });\n      })).catch(err => {\n        console.log('[SW] Some assets failed to cache:', err);\n      });\n    })\n  );\n  self.skipWaiting();\n});\n\nself.addEventListener('activate', (event) => {\n  console.log('[SW] Activating Service Worker');\n  event.waitUntil(\n    caches.keys().then((keys) => {\n      return Promise.all(\n        keys\n          .filter((key) => key !== STATIC_CACHE && key !== DYNAMIC_CACHE)\n          .map((key) => {\n            console.log('[SW] Removing old cache:', key);\n            return caches.delete(key);\n          })\n      );\n    })\n  );\n  self.clients.claim();\n});\n\nself.addEventListener('fetch', (event) => {\n  const { request } = event;\n  const url = new URL(request.url);\n\n  if (request.method !== 'GET') {\n    return;\n  }\n\n  if (url.protocol === 'ws:' || url.protocol === 'wss:') {\n    return;\n  }\n\n  if (url.pathname.startsWith('/api/') || url.pathname.startsWith('/game')) {\n    return;\n  }\n\n  event.respondWith(\n    caches.match(request).then((cachedResponse) => {\n      if (cachedResponse) {\n        fetch(request).then((networkResponse) => {\n          if (networkResponse && networkResponse.status === 200) {\n            caches.open(DYNAMIC_CACHE).then((cache) => {\n              cache.put(request, networkResponse.clone());\n            });\n          }\n        }).catch(() => {});\n        return cachedResponse;\n      }\n\n      return fetch(request).then((networkResponse) => {\n        if (!networkResponse || networkResponse.status !== 200) {\n          return networkResponse;\n        }\n\n        const responseToCache = networkResponse.clone();\n        caches.open(DYNAMIC_CACHE).then((cache) => {\n          cache.put(request, responseToCache);\n        });\n\n        return networkResponse;\n      }).catch(() => {\n        if (request.destination === 'document') {\n          return caches.match('/');\n        }\n        return new Response('Offline', { status: 503, statusText: 'Offline' });\n      });\n    })\n  );\n});\n\nself.addEventListener('message', (event) => {\n  if (event.data === 'skipWaiting') {\n    self.skipWaiting();\n  }\n});\n","path":null,"size_bytes":2825,"size_tokens":null},"client/src/components/ui/FriendsDialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { X, Search, UserPlus, Users, Check, XCircle, Loader2, Circle, Send } from \"lucide-react\";\nimport { useAccount, searchAccounts, sendFriendRequest, loadFriends, loadFriendRequests, acceptFriendRequest, rejectFriendRequest, removeFriend, sendRoomInvite, type Account, type FriendRequest } from \"@/lib/stores/useAccount\";\nimport { toast } from \"sonner\";\n\ninterface FriendsDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n  roomId?: string;\n}\n\nexport function FriendsDialog({ isOpen, onClose, roomId }: FriendsDialogProps) {\n  const { account, friends, friendRequests, setFriends, setFriendRequests } = useAccount();\n  const [tab, setTab] = useState<\"friends\" | \"search\" | \"requests\">(\"friends\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [searchResults, setSearchResults] = useState<Account[]>([]);\n  const [isSearching, setIsSearching] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n\n  useEffect(() => {\n    if (isOpen && account) {\n      loadFriends(account.id).then(setFriends);\n      loadFriendRequests(account.id).then(setFriendRequests);\n    }\n  }, [isOpen, account]);\n\n  useEffect(() => {\n    if (searchQuery.length >= 2) {\n      setIsSearching(true);\n      const timeout = setTimeout(async () => {\n        try {\n          const results = await searchAccounts(searchQuery);\n          setSearchResults(results.filter((r) => r.id !== account?.id));\n        } catch (err) {\n          console.error(\"Search error:\", err);\n        } finally {\n          setIsSearching(false);\n        }\n      }, 300);\n      return () => clearTimeout(timeout);\n    } else {\n      setSearchResults([]);\n    }\n  }, [searchQuery, account?.id]);\n\n  if (!isOpen || !account) return null;\n\n  const handleSendRequest = async (toUserId: number) => {\n    try {\n      await sendFriendRequest(account.id, toUserId);\n      toast.success(\"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØµØ¯Ø§Ù‚Ø©\");\n      setSearchResults(searchResults.filter((r) => r.id !== toUserId));\n    } catch (err: any) {\n      toast.error(err.message || \"ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØµØ¯Ø§Ù‚Ø©\");\n    }\n  };\n\n  const handleAcceptRequest = async (requestId: number) => {\n    try {\n      await acceptFriendRequest(requestId, account.id);\n      toast.success(\"ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ Ø§Ù„ØµØ¯Ø§Ù‚Ø©\");\n      loadFriends(account.id);\n    } catch (err: any) {\n      toast.error(err.message || \"ÙØ´Ù„ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨\");\n    }\n  };\n\n  const handleRejectRequest = async (requestId: number) => {\n    try {\n      await rejectFriendRequest(requestId);\n      toast.info(\"ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„ØµØ¯Ø§Ù‚Ø©\");\n    } catch (err) {\n      toast.error(\"ÙØ´Ù„ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨\");\n    }\n  };\n\n  const handleRemoveFriend = async (friendId: number) => {\n    try {\n      await removeFriend(account.id, friendId);\n      toast.info(\"ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµØ¯ÙŠÙ‚\");\n    } catch (err) {\n      toast.error(\"ÙØ´Ù„ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµØ¯ÙŠÙ‚\");\n    }\n  };\n\n  const handleInviteFriend = async (friendId: number) => {\n    if (!roomId) return;\n    try {\n      const result = await sendRoomInvite(account.id, friendId, roomId);\n      if (result.isOnline) {\n        toast.success(\"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¯Ø¹ÙˆØ©\");\n      } else {\n        toast.info(\"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„Ø¯Ø¹ÙˆØ© (Ø§Ù„ØµØ¯ÙŠÙ‚ ØºÙŠØ± Ù…ØªØµÙ„)\");\n      }\n    } catch (err: any) {\n      toast.error(err.message || \"ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¯Ø¹ÙˆØ©\");\n    }\n  };\n\n  const isFriend = (userId: number) => friends.some((f) => f.id === userId);\n  const hasPendingRequest = (userId: number) => {\n    return friendRequests.some((r) => r.fromUserId === userId || r.toUserId === userId);\n  };\n\n  return (\n    <div className=\"fixed inset-0 flex items-center justify-center bg-black/50 z-50 p-4\" dir=\"rtl\">\n      <div className=\"bg-white rounded-2xl shadow-2xl p-6 max-w-lg w-full max-h-[80vh] flex flex-col animate-in fade-in zoom-in duration-200\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h2 className=\"text-xl font-bold text-gray-800 flex items-center gap-2\">\n            <Users className=\"w-6 h-6 text-blue-500\" />\n            Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n          >\n            <X className=\"w-5 h-5 text-gray-500\" />\n          </button>\n        </div>\n\n        <div className=\"flex gap-2 mb-4\">\n          <button\n            onClick={() => setTab(\"friends\")}\n            className={`flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-colors ${\n              tab === \"friends\" ? \"bg-blue-500 text-white\" : \"bg-gray-100 text-gray-700 hover:bg-gray-200\"\n            }`}\n          >\n            Ø£ØµØ¯Ù‚Ø§Ø¦ÙŠ ({friends.length})\n          </button>\n          <button\n            onClick={() => setTab(\"search\")}\n            className={`flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-colors ${\n              tab === \"search\" ? \"bg-blue-500 text-white\" : \"bg-gray-100 text-gray-700 hover:bg-gray-200\"\n            }`}\n          >\n            Ø¨Ø­Ø«\n          </button>\n          <button\n            onClick={() => setTab(\"requests\")}\n            className={`flex-1 py-2 px-3 rounded-lg font-semibold text-sm transition-colors relative ${\n              tab === \"requests\" ? \"bg-blue-500 text-white\" : \"bg-gray-100 text-gray-700 hover:bg-gray-200\"\n            }`}\n          >\n            Ø§Ù„Ø·Ù„Ø¨Ø§Øª\n            {friendRequests.length > 0 && (\n              <span className=\"absolute -top-1 -left-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center\">\n                {friendRequests.length}\n              </span>\n            )}\n          </button>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto\">\n          {tab === \"friends\" && (\n            <div className=\"space-y-2\">\n              {friends.length === 0 ? (\n                <div className=\"text-center py-8 text-gray-500\">\n                  <Users className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                  <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¨Ø¹Ø¯</p>\n                  <p className=\"text-sm\">Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ØµØ¯Ù‚Ø§Ø¡ ÙˆØ£Ø¶ÙÙ‡Ù…!</p>\n                </div>\n              ) : (\n                friends.map((friend) => (\n                  <div key={friend.id} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-xl\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"relative\">\n                        <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold\">\n                          {friend.displayName.charAt(0)}\n                        </div>\n                        <Circle \n                          className={`absolute -bottom-0.5 -right-0.5 w-4 h-4 ${friend.isOnline ? 'text-green-500 fill-green-500' : 'text-gray-400 fill-gray-400'}`} \n                        />\n                      </div>\n                      <div>\n                        <p className=\"font-semibold text-gray-800\">{friend.displayName}</p>\n                        <p className=\"text-sm text-gray-500 font-mono\">@{friend.username}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      {roomId && (\n                        <button\n                          onClick={() => handleInviteFriend(friend.id)}\n                          className=\"p-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors\"\n                          title=\"Ø¯Ø¹ÙˆØ© Ù„Ù„ØºØ±ÙØ©\"\n                        >\n                          <Send className=\"w-4 h-4\" />\n                        </button>\n                      )}\n                      <button\n                        onClick={() => handleRemoveFriend(friend.id)}\n                        className=\"p-2 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-colors\"\n                        title=\"Ø¥Ø²Ø§Ù„Ø©\"\n                      >\n                        <XCircle className=\"w-4 h-4\" />\n                      </button>\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n          )}\n\n          {tab === \"search\" && (\n            <div className=\"space-y-4\">\n              <div className=\"relative\">\n                <Search className=\"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                <input\n                  type=\"text\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  placeholder=\"Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...\"\n                  className=\"w-full pr-10 pl-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 font-mono\"\n                  dir=\"ltr\"\n                />\n              </div>\n\n              {isSearching ? (\n                <div className=\"flex justify-center py-8\">\n                  <Loader2 className=\"w-8 h-8 animate-spin text-blue-500\" />\n                </div>\n              ) : searchResults.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {searchResults.map((user) => (\n                    <div key={user.id} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-xl\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-10 h-10 bg-gradient-to-br from-gray-400 to-gray-500 rounded-full flex items-center justify-center text-white font-bold\">\n                          {user.displayName.charAt(0)}\n                        </div>\n                        <div>\n                          <p className=\"font-semibold text-gray-800\">{user.displayName}</p>\n                          <p className=\"text-sm text-gray-500 font-mono\">@{user.username}</p>\n                        </div>\n                      </div>\n                      {isFriend(user.id) ? (\n                        <span className=\"text-green-600 text-sm font-semibold\">ØµØ¯ÙŠÙ‚</span>\n                      ) : hasPendingRequest(user.id) ? (\n                        <span className=\"text-yellow-600 text-sm font-semibold\">Ø·Ù„Ø¨ Ù…Ø¹Ù„Ù‚</span>\n                      ) : (\n                        <button\n                          onClick={() => handleSendRequest(user.id)}\n                          className=\"p-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors\"\n                        >\n                          <UserPlus className=\"w-4 h-4\" />\n                        </button>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              ) : searchQuery.length >= 2 ? (\n                <p className=\"text-center text-gray-500 py-4\">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>\n              ) : (\n                <p className=\"text-center text-gray-500 py-4\">Ø£Ø¯Ø®Ù„ Ø­Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø¨Ø­Ø«</p>\n              )}\n            </div>\n          )}\n\n          {tab === \"requests\" && (\n            <div className=\"space-y-2\">\n              {friendRequests.length === 0 ? (\n                <div className=\"text-center py-8 text-gray-500\">\n                  <UserPlus className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                  <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ØµØ¯Ø§Ù‚Ø©</p>\n                </div>\n              ) : (\n                friendRequests.map((request) => (\n                  <div key={request.id} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-xl\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold\">\n                        {request.fromUser?.displayName?.charAt(0) || \"?\"}\n                      </div>\n                      <div>\n                        <p className=\"font-semibold text-gray-800\">{request.fromUser?.displayName}</p>\n                        <p className=\"text-sm text-gray-500 font-mono\">@{request.fromUser?.username}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <button\n                        onClick={() => handleAcceptRequest(request.id)}\n                        className=\"p-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors\"\n                      >\n                        <Check className=\"w-4 h-4\" />\n                      </button>\n                      <button\n                        onClick={() => handleRejectRequest(request.id)}\n                        className=\"p-2 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-colors\"\n                      >\n                        <XCircle className=\"w-4 h-4\" />\n                      </button>\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":13039,"size_tokens":null}},"version":2}